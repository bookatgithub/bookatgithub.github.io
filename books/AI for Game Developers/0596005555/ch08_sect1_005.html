<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>8.5 Scripting Verbal Interaction</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch08_sect1_004.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch08_sect1_006.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch08_sect1_005"></A>
<H3 class="docSection1Title" id="">8.5 Scripting Verbal Interaction</H3>
<P class="docText">The benefits of scripting go beyond just making an AI opponent more sophisticated and challenging. Many types of games incorporate intelligent behavior in ways that aren't meant to be a direct challenge to the player. A role-playing game, for example, might provide the player with a series of subtle hints meant to move the story along. Scripting is an excellent way to enable the game designer to create a compelling story without the need to alter the actual game program.</P>
<P class="docText">Intelligent behavior can make a game more challenging, but verbal responses that are intelligent and appropriate to the situation can go even farther when creating an immersive environment for the player. Verbal interaction can range from helpful hints from a friendly nonplayer character to taunts from an adversary. Verbal interaction seems most intelligent and immersive when it relates to the current game situation. This means the game AI needs to check a given set of game parameters and then respond to them accordingly.</P>
<P class="docText">For example, how a player is armed might be one parameter that can be checked. We can then have an adversarial AI character comment on how ineffective that weapon will be once combat starts. This seems more intelligent and immersive because it's not just a random taunt. It applies to the current game situation. It makes it seem as though the computer-controlled characters are aware of what's happening in the game. A quick example of how this script might look is shown in <A class="docLink" HREF="#ch08exm09">Example 8-9</A>.</P>
<A NAME="ch08exm09"></A>
<H5 class="docExampleTitle">Example 8-9. Verbal taunt script</H5>
<PRE>
If (PlayerArmed ==Dagger)
   Say("What a cute little knife.");
If (PlayerArmed ==Bow)
   Say("Drop the bow now and I'll let you live.");
If (PlayerArmed ==Sword)
   Say("That sword will fit nicely in my collection.");
If (PlayerArmed ==BattleAxe)
   Say("You're too weak to wield that battle axe.");
</PRE><BR>


<P class="docText">As <A class="docLink" HREF="#ch08exm09">Example 8-9</A> shows, knowing a bit about the current game situation can add an immersive effect to gameplay. This is much more effective than simply adding random general taunts.</P>
<P class="docText">So, an important aspect of a scripting system is to enable the script writer to see what's happening inside the game engine. The more game elements the script can see, the better. <A class="docLink" HREF="#ch08_fig02">Figure 8-2</A> shows a hypothetical game scenario in which an evil giant is chasing the player. In this case, the game AI is able to use unique elements of the game state to supply a taunt appropriate to the situation. In this case, we know that the adversary is a giant, the player is a human, and the player is armed with a staff.</P>
<A NAME="ch08_fig02"></A><p><CENTER>
<H5 class="docFigureTitle">Figure 8-2. Giant taunt</H5>
<IMG BORDER="0" id="" SRC="images/0596005555/figs/ch08_fig02.jpg" ALT="figs/ch08_fig02.jpg">
</CENTER></p><br>
<P class="docText"><A class="docLink" HREF="#ch08exm10">Example 8-10</A> shows how the game AI might can be an appropriate taunt during a battle between a computer-controlled giant and a player-controlled human. In a real game you probably would want to add multiple responses for each given situation and then randomly select among them. This would help prevent the responses from becoming repetitive and predictable.</P>
<A NAME="ch08exm10"></A>
<H5 class="docExampleTitle">Example 8-10. Giant taunt script</H5>
<PRE>
If (Creature==Giant) and (player==Human)
   begin
      if (playerArmed==Staff)
         Say("You will need more than a staff, puny human!");
      if (playerArmed==Sword)
         Say("Drop your sword and I might not crush you!");
      if (playerArmed==Dagger)
         Say("Your tiny dagger is no match for my club!");
      end
</PRE><BR>


<P class="docText">Of course, this type of scripting isn't limited to adversarial characters that are out to kill the players. Benevolent computer-controlled characters can use the same techniques. This can help the script writer create an engaging and immersive plot. <A class="docLink" HREF="#ch08exm11">Example 8-11</A> shows how a script helps construct a plot and guide the player actions toward the game goals.</P>
<A NAME="ch08exm11"></A>
<H5 class="docExampleTitle">Example 8-11. Benevolent AI script</H5>
<PRE>
If (Creature==FriendlyWizard)
   begin
      if (playerHas==RedAmulet)
         Say("I see you found the Red Amulet.
              Bring it to the stone temple
              and you will be rewarded.");
   end
</PRE><BR>


<P class="docText">As <A class="docLink" HREF="#ch08exm11">Example 8-11</A> shows, a vital piece of information concerning where the amulet should be placed won't be revealed to the player until the amulet is found and the player confronts the friendly wizard.</P>
<P class="docText">The previous script examples show how game AI can respond in a given situation, but it's also sometimes necessary for game characters to have some type of verbal interaction with the player. This could be benevolent characters meant to provide the player with helpful information, or perhaps a less-than-honest character meant to intentionally mislead the player.</P>
<P class="docText">In this type of scenario, the player needs some mechanism to input text into the game. The game engine then makes the text strings available to the script system, which analyzes the text and provides an appropriate response. <A class="docLink" HREF="#ch08_fig03">Figure 8-3</A> shows how this might appear in an actual game.</P>
<A NAME="ch08_fig03"></A><p><CENTER>
<H5 class="docFigureTitle">Figure 8-3. Merlin</H5>
<IMG BORDER="0" id="" SRC="images/0596005555/figs/ch08_fig03.jpg" ALT="figs/ch08_fig03.jpg">
</CENTER></p><br>
<P class="docText">In the case of <A class="docLink" HREF="#ch08_fig03">Figure 8-3</A>, the player would type in the text "What is your name?" and the scripting system would return the text "I am Merlin." <A class="docLink" HREF="#ch08exm12">Example 8-12</A> shows a basic script that you could use to accomplish this.</P>
<A NAME="ch08exm12"></A>
<H5 class="docExampleTitle">Example 8-12. Basic "What is your name?" script</H5>
<PRE>
                    If Ask("What is your name?")
                       begin
                          Say("I am Merlin.");
                       end
</PRE><BR>


<P class="docText">Of course, <A class="docLink" HREF="#ch08exm12">Example 8-12</A> does have one serious flaw. It works only when the player types in the exact text of the question as it appears in the script. In reality, you can form a question in many ways. For example, what happens if the player enters one of the lines of text shown in <A class="docLink" HREF="#ch08exm13">Example 8-13</A>?</P>
<A NAME="ch08exm13"></A>
<H5 class="docExampleTitle">Example 8-13. Example player input</H5>
<PRE>
What's your name?
Whats your name?
What is your name.
What is thy name?
What is your name, Wizard?
Hello, what is your name?
</PRE><BR>


<P class="docText">As you can see, the script in <A class="docLink" HREF="#ch08exm12">Example 8-12</A> would fail for all the questions shown in <A class="docLink" HREF="#ch08exm13">Example 8-13</A>, even though it's quite obvious what's being asked. Not only can you ask a question in many ways, but we also have to consider the possibility that the player might not form the question in a correct manner. In fact, you can see that one of the example questions ends in a period rather than a question mark. We could have strict requirements for the player-entered text, but it would have the effect of removing the player from the immersive effect of the game whenever he made the inevitable minor error.</P>
<P class="docText">One alternative to checking each literal text string is to create a language parser to decipher each sentence to determine exactly what is being asked. For some games a sophisticated language parser might be appropriate; however, for most games there is a simpler approach. As you saw in <A class="docLink" HREF="#ch08exm13">Example 8-13</A>, you can form the same question in many ways, but if you'll notice, they all have something in common. They all contain the words "what" and "name." So, instead of checking for each literal text string, we can simply search for and respond to particular keywords. In this case, the scripting engine simply checks for the presence of given keywords within a text string.</P>
<P class="docText">As <A class="docLink" HREF="#ch08exm14">Example 8-14</A> shows, the script is checking for the presence of two keywords in the player-entered text. Using this approach, the script responds correctly to every question in <A class="docLink" HREF="#ch08exm13">Example 8-13</A>.</P>
<A NAME="ch08exm14"></A>
<H5 class="docExampleTitle">Example 8-14. Keyword scripting</H5>
<PRE>
If (Ask("what") and Ask("name") )
   begin
      Say("I am Merlin.");
   end
</PRE><BR>


<P class="docText">Now that we've shown you how to write a typical script to check player input for a given set of keywords, let's look at how the actual game engine checks player input for a given keyword. <A class="docLink" HREF="#ch08exm15">Example 8-15</A> shows how to do this.</P>
<A NAME="ch08exm15"></A>
<H5 class="docExampleTitle">Example 8-15. Searching for keywords</H5>
<PRE>
Boolean FoundKeyword(char inputText[kStringLength], char
searchFor[kStringLength])
{	
   char   inStr[kStringLength];
   char   searchStr[kStringLength];
   int    i;
   for (i=0;i&lt;=strlen(inputText);i++)
      {
         inStr[i]=inputText[i];
         if (((int)inStr[i]&gt;=65) &amp;&amp; ((int)inStr[i]&lt;=90))
            inStr[i]=(char)((int)inStr[i]+32);
      }
   for (i=0;i&lt;=strlen(searchFor);i++)
      {
         searchStr[i]=searchFor[i];
         if (((int)searchStr[i]&gt;=65) &amp;&amp;
             ((int)searchStr[i]&lt;=90))
            searchStr[i]=(char)((int)searchStr[i]+32);
      }
   if (strstr(inStr,searchStr)!=NULL)
      return (true);
	
   return (false);
}
</PRE><BR>


<P class="docText"><A class="docLink" HREF="#ch08exm15">Example 8-15</A> shows the actual code in the game engine that is invoked whenever the "Ask" function is called from the game designer's script. This function takes two parameters: <span class="docEmphasis">inputText</span>, which is the line of text the player entered, and <span class="docEmphasis">searchFor</span>, which is the keyword we want to search for. The first thing we do in this function is to convert both strings to all lowercase. Like many programming languages, C and C++ are case-sensitive. A string containing the text "Name" is not equal to a string containing the text "name." We can't rely on the player always using capitalization consistently or properly. The simplest solution is to convert all strings to lowercase. That way, it doesn't matter if the player enters all uppercase, all lowercase, or some combination.</P>
<P class="docText">Once we have two lowercase strings, we call the C function <span class="docEmphasis">strstr</span> to compare the text strings. The <span class="docEmphasis">strstr</span> function searches <span class="docEmphasis">inStr</span> for the first occurrence of <span class="docEmphasis">searchStr</span>. If <span class="docEmphasis">searchStr</span> is not found in <span class="docEmphasis">inStr</span>, a null pointer is returned.</P>

<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch08_sect1_004.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch08_sect1_006.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
