<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Hack 94 Determine Who Is on the System</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="bsdhks-CHP-9-SECT-6.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="bsdhks-CHP-9-SECT-8.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="bsdhks-CHP-9-SECT-7"></A>
<H3 class="docSection1Title">Hack 94 Determine Who Is on the System</H3><P class="docText"><IMG BORDER="0" ALIGN="absmiddle" width="14" height="36" SRC="images/0596006799/figs/beginner.gif" ALT="figs/beginner.gif"> <IMG BORDER="0" ALIGN="absmiddle" width="36" height="36" SRC="images/0596006799/figs/hack94.gif" ALT="figs/hack94.gif"></P>

<P class="docText"><span class="docEmphBold">As a system administrator, it pays to know
what's happening on your systems</span>.</P>

<P class="docText">Sure, you spend time reading your logs, but do you take advantage of
the other information-gathering utilities available to you? Silently,
in the background, your system tracks all kinds of neat information.
If you know enough to peek under the system hood, you can get a very
good view of what is occurring on the system at any given point in
time.</P>

<P><table border="0" bgcolor="black" cellspacing="0" cellpadding="1" width="90%" align="center"><tr><td><table bgcolor="white" width="100%" border="0" cellspacing="0" cellpadding="6"><tr><td width="60" valign="top"><img src="images/pushpin.gif" width="52" height="51"></td><td valign="top">
<P class="docText">For the experienced hacker, the output from these commands may
suggest interesting scripting possibilities.</P>
</td></tr></table></td></tr></table></P><br>

<A NAME="bsdhks-CHP-9-SECT-7.1"></A>

<H4 class="docSection2Title">9.7.1 Who's on First?</H4>

<P class="docText">Have you ever needed to know who logged into a system and for how
long? Use the <TT>users</TT> <A NAME="bsdhks-CHP-9-ITERM-3192"></A>
command to see who's
logged in now:</P>

<PRE>% <B>users</B>
dru biko</PRE><BR>


<P class="docText">Perhaps you prefer to know <A NAME="bsdhks-CHP-9-ITERM-3193"></A>
who is on which terminal. Try
<TT>who</TT>. Here, the <TT>H</TT> includes
column headers and the <TT>u</TT> shows each
user's idle time:</P>

<PRE>% <B>who -Hu</B>
NAME             LINE     TIME         IDLE  FROM            
dru              ttyv1    Jan 25 08:59 01:00 
biko             ttyv5    Jan 25 09:57   .   
dru              ttyp0    Jan 25 09:58 00:02 (hostname)</PRE><BR>


<P class="docText">Feel free to experiment with
<TT>who</TT>'s switches to find an output
that suits your needs. Here, <TT>dru</TT> and
<TT>biko</TT> have logged in physically at this
system's keyboard using <TT>v</TT>irtual
terminals 1 and 5. <TT>dru</TT> has also logged in over the
first <TT>p</TT>suedoterminal (over the network) from the
specified hostname.</P>

<P class="docText">To <A NAME="bsdhks-CHP-9-ITERM-3194"></A>
find out what
everyone is doing, use <TT>w</TT>:</P>

<PRE>% <B>w</B>
10:07AM  up  1:20, 9 users, load averages: 0.02, 0.02, 0.09
USER             TTY      FROM              LOGIN@  IDLE WHAT
dru              v1       -                 8:59AM  1:08 pine
biko             v5       -                 9:57AM     - w
dru              p0       hostname          9:58AM     4 -csh (csh)</PRE><BR>


<P><table border="0" bgcolor="black" cellspacing="0" cellpadding="1" width="90%" align="center"><tr><td><table bgcolor="white" width="100%" border="0" cellspacing="0" cellpadding="6"><tr><td width="60" valign="top"><img src="images/pushpin.gif" width="52" height="51"></td><td valign="top">
<P class="docText">If you're just interested in that first line of
output, use <TT>uptime</TT>.</P>
</td></tr></table></td></tr></table></P><br>

<P class="docText">Notice that as a regular user, I was easily able to find out who is
logged in, where they are, and what they're
currently doing. If you don't want regular users
knowing what commands other users are currently running, see  <A class="docLink" HREF="bsdhks-CHP-6-SECT-5.html#bsdhks-CHP-6-SECT-5"><span class="docEmphBold">[Hack #57]</span></A> .</P>


<A NAME="bsdhks-CHP-9-SECT-7.2"></A>

<H4 class="docSection2Title">9.7.2 When Did That Happen?</H4>

<P class="docText">You're <A NAME="bsdhks-CHP-9-ITERM-3195"></A>
not limited to finding out
what's happening at this particular moment. Use
<TT>lastlogin</TT> to see the most recent
<A NAME="bsdhks-CHP-9-ITERM-3196"></A>
time at which each of your users
logged in:</P>

<PRE>% <B>lastlogin</B>
dru        ttyv1                   Sun Jan 25 08:59:36 2004 
biko       ttyv5                   Sun Jan 25 09:57:18 2004 
dlavigne   ttyv6                   Sat Jan 24 09:48:32 2004 
dru        ttyp0    hostname       Sun Jan 25 09:58:50 2004 
rembackup  ttyp0    hostname       Fri Jan 23 01:00:00 2004</PRE><BR>


<P class="docText">For a slightly different output, <TT>last</TT>
<A NAME="bsdhks-CHP-9-ITERM-3197"></A>
can show who is
still logged in:</P>

<PRE>% <B>last | grep still</B>
dru        ttyp0    hostname       Sun Jan 25 09:58   still logged in
dru        ttyv1                   Sun Jan 25 08:59   still logged in
biko       ttyv5                   Sun Jan 25 09:57   still logged in</PRE><BR>


<P class="docText">Do you need a record of system
<A NAME="bsdhks-CHP-9-ITERM-3198"></A>

<A NAME="bsdhks-CHP-9-ITERM-3199"></A>
shutdowns or reboots? The
<I>/var/log/wtmp</I> database holds this information.
Use <TT>last</TT> to view the desired statistics:</P>

<PRE>% <B>last reboot</B>
reboot           ~                         Tue Jan 20 15:37
reboot           ~                         Tue Nov 25 07:24
reboot           ~                         Sun Aug  3 09:05
wtmp begins Tue Jul  1 15:27:26 EDT 2003

% <B>last shutdown</B>
shutdown         ~                         Wed Dec 24 22:14
wtmp begins Tue Jul  1 15:27:26 EDT 2003</PRE><BR>



<A NAME="bsdhks-CHP-9-SECT-7.3"></A>

<H4 class="docSection2Title">9.7.3 Details, Details</H4>

<P class="docText">Another option to consider is enabling <A NAME="bsdhks-CHP-9-ITERM-3200"></A>
 <A NAME="bsdhks-CHP-9-ITERM-3201"></A>
system accounting, which
maintains a database of extremely detailed statistics of every
process and subprocess that has been executed on a
<A NAME="bsdhks-CHP-9-ITERM-3202"></A>
system.</P>

<PRE># <B>touch /var/account/acct</B>
# <B>accton /var/account/acct</B></PRE><BR>


<P class="docText">Note that the <TT>accton</TT> command will fail if you
don't specify the name of the accounting log or if
that log doesn't already exist. Also, in a queer
case of logic, typing <TT>accton</TT> <span class="docEmphasis">with no
arguments</span> really turns accounting off.</P>

<P class="docText">Once accounting is enabled, <A NAME="bsdhks-CHP-9-ITERM-3203"></A>
use <TT>lastcomm</TT> to view
the contents of <I>/var/account/acct</I>:</P>

<PRE>% <B>lastcomm</B>
lastcomm    -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
man         -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
sh          -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
sh          -F    dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
less        -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
col         -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
groff       -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
grotty      -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
troff       -     dlavigne     ttyv6      0.08 secs Sun Jan 25 11:33
tbl         -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
zcat        -     dlavigne     ttyv6      0.00 secs Sun Jan 25 11:33
cron        -F    root         __         0.00 secs Sun Jan 25 11:33
sh          -     operator     __         0.00 secs Sun Jan 25 11:33
sh          -     operator     __         0.00 secs Sun Jan 25 11:33
dd          -     operator     __         0.00 secs Sun Jan 25 11:33
mv          -     operator     __         0.00 secs Sun Jan 25 11:33
mv          -     operator     __         0.00 secs Sun Jan 25 11:33
mv          -     operator     __         0.00 secs Sun Jan 25 11:33
rm          -     operator     __         0.00 secs Sun Jan 25 11:33
jot         -     operator     __         0.00 secs Sun Jan 25 11:33
accton      -     root         ttyv0      0.00 secs Sun Jan 25 11:32</PRE><BR>


<P class="docText">This comes from a quiet system one minute after enabling accounting.
A <TT>cron</TT> job happened to be running at the time,
hence the <TT>operator</TT> lines. The user
<TT>dlavigne6</TT> also opened up a manpage during that
period. Note all of the processes involved before
<TT>man</TT> actually started.</P>

<P><table border="0" bgcolor="black" cellspacing="0" cellpadding="1" width="90%" align="center"><tr><td><table bgcolor="white" width="100%" border="0" cellspacing="0" cellpadding="6"><tr><td width="60" valign="top"><img src="images/pushpin.gif" width="52" height="51"></td><td valign="top">
<P class="docText">This command can also show you which processes ended abnormally.
Search for the <TT>D</TT> flag, which indicates that the
process dumped core:</P>

<PRE>% <B>lastcomm | grep -w "D"</B></PRE><BR>

</td></tr></table></td></tr></table></P><br>

<P class="docText">Depending upon your security requirements, you may not want users to
have access to such detailed information. After all,
<TT>lastcomm</TT> will show every process run by every
user. Tightening permissions will fix that:</P>

<PRE># <B>chmod 600 /var/account/acct</B>
# <B>su dlavigne</B>
% <B>lastcomm</B>
lastcomm: /var/account/acct: Permission denied</PRE><BR>


<P class="docText">Also, if you're planning on using
<TT>lastcomm</TT> as an extra audit trail, consider
changing this file's flags  <A class="docLink" HREF="bsdhks-CHP-6-SECT-4.html#bsdhks-CHP-6-SECT-4"><span class="docEmphBold">[Hack #56]</span></A> . You'll also
want to have plenty of disk space on the filesystem holding the
database.</P>

<P class="docText">Finally, to enable system accounting when the system boots, add this
line <A NAME="bsdhks-CHP-9-ITERM-3204"></A>

<A NAME="bsdhks-CHP-9-ITERM-3205"></A>
to
<I>/etc/rc.conf</I>:</P>

<PRE>accounting_enable="YES"</PRE><BR>



<A NAME="bsdhks-CHP-9-SECT-7.4"></A>

<H4 class="docSection2Title">9.7.4 See Also</H4>
<UL><LI><P class="docList"><TT>man users</TT></P></LI><LI><P class="docList"><TT>man who</TT></P></LI><LI><P class="docList"><TT>man w</TT></P></LI><LI><P class="docList"><TT>man lastlogin</TT></P></LI><LI><P class="docList"><TT>man last</TT></P></LI><LI><P class="docList"><TT>man lastcomm</TT></P></LI></UL>


<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="bsdhks-CHP-9-SECT-6.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="bsdhks-CHP-9-SECT-8.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
