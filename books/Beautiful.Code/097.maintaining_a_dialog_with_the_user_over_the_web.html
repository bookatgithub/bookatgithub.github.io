<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link href="styles/globalstyle.css" type="text/css" rel="stylesheet"/>
<link title="medium" href="styles/two.css" type="text/css" rel="stylesheet"/>
<script src="scripts/main.js" type="text/javascript" language="javascript"></script>
<title>Section 13.2. Maintaining a Dialog with the User over the Web</title>
</head><body>
<DIV class=h3 style="MARGIN-TOP: 0px; PADDING-BOTTOM: 1em; WIDTH: 100%; PADDING-TOP: 0px"><SPAN>The Design of the Gene Sorte</SPAN><SPAN> &gt; Maintaining a Dialog with the User over the Web</SPAN></DIV>
<DIV></DIV>
<DIV>
<DIV><A name=maintaining_a_dialog_with_the_user_over_the_web></A>
<H3 class=docSection1Title id=-100000>13.2. Maintaining a Dialog with the User over the Web</H3>
<P class=docText><A name=The></A>The <A name=idx-CHP-13-1023></A><A name="a CGI"></A>Gene Sorter is a CGI script. When the user points her web browser to the Gene Sorter's URL (<A class=docLink href="http://genome.ucsc.edu/cgi-bin/hgNear" target=_blank>http://genome.ucsc.edu/cgi-bin/hgNear</A><A name="runs the"></A>), the web server runs the script and sends the output over the network. The script's output is an HTML form. When the user hits a button on the form, the web browser sends a URL to the web server that includes the values in the drop-down menus and other controls encoded as a series of <TT><I>variable=value</I></TT><A name="server runs"></A> pairs. The web server runs the script once more, passing the <TT><I>variable=value</I></TT><A name="script then"></A> pairs as input. The script then generates a new HTML form in response.<A name=idx-CHP-13-1024></A></P>
<P class=docText><A name="script is"></A>CGI scripts can be written in any language. The Gene Sorter script is actually a moderately large program written in C.</P>
<P class=docText><A name="script has"></A>A CGI script has both <A name=idx-CHP-13-1025></A><A name="to other"></A>advantages and disadvantages compared to other programs that interact with users on the desktop. CGI scripts are quite portable and do not need different versions to support users on Windows, Macintosh, and Linux desktops. On the other hand, their interactivity is only modest. Unless one resorts to JavaScript (which introduces serious portability issues of its own), the display will be updated only when the user presses a button and waits a second or two for a new web page. However, for most genomic purposes, CGI provides an acceptably interactive and very standard user interface.</P>
<P class=docText>The <A name=idx-CHP-13-1026></A>lifetime of a <A name=idx-CHP-13-1027></A><A name="starts in"></A>CGI script is very limited. It starts in response to the user clicking on something and finishes when it generates a web page. As a consequence, the script can't keep <A name=idx-CHP-13-1028></A><A name="information in"></A>long-term information in program variables. For very simple <A name=idx-CHP-13-1029></A><A name="the necessary"></A>CGI scripts, all of the necessary information is stored in the <TT><I>variable=value</I></TT> pairs (also known as <SPAN class=docEmphasis>CGI variables</SPAN>).</P>
<P class=docText><A name="scripts such"></A>However, for more complex scripts such as the <A name=idx-CHP-13-1030></A><A name="is not"></A>Gene Sorter, this is not sufficient because the script might need to remember the result of a control that the user set several screens back, but the web server sends only the CGI variables corresponding to the controls in the most recently submitted page. Our CGI scripts therefore need a way to store data for the long term.</P>
<P class=docText><A name="mechanisms CGI"></A>There are two mechanisms CGI provides for storing data not visible in a form's controls: <A name=idx-CHP-13-1031></A><A name="is stored"></A>hidden CGI variables and cookies. In a hidden CGI variable, the data is stored in the HTML in the form of <TT>&lt;INPUT&gt;</TT> <A name=idx-CHP-13-1032></A><A name=type></A>tags of type <TT>hidden</TT><A name="stored by"></A>. With cookies, the data is stored by the web browser and sent in the HTTP header.</P>
<P class=docText><A name="they were"></A>Cookies were somewhat controversial when they were first released, and some users would disable them. However, cookies can persist for years, while hidden variables disappear as soon as a web page is closed. Neither cookies nor hidden variable can store truly large amounts of data. The exact amount varies between web browsers, but generally it's not safe to try to save more than 4 KB of data via these mechanisms.</P>
<P class=docText><A name="To exploit"></A>To exploit both cookies and hidden variables, the Gene Sorter team developed a "<A name=idx-CHP-13-1033></A><A name="the cookie"></A>cart" object that integrates the cookie and hidden variable mechanisms with an <A name=idx-CHP-13-1034></A><A name="maintains two"></A>SQL database. The cart maintains two tables, one associated with a user and one associated with a web session. The tables are of the same format, consisting of a key column, a blob field containing all of the <TT><I>variable=valuepairs</I></TT><A name="same format"></A> in the same format they are passed in the URL, and fields that track the usage times and access counts.</P>
<P class=docText>A <A name=idx-CHP-13-1035></A><A name="user table"></A>key into the user table is kept in a persistent cookie, and a <A name=idx-CHP-13-1036></A><A name="CGI variable"></A>key into the session table is kept in a hidden CGI variable. On startup, the script looks for the <A name=idx-CHP-13-1037></A><A name="in a"></A>user key in a cookie. If it finds it, it loads the associated <TT><I>variable=value</I></TT><A name="If it"></A> pairs into a hash table. If it doesn't find the cookie, it generates a new user key, and the hash table remains empty.</P>
<P class=docText>Next, the script looks for the <A name=idx-CHP-13-1038></A><A name="variables from"></A>session key and loads the variables from it, replacing any variables that are already in the hash. Finally, any new CGI variables are loaded on top of whatever is in hash.</P>
<P class=docText><A name="A series"></A>A series of library routines allows the script to read and write variables in the cart's hash. As the script exits, it updates the database tables with the current contents of the cart. If the user does not have cookies enabled, he will still be able to interact with Gene Sorter during a single session because the session key is not kept in cookies. Separating the session from the user keys also lets the user have the Gene Sorter going in two separate windows, without the two windows interfering with each other. The user level of the cart allows the Gene Sorter to start up in the same place it was last used, even after the user has moved onto another site in the meantime.</P>
<P class=docText>In the <A name=idx-CHP-13-1039></A><A class=docLink href="http://genome.ucsc.edu/" target=_blank>http://genome.ucsc.edu</A> implementation of the <A name=idx-CHP-13-1040></A><A name="the CGI"></A>Gene Sorter, all of the CGI scripts on the site share the same cart. Thus, the cart contains variables that are even more global than normal program variables. This is often useful. If the user is focusing on the mouse genome rather than the human genome in one of our programs, she probably wants to be using the mouse on other programs as well.</P>
<P class=docText><A name="have grown"></A>However, as our programs have grown, to avoid inadvertent <A name=idx-CHP-13-1041></A><A name="between cart"></A>name conflicts between cart variables, we have adopted the convention that cart variables (unless they truly are meant to be global) start with the name of the CGI script that uses them. Thus, most of the Gene <A name=idx-CHP-13-1042></A><A name=with></A>Sorter's cart variables start with <TT>hgNear_</TT><A name="separator because"></A>. (We use the underline character rather than a period as a separator because the period would interfere with JavaScript.)</P>
<P class=docText><A name="the cart"></A>All in all, the cart makes it relatively straightforward for the Gene Sorter to maintain the illusion of continuity to users, even though a separate instance of the program runs on each user click.</P>
<P class=docText>The <A name=idx-CHP-13-1043></A><A name="CGI script"></A>short lifetime of a CGI script does have some advantages. In particular, a CGI script does not need to worry much about memory leaks and closing files because these are all cleaned up by the operating system on program exit. This is particularly nice in the C language, which does not have automatic resource management.</P></DIV></DIV>
<p>&nbsp;</p><p>&nbsp;</p><!-- 仁·义 -->
</body></html>
