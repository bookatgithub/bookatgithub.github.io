<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 6.6.&nbsp; The switch Statement</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="toc.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch06lev1sec5.html><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href=ch06lev1sec7.html><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a name="ch06lev1sec6"></a>
<h3 class="docSection1Title">6.6. The <tt>switch</tt> Statement</h3>
<p class="docText">Deeply nested <tt>if else</tt> statements can often be correct syntactically and yet not correctly reflect the programmer's logic. For example, mistaken <tt>else if</tt> matchings are more likely to pass unnoticed. Adding a new condition and associated logic or making other changes to the statements is also hard to get right. A <B><a name="ch06term23"></a><a class="docLink" href="ch06lev1sec16.html#gloss06_23"><span class="docEmphStrong"><tt>switch</tt> statement</span></a></b> provides a more convenient way to write deeply nested if/else logic.</P>
<p class="docText">Suppose that we have been asked to count how often each of the five vowels appears in some segment of text. Our program logic is as follows:</p>
<UL><li><p class="docList"><a name="idd1e43032"></a><a name="idd1e43037"></a>Read each character until there are no more characters to read</p></LI><LI><p class="docList">Compare each character to the set of vowels</p></li><li><p class="docList">If the character matches one of the vowels, add 1 to that vowel's count</p></li><LI><p class="docList">Display the results</p></LI></UL>
<p class="docText">The program was used to analyze this chapter. Here is the output:</p>
<pre>
     <span class="docEmphStrong">Number of vowel a: 3499</span>
     <span class="docEmphStrong">Number of vowel e: 7132</span>
     <span class="docEmphStrong">Number of vowel i: 3577</span>
     <span class="docEmphStrong">Number of vowel o: 3530</span>
     <span class="docEmphStrong">Number of vowel u: 1185</span>
</pre><br>
<a name="ch06lev2sec4"></a>
<h4 class="docSection2Title">6.6.1. Using a <tt>switch</tt></H4>
<p class="docText">We can solve our problem most directly using a <tt>switch</tt> statement:</P>
<pre>
     char ch;
     // <span class="docEmphItalicAlt">initialize counters for each vowel</span>
     int aCnt = 0, eCnt = 0, iCnt = 0,
         oCnt = 0, uCnt = 0;
     while (cin &gt;&gt; ch) {
         // <span class="docEmphItalicAlt">if</span> <span class="docEmphasis">ch</span> <span class="docEmphItalicAlt">is a vowel, increment the appropriate counter</span>
         switch (ch) {
             case 'a':
                 ++aCnt;
                 break;
             case 'e':
                 ++eCnt;
                 break;
             case 'i':
                 ++iCnt;
                 break;
             case 'o':
                 ++oCnt;
                 break;
             case 'u':
                 ++uCnt;
                 break;
         }
     }
     // <span class="docEmphItalicAlt">print results</span>
     cout  &lt;&lt; "Number of vowel a: \t" &lt;&lt; aCnt &lt;&lt; '\n'
           &lt;&lt; "Number of vowel e: \t" &lt;&lt; eCnt &lt;&lt; '\n'
           &lt;&lt; "Number of vowel i: \t" &lt;&lt; iCnt &lt;&lt; '\n'
           &lt;&lt; "Number of vowel o: \t" &lt;&lt; oCnt &lt;&lt; '\n'
           &lt;&lt; "Number of vowel u: \t" &lt;&lt; uCnt &lt;&lt; endl;
</pre><br>
<p class="docText"><a name="idd1e43118"></a><a name="idd1e43127"></a><a name="idd1e43132"></a><a name="idd1e43137"></a><a name="idd1e43143"></a><a name="idd1e43149"></a><a name="idd1e43158"></a><a name="idd1e43165"></a>A <tt>switch</tt> statement executes by evaluating the parenthesized expression that follows the keyword <tt>switch</tt>. That expression must yield an integral result. The result of the expression is compared with the value associated with each <tt>case</tt>. The <tt>case</tt> keyword and its associated value together are known as the <b><a name="ch06term4"></a><a class="docLink" href="ch06lev1sec16.html#gloss06_04">case label</a></b>. Each case label's value must be a constant expression (<a class="docLink" href="ch02lev1sec7.html#ch02lev1sec7">Section 2.7</a>, p. <a class="docLink" href="ch02lev1sec7.html#ch02lev1sec7">62</a>). There is also a special case label, the <tt>default</tt> label, which we cover on page <a class="docLink" href="#ch06note13">203</a>.</p>
<p class="docText">If the expression matches the value of a <tt>case</tt> label, execution begins with the first statement following that label. Execution continues normally from that statement through the end of the <tt>switch</tt> or until a <tt>break</tt> statement. If no match is found, (and if there is no <tt>default</tt> label), execution falls through to the first statement following the <tt>switch</tt>. In this program, the <tt>switch</tt> is the only statement in the body of a <tt>while</tt>. Here, falling through the <tt>switch</tt> returns control to the <tt>while</tt> condition.</p>
<p class="docText">We'll look at <tt>break</tt> statements in <a class="docLink" href="ch06lev1sec10.html#ch06lev1sec10">Section 6.10</a> (p. <a class="docLink" href="ch06lev1sec10.html#ch06lev1sec10">212</a>). Briefly, a <tt>break</tt> statement interrupts the current control flow. In this case, the <tt>break</tt> TRansfers control out of the <tt>switch</tt>. Execution continues at the first statement following the <tt>switch</tt>. In this example, as we already know, transferring control to the statement following the <tt>switch</tt> returns control to the <tt>while</tt>.</p>

<a name="ch06lev2sec5"></a>
<h4 class="docSection2Title">6.6.2. Control Flow within a <tt>switch</tt></H4>
<p class="docText">It is essential to understand that execution flows across <tt>case</tt> labels.</p>
<a name="ch06note10"></a><div class="docNote"><p>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><TR><td width="60" valign="top"><img border="0" alt="" align="LEFT" width="50" height="54" SRC="images/0201721481/graphics/note.jpg;400478"></TD><td valign="top"><p class="docText"> It is a common misunderstanding to expect that only the statements associated with the matched <tt>case</tt> label are executed. However, execution continues <span class="docEmphasis">across</span> <tt>case</tt> boundaries until the end of the <tt>switch</tt> statement or a <tt>break</tt> is encountered.</p></td></tr></table><br>
</p></div><br>
<p class="docText">Sometimes this behavior is indeed correct. We want to execute the code for a particular label as well as the code for following labels. More often, we want to execute only the code particular to a given label. To avoid executing code for subsequent cases, the programmer must explicitly tell the compiler to stop execution by specifying a <tt>break</tt> statement. Under most conditions, the last statement before the next <tt>case</tt> label is <tt>break</tt>. For example, here is an incorrect implementation of our vowel-counting <tt>switch</tt> statement:</p>
<pre>
     // <span class="docEmphItalicAlt">warning: deliberately incorrect!</span>
     switch (ch) {
          case 'a':
               ++aCnt;   // <span class="docEmphItalicAlt">oops: should have a</span> <span class="docEmphasis">break</span> <span class="docEmphItalicAlt">statement</span>
          case 'e':
               ++eCnt;   // <span class="docEmphItalicAlt">oops: should have a</span> <span class="docEmphasis">break</span> <span class="docEmphItalicAlt">statement</span>
          case 'i':
               ++iCnt;   // <span class="docEmphItalicAlt">oops: should have a</span> <span class="docEmphasis">break</span> <span class="docEmphItalicAlt">statement</span>
          case 'o':
               ++oCnt;   // <span class="docEmphItalicAlt">oops: should have a</span> <span class="docEmphasis">break</span> <span class="docEmphItalicAlt">statement</span>
          case 'u':
               ++uCnt;   // <span class="docEmphItalicAlt">oops: should have a</span> <span class="docEmphasis">break</span> <span class="docEmphItalicAlt">statement</span>
     }
</pre><br>
<p class="docText">To understand what happens, we'll trace through this version assuming that value of <tt>ch</tt> is <tt>'i'</tt>. Execution begins following <tt>case 'i'</tt>thus incrementing <tt>iCnt</tt>. Execution does not stop there but continues across the <tt>case</tt> labels incrementing <tt>oCnt</tt> and <tt>uCnt</tt> as well. If <tt>ch</tt> had been <tt>'e'</tt>, then <tt>eCnt, iCnt, oCnt</tt>, and <tt>uCnt</tt> would all be incremented.</p>
<a name="ch06note11"></a><div class="docNote"><p>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td width="60" valign="top"><img border="0" alt="" align="LEFT" width="57" height="96" SRC="images/0201721481/graphics/beware.jpg;400478"></TD><TD valign="top"><p class="docText"> Forgetting to provide a <tt>break</tt> is a common source of bugs in <tt>switch</tt> statements.</p></TD></tr></table><br>
</P></div><BR>
<a name="ch06note12"></a><div class="docNote"><p>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td width="60" valign="top"><img border="0" alt="" align="LEFT" width="116" height="74" SRC="images/0201721481/graphics/bestpractices.jpg;400478"></td><td valign="top"><p class="docText"> Although it is not strictly necessary to specify a <tt>break</tt> statement after the last label of a <tt>switch</tt>, the safest course is to provide a <tt>break</tt> after every label, even the last. If an additional <tt>case</tt> label is added later, then the <tt>break</tt> is already in place.</P></td></TR></table><BR>
</p></div><br>
<a name="ch06lev3sec2"></a>
<h5 class="docSection3Title"><tt>break</tt> Statements Aren't Always Appropriate</H5>
<p class="docText">There is one common situation where the programmer might wish to omit a <tt>break</tt> statement from a <tt>case</tt> label, allowing the program to <span class="docEmphasis">fall through</span> multiple case labels. That happens when two or more values are to be handled by the same sequence of actions. Only a single value can be associated with a case label. To indicate a range, therefore, we typically stack case labels following one another. For example, if we wished only to count vowels seen rather than count the individual vowels, we might write the following:</P>
<pre>
     int vowelCnt = 0;
     // ...
     switch (ch)
     {
         // <span class="docEmphItalicAlt">any occurrence of a,e,i,o,u increments</span> <span class="docEmphasis">vowelCnt</span>
         case 'a':
         case 'e':
         case 'i':
         case 'o':
         case 'u':
             ++vowelCnt;
             break;
     }
</pre><br>
<p class="docText">Case labels need not appear on a new line. We could emphasize that the cases represent a range of values by listing them all on a single line:</p>
<pre>
     switch (ch)
     {
         // <span class="docEmphItalicAlt">alternative legal syntax</span>
         case 'a': case 'e': case 'i': case 'o': case 'u':
             ++vowelCnt;
             break;
     }
</pre><br>
<p class="docText"><a name="idd1e43489"></a><a name="idd1e43497"></a><a name="idd1e43502"></a><a name="idd1e43510"></a><a name="idd1e43519"></a>Less frequently, we deliberately omit a <tt>break</tt> because we want to execute code for one case and then continue into the next case, executing that code as well.</p>
<a name="ch06note13"></a><div class="docNote"><P>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td width="60" valign="top"><img border="0" alt="" align="LEFT" width="116" height="74" SRC="images/0201721481/graphics/bestpractices.jpg;400478"></TD><td valign="top"><p class="docText"> Deliberately omitting a <tt>break</tt> at the end of a case happens rarely enough that a comment explaining the logic should be provided.</p></TD></tr></table><BR>
</p></div><br>


<a name="ch06lev2sec6"></a>
<h4 class="docSection2Title">6.6.3. The <tt>default</tt> Label</h4>
<p class="docText">The <b><a name="ch06term10"></a><a class="docLink" href="ch06lev1sec16.html#gloss06_10"><span class="docEmphStrong"><tt>default</tt></span> label</a></b> provides the equivalent of an <tt>else</tt> clause. If no <tt>case</tt> label matches the value of the switch expression and there is a <tt>default</tt> label, then the statements following the <tt>default</tt> are executed. For example, we might add a counter to track how many nonvowels we read. We'll increment this counter, which we'll name <tt>otherCnt</tt>, in the <tt>default</tt> case:</p>
<pre>
         // <span class="docEmphItalicAlt">if</span> <span class="docEmphasis">ch</span> <span class="docEmphItalicAlt">is a vowel, increment the appropriate counter</span>
         switch (ch) {
             case 'a':
                 ++aCnt;
                 break;
             // <span class="docEmphItalicAlt">remaining vowel cases as before</span>
             default:
                 ++otherCnt;
                 break;
         }
     }
</pre><br>
<p class="docText">In this version, if <tt>ch</tt> is not a vowel, execution will fall through to the <tt>default</tt> label, and we'll increment <tt>otherCnt</tt>.</p>
<a name="ch06note14"></a><div class="docNote"><p>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td width="60" valign="top"><img border="0" alt="" align="LEFT" width="116" height="74" SRC="images/0201721481/graphics/bestpractices.jpg;400478"></td><td valign="top"><p class="docText"> It can be useful always to define a <tt>default</tt> label even if there is no processing to be done in the default case. Defining the label indicates to subsequent readers that the case was considered but that there is no work to be done.</P></TD></tr></table><BR>
</p></div><br>
<p class="docText">A label may not stand alone; it must precede a statement. If a <tt>switch</tt> ends with the <tt>default</tt> case in which there is no work to be done, then the <tt>default</tt> label must be followed by a null statement.</P>

<a name="ch06lev2sec7"></a>
<H4 class="docSection2Title">6.6.4. <tt>switch</tt> Expression and Case Labels</h4>
<p class="docText">The expression evaluated by a <tt>switch</tt> can be arbitrarily complex. In particular, the expression can define and intialize a variable:</p>
<pre>
     switch(int ival = get_response())
</pre><br>
<p class="docText">In this case, <tt>ival</tt> is initialized, and the value of <tt>ival</tt> is compared with each <tt>case</tt> label. The variable <tt>ival</tt> exists throughout the entire <tt>switch</tt> statement but not outside it.</p>
<p class="docText"><a name="idd1e43672"></a><a name="idd1e43677"></a><a name="idd1e43683"></a><a name="idd1e43690"></a><a name="idd1e43695"></a>Case labels must be constant integral expressions (<a class="docLink" href="ch02lev1sec7.html#ch02lev1sec7">Section 2.7</a>, p. <a class="docLink" href="ch02lev1sec7.html#ch02lev1sec7">62</a>). For example, the following labels result in compile-time errors:</p>
<pre>
     // <span class="docEmphItalicAlt">illegal case label values</span>
     case 3.14:  // <span class="docEmphItalicAlt">noninteger</span>
     case ival:  // <span class="docEmphItalicAlt">nonconstant</span>
</pre><BR>
<p class="docText">It is also an error for any two case labels to have the same value.</p>

<a name="ch06lev2sec8"></a>
<H4 class="docSection2Title">6.6.5. Variable Definitions inside a <tt>switch</tt></H4>
<p class="docText">Variables can be defined following only the last <tt>case</tt> or <tt>default</tt> label:</p>
<pre>
     case true:
          // <span class="docEmphItalicAlt">error: declaration precedes a case label</span>
          string file_name = get_file_name();
          break;
     case false:
          // ...
</pre><br>
<p class="docText">The reason for this rule is to prevent code that might jump over the definition and initialization of a variable.</p>
<p class="docText">Recall that a variable can be used from its point of definition until the end of the block in which it is defined. Now, consider what would happen if we could define a variable between two case labels. That variable would continue to exist until the end of the enclosing block. It could be used by code in case labels following the one in which it was defined. If the <tt>switch</tt> begins executing in one of these subsequent case labels, then the variable might be used even though it had not been defined.</P>
<p class="docText">If we need to define a variable for a particular case, we can do so by defining the variable inside a block, thereby ensuring that the variable can be used only where it is guaranteed to have been defined and initialized:</P>
<pre>
     case true:
         {
             // <span class="docEmphItalicAlt">ok: declaration statement within a statement block</span>
             string file_name = get_file_name();
             // ...
         }
       break;
         case false:
             // ...
</pre><br>


<a href="21001535.html"><img src="images/pixel.gif" alt="" width="1" height="1" border="0"></a><ul></ul></td></TR></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="toc.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch06lev1sec5.html><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href=ch06lev1sec7.html><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr></table>
</body></html>