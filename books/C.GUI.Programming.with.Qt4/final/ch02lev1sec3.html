<html>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<head>
<title>ch02lev1sec3.html</title>
<link rel="STYLESHEET" type="text/css" href="images/css1.css">
<link rel="STYLESHEET" type="text/css" href="images/css2.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec2.html><img src="images/prev.gif" width="20" height="20" border="0" align="absmiddle" alt="Previous Page"></a>
<a href=ch02lev1sec4.html><img src="images/next.gif" width="20" height="20" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<div style=""><div><a name="ch02lev1sec3"></a>

<h3 class="docSection1Title" id="-100000">Rapid Dialog Design</h3>
<p class="docText"><a name="iddle1982"></a><a name="iddle2100"></a><a name="iddle2141"></a><a name="iddle2589"></a><a name="iddle2835"></a><a name="iddle2934"></a><a name="iddle2937"></a><a name="iddle2963"></a><a name="iddle6106"></a><a name="iddle6107"></a><a name="iddle6112"></a><a name="iddle6120"></a><a name="iddle7961"></a><a name="iddle8264"></a><a name="Qt is"></a>&#81;t i&#115; design&#101;d t&#111; be pleasant and &#105;ntuitive to hand-code, and it is no&#116; unusual &#102;or p&#114;ogram&#109;ers to develop e&#110;t&#105;re Qt applic&#97;tions purely &#98;y writing C++ source code. Still, &#109;any programmers prefer to use a visual ap&#112;roach for designing forms, because they f&#105;nd it more natural and faster than hand-c&#111;di&#110;g, &#97;nd they wa&#110;t to be able to experi&#109;ent with and change designs more quickly &#97;nd easily &#116;han is po&#115;sible w&#105;th hand-coded forms.</p>
<p class="docText"><span class="docEmphasis">Q&#116; Designe&#114;</span><a name="options available"></a> expands &#116;he options &#97;vailable to programmers by providing a v&#105;sual design capability. <span class="docEmphasis">Qt Designer</span><a name="be used"></a> can b&#101; used to develop all or just some of a&#110; application's forms. Forms that are created using <span class="docEmphasis">Qt De&#115;igner</span> e&#110;d &#117;p as C++ code, &#115;o <span class="docEmphasis">Qt Designer</span><a name="imposes no"></a> can b&#101; used with a conventional t&#111;ol &#99;hain and imp&#111;se&#115; no special requ&#105;rement&#115; on the comp&#105;ler.</p>
<p class="docText">In this sec&#116;ion, we will use <span class="docEmphasis">Qt Designer</span><a name="Cell dialog"></a> to create the Go &#116;o Cell dialog shown in <a class="docLink" href="#ch02fig04">Figure 2.4</a>. Whether we do &#105;t in code or in <span class="docEmphasis">Qt Designer</span>, creating a dia&#108;og always involves the same fundamental st&#101;ps:</p>
<a name="ch02pro01"></a>





<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Create and initialize the child widgets.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Put the child widgets in layouts.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Set the tab order.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Establish signal–slot connections.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">Implement the dialog's custom slots.<br /><br />
</div></td></tr></table>
<a name="ch02fig04"></a><p><center>

<h5 class="docFigureTitle">&#70;i&#103;ure 2.4. T&#104;e Go to Cell dialog</h5>

<p class="docText">
<img border="0" id="" width="256" height="109" src="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcGlqZmlzaC9nNHAyZ2MwLjA-.jpg" alt="" /></p>



</center></p><br />
<p class="docText">To la&#117;nch <span class="docEmphasis">Qt Designer</span>, click <span class="docEmphRomanAlt">Qt by Trollt&#101;ch &#118;4.x.y|Designe&#114;</span> in the <span class="docEmphRomanAlt">&#83;tart</span> menu on Windo&#119;s, type <tt>desig&#110;er</tt> on the &#99;ommand line on U&#110;ix, or double-cl&#105;ck <span class="docEmphRomanAlt">Designer</span> in the Mac OS X Fin&#100;er. When <span class="docEmphasis">Qt Designer</span><a name="then click"></a> starts, it will pop u&#112; a list of templates. Click the &quot;Widget&quot; template, then c&#108;ick <span class="docEmphRomanAlt">Create</span><a name="for this"></a>. (&#84;he &quot;Dia&#108;og with But&#116;ons Bottom&quot; temp&#108;ate might look tempting, but for this &#101;xa&#109;ple we will c&#114;eate t&#104;e <span class="docEmphRomanAlt">OK</span> and <span class="docEmphRomanAlt">C&#97;ncel</span><a name="You should"></a> butt&#111;ns by hand to sh&#111;w how i&#116; is done.) You should now h&#97;ve a window called &quot;Untitled&quot;.</p>
<p class="docText">By default, <span class="docEmphasis">Qt Desig&#110;er</span><a name="interface consists"></a>'s user interface consists of severa&#108; top-level windows. If you prefer an MDI-style int&#101;rf&#97;ce, with on&#101; to&#112;-level window an&#100; several subwindows, as sh&#111;wn &#105;n <a class="docLink" href="#ch02fig05">Figure 2.5</a>, click <span class="docEmphRomanAlt">&#69;dit|Prefere&#110;ces</span> a&#110;d &#115;et the user inte&#114;face mode &#116;o <span class="docEmphRomanAlt">Docked Window</span>.</p>

<p class="docText"></p><a name="ch02fig05"></a><p><center>

<h5 class="docFigureTitle">Figure 2.5. <span class="docEmphasis">Qt Designer</span> i&#110; docked window mode &#111;n Windows Vista</h5>
<p class="docText"><div class="st1"><a target="_blank" href="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzZ3BpYWZpc2gvLjV0bDJnYzBfMHBq.jpg">[View full size image]</a></div><img border="0" id="" width="500" height="341" src="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcGlqZmlzaC9nNXAyZ2MwLjA-.jpg" alt="" /></p>
</center></p><br />
<p class="docText"><a name="iddle3521"></a><a name="iddle4104"></a><a name="iddle4542"></a><a name="iddle7590"></a><a name="iddle8578"></a><a name="place them"></a>The first step is to cr&#101;ate the child widgets and place them on t&#104;e form. &#67;reate one &#108;abel, one li&#110;e editor, one ho&#114;izontal spacer, and two push b&#117;ttons. For &#101;ac&#104; item, d&#114;ag its na&#109;e or icon fro&#109; <span class="docEmphasis"><a name="Qt Designer"></a>Qt Designer</span><a name="and drop"></a>'s widget &#98;ox and drop the item r&#111;ughly where it shoul&#100; go on the form. The spacer i&#116;em, which is invisible in the final form, is shown in <span class="docEmphasis">Qt Desig&#110;er</span><a name="a blue"></a> as a blue spring.</p>
<p class="docText"><a name="make it"></a>Now drag the bottom of the fo&#114;m up to &#109;ake it short&#101;r. T&#104;is should produce a f&#111;rm that is similar to <a class="docLink" href="#ch02fig06">Figure 2.6</a><a name="the items"></a>. Don't spend to&#111; mu&#99;h time posit&#105;oning t&#104;e items on the f&#111;rm; &#81;t's layout mana&#103;ers will lay t&#104;em out precisely later on.</p>
<a name="ch02fig06"></a><p><center>

<h5 class="docFigureTitle">Fig&#117;re 2.6. The form with some widgets</h5>

<p class="docText">
<img border="0" id="" width="324" height="118" src="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcGlqZmlzaC9nNnAyZ2MwLjA-.jpg" alt="" /></p>



</center></p><br />
<p class="docText">Set ea&#99;h widget's properties using <span class="docEmphasis">Qt Designer</span>'s &#112;roperty editor:</p>
<a name="ch02pro02"></a>





<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Click the text label. Make sure that its <tt>objectName</tt> property is &quot;label&quot; and set the <tt>text</tt> property to &quot;&amp;Cell Location:&quot;.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Click the line editor. Make sure that the <tt>objectName</tt> property is &quot;lineEdit&quot;.<br /><br />
</div></td></tr><tr><td></td><td></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText"><a name="iddle1374"></a><a name="iddle1403"></a><a name="iddle1425"></a><a name="iddle1433"></a><a name="iddle2055"></a><a name="iddle3059"></a><a name="iddle3431"></a><a name="iddle3488"></a><a name="iddle3496"></a><a name="iddle4572"></a><a name="iddle6113"></a><a name="iddle7428"></a><a name="iddle8435"></a>Click the first button. Set the <tt>objectName</tt> property to &quot;okButton&quot;, the <tt>enabled</tt> property to &quot;false&quot;, the <tt>text</tt> property to &quot;OK&quot;, and the <tt>default</tt> property to &quot;true&quot;.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Click the second button. Set the <tt>objectName</tt> property to &quot;cancelButton&quot; and the <tt>text</tt> property to &quot;Cancel&quot;.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">Click the form's background to select the form itself. Set the <tt>objectName</tt> property to &quot;GoToCellDialog&quot; and the <tt>windowTitle</tt> property to &quot;Go to Cell&quot;.<br /><br />
</div></td></tr></table>
<p class="docText"><a name="shows"></a>All the widgets look fine &#110;o&#119;, except the t&#101;xt &#108;abel, which shows <span class="docEmphRomanAlt">&amp;Cell Location</span>. &#67;lick <span class="docEmphRomanAlt">Edit|Edit Buddies</span><a name="allows you"></a> to enter a special &#109;ode that all&#111;ws &#121;ou &#116;o set buddi&#101;s. N&#101;xt, click the lab&#101;l and &#100;rag the red arrow line &#116;o the line editor, then rele&#97;se. The label should now appear as <span class="docEmphRomanAlt"><span class="docEmphUl">C</span>el&#108; Location</span>, as shown in <a class="docLink" href="#ch02fig07">Figure 2.7</a>, and have the line &#101;di&#116;or as its &#98;uddy. Click <span class="docEmphRomanAlt">&#69;dit|Edit Widgets</span> to le&#97;ve buddy mode.</p>
<a name="ch02fig07"></a><p><center>

<h5 class="docFigureTitle">Figure 2.7. T&#104;e form &#119;ith propert&#105;es set</h5>

<p class="docText">
<img border="0" id="" width="324" height="118" src="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcGlqZmlzaC9nN3AyZ2MwLjA-.jpg" alt="" /></p>



</center></p><br />
<p class="docText"><a name="widgets on"></a>T&#104;e next step is t&#111; la&#121; out the widg&#101;ts on t&#104;e form:</p>
<a name="ch02pro03"></a>




<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Click the <span class="docEmphRomanAlt">Cell Location</span> label and press <span class="docEmphRomanAlt">Shift</span> as you click the line editor next to it so that they are both selected. Click <span class="docEmphRomanAlt">Form|Lay Out Horizontally</span>.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Click the spacer, then hold <span class="docEmphRomanAlt">Shift</span> as you click the form's <span class="docEmphRomanAlt">OK</span> and <span class="docEmphRomanAlt">Cancel</span> buttons. Click <span class="docEmphRomanAlt">Form|Lay Out Horizontally</span>.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Click the background of the form to deselect any selected items, then click <span class="docEmphRomanAlt">Form|Lay Out Vertically</span>.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Click <span class="docEmphRomanAlt">Form|Adjust Size</span> to resize the form to its preferred size.<br /><br />
</div></td></tr></table>
<p class="docText"><a name="red lines"></a>The red lines that appea&#114; on the form show the layouts that have bee&#110; created, as shown in <a class="docLink" href="#ch02fig08">Figure 2.8</a>. They don't appear whe&#110; the form is run.</p>
<a name="ch02fig08"></a><p><center>

<h5 class="docFigureTitle">Figure 2.8. The form with the layouts</h5>

<p class="docText">
<img border="0" id="" width="250" height="107" src="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcGlqZmlzaC9nOHAyZ2MwLjA-.jpg" alt="" /></p>



</center></p><br />
<p class="docText"><a name="iddle2790"></a><a name="iddle4421"></a><a name="iddle5337"></a><a name="iddle6116"></a><a name="iddle6123"></a><a name="iddle7911"></a><a name="iddle8265"></a><a name="iddle8269"></a><a name="iddle8278"></a><a name="iddle8362"></a>Now cli&#99;k <span class="docEmphRomanAlt">Edit|Edit T&#97;b Order</span><a name="every widget"></a>. A n&#117;mber in a b&#108;ue rectangle will appear next to e&#118;ery widget that can accept focus, as shown i&#110; <a class="docLink" href="#ch02fig09">Figure 2.9</a><a name="Click each"></a>. C&#108;ick each wi&#100;g&#101;t in t&#117;rn in the o&#114;der you want them &#116;o accept focu&#115;, then click <span class="docEmphRomanAlt">Edit|Edit Widgets</span><a name="tab order"></a> to leave t&#97;b order mode.</p>
<a name="ch02fig09"></a><p><center>

<h5 class="docFigureTitle"><a name="Setting the"></a>Figure 2.9. Sett&#105;ng the form's tab order</h5>

<p class="docText">
<img border="0" id="" width="250" height="107" src="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcGlqZmlzaC9nOXAyZ2MwLjA-.jpg" alt="" /></p>



</center></p><br />
<p class="docText">To previ&#101;w the dialog, click the <span class="docEmphRomanAlt">Form|Preview</span> menu option. Check &#116;he tab or&#100;e&#114; by pre&#115;sing <span class="docEmphRomanAlt">Tab</span><a name="title bar"></a> repeatedly. Cl&#111;se the dialog using the c&#108;ose button &#105;n the ti&#116;le bar.</p>
<p class="docText">Sa&#118;e the dialog as <tt>go&#116;ocelldi&#97;log.ui</tt> in a di&#114;ectory ca&#108;led <tt>gotocell</tt>, and create a <tt>main.cpp</tt><a name="using a"></a> fil&#101; in the same directory using a pla&#105;n text editor:</p>
<div class="docText"><pre>#include &lt;QApplication&gt;
#include &lt;QDialog&gt;

#include "ui_gotocelldialog.h"

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);

    Ui::GoToCellDialog ui;
    QDialog *dialog = new QDialog;
    ui.setupUi(dialog);
    dialog-&gt;show();

    return app.exec();
}</pre></div><br />
<p class="docText">Now run <tt>qmake</tt> to create a <tt>.p&#114;o</tt> file and a makefile (<tt>qmake -project</tt>; <tt>qmake gotocell.pro</tt>). The <tt>q&#109;ake</tt><a name="file"></a> tool is s&#109;art enough t&#111; de&#116;ect the user interface f&#105;le <tt>gotocelldialog.ui</tt><a name="rules to"></a> and to gene&#114;ate th&#101; ap&#112;rop&#114;iate makefile ru&#108;es to invok&#101; <tt>uic</tt>, Qt's user int&#101;rface compil&#101;r. The <tt>uic</tt> tool converts <tt>got&#111;celldialog.ui</tt> into C++ and puts the res&#117;lt in <tt>ui_gotocelldialog.h</tt>.</p>
<p class="docText">The generated <tt>ui_gotoce&#108;ldialog.h</tt> file contains the definition of the <tt>Ui::GoT&#111;Ce&#108;lDialog</tt> cl&#97;ss, which i&#115; a C++ equivalent of the <tt>go&#116;ocelldialog.ui</tt><a name="child widgets"></a> file. The cl&#97;ss declar&#101;s m&#101;mb&#101;r variables t&#104;at sto&#114;e the form'&#115; child widgets a&#110;d layouts, and a <tt>setupUi()</tt><a name="that initializes"></a> function th&#97;t initializes the form. The genera&#116;ed class looks like this:</p>
<div class="docText"><pre>class Ui::GoToCellDialog
{
public:
    QLabel *label;
    QLineEdit *lineEdit;
    QSpacerItem *spacerItem;
    QPushButton *okButton;
    QPushButton *cancelButton;
    ...

    void setupUi(QWidget *widget) {
        ...
    }
};</pre></div><br />
<p class="docText"><a name="iddle2933"></a><a name="iddle3944"></a><a name="iddle4924"></a><a name="iddle4926"></a><a name="iddle7408"></a><a name="iddle7833"></a><a name="iddle7875"></a><a name="form in"></a>The generated class do&#101;sn't have any base class. When we use the form in <tt>main.cpp</tt><a name="we create"></a>, we &#99;reate a <tt>QDia&#108;og</tt><a name="it to"></a> and pass &#105;t to <tt>set&#117;pUi()</tt>.</p>
<p class="docText"><a name="you run"></a>If you run the prog&#114;am now, the dialog will work, but it do&#101;sn'&#116; functio&#110; e&#120;actly as we wan&#116;:</p>
<ul><li><p class="docList">The <span class="docEmphRomanAlt">OK</span> bu&#116;ton is always disable&#100;.</p></li><li><p class="docList">The <span class="docEmphRomanAlt">Canc&#101;l</span> button does nothing.</p></li><li><p class="docList"><a name="valid cell"></a>The &#108;ine editor accepts any text, instead &#111;f accepting only valid cell locations.</p></li></ul>
<p class="docText"><a name="function properly"></a>We can make the &#100;ialog function properly by writing some code. The clea&#110;e&#115;t appro&#97;ch is to cr&#101;ate a new c&#108;ass that is derived from bot&#104; <tt>QDial&#111;g</tt> a&#110;d <tt>&#85;i::GoToCell&#68;ialog</tt><a name="that any"></a> and t&#104;at implements the &#109;issing functionalit&#121; (thus proving the adage that any s&#111;ftware problem can be solved simply by ad&#100;ing another layer of ind&#105;rection). Our naming convention is to give t&#104;is new &#99;lass the sam&#101; na&#109;e as the <tt>uic</tt>-generated c&#108;ass but without the <tt>Ui::</tt> pref&#105;x.</p>
<p class="docText"><a name="called"></a>Using &#97; text edit&#111;r, c&#114;eate a file &#99;alled <tt>gotoc&#101;lldi&#97;log.h</tt> that contains the &#102;ollowing code:</p>
<div class="docText"><pre>#ifndef GOTOCELLDIALOG_H
#define GOTOCELLDIALOG_H

#include &lt;QDialog&gt;

#include "ui_gotocelldialog.h"

class GoToCellDialog : public QDialog, public Ui::GoToCellDialog
{
    Q_OBJECT

public:
    GoToCellDialog(QWidget *parent = 0);

private slots:
    void on_lineEdit_textChanged();
};

#endif</pre></div><br />
<p class="docText"><a name="to access"></a>Here, we h&#97;ve used public inheritance because we want to acces&#115; the dialog's widgets from outside the dialog. The im&#112;lementation belongs in the <tt>gotocelldialog.c&#112;p</tt> fi&#108;e:</p>
<div class="docText"><pre>#include &lt;QtGui&gt;

#include "gotocelldialog.h"

GoToCellDialog::GoToCellDialog(QWidget *parent)
    : QDialog(parent)
{
    setupUi(this);

    QRegExp regExp("[A-Za-z][1-9][0-9]{0,2}");
    lineEdit-&gt;setValidator(new QRegExpValidator(regExp, this));

    connect(okButton, SIGNAL(clicked()), this, SLOT(accept()));
    connect(cancelButton, SIGNAL(clicked()), this, SLOT(reject()));
}

void GoToCellDialog::on_lineEdit_textChanged()
{
    okButton-&gt;setEnabled(lineEdit-&gt;hasAcceptableInput());
}</pre></div><br />
<p class="docText"><a name="iddle1142"></a><a name="iddle1261"></a><a name="iddle1552"></a><a name="iddle2081"></a><a name="iddle2325"></a><a name="iddle2941"></a><a name="iddle2942"></a><a name="iddle2981"></a><a name="iddle3010"></a><a name="iddle3783"></a><a name="iddle3945"></a><a name="iddle3990"></a><a name="iddle3991"></a><a name="iddle4101"></a><a name="iddle4132"></a><a name="iddle4133"></a><a name="iddle4257"></a><a name="iddle4262"></a><a name="iddle4977"></a><a name="iddle5219"></a><a name="iddle5268"></a><a name="iddle5272"></a><a name="iddle5673"></a><a name="iddle5677"></a><a name="iddle6445"></a><a name="iddle6828"></a><a name="iddle7446"></a><a name="iddle7521"></a><a name="iddle8007"></a><a name="iddle8382"></a><a name="iddle8574"></a><a name="page_28"></a><a name="the constructor"></a>In the con&#115;tructo&#114;, we call <tt>setupUi()</tt> to initial&#105;ze the form. Thanks to multip&#108;e inherita&#110;c&#101;, we &#99;an access <tt>Ui::GoT&#111;Ce&#108;lDialog</tt>'s memb&#101;rs di&#114;ectly. After creating the u&#115;er interface, <tt>setupUi()</tt><a name="convention"></a> will also &#97;utomatically connect any slots that follow the naming &#99;onvention <tt>on_</tt><span class="docEmphasis"><tt>objectName</tt></span><tt>_</tt><span class="docEmphasis"><tt>signalName</tt></span><tt>()</tt><a name="to the"></a> to the correspond&#105;ng <span class="docEmphasis"><tt>obje&#99;tName</tt></span>'s <span class="docEmphasis"><tt>sign&#97;lName</tt></span><tt>()</tt><a name="this means"></a> sig&#110;al. In our example, t&#104;is means that <tt>setupUi()</tt><a name="establish the"></a> w&#105;ll esta&#98;lish the fo&#108;lowing sig&#110;al–slot conne&#99;tion:</p>
<div class="docText"><pre>connect(lineEdit, SIGNAL(textChanged(const QString &amp;)),
        this, SLOT(on_lineEdit_textChanged()));</pre></div><br />
<p class="docText"><a name="restrict the"></a>Also in &#116;he constructor, &#119;e set up a validator t&#111; restrict the range of &#116;he input. Qt provides three built-in val&#105;dator classes: <tt>QIntValidator</tt>, <tt>QDoubleValidator</tt>, and <tt>QR&#101;gExpValidator</tt>. Here we use a <tt>QRegE&#120;p&#86;alidato&#114;</tt><a name="Allow one"></a> with t&#104;e regular expression &quot;[A-Za-z][1-9][0-9]{0,2}&quot;, &#119;hich means: Allow one uppercase or lowe&#114;case l&#101;tt&#101;r, f&#111;llowe&#100; b&#121; one di&#103;it in the range 1 &#116;o 9, followed by zero, one, o&#114; two digits each in the range 0 to 9. (For an introdu&#99;tion to regular expressions, see the <tt>QRegExp</tt> class docume&#110;tation.)</p>
<p class="docText">By passing <tt>this</tt> to the <tt>QRegExpValidator</tt> c&#111;ns&#116;ructor, w&#101; ma&#107;e it a child of the <tt>&#71;oToCellDialog</tt> object. By do&#105;ng so, we &#100;o&#110;'t &#104;ave to worry about d&#101;le&#116;ing the <tt>QRegE&#120;pValidato&#114;</tt> later; it will be deleted autom&#97;tically when its parent is delet&#101;d.</p>
<p class="docText">Qt's parent–child mechanism is implement&#101;d in <tt>QObject</tt><a name="a parent"></a>. When we create an obj&#101;ct (&#97; widget, va&#108;idator, or a&#110;y other k&#105;nd) with a parent, the parent ad&#100;s &#116;he objec&#116; to the li&#115;t of its children. Whe&#110; t&#104;e parent &#105;s deleted, i&#116; walks through its list of children and &#100;eletes each child. The children t&#104;emselves then delete all of their children, and &#115;o on recursively until none remain. The parent–ch&#105;ld mech&#97;nism grea&#116;ly simpl&#105;fies memory management, &#114;educing the risk of mem&#111;ry &#108;eaks. The on&#108;y objects w&#101; must call <tt>d&#101;le&#116;e</tt><a name="with"></a> on are the obje&#99;ts we create with <tt>new</tt><a name="a child"></a> and t&#104;at have no parent. &#65;nd if we delete a child object &#98;efore its parent, Qt will automatically remove that object from the pa&#114;ent's list of children.</p>
<p class="docText"><a name="iddle1052"></a><a name="iddle1063"></a><a name="iddle1434"></a><a name="iddle2139"></a><a name="iddle4259"></a><a name="iddle4930"></a><a name="iddle4932"></a><a name="iddle4934"></a><a name="iddle4940"></a><a name="iddle4944"></a><a name="iddle6834"></a><a name="iddle6837"></a><a name="the parent"></a>For widgets, the parent &#104;as an a&#100;d&#105;tional &#109;eaning: Child widgets a&#114;e shown within the pa&#114;ent's a&#114;ea. Whe&#110; w&#101; delete the par&#101;nt &#119;idget, not only does the c&#104;ild vani&#115;h from memory, it also vanis&#104;es from the screen.</p>
<p class="docText">At the end of the constructor, &#119;e connect the <span class="docEmphRomanAlt">OK</span> button to <tt>QDialog</tt>'s <tt>accept()</tt> slot and t&#104;e <span class="docEmphRomanAlt">Cancel</span> button to the <tt>reject()</tt> slot. Both slots close t&#104;e dial&#111;g, b&#117;t <tt>accept()</tt> s&#101;ts the dialog's res&#117;lt value to <tt>QDialog::Accepted</tt> (which &#101;qu&#97;ls 1), and <tt>rej&#101;ct()</tt> &#115;ets the result &#116;o <tt>QDialo&#103;::Rejected</tt><a name="to see"></a> (which eq&#117;als 0). When we us&#101; this dialog, we can u&#115;e the result to see if the user click&#101;d <span class="docEmphRomanAlt">OK</span><a name="and act"></a> and act accordingly.</p>
<p class="docText">The <tt>on_lineEdit_textC&#104;anged()</tt><a name="or disables"></a> slot enables or disables the <span class="docEmphRomanAlt">OK</span><a name="to whether"></a> button, according to wh&#101;th&#101;r t&#104;e line &#101;ditor contains a val&#105;d cell location. <tt>QLineEd&#105;t::hasAc&#99;eptableInp&#117;t()</tt> uses the &#118;alidator we se&#116; in the co&#110;structor.</p>
<p class="docText">T&#104;is complet&#101;s the dialog. We ca&#110; now rewrite <tt>main.cpp</tt> to use it:</p>
<div class="docText"><pre>#include &lt;QApplication&gt;

#include "gotocelldialog.h"

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);
    GoToCellDialog *dialog = new GoToCellDialog;
    dialog-&gt;show();
    return app.exec();
}</pre></div><br />
<p class="docText">R&#101;generate <tt>gotocell.pro</tt> using <tt>qmak&#101; -project</tt> (since we have added source files to th&#101; pr&#111;je&#99;t), run <tt>qmake g&#111;tocell.pro</tt><a name="Type "></a> to upda&#116;e the makefile, then build a&#110;d &#114;un the &#97;pplicati&#111;n again. T&#121;pe &quot;&#65;12&quot; in the line edit&#111;r, and &#110;otice that the <span class="docEmphRomanAlt">OK</span><a name="random text"></a> button becom&#101;s enabled. Try typing some random &#116;ext to see how the validator does its job. C&#108;ick <span class="docEmphRomanAlt">Cancel</span> to close the dialog.</p>
<p class="docText"><a name="buttons are"></a>The dialog work&#115; correc&#116;ly, but fo&#114; Mac OS &#88; users, the buttons are the wrong &#119;ay round. We chose to add each button indi&#118;idually, to &#115;how how &#105;t was do&#110;e, but really w&#101; sh&#111;uld h&#97;ve used a <tt>QDialogButt&#111;nBox</tt><a name="we specify"></a>, a widget that cont&#97;ins the buttons we specify and t&#104;at presents them in the correct &#119;ay for the window system on which th&#101; ap&#112;lic&#97;tion is be&#105;ng run, as shown in <a class="docLink" href="#ch02fig10">Figure 2.10</a>.</p>
<a name="ch02fig10"></a><p><center>

<h5 class="docFigureTitle"><a name="Vista and"></a>F&#105;gure 2.10. The Go to Cell dialog on Win&#100;o&#119;s Vista and M&#97;c OS X</h5>
<p class="docText"><div class="st1"><a target="_blank" href="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzZ3BpYWZpc2gvLjB0bDJnYzBfMXBq.jpg">[View full size image]</a></div><img border="0" id="" width="500" height="116" src="images/MXJkcjcvYWd0Yy8xMC84bXBlaTlzNzQ5YTk3ZzMzcGlqZmlzaC9nMHAyZ2MwLjE-.jpg" alt="" /></p>
</center></p><br />
<p class="docText"><a name="make the"></a>To ma&#107;e the dialog u&#115;e a <tt>QDia&#108;ogButtonBox</tt>, w&#101; must chang&#101; both the design and the code. &#73;n <span class="docEmphasis">Qt Designer</span>, there are ju&#115;t four steps to take:</p>
<a name="ch02pro04"></a>




<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Click the form (not any of the widgets or layouts) and then click <span class="docEmphRomanAlt">Form|Break Layout</span>.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Click and delete the <span class="docEmphRomanAlt">OK</span> button, the <tt>Cancel</tt> button, the horizontal spacer, and the (now empty) horizontal layout.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Drag a &quot;Button Box&quot; onto the form, below the cell location label and line editor.<br /><br />
</div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Click the form and then click <span class="docEmphRomanAlt">Form|Lay Out Vertically</span>.<br /><br />
</div></td></tr></table>
<p class="docText"><a name="iddle1061"></a><a name="iddle1065"></a><a name="iddle1470"></a><a name="iddle4126"></a><a name="iddle6836"></a><a name="iddle6839"></a><a name="the dialog"></a>If we had just been doing desi&#103;n changes, such as changing the dialog's &#108;ayouts and &#119;idget prope&#114;ties, w&#101; would be able to simply &#114;ebuild the application. &#66;ut here w&#101; ha&#118;e removed s&#111;me widgets and a&#100;d&#101;d a ne&#119; widget, and in t&#104;ese cases we must usually change th&#101; code too.</p>
<p class="docText"><a name="The changes"></a>The changes we must make a&#114;e all in the file <tt>gotocelldi&#97;log.cpp</tt><a name="the new"></a>. Here is the new version of the constructor:</p>
<div class="docText"><pre>GoToCellDialog::GoToCellDialog(QWidget *parent)
    : QDialog(parent)
{
    setupUi(this);
    buttonBox-&gt;button(QDialogButtonBox::Ok)-&gt;setEnabled(false);

    QRegExp regExp("[A-Za-z][1-9][0-9]{0,2}");
    lineEdit-&gt;setValidator(new QRegExpValidator(regExp, this));

    connect(buttonBox, SIGNAL(accepted()), this, SLOT(accept()));
    connect(buttonBox, SIGNAL(rejected()), this, SLOT(reject()));
}</pre></div><br />
<p class="docText"><a name="the previous"></a>In t&#104;e prev&#105;ous ver&#115;ion, we i&#110;itially disabled t&#104;e <span class="docEmphRomanAlt">OK</span> button in <span class="docEmphasis">Qt Designer</span>. We cannot do tha&#116; with a <tt>QD&#105;alogBu&#116;tonBox</tt>, s&#111; we do &#115;o in cod&#101;, immediately af&#116;er the <tt>setupUi()</tt> cal&#108;. The <tt>QDialogButtonBox</tt><a name="use this"></a> c&#108;ass has an enum of standard buttons, and we can use thi&#115; to access particular buttons, in this case the <span class="docEmphRomanAlt">OK</span> button.</p>
<p class="docText">Very &#99;onveniently, <span class="docEmphasis">Qt Designer</span>'s default name for a <tt>QDialogButtonB&#111;x</tt> i&#115; <tt>button&#66;ox</tt><a name="the button"></a>. Both c&#111;nnections are &#109;ade from the button box rather than from &#116;he butto&#110;s &#116;hemselv&#101;s. The <tt>acce&#112;ted()</tt> &#115;ignal is emitte&#100; when a bu&#116;ton with the <tt>AcceptRole</tt> is clicked, and s&#105;milarly the <tt>rejected()</tt> signal i&#115; emitted by a button with the <tt>RejectRole</tt>. By d&#101;fault, the standard <tt>QDialogButtonBox::O&#107;</tt> button ha&#115; the <tt>Acc&#101;pt&#82;ole</tt>, and the <tt>QDialogButto&#110;Box::Cancel</tt> button h&#97;s the <tt>Reje&#99;tRole</tt>.</p>
<p class="docText">Only o&#110;e &#109;ore change is requir&#101;d, i&#110; the <tt>on_li&#110;eEdit_textCha&#110;ged()</tt> slot:</p>
<div class="docText"><pre>void GoToCellDialog::on_lineEdit_textChanged()
{
    buttonBox-&gt;button(QDialogButtonBox::Ok)-&gt;setEnabled(
            lineEdit-&gt;hasAcceptableInput());
}</pre></div><br />
<p class="docText"><a name="of referring"></a>The only thing dif&#102;erent from before is that instead &#111;f referring to a particular button stor&#101;d as a member variable, we access the button box's <span class="docEmphRomanAlt">OK</span> button.</p>
<p class="docText"><a name="iddle1439"></a><a name="iddle1543"></a><a name="iddle2617"></a><a name="iddle2691"></a><a name="iddle7415"></a><a name="iddle7564"></a><a name="iddle7570"></a><a name="iddle8134"></a><a name="iddle8709"></a>&#79;ne of the bea&#117;ties of us&#105;ng <span class="docEmphasis">Qt De&#115;igner</span><a name="freedom to"></a> is that it allows pro&#103;rammers great free&#100;o&#109; to modify th&#101;ir &#102;orm de&#115;igns wi&#116;hout being &#102;orced t&#111; change their source code. &#87;hen you develop a form purely by writing C++ cod&#101;, changes to the design can be quite time-co&#110;suming. With <span class="docEmphasis">Qt Designer</span>, no time is lost sin&#99;e <tt>uic</tt><a name="that have"></a> simply &#114;egene&#114;ates t&#104;e source code for any fo&#114;ms that have changed. T&#104;e dial&#111;g's &#117;ser inter&#102;ace is saved &#105;n a <tt>.ui</tt><a name="file format"></a> fi&#108;e (an XML-based f&#105;le format), while cu&#115;tom functionality is implement&#101;d by subclassing the <tt>uic</tt>-gene&#114;ated class.</p>

</div></div>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch02lev1sec2.html><img src="images/prev.gif" width="20" height="20" border="0" align="absmiddle" alt="Previous Page"></a>
<a href=ch02lev1sec4.html><img src="images/next.gif" width="20" height="20" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>