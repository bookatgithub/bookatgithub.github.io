<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 11.7.&nbsp; Functional Programming</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11lev1sec6.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11lev1sec8.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch11lev1sec7"></a>
<h3 id="title-IDA1VHZF" class="docSection1Title">11.7. Functional Programming</H3>
<p class="docText"><a name="iddle1083"></a><a name="iddle2090"></a><a name="iddle2109"></a><a name="iddle2110"></a><a name="iddle2633"></a><a name="iddle2641"></a><a name="iddle3219"></a><a name="iddle3650"></a>Python is not and will probably not ever claim to be a functional programming language, but it does support a number of valuable functional programming constructs. There are also some that behave like functional programming mechanisms but may not be traditionally considered as such. What Python <span class="docEmphasis">does</span> provide comes in the form of four built-in functions and lambda expressions.</p>
<a name="ch11lev2sec18"></a>
<H4 id="title-IDADYHZF" class="docSection2Title">11.7.1. Anonymous Functions and <tt>lambda</tt></H4>
<p class="docText">Python allows one to create <span class="docEmphasis">anonymous functions</span> using the <span class="docEmphStrong"><tt>lambda</tt></span> keyword. They are &quot;anonymous&quot; because they are not declared in the standard manner, i.e., using the <span class="docEmphStrong"><tt>def</tt></span> statement. (Unless assigned to a local variable, such objects do not create a name in any namespace either.) However, as functions, they may also have arguments. An entire lambda &quot;statement&quot; represents an expression, and the body of that expression must also be given on the same line as the declaration. We now present the syntax for anonymous functions:</P>

<div class="docText"><pre><span class="docEmphStrong">lambda</span> [<span class="docEmphasis">arg1[, arg2, ... argN]]: expression</span></pre></div><BR>
<p class="docText">Arguments are optional, and if used, are usually part of the expression as well.</p>
<a name="ch11note01"></a><div class="docNote"><p class="docNoteTitle">Core Note: <tt>lambda</tt> expression returns callable function object</p><p><table width="90%" border="0" cellspacing="0" cellpadding="1"><TR><td width="60" valign="top">
<img border="0" alt="" align="LEFT" width="50" height="50" SRC="images/core_note.jpg">


</TD><td valign="top"><p class="docText"><span class="docEmphasis">Calling</span> <span class="docEmphStrong"><tt>lambda</tt></span> <span class="docEmphasis">with an appropriate expression yields a function object that can be used like any other function. They can be passed to other functions, aliased with additional references, be members of container objects, and as callable objects, be invoked (with any arguments, if necessary). When called, these objects will yield a result equivalent to the same expression if given the same arguments. They are indistinguishable from functions that return the evaluation of an equivalent expression</span>.</P></td></TR></table></P></div><br>
<p class="docText">Before we look at any examples using <span class="docEmphStrong"><tt>lambda</tt></span>, we would like to review single-line statements and then show the resemblances to lambda expressions.</p>
<div class="docText"><pre><span class="docEmphStrong">def</span> true():
    <span class="docEmphStrong">return</span> True</pre></div><br>

<p class="docText">The above function takes no arguments and always returns <tt>true</tt>. Single line functions in Python may be written on the same line as the header. Given that, we can rewrite our <tt>TRue()</tt> function so that it looks something like the following:</p>
<div class="docText"><pre><span class="docEmphStrong">def</span> true(): <span class="docEmphStrong">return</span> True</pre></div><br>
<p class="docText">We will present the named functions in this manner for the duration of this chapter because it helps one visualize their lambda equivalents. For our <tt>TRue()</tt> function, the equivalent expression (no arguments, returns <tt>true</tt>) using <span class="docEmphStrong"><tt>lambda</tt></span> is:</p>
<div class="docText"><pre><span class="docEmphStrong">lambda</span> :True</pre></div><br>
<p class="docText">Usage of the named <tt>TRue()</tt> function is fairly obvious, but not for <span class="docEmphStrong"><tt>lambda</tt></span>. Do we just use it as is, or do we need to assign it somewhere? A lambda function by itself serves no purpose, as we see here:</P>
<div class="docText"><pre>&gt;&gt;&gt; <span class="docEmphStrong">lambda</span> :True
&lt;function &lt;lambda&gt; at f09ba0&gt;</pre></div><br>
<p class="docText">In the above example, we simply used <span class="docEmphStrong"><tt>lambda</tt></span> to create a function (object), but did not save it anywhere nor did we call it. The reference count for this function object is set to True on creation of the function object, but because no reference is saved, goes back down to zero and is garbage-collected. To keep the object around, we can save it into a variable and invoke it any time after. Perhaps now is a good opportunity:</p>
<div class="docText"><pre>&gt;&gt;&gt; true = <span class="docEmphStrong">lambda</span> :True
&gt;&gt;&gt; true()
True</pre></div><br>
<p class="docText">Assigning it looks much more useful here. Likewise, we can assign lambda expressions to a data structure such as a list or tuple where, based on some input criteria, we can choose which function to execute as well as what the arguments would be. (In the next section, we will show how to use lambda expressions with functional programming constructs.)</p>
<p class="docText">Let us now design a function that takes two numeric or string arguments and returns the sum for numbers or the concatenated string. We will show the standard function first, followed by its unnamed equivalent.</p>
<div class="docText"><pre><span class="docEmphStrong">def</span> add(x, y): <span class="docEmphStrong">return</span> x + y <img src=images/U21D4.jpg border=0> <span class="docEmphStrong">lambda</span> x, y: x + y</pre></div><br>
<p class="docText"><a name="iddle1092"></a><a name="iddle2040"></a><a name="iddle2111"></a><a name="iddle2113"></a><a name="iddle2118"></a><a name="iddle2119"></a><a name="iddle2123"></a><a name="iddle2189"></a><a name="iddle2772"></a><a name="iddle3565"></a>Default and variable arguments are permitted as well, as indicated in the following examples:</p>
<div class="docText"><pre><span class="docEmphStrong">def</span> usuallyAdd2(x, y=2): <span class="docEmphStrong">return</span> x+y <img src=images/U21D4.jpg border=0> <span class="docEmphStrong">lambda</span> x, y=2: x+y
<span class="docEmphStrong">def</span> showAllAsTuple(*z): <span class="docEmphStrong">return</span> z <img src=images/U21D4.jpg border=0> <span class="docEmphStrong">lambda</span> *z: z</pre></div><br>
<p class="docText">Seeing is one thing, so we will now try to make you believe by showing how you can try them in the interpreter:</p>
<div class="docText"><pre>&gt;&gt;&gt; a = <span class="docEmphStrong">lambda</span> x, y=2: x + y
&gt;&gt;&gt; a(3)
5
&gt;&gt;&gt; a(3,5)
8
&gt;&gt;&gt; a(0)
2
&gt;&gt;&gt; a(0,9)
9
&gt;&gt;&gt;
&gt;&gt;&gt; b = <span class="docEmphStrong">lambda</span> *z: z
&gt;&gt;&gt; b(23, 'zyx')
(23, 'zyx')
&gt;&gt;&gt; b(42)
(42,)</pre></div><br>
<p class="docText">One final word on <span class="docEmphStrong"><tt>lambda</tt></span>: Although it appears that <span class="docEmphStrong"><tt>lambda</tt></span> is a one-line version of a function, it is not equivalent to an &quot;inline&quot; statement in C++, whose purpose is bypassing function stack allocation during invocation for performance reasons. A lambda expression works just like a function, creating a frame object when called.</p>

<a name="ch11lev2sec19"></a>
<h4 id="title-IDAWS3KN" class="docSection2Title">11.7.2. Built-in Functions: <tt>apply()</tt>, <tt>filter()</tt>, <tt>map()</tt>, <tt>reduce()</tt></H4>
<p class="docText">In this section, we will look at the <tt>apply()</tt>, <tt>filter()</tt>, <tt>map()</tt>, and <tt>reduce()</tt> built-in functions as well as give some examples to show how they can be used. These functions provide the functional programming features found in Python. A summary of these functions is given in <a class="docLink" href="#ch11table02">Table 11.2</a>. All take a function object to somehow invoke.</p>
<a name="ch11table02"></a><P><table cellspacing="0" FRAME="hsides" RULES="none" cellpadding="5"><caption><h5 class="docTableTitle">Table 11.2. Functional Programming Built-in Functions</H5></caption><colgroup align="left" span="2"><col width="200"><col width="300"></colgroup><thead><tr><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Built-in Function</P></th><th class="thead" scope="col" align="left" valign="bottom"><p class="docText">Description</p></th></TR></thead><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>apply(</tt> <span class="docEmphasis"><tt>func</tt></span><tt>[</tt>, <span class="docEmphasis"><tt>nkw</tt></span><tt>][</tt>, <span class="docEmphasis"><tt>kw</tt></span> <tt>]</tt>)<sup class="docFootnote"><a class="docLink" href="#ch11tna1">[a]</a></sup></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Calls <span class="docEmphasis"><tt>func</tt></span> with optional arguments, <span class="docEmphasis"><tt>nkw</tt></span> for non-keyword arguments and <span class="docEmphasis"><tt>kw</tt></span> for keyword arguments; the return value is the return value of the function call</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>filter(</tt> <span class="docEmphasis"><tt>func</tt></span>, <span class="docEmphasis"><tt>seq</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch11tnb1">[b]</a></sup></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Invokes Boolean function <span class="docEmphasis"><tt>func</tt></span> iteratively over each element of <tt>seq</tt>; returns a sequence for those elements for which <span class="docEmphasis"><tt>func</tt></span> returned true</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>map(</tt> <span class="docEmphasis"><tt>func</tt></span>, <span class="docEmphasis"><tt>seq1</tt></span><tt>[,</tt> <span class="docEmphasis"><tt>seq2</tt></span><tt>...])</tt><sup class="docFootnote"><a class="docLink" href="#ch11tnb1">[b]</a></sup></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Applies function <span class="docEmphasis"><tt>func</tt></span> to each element of given sequence(s) and provides return values in a list; if <span class="docEmphasis"><tt>func</tt></span> is <tt>None</tt>, <span class="docEmphasis">func</span> behaves as the identity function, returning a list consisting of <tt>n</tt>-tuples for sets of elements of each sequence</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>reduce(</tt><span class="docEmphasis"><tt>func</tt></span>, <span class="docEmphasis"><tt>seq</tt></span><tt>[,</tt> <span class="docEmphasis"><tt>init</tt></span><tt>]</tt>)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Applies binary function <span class="docEmphasis"><tt>func</tt></span> to elements of sequence <span class="docEmphasis"><tt>seq</tt></span>, taking a pair at a time (previous result and next sequence item), continually applying the current result with the next value to obtain the succeeding result, finally reducing our sequence to a single return value; if initial value <span class="docEmphasis"><tt>init</tt></span> given, first compare will be of <span class="docEmphasis"><tt>init</tt></span> and first sequence element rather than the first two sequence elements</p></td></tr></table></p><br><blockquote><p class="docFootnote"><sup><a name="ch11tna1">[a]</a></sup> Effectively deprecated in 1.6 to be phased out in future versions of Python.</p></blockquote><blockquote><p class="docFootnote"><sup><a name="ch11tnb1">[b]</a></sup> Partially deprecated by list comprehensions introduced in Python 2.0.</p></blockquote>
<p class="docText">As you may imagine, lambda functions fit nicely into applications using any of these functions because all of them take a function object with which to execute, and <span class="docEmphStrong"><tt>lambda</tt></span> provides a mechanism for creating functions on the fly.</p>
<a name="ch11lev3sec10"></a>

<h5 id="title-IDAL03KN" class="docSection3Title"><tt>*apply( )</tt></h5>
<p class="docText"><a name="iddle1093"></a><a name="iddle2112"></a><a name="iddle2120"></a><a name="iddle2124"></a><a name="iddle2773"></a><a name="iddle3566"></a>As mentioned before, the calling syntax for functions, which now allow for a tuple of variable arguments as well as a dictionary of keyword variable arguments, effectively deprecates <tt>apply( )</tt> as of Python 1.6. The function will be phased out and eventually removed in a future version of Python. We mention it here for historical purposes as well as for those maintaining code that uses <tt>apply( )</tt>.</P>

<a name="ch11lev3sec11"></a>

<h5 id="title-IDAL23KN" class="docSection3Title"><tt>filter( )</tt></H5>
<p class="docText">The second built-in function we examine in this chapter is <tt>filter( )</tt>. Imagine going to an orchard and leaving with a bag of apples you picked off the trees. Wouldn't it be nice if you could run the entire bag through a filter to keep just the good ones? That is the main premise of the <tt>filter( )</tt> function.</p>
<p class="docText">Given a sequence of objects and a &quot;filtering&quot; function, run each item of the sequence through the filter, and keep only the ones that the function returns true for. The <tt>filter()</tt> function calls the given Boolean function for each item of the provided sequence. Each item for which <tt>filter()</tt> returns a non-zero (true) value is appended to a list. The object that is returned is a &quot;filtered&quot; sequence of the original.</P>
<p class="docText">If we were to code <tt>filter( )</tt> in pure Python, it might look something like this:</p>
<div class="docText"><pre><span class="docEmphStrong">def</span> filter(<span class="docEmphasis">bool_func, seq</span>):
    filtered_seq = []
    <span class="docEmphStrong">for</span> eachItem <span class="docEmphStrong">in</span> <span class="docEmphasis">seq</span>:
        <span class="docEmphStrong">if</span> <span class="docEmphasis">bool_func</span>(eachItem):
            filtered_seq.append(eachItem)
    <span class="docEmphasis">return</span> filtered_seq</pre></div><BR>
<p class="docText">One way to understand <tt>filter()</tt> better is by visualizing its behavior. <a class="docLink" href="#ch11fig01">Figure 11-1</a> attempts to do just that.</p>
<a name="ch11fig01"></a><P><center>

<H5 class="docFigureTitle">Figure 11-1. How the filter( ) built-in function works</H5>

<p class="docText">
<img border="0" alt="" width="500" height="259" SRC="images/chun_fig11_01.jpg"></P>


</center></p><br>
<p class="docText">In <a class="docLink" href="#ch11fig01">Figure 11-1</a>, we observe our original sequence at the top, items <tt>seq[0]</tt>, <tt>seq[1]</tt>, ... <tt>seq[N-1]</tt> for a sequence of size N. For each call to <tt>bool_func()</tt>, i.e., <span class="docEmphasis"><tt>bool_func</tt></span> <tt>(</tt><span class="docEmphasis"><tt>seq</tt></span> <tt>[0])</tt>, <span class="docEmphasis"><tt>bool_func</tt></span> <tt>(</tt><span class="docEmphasis"><tt>seq</tt></span> <tt>[1])</tt>, etc., a return value of <tt>False</tt> or <tt>true</tt> comes back (as per the definition of a Boolean functionensure that indeed your function does return one or the other). If <tt>bool_func()</tt> returns <tt>TRue</tt> for any sequence item, that element is inserted into the return sequence. When iteration over the entire sequence has been completed, <tt>filter()</tt> returns the newly created sequence.</p>
<p class="docText">We present below a script that shows one way to use <tt>filter()</tt> to obtain a short list of random odd numbers. The script generates a larger set of random numbers first, then filters out all the even numbers, leaving us with the desired dataset. When we first coded this example, <tt>oddnogen.py</tt> looked like the following:</P>
<div class="docText"><pre><span class="docEmphStrong">from</span> random <span class="docEmphStrong">import</span> randint

<span class="docEmphStrong">def</span> odd(n):
    <span class="docEmphStrong">return</span> n % 2

allNums = []
<span class="docEmphStrong">for</span> eachNum <span class="docEmphStrong">in</span> range(9):
    allNums.append(randint(1, 99))
<span class="docEmphStrong">print</span> filter(odd, allNums)</pre></div><br>
<p class="docText">This code consists of two functions: <tt>odd()</tt>, a Boolean function that determined if an integer was odd (true) or even (false), and <tt>main()</tt>, the primary driving component. The purpose of <tt>main()</tt> is to generate ten random numbers between 1 and 100; then <tt>filter()</tt> is called to remove all the even numbers. Finally, the set of odd numbers is displayed, preceded by the size of our filtered list.</P>
<p class="docText">Importing and running this module several times, we get the following output:</p>
<div class="docText"><pre>$ python oddnogen.py
[9, 33, 55, 65]

$ python oddnogen.py
[39, 77, 39, 71, 1]

$ python oddnogen.py
[23, 39, 9, 1, 63, 91]

$ python oddnogen.py
[41, 85, 93, 53, 3]</pre></div><BR>
<a name="ch11lev4sec7"></a>
<H5 id="title-IDA00I3D" class="docSection4Title">Refactoring Pass 1</h5>
<p class="docText">We notice on second glance that <tt>odd()</tt> is simple enough to be replaced by a <span class="docEmphStrong"><tt>lambda</tt></span> expression:</p>
<div class="docText"><pre><span class="docEmphStrong">from</span> random <span class="docEmphStrong">import</span> randint

allNums = []
<span class="docEmphStrong">for</span> eachNum <span class="docEmphStrong">in</span> range(9):
    allNums.append(randint(1, 99))
<span class="docEmphStrong">print</span> filter(<span class="docEmphStrong">lambda</span> n: n%2, allNums)</pre></div><br>

<a name="ch11lev4sec8"></a>

<h5 id="title-IDAO2I3D" class="docSection4Title">Refactoring Pass 2</H5>
<p class="docText"><a name="iddle2121"></a><a name="iddle2774"></a>We have already mentioned how list comprehensions can be a suitable replacement for <tt>filter()</tt> so here it is:</p>
<div class="docText"><pre><span class="docEmphStrong">from</span> random <span class="docEmphStrong">import</span> randint

allNums = []
<span class="docEmphStrong">for</span> eachNum <span class="docEmphStrong">in</span> range(9):
    allNums.append(randint(1, 99))
<span class="docEmphStrong">print</span> [n <span class="docEmphStrong">for</span> n <span class="docEmphStrong">in</span> allNums <span class="docEmphStrong">if</span> n%2]</pre></div><br>

<a name="ch11lev4sec9"></a>
<H5 id="title-IDAT4I3D" class="docSection4Title">Refactoring Pass 3</h5>
<p class="docText">We can further simplify our code by integrating another list comprehension to put together our final list. As you can see below, because of the flexible syntax of list comps, there is no longer a need for intermediate variables. (To make things fit, we import <tt>randint()</tt> with a shorter name into our code.)</p>
<div class="docText"><pre><span class="docEmphStrong">from</span> random <span class="docEmphStrong">import</span> randint <span class="docEmphStrong">as</span> ri
<span class="docEmphStrong">print</span> [n <span class="docEmphStrong">for</span> n <span class="docEmphStrong">in</span> [ri(1,99) <span class="docEmphStrong">for</span> i <span class="docEmphStrong">in</span> range(9)] <span class="docEmphStrong">if</span> n%2]</pre></div><br>
<p class="docText">Although longer than it should be, the line of code making up the core part of this example is not as obfuscated as one might think.</P>


<a name="ch11lev3sec12"></a>
<H5 id="title-IDATAJ3D" class="docSection3Title"><tt>map( )</tt></h5>
<p class="docText">The <tt>map()</tt> built-in function is similar to <tt>filter()</tt> in that it can process a sequence through a function. However, unlike <tt>filter()</tt>, <tt>map()</tt> &quot;maps&quot; the function call to each sequence item and returns a list consisting of all the return values.</p>
<p class="docText">In its simplest form, <tt>map()</tt> takes a function and sequence, applies the function to each item of the sequence, and creates a return value list that is comprised of each application of the function. So if your mapping function is to add 2 to each number that comes in and you feed that function to <tt>map()</tt> along with a list of numbers, the resulting list returned is the same set of numbers as the original, but with 2 added to each number. If we were to code how this simple form of <tt>map()</tt> works in Python, it might look something like the code below that is illustrated in <a class="docLink" href="#ch11fig02">Figure 11.2</a>.</p>
<a name="ch11fig02"></a><p><center>

<h5 class="docFigureTitle">Figure 11-2. How the <tt>map()</tt> built-in function works</h5>

<p class="docText">
<img border="0" alt="" width="500" height="271" SRC="images/chun_fig11_02.jpg"></p>


</center></p><br>
<div class="docText"><pre><span class="docEmphStrong">def</span> map(<span class="docEmphasis">func, seq</span>):
     mapped_seq = []
     <span class="docEmphStrong">for</span> eachItem <span class="docEmphStrong">in</span> <span class="docEmphasis">seq</span>:
     mapped_seq.append(func(eachItem))
     <span class="docEmphStrong">return</span> mapped_seq</pre></div><br>
<p class="docText"><a name="iddle2638"></a>We can whip up a few quick <span class="docEmphStrong"><tt>lambda</tt></span> functions to show you how <tt>map()</tt> works on real data:</p>
<div class="docText"><pre>&gt;&gt;&gt; map((<span class="docEmphStrong">lambda</span> x: x+2), [0, 1, 2, 3, 4, 5])
[2, 3, 4, 5, 6, 7]
&gt;&gt;&gt;
&gt;&gt;&gt; map(<span class="docEmphStrong">lambda</span> x: x**2, range(6))
[0, 1, 4, 9, 16, 25]
&gt;&gt;&gt; [x+2 <span class="docEmphStrong">for</span> x <span class="docEmphStrong">in</span> range(6)]
[2, 3, 4, 5, 6, 7]
&gt;&gt;&gt;
&gt;&gt;&gt;[x**2 <span class="docEmphStrong">for</span> x <span class="docEmphStrong">in</span> range(6)]
[0, 1, 4, 9, 16, 25]</pre></div><br>
<p class="docText">We have also discussed how map () can sometimes can be replaced by list comprehensions, so here we refactor our two examples above.</P>
<p class="docText">The more general form of <tt>map()</tt> can take more than a single sequence as its input. If this is the case, then <tt>map()</tt> will iterate through each sequence in parallel. On the first invocation, it will bundle the first element of each sequence into a tuple, apply the <tt>func</tt> function to it, and return the result as a tuple into the <tt>mapped_seq</tt> mapped sequence that is finally returned as a whole when <tt>map()</tt> has completed execution.</p>
<p class="docText"><a class="docLink" href="#ch11fig02">Figure 11-2</a> illustrated how <tt>map()</tt> works with a single sequence. If we used <tt>map()</tt> with <span class="docEmphasis">M</span> sequences of <span class="docEmphasis">N</span> objects each, our previous diagram would be converted to something like the diagram presented in <a class="docLink" href="#ch11fig03">Figure 11-3</a>.</P>

<p class="docText"></p><a name="ch11fig03"></a><P><center>

<h5 class="docFigureTitle">Figure 11-3. How the <span class="docEmphStrong"><tt>map()</tt></span> built-in function works with &gt; 1 sequence</H5>

<p class="docText">
<img border="0" alt="" width="500" height="319" SRC="images/chun_fig11_03.jpg"></p>


</center></P><BR>
<p class="docText"><a name="iddle1209"></a><a name="iddle2125"></a><a name="iddle3567"></a>Here are several examples using <tt>map()</tt> with multiple sequences:</P>
<div class="docText"><pre>&gt;&gt;&gt; map(<span class="docEmphStrong">lambda</span> x, y: x + y, [1,3,5], [2,4,6])
[3, 7, 11]
&gt;&gt;&gt;
&gt;&gt;&gt; map(<span class="docEmphStrong">lambda</span> x, y: (x+y, x-y), [1,3,5], [2,4,6])
[(3, -1), (7, -1), (11, -1)]
&gt;&gt;&gt;
&gt;&gt;&gt; map(None, [1,3,5], [2,4,6])
[(1, 2), (3, 4), (5, 6)]</pre></div><BR>
<p class="docText">The last example above uses <tt>map()</tt> and a function object of <tt>None</tt> to merge elements of unrelated sequences together. This idiom was so commonly used prior to Python 2.0 that a new built-in function, <tt>zip()</tt>, was added just to address it:</p>

<p class="docText">
<img border="0" alt="" width="50" height="47" SRC="images/2_0.jpg"></p>


<div class="docText"><pre>&gt;&gt;&gt; zip([1,3,5], [2,4,6])
[(1, 2), (3, 4), (5, 6)]</pre></div><br>

<a name="ch11lev3sec13"></a>
<H5 id="title-IDAMJJ3D" class="docSection3Title"><tt>reduce( )</tt></h5>
<p class="docText">The final functional programming piece is <tt>reduce()</tt>, which takes a <span class="docEmphasis">binary function</span> (a function that takes two values, performs some calculation and returns one value as output), a sequence, and an optional initializer, and <a name="iddle2065"></a><a name="iddle2639"></a>methodologically &quot;reduces&quot; the contents of that list down to a single value, hence its name. In other languages, this concept is known as <span class="docEmphasis">folding</span>.</P>
<p class="docText">It does this by taking the first two elements of the sequence and passing them to the binary function to obtain a single value. It then takes this value and the next item of the sequence to get yet another value, and so on until the sequence is exhausted and one final value is computed.</p>
<p class="docText">You may try to visualize <tt>reduce()</tt> as the following equivalence example:</P>
<div class="docText"><pre>reduce(func, [1, 2, 3]) <img src=images/U2261.jpg border=0> func(func(1, 2), 3)</pre></div><br>
<p class="docText">Some argue that the &quot;proper functional&quot; use of <tt>reduce()</tt> requires only one item to be taken at a time for <tt>reduce()</tt>. In our first iteration above, we took two items because we did not have a &quot;result&quot; from the previous values (because we did not <span class="docEmphasis">have</span> any previous values). This is where the optional initializer comes in (see the <tt>init</tt> variable below). If the initializer is given, then the first iteration is performed on the initializer and the first item of the sequence, and follows normally from there.</P>
<p class="docText">If we were to try to implement <tt>reduce()</tt> in pure Python, it might look something like this:</P>
<div class="docText"><pre><span class="docEmphStrong">def</span> reduce(bin_func, seq, init=None):
    lseq = list(seq)           # convert to list
    <span class="docEmphStrong">if</span> init <span class="docEmphStrong">is</span> None:                # initializer?
         res = lseq.pop(0)     #  no
    <span class="docEmphStrong">else</span>:
         res = init             #  yes
    <span class="docEmphStrong">for</span> item <span class="docEmphStrong">in</span> lseq:       # reduce sequence
         res = bin_func(res, item)     # apply function
    <span class="docEmphStrong">return</span> res                               # return result</pre></div><br>
<p class="docText">This may be the most difficult of the four conceptually, so we should again show you an example as well as a functional diagram (see <a class="docLink" href="#ch11fig04">Figure 11-4</a>). The &quot;hello world&quot; of <tt>reduce()</tt> is its use of a simple addition function or its <span class="docEmphStrong"><tt>lambda</tt></span> equivalent seen earlier in this chapter:</p>
<a name="ch11fig04"></a><p><center>

<h5 class="docFigureTitle">Figure 11-4. How the <tt>reduce()</tt> built-in function works</H5>

<p class="docText">
<img border="0" alt="" width="500" height="429" SRC="images/chun_fig11_04.jpg"></p>


</center></p><BR>
<div class="docText"><pre>&#183; <span class="docEmphStrong">def</span> mySum(x,y): <span class="docEmphStrong">return</span> x+y
&#183; <span class="docEmphStrong">lambda</span> x,y: x+y</pre></div><br>
<p class="docText">Given a list, we can get the sum of all the values by simply creating a loop, iteratively going through the list, adding the current element to a running subtotal, and being presented with the result once the loop has completed:</p>
<div class="docText"><pre>&gt;&gt;&gt; <span class="docEmphStrong">def</span> mySum(x,y): <span class="docEmphStrong">return</span> x+y
&gt;&gt;&gt; allNums = range(5)         # [0, 1, 2, 3, 4]
&gt;&gt;&gt; total = 0</pre></div><br>
<div class="docText"><pre>&gt;&gt;&gt; for eachNum in allNums:
...     total = mySum(total, eachNum)
...
&gt;&gt;&gt; print 'the total is:', total
the total is: 10</pre></div><BR>
<p class="docText"><a name="iddle2640"></a>Using <span class="docEmphStrong"><tt>lambda</tt></span> and <tt>reduce()</tt>, we can do the same thing on a single line:</P>
<div class="docText"><pre>&gt;&gt;&gt; <span class="docEmphStrong">print</span> 'the total is:', reduce((<span class="docEmphStrong">lambda</span> x,y: x+y), range(5))
the total is: 10</pre></div><br>

<p class="docText">The <tt>reduce()</tt> function performs the following mathematical operations given the input above:</p>
<div class="docText"><pre>((((0 + 1) + 2) + 3) + 4)       <img src=images/U21D2.jpg border=0>   10</pre></div><br>
<p class="docText">It takes the first two elements of the list (0 and 1), calls <tt>mySum()</tt> to get 1, then calls <tt>mySum()</tt> again with that result and the next item 2, gets the result from that, pairs it with the next item 3 and calls <tt>mySum()</tt>, and finally takes the entire subtotal and calls <tt>mySum()</tt> with 4 to obtain 10, which is the final return value.</p>


<a name="ch11lev2sec20"></a>

<h4 id="title-IDALRJ3D" class="docSection2Title">11.7.3. Partial Function Application</h4>
<p class="docText"><a name="iddle1554"></a><a name="iddle2117"></a><a name="iddle2122"></a><a name="iddle3394"></a><a name="iddle3420"></a>The notion of <span class="docEmphasis">currying</span> combines the concepts of functional programming and default and variable arguments together. A function taking N arguments that is &quot;curried&quot; embalms the first argument as a fixed parameter and returns another function object taking (the remaining) N-1 arguments, akin to the actions of the LISP primitive functions <tt>car</tt> and <tt>cdr</tt>, respectively. Currying can be generalized into <span class="docEmphasis">partial function application</span> (PFA), in which any number (and order) of arguments is parlayed into another function object with the remainder of the arguments to be supplied later.</p>
<p class="docText">In a way, this seems similar to default arguments where if arguments are not provided, they take on a &quot;default&quot; value. In the case of PFAs, the arguments do not have a default value for all calls to a function, only to a specific set of calls. You can have multiple partial function calls, each of which may pass in different arguments to the function, hence the reason why default arguments cannot be used.</p>
<p class="docText">This feature was introduced in Python 2.5 and made available to users via the <tt>functools</tt> module.</p>

<p class="docText">
<img border="0" alt="" width="50" height="47" SRC="images/2_5.jpg"></p>


<a name="ch11lev3sec14"></a>
<h5 id="title-IDAWTJ3D" class="docSection3Title">Simple Functional Example</h5>
<p class="docText">How about creating a simple little example? Let us take two simple functions <tt>add()</tt> and <tt>mul()</tt>, both found in the <tt>operator</tt> module. These are just functional interfaces to the <tt>+</tt> and <tt>*</tt> operators that we are already familiar with, e.g., <tt>add(x,</tt> <tt>y)</tt> is the same as <tt>x</tt> <tt>+</tt> <tt>y</tt>. Say that we wanted to add one to a number or multiply another by 100 quite often in our applications.</P>
<p class="docText">Rather than having multiple calls like <tt>add(1, foo), add(1, bar), mul(100, foo), mul(100, bar)</tt>, would it not be nice to just have existing functions that simplify the function call, i.e., <tt>add1(foo),</tt> <tt>add1(bar),</tt> <tt>mul100(foo),</tt> <tt>mul100(bar)</tt>, but without having to write functions <tt>add1()</tt> and <tt>mul100()</tt>? Well, now you can with PFAs. You can create a PFA by using the <tt>partial()</tt> function found in the functional module:</p>
<div class="docText"><pre>&gt;&gt;&gt; <span class="docEmphStrong">from</span> operator <span class="docEmphStrong">import</span> add, mul
&gt;&gt;&gt; <span class="docEmphStrong">from</span> functools <span class="docEmphStrong">import</span> partial
&gt;&gt;&gt; add1 = partial(add, 1)     # add1(x) == add(1, x)
&gt;&gt;&gt; mul100 = partial(mul, 100) # mul100(x) == mul(100, x)
&gt;&gt;&gt;
&gt;&gt;&gt; add1(10)
11
&gt;&gt;&gt; add1(1)
2

&gt;&gt;&gt; mul100(10)
1000
&gt;&gt;&gt; mul100(500)
50000</pre></div><BR>
<p class="docText"><a name="iddle2629"></a>This example may or may not open your eyes to the power of PFAs, but we have to start somewhere. PFAs are best used when calling functions that take many parameters. It is also easier to use PFAs with keyword arguments, because specific arguments can be given explicitly, either as curried arguments, or those more &quot;variable&quot; that are passed in at runtime, and we do not have to worry about ordering. Below is an example from the Python documentation for use in applications where binary data (as strings) need to be converted to integers fairly often:</p>
<div class="docText"><pre>&gt;&gt;&gt; baseTwo = partial(int, base=2)
&gt;&gt;&gt; baseTwo.__doc__ = 'Convert base 2 string to an int.'
&gt;&gt;&gt; baseTwo('10010')
18</pre></div><BR>
<p class="docText">This example uses the <tt>int()</tt> built-in function and fixes the base to 2 specifically for binary string conversion. Now instead of multiple calls to <tt>int()</tt> all with the same second parameter (of 2), e.g., <tt>int('10010', 2)</tt>, we can simply use our new <tt>baseTwo()</tt> function with a single argument. Good style is also followed because it adds a documentation string to the &quot;new (partial) function,&quot; and it is also another good use of &quot;function attributes&quot; (see <a class="docLink" href="ch11lev1sec3.html#ch11lev2sec10">Section 11.3.4</a> above). One important thing to note is that the keyword argument <tt>base</tt> is required here.</p>

<a name="ch11lev3sec15"></a>
<H5 id="title-IDAKXJ3D" class="docSection3Title">Be Wary of Keywords</h5>
<p class="docText">If you create the partial function without the <tt>base</tt> keyword, e.g., <tt>baseTwoBAD</tt> <tt>=</tt> <tt>partial(int, 2)</tt>, it would pass the arguments to <tt>int()</tt> in the wrong order because the fixed arguments are always placed to the left of the runtime arguments, meaning that <tt>baseTwoBAD(x)</tt> <tt>==</tt> <tt>int(2, x)</tt>. If you call it, it would pass in 2 as the number to convert and the base as <tt>'10010'</tt>, resulting in an exception:</P>
<div class="docText"><pre>&gt;&gt;&gt; baseTwoBAD = partial(int, 2)
&gt;&gt;&gt; baseTwoBAD('10010')
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
TypeError: an integer is required</pre></div><BR>
<p class="docText"><a name="iddle2284"></a>With the keyword in place, the order is preserved properly since, as you know, keyword arguments always come after the formal arguments, so <tt>baseTwo(x)</tt> <tt>==</tt> <tt>int(x, base=2)</tt>.</P>

<a name="ch11lev3sec16"></a>
<H5 id="title-IDAFZJ3D" class="docSection3Title">Simple GUI Class Example</h5>
<p class="docText">PFAs also extended to all callables like classes and methods. An excellent example of using PFAs is in providing &quot;partial-GUI templating.&quot; GUI widgets often have many parameters, such as text, length, maximum size, background and foreground colors, both active and otherwise, etc. If we wanted to &quot;fix&quot; some of those arguments, such as making all text labels be in white letters on a blue background, you can customize it exactly that way into a pseudo template for similar objects.</p>
<a name="ch11list06"></a><h5 id="title-IDASZJ3D" class="docExampleTitle">Example 11.6. Partial Function Application GUI (<tt>pfaGUI.py</tt>)</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>


<p class="docText"><span class="docEmphasis">This a more useful example of partial function application, or more accurately, &quot;partial class instantiation&quot; in this case . . . why?</span></P>

<pre>1  #!/usr/bin/env python
2
3  <span class="docEmphStrong">from</span> functools <span class="docEmphStrong">import</span> partial
4  <span class="docEmphStrong">import</span> Tkinter
5
6  root = Tkinter.Tk()
7  MyButton = partial(Tkinter.Button, root,
8      fg='white', bg='blue')
9  b1 = MyButton(text='Button 1')
10 b2 = MyButton(text='Button 2')
11 qb = MyButton(text='QUIT', bg='red',
12     command=root.quit)
13 b1.pack()
14 b2.pack()
15 qb.pack(fill=Tkinter.X, expand=True)
16 root.title('PFAs!')
17 root.mainloop()</pre><br>

</TD></TR></table></p>
<p class="docText">In lines 7-8, we create the &quot;partial class instantiator&quot; (because that is what it is instead of a partial function) for <tt>Tkinter.Button</tt>, fixing the parent window argument root and both foreground and background colors. We create two buttons <tt>b1</tt> and <tt>b2</tt> matching this template providing only the text label as unique to each. The quit button (lines 11-12) is slightly more customized, taking on a different background color (red, which overrides the blue default) and installing a callback to close the window when it is pressed. (The other two buttons have no function when they are pressed.)</p>
<p class="docText"><a name="iddle2162"></a><a name="iddle2263"></a><a name="iddle2343"></a><a name="iddle2726"></a><a name="iddle3680"></a><a name="iddle3683"></a><a name="iddle4438"></a><a name="iddle4442"></a>Without the <tt>MyButton</tt> &quot;template,&quot; you would have to use the &quot;full&quot; syntax each time (because you are still not giving all the arguments as there are plenty of parameters you are not passing that have default values):</p>
<div class="docText"><pre>b1 = Tkinter.Button(root, fg='white', bg='blue', text='Button 1')
b2 = Tkinter.Button(root, fg='white', bg='blue', text='Button 2')
qb = Tkinter.Button(root, fg='white', text='QUIT', bg='red',
           command=root.quit)</pre></div><br>
<p class="docText">Here is a snapshot of what this simple GUI looks like:</P>

<p class="docText">
<img border="0" alt="" width="65" height="87" SRC="images/untitled_1.jpg"></p>



<p class="docText">Why bother with so much repetition when your code can be more compact and easy to read? You can find out more about GUI programming in <a class="docLink" href="ch18.html#ch18">Chapter 18</a> (<a class="docLink" href="ch18lev1sec3.html#ch18lev2sec7">Section 18.3.5</a>), where we feature a longer example of using PFAs.</p>
<p class="docText">From what you have seen so far, you can see that PFA takes on the flavors of templating and &quot;style-sheeting&quot; in terms of providing defaults in a more functional programming environment. You can read more about them in the documentation for the <tt>functools</tt> module documentation found in the Python Library Reference, the &quot;What's New in Python 2.5&quot; document, and the specifying PEP 309.</P>



</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11lev1sec6.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch11lev1sec8.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>