<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 13.13.&nbsp; Customizing Classes with Special Methods</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec12.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec14.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a href="14051536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a><a name="ch13lev1sec13"></a>
<h3 id="title-IDAYCHZF" class="docSection1Title">13.13. Customizing Classes with Special Methods</H3>
<p class="docText">We covered two important aspects of methods in preceding sections of this chapter: first, that methods must be bound (to an instance of their corresponding class) before they can be invoked; and second, that there are two <a name="iddle1631"></a><a name="iddle2422"></a><a name="iddle2905"></a><a name="iddle3069"></a>special methods which provide the functionality of constructors and destructors, namely <tt>__init__()</tt> and <tt>__del__()</tt> respectively.</p>
<p class="docText">In fact, <tt>__init__()</tt> and <tt>__del__()</tt> are part of a set of special methods which can be implemented. Some have the predefined default behavior of inaction while others do not and should be implemented where needed. These special methods allow for a powerful form of extending classes in Python. In particular, they allow for:</P>
<UL><LI><p class="docList">Emulating standard types</P></li><li><p class="docList">Overloading operators</p></LI></ul>
<p class="docText">Special methods enable classes to emulate standard types by overloading standard operators such as <tt>+</tt>, <tt>*</tt>, and even the slicing subscript and mapping operator <tt>[ ]</tt>. As with most other special reserved identifiers, these methods begin and end with a double underscore ( __ ). <a class="docLink" href="#ch13table04">Table 13.4</a> presents a list of all special methods and their descriptions.</P>
<a name="ch13table04"></a><p><table cellspacing="0" FRAME="hsides" RULES="none" cellpadding="5"><caption><H5 class="docTableTitle">Table 13.4. <a name="iddle1174"></a><a name="iddle3161"></a>Special Methods for Customizing Classes</h5></caption><colgroup align="left" span="2"><col width="225"><col width="250"></colgroup><thead><TR><th class="thead" scope="col" align="left" valign="top"><p class="docText"><span class="docEmphasis">Special Method</span></P></th><th class="thead" scope="col" align="left" valign="top"><p class="docText"><span class="docEmphasis">Description</span></p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD"><p class="docText"><span class="docEmphStrong"><span class="docEmphasis">Basic Customization</span></span></P></td><td class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD">&nbsp;</TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__init__</tt>(<span class="docEmphasis"><tt>self</tt></span>[, <span class="docEmphasis"><tt>arg1, ...</tt></span>] )</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Constructor (with any optional arguments)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__new__</tt>(<span class="docEmphasis"><tt>self</tt></span>[<span class="docEmphasis"><tt>, arg1, ...</tt></span>] )<sup class="docFootnote"><a class="docLink" href="#ch13fn02">[a]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Constructor (with any optional argu ments); usually used for setting up subclassing of immutable data types</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__del__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Destructor</p></TD></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__str__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Printable string representation; <tt>str()</tt> built-in and <span class="docEmphStrong"><tt>print</tt></span> statement</p></td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__repr__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Evaluatable string representation; <tt>repr()</tt> built-in and <tt>''</tt> operator</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C.</tt></span><tt>__unicode__</tt>(<span class="docEmphasis"><tt>self</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn03">[b]</a></sup></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Unicode string representation; <tt>unicode()</tt> built-in</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__call__</tt>(<span class="docEmphasis"><tt>self, *args</tt></span>)</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Denote callable instances</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__nonzero__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Define <tt>False</tt> value for object; <tt>bool()</tt> built-in (as of 2.2)</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__len__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">&quot;Length&quot; (appropriate for class); <tt>len()</tt> built-in</p></TD></tr><TR><TD class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD"><p class="docText"><span class="docEmphStrong"><span class="docEmphasis">Object (Value) Comparison</span></span><sup class="docFootnote"><a class="docLink" href="#ch13fn04">[c]</a></sup></P></TD><td class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD">&nbsp;</td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__cmp__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">object comparison; <tt>cmp()</tt> built-in</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__lt__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>) and <span class="docEmphasis"><tt>C</tt></span><tt>.__le__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">less than/less than or equal to; <tt>&lt;</tt> and <tt>&lt;=</tt> operators</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__gt__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>) and <span class="docEmphasis"><tt>C</tt></span><tt>.__ge__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">greater than/greater than or equal to; <tt>&gt;</tt> and <tt>&gt;=</tt> operators</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__eq__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>) and <span class="docEmphasis"><tt>C</tt></span><tt>.__ne__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">equal/not equal to; <tt>==,!=</tt> and <tt>&lt;&gt;</tt> operators</p></td></tr><tr><TD class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD"><p class="docText"><span class="docEmphStrong"><span class="docEmphasis">Attributes</span></span></p></TD><td class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD">&nbsp;</TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__getattr__</tt>(<span class="docEmphasis"><tt>self, attr</tt></span>)</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Get attribute; <tt>getattr()</tt> built-in; called only if attributes not found</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__setattr__</tt>(<span class="docEmphasis"><tt>self, attr, val</tt></span>)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Set attribute;</P></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__delattr__</tt>(<span class="docEmphasis"><tt>self, attr</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Delete attribute;</P></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__getattribute__</tt>(<span class="docEmphasis"><tt>self, attr</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn02">[a]</a></sup></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Get attribute; <tt>getattr()</tt> built-in; always called</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__get__</tt>(<span class="docEmphasis"><tt>self, attr</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn02">[a]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(descriptor) Get attribute</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__set__</tt>(<span class="docEmphasis"><tt>self, attr, val</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn02">[a]</a></sup></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">(descriptor) Set attribute</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__delete__</tt>(<span class="docEmphasis"><tt>self, attr</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn02">[a]</a></sup></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">(descriptor) Delete attribute</P></td></tr><tr><TD class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD"><p class="docText"><span class="docEmphStrong"><span class="docEmphasis">Customizing Classes / Emulating Types</span></span></p></TD><td class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD">&nbsp;</TD></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Numeric Types: Binary Operators</span><sup class="docFootnote"><a class="docLink" href="#ch13fn05">[d]</a></sup></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*add__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Addition; <tt>+</tt> operator</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*sub__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Subtraction; <tt>-</tt> operator</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*mul__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Multiplication; <tt>*</tt> operator</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*div__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Division; <tt>/</tt> operator</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis">C</span><tt>.__*truediv__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn06">[e]</a></sup></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">True division; <tt>/</tt> operator</p></TD></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*floordiv__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn06">[e]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Floor division; <tt>//</tt> operator</p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*mod__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Modulo/remainder; <tt>%</tt> operator</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*divmod__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Division and modulo; <tt>divmod()</tt> built-in</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*pow__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>[, <span class="docEmphasis"><tt>mod</tt></span>])</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Exponentiation; <tt>pow()</tt> built-in; <tt>**</tt> operator</P></td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*lshift__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Left shift; <tt>&lt;&lt;</tt> operator</P></TD></tr><tr><td class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD"><p class="docText"><span class="docEmphStrong"><span class="docEmphasis">Customizing Classes / Emulating Types</span></span></P></td><TD class="docTableCell" align="left" valign="top" style="background-color:#DDDDDD">&nbsp;</td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Numeric Types: Binary Operators</span><sup class="docFootnote"><a class="docLink" href="#ch13fn07">[f]</a></sup></P></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*rshift__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Right shift; <tt>&gt;&gt;</tt> operator</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*and__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bitwise AND; <tt>&amp;</tt> operator</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*or__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bitwise OR; <tt>|</tt> operator</P></td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*xor__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Bitwise XOR; <tt>^</tt> operator</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Numeric Types: Unary Operators</span></p></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__neg__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Unary negation</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__pos__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Unary no-change</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__abs__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Absolute value; <tt>abs()</tt> built-in</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__invert__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bit inversion; <tt>~</tt> operator</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Numeric Types: Numeric Conversion</span></P></td><TD class="docTableCell" align="left" valign="top">&nbsp;</td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__complex__</tt>(<span class="docEmphasis"><tt>self, com</tt></span>)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Convert to complex; <tt>complex()</tt> built-in</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__int__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Convert to int; <tt>int()</tt> built-in</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__long__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Convert to long; <tt>long()</tt> built-in</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__float__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Convert to float; <tt>float()</tt> built-in</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Numeric Types: Base Representation (String)</span></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__oct__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Octal representation; <tt>oct()</tt> built-in</p></TD></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__hex__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Hexadecimal representation; <tt>hex()</tt> built-in</p></td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Numeric Types: numeric coercion</span></p></TD><td class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__coerce__</tt>(<span class="docEmphasis"><tt>self, num</tt></span>)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Coerce to same numeric type; <tt>coerce()</tt> built-in</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__index__</tt>(<span class="docEmphasis"><tt>self</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn08">[g]</a></sup></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Coerce alternate numeric type to integer if/when necessary (e.g., for slice indexes, etc.)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><a name="iddle3745"></a><a name="iddle2782"></a><span class="docEmphStrong">Sequence Types<sup class="docFootnote"><a class="docLink" href="#ch13fn06">[e]</a></sup></span></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__len__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Number of items in sequence</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__getitem__</tt>(<span class="docEmphasis"><tt>self, ind</tt></span>)</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Get single sequence element</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__setitem__</tt>(<span class="docEmphasis"><tt>self, ind, val</tt></span>)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Set single sequence element</P></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__delitem__</tt>(<span class="docEmphasis"><tt>self, ind</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Delete single sequence element</P></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphBoldItalic">Special Method</span></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphBoldItalic">Description</span></P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Sequence Types</span><sup class="docFootnote"><a class="docLink" href="#ch13fn06">[e]</a></sup></p></td><td class="docTableCell" align="left" valign="top">&nbsp;</td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__getslice__</tt>(<span class="docEmphasis"><tt>self, ind1, ind2</tt></span>)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Get sequence slice</P></td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__setslice__</tt>(<span class="docEmphasis"><tt>self, i1, i2, val</tt></span>)</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Set sequence slice</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__delslice__</tt>(<span class="docEmphasis"><tt>self, ind1, ind2</tt></span>)</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Delete sequence slice</p></TD></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__contains__</tt>(<span class="docEmphasis"><tt>self, val</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn07">[f]</a></sup></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Test sequence membership; <span class="docEmphStrong"><tt>in</tt></span> keyword</p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*add__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Concatenation; <tt>+</tt> operator</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__*mul__</tt>(<span class="docEmphasis"><tt>self, obj</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Repetition; <tt>*</tt> operator</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__iter__</tt>(<span class="docEmphasis"><tt>self</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn06">[e]</a></sup></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Create iterator class; <tt>iter()</tt> built-in</P></td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Mapping Types</span></p></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__len__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Number of items in mapping</P></td></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__hash__</tt>(<span class="docEmphasis"><tt>self</tt></span>)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Hash function value</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__getitem__</tt>(<span class="docEmphasis"><tt>self, key</tt></span>)</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Get value with given <span class="docEmphasis"><tt>key</tt></span></p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__setitem__</tt>(<span class="docEmphasis"><tt>self, key, val</tt></span>)</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Set <span class="docEmphasis"><tt>value</tt></span> with given <span class="docEmphasis"><tt>key</tt></span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__delitem__</tt>(<span class="docEmphasis"><tt>self, key</tt></span>)</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Delete value with given <span class="docEmphasis"><tt>key</tt></span></p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><tt>C</tt></span><tt>.__missing__</tt>(<span class="docEmphasis"><tt>self, key</tt></span>)<sup class="docFootnote"><a class="docLink" href="#ch13fn08">[g]</a></sup></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Provides default value when dictionary does not have given <span class="docEmphasis"><tt>key</tt></span></P></TD></TR></table></p><br><blockquote><p class="docFootnote"><sup><a name="ch13fn02">[a]</a></sup> New in <a class="docLink" href="ch05lev1sec2.html#ch05lev3sec2">Python 2.2</a>; for use with new-style classes only.</p></blockquote><blockquote><p class="docFootnote"><sup><a name="ch13fn03">[b]</a></sup> New in <a class="docLink" href="ch05lev1sec2.html#ch05lev3sec3">Python 2.3</a>.</P></blockquote><blockquote><p class="docFootnote"><sup><a name="ch13fn04">[c]</a></sup> All except <tt>cmp()</tt> new in <a class="docLink" href="ch05lev1sec2.html#ch05lev3sec1">Python 2.1</a>.</p></blockquote><blockquote><p class="docFootnote"><sup><a name="ch13fn05">[d]</a></sup> &quot;<tt>*</tt>&quot;either nothing (self OP obj), &quot;<tt>r</tt>&quot; (<tt>obj OP self</tt>), or &quot;<tt>i</tt>&quot; for in-place operation (new in Python 2.0), i.e., <tt>__add__</tt>, <tt>__radd__</tt>, or <tt>__iadd__</tt>.</P></blockquote><blockquote><p class="docFootnote"><sup><a name="ch13fn06">[e]</a></sup> New in <a class="docLink" href="ch05lev1sec2.html#ch05lev3sec2">Python 2.2</a>.</p></blockquote><blockquote><p class="docFootnote"><sup><a name="ch13fn07">[f]</a></sup> &quot;<tt>*</tt>&quot; either nothing (self OP obj), &quot;<tt>r</tt>&quot; (<tt>obj OP self</tt>), or &quot;<tt>i</tt>&quot; for in-place operation (new in Python 1.6), i.e., <tt>__add__</tt>, <tt>__radd__</tt>, or <tt>__iadd__</tt>.</P></blockquote><blockquote><p class="docFootnote"><sup><a name="ch13fn08">[g]</a></sup> New in Pathon 2.5.</p></blockquote>
<p class="docText"><a name="iddle1036"></a><a name="iddle1185"></a><a name="iddle1402"></a><a name="iddle1725"></a><a name="iddle2060"></a><a name="iddle2434"></a><a name="iddle2902"></a><a name="iddle3162"></a><a name="iddle3252"></a><a name="iddle3664"></a><a name="iddle4226"></a>The Basic Customization and Object (Value) Comparison special methods can be implemented for most classes and are not tied to emulation of any specific types. The latter set, also known as Rich Comparisons, was added in <a class="docLink" href="ch05lev1sec2.html#ch05lev3sec1">Python 2.1</a>.</P>
<p class="docText">The Attributes group helps manage instance attributes of your class. This is also independent of emulation. There is also one more, <tt>__getattribute__()</tt>, which applies to new-style classes only, so we will describe it in an upcoming section.</P>

<p class="docText">
<img border="0" alt="" width="50" height="47" SRC="images/2_1.jpg"></p>


<p class="docText">The Numeric Types set of special methods can be used to emulate various numeric operations, including those of the standard (unary and binary) operators, conversion, base representation, and coercion. There are also special methods to emulate sequence and mapping types. Implementation of some of these special methods will overload operators so that they work with instances of your class type.</p>
<p class="docText">The additional division operators <tt>__*truediv__()</tt> and <tt>__*floordiv__()</tt> were added in <a class="docLink" href="ch05lev1sec2.html#ch05lev3sec2">Python 2.2</a> to support the pending change to the Python division operatoralso see <a class="docLink" href="ch05lev1sec5.html#ch05lev2sec11">Section 5.5.3</a>. Basically, if the interpreter has the new division enabled, either via a switch when starting up Python or via the import of division from <tt>__future__</tt>, the single slash division operator ( <tt>/</tt> ) will represent true division, meaning that it will always return a floating point value, regardless of whether floats or integers make up the operands (complex division stays the same). The double slash division operator ( <tt>//</tt> ) will provide the familiar floor division with which most engineers who come from the standard compiled languages like C/C++ and Java are familiar. Similarly, these methods will only work with these symbols applied to classes that implement these methods and when new division is enabled.</p>

<p class="docText">
<img border="0" alt="" width="50" height="48" SRC="images/2_2.jpg"></P>


<p class="docText">Numeric binary operators in the table annotated with a wildcard asterisk in their names are so denoted to indicate that there are multiple versions of those methods with slight differences in their name. The asterisk either symbolizes no additional character in the string, or a single &quot;r&quot; to indicate a right-hand operation. Without the &quot;r,&quot; the operation occurs for cases that are of the format <tt>self</tt> <span class="docEmphasis"><tt>OP</tt></span> <tt>obj</tt>; the presence of the &quot;r&quot; indicates the format <tt>obj</tt> <span class="docEmphasis"><tt>OP</tt></span> <tt>self</tt>. For example, <tt>__add__(self</tt>, <tt>obj)</tt> is called for <tt>self + obj</tt>, and <tt>__radd__(self</tt>, <tt>obj)</tt> would be invoked for <tt>obj + self</tt>.</p>

<p class="docText">
<img border="0" alt="" width="50" height="47" SRC="images/2_0.jpg"></p>


<p class="docText">Augmented assignment, new in Python 2.0, introduces the notion of &quot;in-place&quot; operations. An &quot;i&quot; in place of the asterisk implies a combination left-hand operation plus an assignment, as in <tt>self = self OP obj</tt>. For example, <tt>__iadd__(self</tt>, <tt>obj)</tt> is called for <tt>self = self + obj</tt>.</P>

<p class="docText">
<img border="0" alt="" width="50" height="48" SRC="images/2_2.jpg"></p>


<p class="docText">With the arrival of new-style classes in <a class="docLink" href="ch05lev1sec2.html#ch05lev3sec2">Python 2.2</a>, several more special methods have been added for overriding. However, as we mentioned at the beginning of the chapter, we are now focusing only on the core portion of material applicable to both classic classes as well as new-style classes, and then later on in the chapter, we address the advanced features of new-style classes.</p>
<a name="ch13lev2sec42"></a>
<h4 id="title-IDAVL2KN" class="docSection2Title">13.13.1. Simple Customization (<tt>RoundFloat2</tt>)</H4>
<p class="docText">Our first example is totally trivial. It is based to some extent on the <tt>RoundFloat</tt> class we saw earlier in the section on subclassing Python types. This example is simpler. In fact, we are not even going to subclass anything (except object of course)... we do not want to &quot;take advantage&quot; of all the &quot;goodies&quot; that come with floats. No, this time, we want to create a barebones example so that you have a better idea of how class customization works. The premise of this class is still the same as the other one: we just want a class to save a floating point number rounded to two decimal places.</P>
<div class="docText"><pre><span class="docEmphStrong">class</span> RoundFloatManual(object):
    <span class="docEmphStrong">def</span> __init__(self, val):
        <span class="docEmphStrong">assert</span> isinstance(val, float), \
            "Value must be a float!"
        self.value = round(val, 2)</pre></div><br>
<p class="docText">This class takes a single floating point valueit asserts that the type must be a float as it is passed to the constructorand saves it as the instance attribute <tt>value</tt>. Let us try to execute it and create an instance of this class:</p>
<div class="docText"><pre>&gt;&gt;&gt; rfm = RoundFloatManual(42)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
  File "roundFloat2.py", line 5, in __init__
    <span class="docEmphStrong">assert</span> isinstance(val, float), \
AssertionError: Value must be a float!
&gt;&gt;&gt; rfm = RoundFloatManual(4.2)
&gt;&gt;&gt; rfm
&lt;roundFloat2.RoundFloatManual object at 0x63030&gt;
&gt;&gt;&gt; <span class="docEmphStrong">print</span> rfm
&lt;roundFloat2.RoundFloatManual object at 0x63030&gt;</pre></div><br>
<p class="docText">As you can see, it chokes on invalid input, but provides no output if input was valid. But look what happens when we try to dump the object in the interactive interpreter. We get some information, but this is not what we were looking for. (We wanted to see the numeric value, right?) And calling <span class="docEmphStrong"><tt>print</tt></span> does not apparently help, either.</p>
<p class="docText">Unfortunately, neither <span class="docEmphStrong"><tt>print</tt></span> (using <tt>str()</tt>) nor the actual object's string representation (using <tt>repr()</tt>) reveals much about our object. One good idea would be to implement either <tt>__str__()</tt> or <tt>__repr__()</tt>, or both so that we can &quot;see&quot; what our object looks like. In other words, when you want to display your object, you actually want to see something meaningful rather than the generic Python object string (<span class="docEmphasis"><tt>&lt;</tt><span class="docEmphasis"><tt>object </tt></span><tt>object at </tt><span class="docEmphasis"><tt>id</tt></span><tt>&gt;</tt></span>). Let us add a <tt>__str__()</tt> method, overriding the default behavior:</p>
<div class="docText"><pre><span class="docEmphStrong">def</span> __str__(self):
    <span class="docEmphStrong">return</span> str(self.value)</pre></div><br>
<p class="docText">Now we get the following:</p>
<div class="docText"><pre>    &gt;&gt;&gt; rfm = RoundFloatManual(5.590464)
    &gt;&gt;&gt; rfm
    &lt;roundFloat2.RoundFloatManual object at 0x5eff0&gt;
    &gt;&gt;&gt; <span class="docEmphStrong">print</span> rfm
    5.59
    &gt;&gt;&gt; rfm = RoundFloatManual(5.5964)
    &gt;&gt;&gt; <span class="docEmphStrong">print</span> rfm
    5.6</pre></div><br>
<p class="docText">We still have a few problems ... one is that just dumping the object in the interpreter still shows the default object notation, but that is not so bad. If we wanted to fix it, we would just override <tt>__repr__()</tt>. Since our string representation is also a Python object, we can make the output of <tt>__repr__()</tt> the same as <tt>__str__()</tt>.</p>
<p class="docText">To accomplish this, we can just copy the code from <tt>__str__()</tt> to <tt>__repr__()</tt>. This is a simple example, so it cannot really hurt us, but as a programmer, you know that is not the best thing to do. If a bug existed in <tt>__str__()</tt>, then we will copy that bug to <tt>__repr__()</tt>.</p>
<p class="docText">The best solution is to recall that the code represented by <tt>__str__()</tt> is an object too, and like all objects, references can be made to them, so let us just make <tt>__repr__()</tt> an alias to <tt>__str__()</tt>:</p>
<div class="docText"><pre>    __repr__ = __str__</pre></div><br>
<p class="docText">In the second example with 5.5964, we see that it rounds the value correctly to 5.6, but we still wanted two decimal places to be displayed. One more tweak, and we should be done. Here is the fix:</P>
<div class="docText"><pre><span class="docEmphStrong">def</span> __str__(self):
    <span class="docEmphStrong">return</span> '%.2f' % self.value</pre></div><br>
<p class="docText">And here is the resulting output with both <tt>str()</tt> and <tt>repr()</tt> output:</P>
<div class="docText"><pre>    &gt;&gt;&gt; rfm = RoundFloatManual(5.5964)
    &gt;&gt;&gt; rfm
    5.60
    &gt;&gt;&gt; <span class="docEmphStrong">print</span> rfm
    5.60</pre></div><br>
<p class="docText"><a name="iddle2900"></a><a name="iddle3151"></a>In our original <tt>RoundFloat</tt> example at the beginning of this chapter, we did not have to worry about all the fine-grained object display stuff; the reason is that <tt>__str__()</tt> and <tt>__repr__()</tt> have already been defined for us as part of the float class. All we did was inherit them. Our more &quot;manual&quot; version required additional work from us. Do you see how useful derivation is? You do not even need to know how far up the inheritance tree the interpreter needs to go to find a declared method that you are using without guilt. We present the full code of this class in <a class="docLink" href="#ch13list02">Example 13.2</a>.</P>
<a name="ch13list02"></a><h5 id="title-IDA1S2KN" class="docExampleTitle">Example 13.2. Basic Customization (<tt>roundFloat2.py</tt>)</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>



<pre>1  #!/usr/bin/env python
2
3  <span class="docEmphStrong">class</span> RoundFloatManual(object):
4     <span class="docEmphStrong">def</span> __init__(self, val):
5        <span class="docEmphStrong">assert</span> isinstance(val, float), \
6        "Value must be a float!"
7        self.value = round(val, 2)
8
9     <span class="docEmphStrong">def</span> __str__(self):
10       <span class="docEmphStrong">return</span> '%.2f' % self.value
11
12    __repr__ = __str__</pre><BR>

</TD></tr></table></p>
<p class="docText">Now let us try a slightly more complex example.</p>

<a name="ch13lev2sec43"></a>
<H4 id="title-IDADU2KN" class="docSection2Title">13.13.2. Numeric Customization (<tt>Time60</tt>)</h4>
<p class="docText">For our first realistic example, let us say we wanted to create a simple application that manipulated time as measured in hours and minutes. The class we are going to create can be used to track the time worked by an employee, the amount of time spent online by an ISP (Internet service provider) subscriber, the amount of total uptime for a database (not inclusive of downtime for backups and upgrades), the total amount of time played in a poker tournament, etc.</P>
<p class="docText">For our <tt>Time60</tt> class, we will take integers as hours and minutes as input to our constructor.</p>
<div class="docText"><pre><span class="docEmphStrong">class</span> Time60(object):            # ordered pair
    <span class="docEmphStrong">def</span> __init__(self, hr, min): # constructor
        self.hr = hr             # assign hours
        self.min = min           # assign minutes</pre></div><BR>
<a name="ch13lev3sec22"></a>

<h5 id="title-IDAGV2KN" class="docSection3Title">Display</H5>
<p class="docText"><a name="iddle3286"></a>Also, as seen in the previous example, we want meaningful output if we display our instances, so we need to override <tt>__str__()</tt> (and <tt>__repr__()</tt> if so desired). As humans, we are used to seeing hours and minutes in colon-delimited format, e.g. &quot;4:30,&quot; representing four and a half hours (four hours and thirty minutes):</P>
<div class="docText"><pre><span class="docEmphStrong">def</span> __str__(self):
    <span class="docEmphStrong">return</span> '%d:%d' % (self.hr, self.min)</pre></div><br>
<p class="docText">Using this class, we can instantiate some objects. In the example below, we are starting a timesheet to track the number of billable hours for a contractor:</p>
<div class="docText"><pre>    &gt;&gt;&gt; mon = Time60(10, 30)
    &gt;&gt;&gt; tue = Time60(11, 15)
    &gt;&gt;&gt;
    &gt;&gt;&gt; <span class="docEmphStrong">print</span> mon, tue
    10:30 11:15</pre></div><br>
<p class="docText">The output is very nice, exactly what we wanted to see. What is the next step? Let us say we want our objects to interact. In particular, for our timesheet application, it is a necessity to be able to add <tt>Time60</tt> instances together and have our objects do all meaningful operations. We would love to see something like this:</p>
<div class="docText"><pre>    &gt;&gt;&gt; mon + tue
    21:45</pre></div><BR>

<a name="ch13lev3sec23"></a>
<h5 id="title-IDAIX2KN" class="docSection3Title">Addition</h5>
<p class="docText">With Python, overloading operators is simple. For the plus sign ( <tt>+</tt> ), we need to overload the <tt>__add__()</tt> special method, and perhaps <tt>__radd__()</tt> and <tt>__iadd__()</tt>, if applicable. More on those in a little while. Implementing <tt>__add__()</tt> does not sound too difficultwe just add the hours together followed by the minutes. Most of the complexity lies in what we do with the new totals. If we want to see &quot;21:45,&quot; we have to realize that <span class="docEmphasis">that</span> is another <tt>Time60</tt> object. We are not modifying <tt>mon</tt> or <tt>tue</tt>, so our method would have to create another object and fill it in with the sums we calculated.</P>
<p class="docText">We implement the <tt>__add__()</tt> special method in such a way that we calculate the individual sums first, then call the class constructor to return a new object:</p>
<div class="docText"><pre><span class="docEmphStrong">def</span> __add__(self, other):
    <span class="docEmphStrong">return</span> self.__class__(self.hr + other.hr,
        self.min + other.min)</pre></div><br>
<p class="docText">The new object is created by invoking the class as in any normal situation. The only difference is that from within the class, you typically would not invoke <a name="iddle1186"></a><a name="iddle2435"></a>the class name directly. Rather, you take the <tt>__class__</tt> attribute of <tt>self</tt>, which is the class from which <tt>self</tt> was instantiated, and invoke <span class="docEmphasis">that</span>. Because <tt>self.__class__</tt> is the same as <tt>Time60</tt>, calling <tt>self.__class__()</tt> is the same as calling <tt>Time60()</tt>.</p>
<p class="docText">This is the more object-oriented approach anyway. The other reason is that if we used the real class name everywhere we create a new object and later on decided to change the class name to something else, we would have to perform very careful global search-and-replace. By using <tt>self.__class__</tt>, we do not have to do anything other than change the name in the <span class="docEmphStrong"><tt>class</tt></span> directive.</P>
<p class="docText">With our plus sign overloading, we can now &quot;add&quot; <tt>Time60</tt> objects:</P>
<div class="docText"><pre>    &gt;&gt;&gt; mon = Time60(10, 30)
    &gt;&gt;&gt; tue = Time60(11, 15)
    &gt;&gt;&gt; mon + tue
    &lt;time60.Time60 object at 0x62190&gt;
    &gt;&gt;&gt; <span class="docEmphStrong">print</span> mon + tue
    21:45</pre></div><br>
<p class="docText">Oops, we forgot to add an <tt>__repr__ </tt>alias to <tt>__str__</tt>, which is easily fixable.</p>
<p class="docText">One question you may have is, &quot;What happens when I try to use an operator in an overload situation where I do not have the appropriate special methods defined?&quot; The answer is a <tt>TypeError</tt> exception:</p>
<div class="docText"><pre>    &gt;&gt;&gt; mon - tue
    Traceback (most recent call last):
      File "&lt;stdin&gt;", line 1, in ?

    TypeError: unsupported operand type(s) for -: 'Time60'
    and 'Time60'</pre></div><br>

<a name="ch13lev3sec24"></a>
<h5 id="title-IDALD3KN" class="docSection3Title">In-Place Addition</h5>
<p class="docText">With augmented assignment (introduced back in Python 2.0), we may also wish to override the &quot;in-place&quot; operators, for example, <tt>__iadd__()</tt>. This is for supporting an operation like <tt>mon += tue</tt> and having the correct result placed in <tt>mon</tt>. The only trick with overriding an <tt>__i*__()</tt> method is that it has to return <tt>self</tt>. Let us add the following bits of code to our example, fixing our <tt>repr()</tt> issue above as well as supporting augmented assignment:</p>
<div class="docText"><pre>__repr__ = __str__

<span class="docEmphStrong">def</span> __iadd__(self, other):
    self.hr += other.hr
    self.min += other.min
    <span class="docEmphStrong">return</span> self</pre></div><br>
<p class="docText">Here is our resulting output:</p>
<div class="docText"><pre>    &gt;&gt;&gt; mon = Time60(10, 30)
    &gt;&gt;&gt; tue = Time60(11, 15)
    &gt;&gt;&gt; mon
    10:30
    &gt;&gt;&gt; id(mon)
    401872
    &gt;&gt;&gt; mon += tue
    &gt;&gt;&gt; id(mon)
    401872
    &gt;&gt;&gt; mon
    21:45</pre></div><br>
<p class="docText">Note the use of the <tt>id()</tt> built-in function to confirm that before and after the in-place addition we are indeed modifying the same object and not creating a new one. This is a great start at a class that has a lot of potential. The complete class definition for <tt>Time60</tt> is given in <a class="docLink" href="#ch13list03">Example 13.3</a>.</p>
<a name="ch13list03"></a><h5 id="title-IDAOF3KN" class="docExampleTitle">Example 13.3. Intermediate Customization (<tt>time60.py</tt>)</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>



<pre>1  #!/usr/bin/env python
2
3  <span class="docEmphStrong">class</span> Time60(object):
4     'Time60 - track hours and minutes'
5
6     <span class="docEmphStrong">def</span> __init__(self, hr, min):
7     'Time60 constructor - takes hours and minutes'
8          self.hr = hr
9          self.min = min
10
11    <span class="docEmphStrong">def</span> __str__(self):
12         'Time60 - string representation'
13         <span class="docEmphStrong">return</span> '%d:%d' % (self.hr, self.min)
14
15    __repr__ = __str__
16
17    <span class="docEmphStrong">def</span> __add__(self, other):
18         'Time60 - overloading the addition operator'
19         <span class="docEmphStrong">return</span> self.__class__(self.hr + other.hr,
20         self.min + other.min)
21
22    <span class="docEmphStrong">def</span> __iadd__(self, other):
23         'Time60 - overloading in-place addition'
24         self.hr += other.hr
25         self.min += other.min
26         <span class="docEmphStrong">return</span> self</pre><BR>

</td></TR></table></p>

<p class="docText"></P><a name="ch13list04"></a><H5 id="title-IDADH3KN" class="docExampleTitle">Example 13.4. Random Sequence Iterator (<tt>randSeq.py</tt>)</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>



<pre>1  #!/usr/bin/env python
2
3  <span class="docEmphStrong">from</span> random <span class="docEmphStrong">import</span> choice
4
5  <span class="docEmphStrong">class</span> RandSeq(object):
6     <span class="docEmphStrong">def</span> __init__(self, seq):
7          self.data = seq
8
9     <span class="docEmphStrong">def</span> __iter__(self):
10         <span class="docEmphStrong">return</span> self
11
12    <span class="docEmphStrong">def</span> next(self):
13         <span class="docEmphStrong">return</span> choice(self.data)</pre><br>

</TD></tr></table></P>

<a name="ch13lev3sec25"></a>
<h5 id="title-IDAYI3KN" class="docSection3Title">Further Refinements</H5>
<p class="docText"><a name="iddle2558"></a><a name="iddle2898"></a><a name="iddle2901"></a><a name="iddle3095"></a><a name="iddle3527"></a>We will leave it here, but there is plenty of optimization and significant improvements that can be made to this class. For example, wouldn't it be nice if we could just feed a 2-tuple (10, 30) into our constructor rather than having to pass in two separate arguments? What about a string like &quot;10:30&quot;?</p>
<p class="docText">The answer is yes, you can, and it <span class="docEmphasis">is</span> easy to do in Python but not by overloading the constructor as the case may be with other object-oriented programming languages. Python does not allow overloading callables with multiple signatures, so the only way to make it happen is with a single constructor and performing self-introspection with the <tt>isinstance()</tt> and (perhaps) <tt>type()</tt> built-in functions.</P>
<p class="docText">Supporting multiple forms of input makes our application more robust and flexible. The same is true for the ability to perform other operations like subtraction. Of course these are optional and serve as icing on the cake, but what we <span class="docEmphasis">should</span> be worried about first are two moderate flaws: undesired formatting when there are fewer than ten minutes and the lack of support of <span class="docEmphasis">sexagesimal</span><sup class="docFootnote"><a class="docLink" href="#ch13fn09">[1]</a></sup> (base 60) operations:</P><blockquote><p class="docFootnote"><sup><a name="ch13fn09">[1]</a></sup> Latin-originated name for base 60; sometimes <span class="docEmphasis">hexagesimal</span> is used, a hybrid combining the Greek root &quot;hexe&quot; with the Latin &quot;gesimal.&quot;</p></blockquote>
<div class="docText"><pre>    &gt;&gt;&gt; wed = Time60(12, 5)
    &gt;&gt;&gt; wed
    12:5
    &gt;&gt;&gt; thu = Time60(10, 30)
    &gt;&gt;&gt; fri = Time60(8, 45)
    &gt;&gt;&gt; thu + fri
    18:75</pre></div><br>
<p class="docText"><a name="iddle2567"></a><a name="iddle2897"></a>Displaying <tt>wed</tt> should have resulted in &quot;12:05,&quot; and summing <tt>thu</tt> and <tt>fri</tt> should have given an output of &quot;19:15.&quot; The fixes for these flaws and the improvements suggested just above are great practice building your class customization skills. You can get a more complete description of these upgrades in <a class="docLink" href="ch13lev1sec18.html#ch13qa1q20">Exercise 13-20</a> at the end of the chapter.</p>
<p class="docText">Hopefully, you now have a better understanding of operator overloading, why you would want to do it, and how you can implement special methods to accomplish that task. Let's look at more complex customizations, continuing with the optional section that follows.</p>



<a name="ch13lev2sec44"></a>
<H4 id="title-IDAHM3KN" class="docSection2Title">13.13.3. Iterators (<tt>RandSeq</tt> and <tt>AnyIter</tt>)</h4>
<a name="ch13lev3sec26"></a>
<h5 id="title-IDAUM3KN" class="docSection3Title">RandSeq</H5>
<p class="docText">We were introduced to iterators formally in <a class="docLink" href="ch08.html#ch08">Chapter 8</a> but we have been using them throughout this text. They are simply a mechanism to go through items of a sequence (or sequence-like object) one at a time. In <a class="docLink" href="ch08.html#ch08">Chapter 8</a> we described how implementing the <tt>__iter__()</tt> and <tt>next()</tt> methods of a class can be used to create an iterator. We will demonstrate that with two examples here.</p>
<p class="docText">The first example is a <tt>RandSeq</tt> (short for RANDom SEQuence). We feed an initial sequence to our class, then let the user iterate (infinitely) through it via <tt>next()</tt>.</p>
<p class="docText">The <tt>__init__()</tt> method does the aforementioned assignment. The <tt>__iter__()</tt> just returns self, which is how you declare an object is an iterator, and finally, <tt>next()</tt> is called to get successive values of iteration. The only catch with this iterator is that it never ends.</p>
<p class="docText">This example demonstrates some unusual things we can do with custom class iterations. One is infinite iteration. Because we read the sequence nondestructively, we never run out of elements. Each time the user calls <tt>next()</tt>, it gets the next value, but our object never raises <tt>StopIteration</tt>. If we run it, we will get output similar to the following:</P>
<div class="docText"><pre>    &gt;&gt;&gt; <span class="docEmphStrong">from</span> randseq <span class="docEmphStrong">import</span> RandSeq
    &gt;&gt;&gt; <span class="docEmphStrong">for</span> eachItem <span class="docEmphStrong">in</span> RandSeq(
    ...         ('rock', 'paper', 'scissors')):
    ...     <span class="docEmphStrong">print</span> eachItem
    ...
    scissors
    scissors
    rock
    paper
    paper
    scissors
    :</pre></div><BR>

<p class="docText"></p><a name="ch13list05"></a><h5 id="title-IDAJP3KN" class="docExampleTitle">Example 13.5. Any Number of Items Iterator (<tt>anyIter.py</tt>)</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>



<pre>1  #!/usr/bin/env python
2
3  <span class="docEmphStrong">class</span> AnyIter(object):
4      <span class="docEmphStrong">def</span> __init__(self, data, safe=False):
5          self.safe = safe
6          self.iter = iter(data)
7
8      <span class="docEmphStrong">def</span> __iter__(self):
9          <span class="docEmphStrong">return</span> self
10
11     <span class="docEmphStrong">def</span> next(self, howmany=1):
12         retval = []
13         <span class="docEmphStrong">for</span> eachItem  <span class="docEmphStrong">in</span> range(howmany):
14             <span class="docEmphStrong">try</span>:
15                retval.append(self.iter.next())
16             <span class="docEmphStrong">except</span> StopIteration:
17                <span class="docEmphStrong">if</span> self.safe:
18                     <span class="docEmphStrong">break</span>
19                <span class="docEmphStrong">else</span>:
20                     <span class="docEmphStrong">raise</span>
21         <span class="docEmphStrong">return</span> retval</pre><br>

</td></tr></table></p>

<a name="ch13lev3sec27"></a>
<h5 id="title-IDAWR3KN" class="docSection3Title"><tt>AnyIter</tt></h5>
<p class="docText">In the second example, we do create an iterator object, but rather than iterating through one item at a time, we give the <tt>next()</tt> method an argument telling how many items to return. Here is the code for our (ANY number of items ITERator):</P>
<p class="docText">Like <tt>RandSeq</tt>, the <tt>AnyIter</tt> class should be fairly simple to figure out. We described the basic operation above... it works just like any other iterator except that users can request the next <span class="docEmphasis">N</span> items of the iterable instead of only one.</p>
<p class="docText">We create the object by being given an iterable and a <tt>safe</tt> flag. If the flag is <tt>TRue</tt>, we will return any items retrieved before exhausting the iterable, but if the flag is <tt>False</tt>, we will reraise the exception if the user asked for too many items. The core of any complexity lies in <tt>next()</tt>, specifically how it quits (lines 14-21).</p>
<p class="docText">In the last part of <tt>next()</tt>, we create a list of items to return and call the object's <tt>next()</tt> for each item. If we exhaust the list and get a <tt>StopIteration</tt> exception, we check the <tt>safe</tt> flag. If unsafe, we throw the exception <a name="iddle2899"></a><a name="iddle3008"></a>back to the caller (<span class="docEmphStrong"><tt>raise</tt></span>); otherwise, we return whatever items we have saved up (<span class="docEmphStrong"><tt>break</tt></span> and <span class="docEmphStrong"><tt>return</tt></span>).</P>
<div class="docText"><pre>    &gt;&gt;&gt; a = AnyIter(range(10))
    &gt;&gt;&gt; i = iter(a)
    &gt;&gt;&gt; <span class="docEmphStrong">for</span> j  <span class="docEmphStrong">in</span> range(1,5):
    &gt;&gt;&gt;     <span class="docEmphStrong">print</span> j, ':', i.next(j)
    1 : [0]
    2 : [1, 2]
    3 : [3, 4, 5]
    4 : [6, 7, 8, 9]</pre></div><br>
<p class="docText">The execution above ran fine because the iteration fit the number of items perfectly. What happens when things go awry? Let us try &quot;unsafe&quot; mode first, which is how we created our iterator to begin with from above:</P>
<div class="docText"><pre>    &gt;&gt;&gt; i = iter(a)
    &gt;&gt;&gt; i.next(14)
    Traceback (most recent call last):
      File "&lt;stdin&gt;", line 1, in ?
      File "anyIter.py", line 15, in next
        retval.append(self.iter.next())
      StopIteration</pre></div><br>
<p class="docText">The <tt>StopIteration</tt> exception was raised because we exceeded our supply of items, and that exception was reraised back to the caller (line 20). If we were to recreate the iterator in &quot;safe&quot; mode and run it with the same example, we get back whatever the iterator could get us before running out of items:</P>
<div class="docText"><pre>    &gt;&gt;&gt; a = AnyIter(range(10), True)
    &gt;&gt;&gt; i = iter(a)
    &gt;&gt;&gt; i.next(14)
    [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</pre></div><BR>



<a name="ch13lev2sec45"></a>
<H4 id="title-IDAKV3KN" class="docSection2Title">13.13.4. *Multi-type Customization (<tt>NumStr</tt>)</H4>
<p class="docText">Let us create another new class, <tt>NumStr</tt>, consisting of a number-string ordered pair, called <span class="docEmphasis">n</span> and <span class="docEmphasis">s</span>, respectively, using integers as our number type. Although the &quot;proper&quot; notation of an ordered pair is <tt>(n, s)</tt>, we choose to represent our pair as <tt>[n :: s]</tt> just to be different. Regardless of the notation, these two data elements are inseparable as far as our model is concerned. We want to set up our new class, called <tt>NumStr</tt>, with the following characteristics:</p>
<a name="ch13lev3sec28"></a>

<h5 id="title-IDAGW3KN" class="docSection3Title">Initialization</h5>
<p class="docText">The class should be initialized with both the number and string; if either (or both) is missing, then 0 and the empty string should be used, i.e., <tt>n=0</tt> and <tt>s=''</tt>, as defaults.</P>

<a name="ch13lev3sec29"></a>
<h5 id="title-IDAXW3KN" class="docSection3Title">Addition</H5>
<p class="docText">We define the addition operator functionality as adding the numbers together and concatenating the strings; the tricky part is that the strings must be concatenated in the correct order. For example, let <tt>NumStr1 = [n1 :: s1]</tt> and <tt>NumStr2 = [n2 :: s2]</tt>. Then <tt>NumStr1 + NumStr2</tt> is performed as <tt>[n1 + n2 :: s1 + s2]</tt> where <tt>+</tt> represents addition for numbers and concatenation for strings.</p>

<a name="ch13lev3sec30"></a>
<H5 id="title-IDAOX3KN" class="docSection3Title">Multiplication</h5>
<p class="docText">Similarly, we define the multiplication operator functionality as multiplying the numbers together and repeating or concatenating the strings, i.e., <tt>NumStr1 * NumStr2 = [n1 * n :: s1 * n]</tt>.</P>

<a name="ch13lev3sec31"></a>
<H5 id="title-IDA3X3KN" class="docSection3Title">False Value</h5>
<p class="docText">This entity has a false value when the number has a numeric value of zero and the string is empty, i.e., when <tt>NumStr = [0 :: '']</tt>.</p>

<a name="ch13lev3sec32"></a>
<h5 id="title-IDAPY3KN" class="docSection3Title">Comparisons</h5>
<p class="docText">Comparing a pair of <tt>NumStr</tt> objects, i.e., <tt>[n1 :: s1]</tt> vs. <tt>[n2 :: s2]</tt>, we find nine different combinations (i.e., <tt>n1 &gt; n2</tt> and <tt>s1 &lt; s2</tt>, <tt>n1 == n2</tt> and <tt>s1 &gt; s2</tt>, etc.). We use the normal numeric and lexicographic compares for numbers and strings, respectively, i.e., the ordinary comparison of <tt>cmp(obj1</tt>, <tt>obj2</tt>) will return an integer less than zero if <tt>obj1 &lt; obj2</tt>, greater than zero if <tt>obj1 &gt; obj2</tt>, or equal to zero if the objects have the same value.</P>
<p class="docText">The solution for our class is to add both of these values and return the result. The interesting thing is that <tt>cmp()</tt> does not always return -1, 0, or 1 for us. It is, as described above, an integer less than, equal to, or greater than zero.</p>
<p class="docText">In order to correctly compare our objects, we need <tt>__cmp__()</tt> to return a value of 1 if <tt>(n1 &gt; n2)</tt> and <tt>(s1 &gt; s2)</tt>, -1 if <tt>(n1 &lt; n2)</tt> and <tt>(s1 &lt; s2)</tt>, and 0 if both sets of numbers and strings are the same, or if the comparisons offset each other, i.e., <tt>(n1 &lt; n2)</tt> and <tt>(s1 &gt; s2)</tt>, or vice versa.</p>

<p class="docText"></P><a name="ch13list06"></a><h5 id="title-IDAL03KN" class="docExampleTitle">Example 13.6. Multi-Type Class Customization (<tt>numstr.py</tt>)</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><TD>



<pre>1  #!/usr/bin/env python
2
3  <span class="docEmphStrong">class</span> NumStr(object):
4
5      <span class="docEmphStrong">def</span> __init__(self, num=0, string=''):
6          self.__num = num
7          self.__string = string
8
9      <span class="docEmphStrong">def</span> __str__(self):        # define for str()
10         <span class="docEmphStrong">return</span> '[%d :: %r]' % \
11             self.__num, self.__string)
12     __repr__ = __str__
13
14     <span class="docEmphStrong">def</span> __add__(self, other):     # define for s+o
15         <span class="docEmphStrong">if</span> isinstance(other, NumStr):
16             <span class="docEmphStrong">return</span> self.__class__(self.__num + \
17                 other.__num, \
18                 self.__string + other.__string)
19         <span class="docEmphStrong">else</span>:
20             <span class="docEmphStrong">raise</span> TypeError, \
21     'Illegal argument type for built-in operation'
22
23     <span class="docEmphStrong">def</span> __mul__(self, num):       # define for o*n
24         <span class="docEmphStrong">if</span> isinstance(num, int):
25             <span class="docEmphStrong">return</span> self.__class__(self.__num * num
26                 self.__string * num)
27        <span class="docEmphStrong">else</span>:
28            <span class="docEmphStrong">raise</span> TypeError, \
29     'Illegal argument type for built-in operation'
30
31     <span class="docEmphStrong">def</span> __nonzero__(self):        # False if both are
32         <span class="docEmphStrong">return</span> self.__num  <span class="docEmphStrong">or</span> len(self.__string)
33
34     <span class="docEmphStrong">def</span> __norm_cval(self, cmpres):# normalize cmp()
35         <span class="docEmphStrong">return</span> cmp(cmpres, 0)
36
37     <span class="docEmphStrong">def</span> __cmp__(self, other):     # define for cmp()
38         <span class="docEmphStrong">return</span> self.__norm_cval(
39                 cmp(self.__num, other.__num)) + \
40             self.__norm_cval(
41                 cmp(self.__string, other.__string))</pre><br>

</td></tr></table></p>
<p class="docText">Given the above criteria, we present the code below for <tt>numStr.py</tt>, with some sample execution:</p>
<div class="docText"><pre>   &gt;&gt;&gt; a = NumStr(3, 'foo')
   &gt;&gt;&gt; b = NumStr(3, 'goo')
   &gt;&gt;&gt; c = NumStr(2, 'foo')
   &gt;&gt;&gt; d = NumStr()
   &gt;&gt;&gt; e = NumStr(string='boo')
   &gt;&gt;&gt; f = NumStr(1)
   &gt;&gt;&gt; a
   [3 :: 'foo']
   &gt;&gt;&gt; b
   [3 :: 'goo']
   &gt;&gt;&gt; c
   [2 :: 'foo']
   &gt;&gt;&gt; d
   [0 :: '']
   &gt;&gt;&gt; e
   [0 :: 'boo']
   &gt;&gt;&gt; f
   [1 :: '']
   &gt;&gt;&gt; a &lt; b
   True
   &gt;&gt;&gt; b &lt; c
   False
   &gt;&gt;&gt; a == a
   True
   &gt;&gt;&gt; b * 2
   [6 :: 'googoo']
   &gt;&gt;&gt; a * 3
   [9 :: 'foofoofoo']
   &gt;&gt;&gt; b + e
   [3 :: 'gooboo']
   &gt;&gt;&gt; e + b
   [3 :: 'boogoo']
   &gt;&gt;&gt; <span class="docEmphStrong">if</span> d: 'not false'     # also bool(d)
   ...
   &gt;&gt;&gt; <span class="docEmphStrong">if</span> e: 'not false'     # also bool(e)
   ...
   'not false'
   &gt;&gt;&gt; cmp(a,b)
   -1
   &gt;&gt;&gt; cmp(a,c)
   1
   &gt;&gt;&gt; cmp(a,a)
   0</pre></div><br>

<a name="ch13lev3sec33"></a>
<h5 id="title-IDAI43KN" class="docSection3Title">Line-by-Line Explanation</h5>
<a name="ch13lev4sec4"></a>
<h5 id="title-IDAR43KN" class="docSection4Title">Lines 17</h5>
<p class="docText">The top of our script features the constructor <tt>__init__()</tt> setting up our instance initializing itself with the values passed via the class instantiator call <tt>NumStr()</tt>. If either value is missing, the attribute takes on the default false value of either zero or the empty string, depending on the argument.</p>
<p class="docText">One significant oddity is the use of double underscores to name our attributes. As we will find out in the next section, this is used to enforce a level, albeit elementary, of privacy. Programmers importing our module will not have straightforward access to our data elements. We are attempting to enforce one of the encapsulation properties of OO design by permitting access only through accessor functionality. If this syntax appears odd or uncomfortable to you, you can remove all double underscores from the instance attributes, and the examples will still work in the exact same manner.</p>
<p class="docText">All attributes that begin with a double underscore ( __ ) are &quot;mangled&quot; so that these names are not as easily accessible during runtime. They are not, however, mangled in such a way so that it cannot be easily reverse-engineered. In fact, the mangling pattern is fairly well known and easy to spot. The main point is to prevent the name from being accidentally used when it is imported by an external module where conflicts may arise. The name is changed to a new identifier name containing the class name to ensure that it does not get &quot;stepped on&quot; unintentionally. For more information, check out <a class="docLink" href="ch13lev1sec14.html#ch13lev1sec14">Section 13.14</a> on privacy.</P>

<a name="ch13lev4sec5"></a>
<h5 id="title-IDAR53KN" class="docSection4Title">Lines 912</H5>
<p class="docText">We choose the string representation of our ordered pair to be &quot;<tt>[num :: 'str']</tt>&quot; so it is up to <tt>__str__()</tt> to provide that representation whenever <tt>str()</tt> is applied to our instance and when the instance appears in a <span class="docEmphStrong"><tt>print</tt></span> statement. Because we want to emphasize that the second element is a string, it is more visually convincing if the users view the string surrounded by quotation marks. To that end, we use the &quot;<tt>repr()</tt>&quot; representation format conversion code &quot;<tt>%r</tt>&quot; instead of &quot;<tt>%s</tt>.&quot; It is equivalent to calling <tt>repr()</tt> or using the single back quotation marks to give the evaluatable version of a string, which <span class="docEmphasis">does</span> have quotation marks:</p>
<div class="docText"><pre>    &gt;&gt;&gt; <span class="docEmphStrong">print</span> a
    [3 :: 'foo']</pre></div><BR>
<p class="docText"><span class="docEmphasis">Not</span> calling <tt>repr()</tt> on <tt>self.__string</tt> (leaving the backquotes off or using &quot;<tt>%s</tt>&quot;) would result in the string quotations being absent:</p>
<div class="docText"><pre> <span class="docEmphStrong">return</span> '[%d :: %s]' % (self.__num, self.__string)</pre></div><BR>
<p class="docText">Now calling <span class="docEmphStrong"><tt>print</tt></span> again on an instance results in:</p>
<div class="docText"><pre>    &gt;&gt;&gt; <span class="docEmphStrong">print</span> a
    [3 :: foo]</pre></div><BR>
<p class="docText">How does that look without the quotations? Not as convincing that &quot;foo&quot; is a string, is it? It looks more like a variable. The author is not as convinced either. (We quickly and quietly back out of that change and pretend we never even touched it.)</P>
<p class="docText">The first line of code after the <tt>__str__()</tt> function is the assignment of that function to another special method name, <tt>__repr__</tt>. We made a decision that an evaluatable string representation of our instance should be the same as the printable string representation. Rather than defining an entirely new function that is a duplicate of <tt>__str__()</tt>, we just create an alias, copying the reference.</P>
<p class="docText">When you implement <tt>__str__()</tt>, it is the code that is called by the interpreter if you ever apply the <tt>str()</tt> built-in function using that object as an argument. The same goes for <tt>__repr__()</tt> and <tt>repr()</tt>.</P>
<p class="docText">How would our execution differ if we chose not to implement <tt>__repr__()</tt>? If the assignment is removed, only the <span class="docEmphStrong"><tt>print</tt></span> statement that calls <tt>str()</tt> will show us the contents of our object. The evaluatable string representation defaults to the Python standard of <tt>&lt;...some_object_ information...&gt;</tt>.</p>
<div class="docText"><pre>    &gt;&gt;&gt; <span class="docEmphStrong">print</span> a          # calls str(a)
    [3 :: 'foo']
    &gt;&gt;&gt; a                # calls repr(a)
    &lt;NumStr.NumStr instance at 122640&gt;</pre></div><br>

<a name="ch13lev4sec6"></a>
<h5 id="title-IDA11I3D" class="docSection4Title">Lines 1421</H5>
<p class="docText">One feature we would like to add to our class is the addition operation, which we described earlier. One of Python's features for customizing classes is that we can overload operators to make these types of customizations more &quot;realistic.&quot; Invoking a function such as &quot;<tt>add(obj1</tt>, <tt>obj2)</tt>&quot; to &quot;add&quot; objects <tt>obj1</tt> and <tt>obj2</tt> may <span class="docEmphasis">seem</span> like addition, but is it not more compelling to be able to invoke that same operation using the plus sign ( + ) like this? <img src=images/U21D2.jpg border=0> <tt>obj1 + obj2</tt></p>
<p class="docText">Overloading the plus sign requires the implementation of <tt>__add__()</tt> for <tt>self</tt> (SELF) and the other operand (OTHER). The <tt>__add__()</tt> function takes care of the <tt>Self + Other</tt> case, but we do not need to define <tt>__radd__()</tt> to handle the <tt>Other + Self</tt> because that is taken care of by the <tt>__add__()</tt> for <tt>Other</tt>. The numeric addition is not affected as much as the string concatenation because order matters.</P>
<p class="docText">The addition operation adds each of the two components, with the pair of results forming a new objectcreated as the results are passed to a call for instantiation as calling <tt>self.__class__</tt>() (again, also previously explained above). Any object other than a like type should result in a <tt>TypeError</tt> exception, which we raise in such cases.</p>

<a name="ch13lev4sec7"></a>
<H5 id="title-IDAN3I3D" class="docSection4Title">Lines 2329</h5>
<p class="docText">We also overload the asterisk [by implementing <tt>__mul__()</tt>] so that both numeric multiplication and string repetition are performed, resulting in a new object, again created via instantiation. Since repetition allows only an integer to the right of the operator, we must enforce this restriction as well. We also do not define <tt>__rmul__()</tt> for the same reason.</P>

<a name="ch13lev4sec8"></a>

<H5 id="title-IDAA4I3D" class="docSection4Title">Lines 3132</h5>
<p class="docText"><a name="iddle1169"></a><a name="iddle1800"></a><a name="iddle2363"></a><a name="iddle2873"></a><a name="iddle3229"></a><a name="iddle3457"></a><a name="iddle3474"></a>Python objects have a Boolean value at any time. For the standard types, objects have a false value when they are either a numeric equivalent of zero or an empty sequence or mapping. For our class, we have chosen both that its numeric value must be zero <span class="docEmphasis">and</span> that the string be empty in order for any such instance to have a false value. We override the <tt>__nonzero__()</tt> method for this purpose. Other objects such as those that strictly emulate sequence or mapping types use a length of zero as a false value. In those cases, you would implement the <tt>__len__()</tt> method to effect that functionality.</p>

<a name="ch13lev4sec9"></a>
<h5 id="title-IDA45I3D" class="docSection4Title">Lines 3441</h5>
<p class="docText"><tt>__norm_cval()</tt> (short for &quot;normalize <tt>cmp()</tt> value&quot;) is not a special method. Rather, it is a helper function to our overriding of <tt>__cmp__()</tt>; its sole purpose is to convert all positive return values of <tt>cmp()</tt> to 1, and all negative values to -1. <tt>cmp()</tt> normally returns arbitrary positive or negative values (or zero) based on the result of the comparison, but for our purposes, we need to restrict the return values to only -1, 0, and 1. Calling <tt>cmp()</tt> with integers and comparing to zero will give us the result we need, being equivalent to the following snippet of code:</P>
<div class="docText"><pre><span class="docEmphStrong">def</span> __norm_cval(self, cmpres):
    <span class="docEmphStrong">if</span> cmpres &lt; 0:
        <span class="docEmphStrong">return</span> -1
    <span class="docEmphStrong">elif</span> cmpres &gt; 0:
        <span class="docEmphStrong">return</span> 1
    <span class="docEmphStrong">else</span>:
        <span class="docEmphStrong">return</span> 0</pre></div><br>
<p class="docText">The actual comparison of two like objects consists of comparing the numbers and the strings, and returning the sum of the comparisons.</p>







<a href="14051536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec12.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch13lev1sec14.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>