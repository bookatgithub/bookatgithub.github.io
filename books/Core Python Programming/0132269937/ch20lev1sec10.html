<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 20.10.&nbsp; Exercises</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch20lev1sec9.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch21.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch20lev1sec10"></a>

<h3 id="700181-808" class="docSection1Title">20.10. Exercises</H3>
<p><table border="0" cellspacing="16" cellpadding="0"><TR valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q1"></a><B>20-1.</b></TD><td><p class="docText"><span class="docEmphasis"><tt>urllib</tt></span> <span class="docEmphasis">Module and Files</span>. Update the <tt>friends3.py</tt> script so that it stores names and corresponding number of friends into a two-column text file on disk and continues to add names each time the script is run.</p>
<p class="docText">Extra Credit: Add code to dump the contents of such a file to the Web browser (in HTML format). Additional Extra Credit: Create a link that clears all the names in this file.</p></TD></tr><TR valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q2"></a><B>20-2.</b></td><TD><p class="docText"><span class="docEmphasis"><tt>urllib</tt></span> <span class="docEmphasis">Module</span>. Write a program that takes a user-input URL (either a Web page or an FTP file, i.e., <tt><a class="docLink" target="_blank" href="http://python.org">http://python.org</a></tt> or <tt>ftp://ftp.python.org/pub/python/README)</tt>, and downloads it to your machine with the same filename (or modified name similar to the original if it is invalid on your system). Web pages (HTTP) should be saved as .<tt>htm</tt> or .<tt>html</tt> files, and FTP'd files should retain their extension.</P></td></tr><tr valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q3"></a><B>20-3.</b></td><td><p class="docText"><span class="docEmphasis"><tt>urllib</tt></span> <span class="docEmphasis">Module</span>. Rewrite the <tt>grabWeb.py</tt> script of Example 11.,4, which downloads a Web page and displays the first and last non-blank lines of the resulting HTML file so that you use <tt>urlopen()</tt> instead of <tt>urlretrieve()</tt> to process the data directly (as opposed to downloading the entire file first before processing it).</P></td></tr><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q4"></a><B>20-4.</b></td><td><p class="docText"><span class="docEmphasis">URLs and Regular Expressions</span>. Your browser may save your favorite Web site URLs as a &quot;bookmarks&quot; HTML file (Mozilla-flavored browsers do this) or as a set of .URL files in a &quot;favorites&quot; directory (IE does this). Find your browser's method of recording your &quot;hot links&quot; and the location of where and how they stored. Without altering any of the files, strip the URLs and names of the corresponding Web sites (if given) and produce a two-column list of names and links as output, and storing this data into a disk file. Truncate site names or URLs to keep each line of output within 80 columns in size.</p></td></tr><tr valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q5"></a><b>20-5.</b></td><td><p class="docText"><span class="docEmphasis">URLs</span>, <span class="docEmphasis"><tt>urllib</tt></span> <span class="docEmphasis">Module, Exceptions, and REs</span>. As a follow-up problem to the previous one, add code to your script to test each of your favorite links. Report back a list of dead links (and their names), i.e., Web sites that are no longer active or a Web page that has been removed. Only output and save to disk the still-valid links.</p></td></TR><tr><TD></td><TD></td></TR><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q6"></a><B>20-6.</b></TD><TD><p class="docText"><span class="docEmphasis">Error Checking</span>. The <tt>friends3.py</tt> script reports an error if no radio button was selected to indicate the number of friends. Update the CGI script to also report an error if no name (e.g., blank or whitespace) is entered.</p>
<p class="docText">Extra Credit: We have so far explored only server-side error checking. Explore JavaScript programming and implement client-side error checking by creating JavaScript code to check for both error situations so that these errors are stopped before they reach the server.</p>
<p class="docText">Problems 20-7 to 20-10 below pertain to <span class="docEmphasis">Web server access log files and regular expressions</span>. Web servers (and their administrators) generally have to maintain an access log file (usually <tt>logs/access_log</tt> from the main Web, server directory) which tracks requests file. Over a period of time, such files get large and either need to be stored or truncated. Why not save only the pertinent information and delete the files to conserve disk space? The exercises below are designed to give you some exercise with REs and how they can be used to help archive and analyze Web server data.</p></TD></tr><TR valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q7"></a><B>20-7.</b></td><TD><p class="docText">Count how many of each type of request (GET versus POST) exist in the log file.</P></td></tr><tr valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q8"></a><B>20-8.</b></td><td><p class="docText">Count the successful page/data downloads: Display all links that resulted in a return code of 200 (OK [no error]) and how many times each link was accessed.</P></td></tr><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q9"></a><B>20-9.</b></td><td><p class="docText">Count the errors: Show all links that resulted in errors (return codes in the 400s or 500s) and how many times each link was accessed.</p></td></tr><tr valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q10"></a><b>20-10.</b></td><td><p class="docText">Track IP addresses: For each IP address, output a list of each page/data downloaded and how many times that link was accessed.</p></td></TR><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q11"></a><b>20-11.</b></TD><td><p class="docText"><span class="docEmphasis">Simple CGI</span>. Create a &quot;Comments&quot; or &quot;Feedback&quot; page for a Web site. Take user feedback via a form, process the data in your script, and return a &quot;thank you&quot; screen.</P></td></TR><TR valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q12"></a><B>20-12.</b></td><td><p class="docText"><span class="docEmphasis">Simple CGI</span>. Create a Web guestbook. Accept a name, an e-mail address, and a journal entry from a user and log it to a file (format of your choice). Like the previous problem, return a &quot;thanks for filling out a guestbook entry&quot; page. Also provide a link that allows users to view guestbooks.</p></TD></tr><TR valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q13"></a><B>20-13.</b></td><TD><p class="docText"><span class="docEmphasis">Web Browser Cookies and Web site Registration</span>. Update your solution to <a class="docLink" href="#ch20qa1q4">Exercise 20-4</a>. So your user-password information should now pertain to Web site registration instead of a simple text-based menu system.</P>
<p class="docText">Extra Credit: familiarize yourself with setting Web browser cookies and maintain a login session for 4 hours from the last successful login.</p></td></tr><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q14"></a><b>20-14.</b></td><TD><p class="docText"><span class="docEmphasis">Web Clients</span>. Port <a class="docLink" href="ch20lev1sec2.html#ch20list01">Example 20.1</a>, <tt>crawl.py</tt>, the Web crawler, to using the <tt>HTMLParser</tt> module or the BeautifulSoup parsing system.</p></td></tr><TR valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q15"></a><b><a class="docLink" href="app01lev1sec19.html#app01qa19q0a1">20-15.</a></b></td><td><p class="docText"><span class="docEmphasis">Errors</span>. What happens when a CGI script crashses? How can the <tt>cgitb</tt> module be helpful?</p></td></tr><tr valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q16"></a><b>20-16.</b></td><td><p class="docText"><span class="docEmphasis">CGI, File Updates, and Zip Files</span>. Create a CGI application that not only saves files to the server's disk, but also intelligently unpacks Zip files (or other archive) into a subdirectory named after the archive file.</p></TD></tr><TR valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q17"></a><B>20-17.</b></td><TD><p class="docText"><span class="docEmphasis">Zope, Plone, TurboGears, Django</span>. Investigate each of these complex Web development platforms and create one simple application in each.</p></TD></TR><TR valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q18"></a><b>20-18.</b></td><td><p class="docText"><span class="docEmphasis">Web Database Application</span>. Think of a database schema you want to provide as part of a Web database application. For this multi-user application, you want to provide everyone read access to the entire contents of the database, but perhaps only write access to each individual. One example may be an &quot;address book&quot; for your family and relatives. Each family member, once successfully logged in, is presented with a Web page with several options, add an entry, view my entry, update my entry, remove or delete my entry, and view all entries (entire database).</P>
<p class="docText">Design a <tt>UserEntry</tt> class and create a database entry for each instance of this class. You may use any solution created for any previous problem to implement the registration framework. Finally, you may use any type of storage mechanism for your database, either a relational database such as MySQL or some of the simpler Python persistent storage modules such as <tt>anydbm</tt> or <tt>shelve</tt>.</p></TD></tr><TR valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q19"></a><B>20-19.</b></TD><td><p class="docText"><span class="docEmphasis">Electronic Commerce Engine</span>. Use the classes created for your solution to <a class="docLink" href="ch13lev1sec18.html#ch13qa1q11">Exercise 13-11</a> and add some product inventory to create a potential electronic commerce Web site. Be sure your Web application also supports multiple customers and provides registration for each user.</p></td></tr><TR><td></td><TD></td></tr><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q20"></a><B>20-20.</b></td><td><p class="docText"><span class="docEmphasis">Dictionaries and <tt>cgi</tt> module</span>. As you know, the <tt>cgi.FieldStorage()</tt> method returns a dictionary-like object containing the key-value pairs of the submitted CGI variables. You can use methods such as <tt>keys()</tt> and <tt>has_key()</tt> for such objects. In Python 1.5, a <tt>get()</tt> method was added to dictionaries which returned the value of the requested key, or the default value for a non-existent key. <tt>FieldStorage</tt> objects do not have such a method. Let's say we grab the form in the usual manner of:</p>
<div class="docText"><pre>form = cgi.FieldStorage()</pre></div><br>
<p class="docText">Add a similar <tt>get()</tt> method to class definition in <tt>cgi.py</tt> (you can rename it to <tt>mycgi.py</tt> or something like that) such that code that looks like this:</p>
<div class="docText"><pre><span class="docEmphStrong">if</span> form.has_key('who'):
    who = form['who'].value
<span class="docEmphStrong">else</span>:
  who = '(no name submitted)'</pre></div><br>
<p class="docText">... can be replaced by a single line which makes forms even more like a dictionary:</p>
<div class="docText"><pre>howmany = form.get('who', '(no name submitted)')</pre></div><br>
</td></tr><tr valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q21"></a><B>20-21.</b></td><TD><p class="docText"><span class="docEmphasis">Creating Web Servers</span>. Our code for <tt>myhttpd.py</tt> in <a class="docLink" href="ch20lev1sec7.html#ch20lev1sec7">Section 20.7</a> is only able to read HTML files and return them to the calling client. Add support for plain text files with the &quot;.<tt>txt</tt>&quot; ending. Be sure that you return the correct MIME type of &quot;text/plain.&quot;</p>
<p class="docText">Extra credit: add support for JPEG files ending with either &quot;.<tt>jpg</tt>&quot; or &quot;.<tt>jpeg</tt>&quot; and having a MIME type of &quot;image/jpeg.&quot;</P></td></TR><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q22"></a><B>20-22.</b></TD><TD><p class="docText"><span class="docEmphasis">Advanced Web Clients</span>. URLs given as input to <tt>crawl.py</tt> must have the leading &quot;<tt>http://</tt>&quot; protocol indicator and top-level URLs must contain a trailing slash, i.e., <tt><a class="docLink" target="_blank" href="http://www.prenhallprofessional.com/">http://www.prenhallprofessional.com/</a></tt>. Make <tt>crawl.py</tt> more robust by allowing the user to input just the hostname (without the protocol part [make it assume HTTP]) and also make the trailing slash optional. For example, <tt><a class="docLink" target="_blank" href="http://www.prenhallprofessional.com">www.prenhallprofessional.com</a></tt> should now be acceptable input.</p></td></tr><TR valign="top"><td align="right" class="docText" width="50"><a name="ch20qa1q23"></a><B>20-23.</b></td><TD><p class="docText"><span class="docEmphasis">Advanced Web Clients</span>. Update the <tt>crawl.py</tt> script in <a class="docLink" href="ch20lev1sec3.html#ch20lev1sec3">Section 20.3</a> to also download links that use the &quot;<tt>ftp:</tt>&quot; scheme. All &quot;<tt>mailto:</tt>&quot; links are ignored by <tt>crawl.py</tt>. Add support to ensure that it also ignores &quot;<tt>telnet:</tt>&quot;, &quot;<tt>news:</tt>&quot;, &quot;<tt>gopher:</tt>&quot;, and &quot;<tt>about:</tt>&quot; links.</p></TD></TR><tr><td></td><td></TD></tr><tr valign="top"><TD align="right" class="docText" width="50"><a name="ch20qa1q24"></a><b>20-24.</b></td><td><p class="docText"><span class="docEmphasis">Advanced Web Clients</span>. The <tt>crawl.py</tt> script in <a class="docLink" href="ch20lev1sec3.html#ch20lev1sec3">Section 20.3</a> only downloads <tt>.html</tt> files via links found in Web pages at the same site and does not handle/save images that are also valid &quot;files&quot; for those pages. It also does not handle servers that are susceptible to URLs that are missing the trailing slash ( / ). Add a pair of classes to <tt>crawl.py</tt> to deal with these problems.</P>
<p class="docText">A <tt>My404UrlOpener</tt> class should subclass <tt>urllib.FancyURLOpener</tt> and consist of a single method, <tt>http_error_404()</tt> which determines if a 404 error was reached using a URL without a trailing slash. If so, it adds the slash and retries the request again (and only once). If it still fails, return a real 404 error. You must set <tt>urllib._urlopener</tt> with an instance of this class so that <tt>urllib</tt> uses it.</P>
<p class="docText">Create another class called <tt>LinkImageParser</tt>, which derives from <tt>htmllib.HTMLParser</tt>. This class should contain a constructor to call the base class constructor as well as initialize a list for the image files parsed from Web pages. The <tt>handle_image()</tt> method should be overridden to add image filenames to the image list (instead of discarding them like the current base class method does).</p></td></tr></table></p>

</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch20lev1sec9.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch21.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>