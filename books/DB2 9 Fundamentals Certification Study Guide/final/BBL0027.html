<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Creating Database (Data) Objects</title>
<link rel="STYLESHEET" type="text/css" href="images/css1.css">
<link rel="STYLESHEET" type="text/css" href="images/css2.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=BBL0026.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=BBL0028.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><div class="chapter">
<a name=""></a>
<div class="section">
<h2 class="first-section-title">
<a name="401"></a><a name="ch04le"></a>Creating Database (Data) Objects</h2>
<p class="first-para">Database objects, also known as data objects, are used to control how all user data (and some system data) is stored and organized within a DB2 database. Data objects include:</p>
<a name="402"></a><a name=""></a>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">Schemas</p>
</li>
<li class="listitem">
<p class="first-para">Tables</p>
</li>
<li class="listitem">
<p class="first-para">Views</p>
</li>
<li class="listitem">
<p class="first-para">Indexes</p>
</li>
<li class="listitem">
<p class="first-para">Aliases</p>
</li>
<li class="listitem">
<p class="first-para">Sequences</p>
</li>
<li class="listitem">
<p class="first-para">Triggers</p>
</li>
<li class="listitem">
<p class="first-para">User-defined data types</p>
</li>
<li class="listitem">
<p class="first-para">User-defined functions</p>
</li>
<li class="listitem">
<p class="first-para">Stored procedures</p>
</li>
<li class="listitem">
<p class="first-para">Packages</p>
</li>
</ul>
<div class="section">
<h3 class="sect3-title">
<a name="403"></a><a name="ch04lev"></a>Schemas</h3>
<p class="first-para">Schemas are objects that are used to logically classify and group other objects in the database. Because schemas are objects themselves, they have privileges associated with them that allow the schema owner to control which users can create, alter, and drop objects within them.</p>
<p class="para">Most objects in a database are named using a two-part naming convention. The first (leftmost) part of the name is called the <i class="emphasis">schema name</i> or <i class="emphasis">qualifier</i>, and the second (rightmost) part is called the <i class="emphasis">object name</i>. Syntactically, these two parts are concatenated and delimited with a period (for example, <span class="fixed">HR.EMPLOYEES</span>). When any object that can be qualified by a schema name (such as a table, view, index, user-defined data type, user-defined function, nickname, package, or trigger) is first created, it is assigned to a particular schema based on the qualifier in its name. <a class="internaljump" href="#ch0">Figure 4-7</a> illustrates how a table named <span class="fixed">STAFF</span> would be assigned to the <span class="fixed">PAYROLL</span> schema during the table creation process.</p>
<div class="figure">
<a name="404"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig212_01_0.jpg" NAME="IMG_62" target="_parent"><img alt="Image from book" id="IMG_62" src="images/fig212_01.jpg" height="256" width="340" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-7: </span>Assigning a table object to a schema.</span>
</div>
<a name="405"></a><a name=""></a>
<p class="para">Some schema names are reserved and cannot be used. An example includes the names assigned to the four schemas that are automatically created when a database is created-<span class="fixed">SYSIBM</span>, <span class="fixed">SYSCAT</span>, <span class="fixed">SYSSTAT</span>, and <span class="fixed">SYSFUN</span>.</p>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">If no schema/qualifier name is specified when an object is created, that object is assigned to the default schema, which is usually the user ID of the individual who created the object.</p>
</td>
</tr>
</table>
<p class="para">Schemas are implicitly created whenever a data object that has been assigned a qualifier that is different from existing schema names is created-provided the user creating the object holds <span class="fixed">IMPLICIT_SCHEMA</span> privilege. (Unless otherwise specified, when a new database is created, the group <span class="fixed">PUBLIC</span> is given <span class="fixed">IMPLICIT_SCHEMA</span> privilege. This allows any user to create objects in any schema not already in existence.) Schemas can be explicitly created by executing the <span class="fixed">CREATE SCHEMA</span> SQL statement. The basic syntax for this statement is:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SCHEMA [<i class="emphasis">SchemaName</i>]
&lt;<i class="emphasis">SQLStatement</i>, ...&gt;
<a name="406"></a><a name="IDX-"></a>
</pre>
</div>
<p class="para">or</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SCHEMA
AUTHORIZATION [<i class="emphasis">AuthorizationName</i>]
&lt;<i class="emphasis">SQLStatement</i>, ...&gt;
</pre>
</div>
<p class="para">or</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SCHEMA [<i class="emphasis">SchemaName</i>]
AUTHORIZATION [<i class="emphasis">AuthorizationName</i>]
&lt;<i class="emphasis">SQLStatement</i>, ...&gt;
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SchemaName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the schema to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">AuthorizationName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the user who is to be given ownership of the schema once it is created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SQLStatement</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Specifies one or more SQL statements that are to be executed together with the <span class="fixed">CREATE SCHEMA</span> statement. (Only the following SQL statements are valid: <span class="fixed">CREATE TABLE, CREATE VIEW, CREATE INDEX, COMMENT ON</span>, and <span class="fixed">GRANT</span>).</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">If a schema name is specified, but no authorization name is provided, the authorization ID of the user who issued the <span class="fixed">CREATE SCHEMA</span> statement is given ownership of the newly created schema; if an authorization name is specified but no schema name is provided, the new schema is assigned the same name as the authorization name used.</p>
<p class="para">So, if you wanted to explicitly create a schema named <span class="fixed">PAYROLL</span> and give ownership of the schema to the user <span class="fixed">DB2ADMIN</span>, you could do so by executing a <span class="fixed">CREATE SCHEMA</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SCHEMA payroll
AUTHORIZATION db2admin
</pre>
</div>
<p class="para">On the other hand, if you wanted to explicitly create a schema named <span class="fixed">INVENTORY</span>, along with a table named <span class="fixed">PARTS</span> inside the schema named <span class="fixed">INVENTORY</span>, you <a name="407"></a><a name=""></a>could do so by executing a <span class="fixed">CREATE SCHEMA</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SCHEMA inventory
CREATE TABLE parts (partno        INTEGER NOT NULL,
                    description   VARCHAR(50),
                    quantity      SMALLINT)
</pre>
</div>
<p class="para">Schemas can also be created using the Create Schema dialog, which can be activated by selecting the appropriate action from the Schemas menu found in the Control Center. <a class="internaljump" href="#ch0">Figure 4-8</a> shows the Control Center menu items that must be selected to activate the Create Schema dialog; <a class="internaljump" href="#ch0">Figure 4-9</a> shows how the Create Schema dialog looks when it is first activated.</p>
<div class="figure">
<a name="408"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig214_01_0.jpg" NAME="IMG_63" target="_parent"><img alt="Image from book" id="IMG_63" src="images/fig214_01.jpg" height="259" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-8: </span>Invoking the Create Schema dialog from the Control Center.</span>
</div>
<div class="figure">
<a name="409"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig215_01_0.jpg" NAME="IMG_64" target="_parent"><img alt="Image from book" id="IMG_64" src="images/fig215_01.jpg" height="137" width="228" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-9: </span>The Create Schema dialog.</span>
</div>
<a name="410"></a><a name=""></a>
<p class="last-para">Given that schemas can be implicitly created by creating an object and assigning it a new schema name, you may be wondering why anyone would want to explicitly create a schema using the <span class="fixed">CREATE SCHEMA</span> statement (or the Create Schema dialog). The primary reason for explicitly creating a schema has to do with access control. An explicitly created schema has an owner, identified either by the authorization ID of the user who executed the <span class="fixed">CREATE SCHEMA</span> statement or by the authorization ID provided to identify the owner when the schema was created. A schema owner has the authority to create, alter, and drop any object stored in the schema; to drop the schema itself; and to grant these privileges to other users. On the other hand, implicitly created schemas are considered to be owned by the user "<span class="fixed">SYSIBM</span>." Any user can create an object in an implicitly created schema, and each object in the schema is controlled by the user who created it. Furthermore, only users with System Administrator (<span class="fixed">SYSADM</span>) or Database Administrator (<span class="fixed">DBADM</span>) authority are allowed to drop implicitly created schemas. Thus, in order for a user other than a system administrator or database administrator to have complete control over a schema, as well as all data objects stored in it, the schema must be created explicitly.</p>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="411"></a><a name="ch04lev"></a>Tables</h3>
<p class="first-para">A table is a logical database object that acts as the main repository in a database. Tables present data as a collection of unordered rows with a fixed number of columns; each column contains values of the same data type or one of its subtypes, and each row contains a set of values for each column available. Usually, the columns in a table are logically related, and additional relationships can be defined between two or more tables. The storage representation of a row is called a <i class="emphasis">record,</i> the storage representation of a column is called a <i class="emphasis">field</i>, and each <a name="412"></a><a name=""></a>intersection of a row and column is called a <i class="emphasis">value.</i> <a class="internaljump" href="#ch0">Figure 4-10</a> shows the structure of a simple database table.</p>
<div class="figure">
<a name="413"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig216_01_0.jpg" NAME="IMG_65" target="_parent"><img alt="Image from book" id="IMG_65" src="images/fig216_01.jpg" height="247" width="348" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-10: </span>A simple database table.</span>
</div>
<p class="para">With DB2 9, five types of tables are available:</p>
<ul class="simple-list">
<li class="first-listitem">
<p class="para">
<b>Base tables:</b> User-defined tables designed to hold persistent user data.</p>
</li>
<li class="listitem">
<p class="para">
<b>Result tables:</b> DB2 Database Manager-defined tables populated with rows retrieved from one or more base tables in response to a query.</p>
</li>
<li class="listitem">
<p class="para">
<b>Materialized query tables:</b> User-defined tables whose definition is based on the result of a query, and whose data is in the form of precomputed results that are taken from one or more tables upon which the materialized query table definition is based. Materialized query tables (MQTs) are used during query optimization to improve the performance of a subset of queries.</p>
</li>
<li class="listitem">
<p class="para">
<b>Declared temporary tables:</b> User-defined tables used to hold nonpersistent data temporarily, on behalf of a single application. Declared temporary tables are explicitly created by an application when they are needed and implicitly destroyed when the application that created them terminates its last database connection.</p>
<a name="414"></a><a name=""></a>
</li>
<li class="listitem">
<p class="para">
<b>Typed tables:</b> User-defined tables whose column definitions are based on the attributes of a user-defined structured data type.</p>
</li>
</ul>
<p class="para">Because tables are the basic data objects used to store information, many are often created for a single database. Tables are created by executing the <span class="fixed">CREATE TABLE</span> SQL statement. In its simplest form, the syntax for this statement is:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE TABLE [<i class="emphasis">TableName</i>]
([<i class="emphasis">ColumnName</i>] [<i class="emphasis">DataType</i>], ...)
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">TableName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the table to be created. (The table name specified must be unique within the schema the table is to be created in.)</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ColumnName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the unique name (within the table definition) that is to be assigned to the column that is to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">DataType</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the data type (built-in or user-defined) to be assigned to the column to be created; the data type specified determines the kind of data values that can be stored in the column. (<a class="internaljump" href="#ch04t">Table 4-2</a> contains a list of valid built-in data type definitions.)</p>
</td>
</tr>
</tbody>
</table>
</div>
<a name="415"></a><a name="ch04t"></a>
<table linktabletoexcel="yes" id="ch04table02" class="table" border="1">
<caption class="table-title">
<span class="table-title"><span class="table-titlelabel">Table 4-2: </span>Built-In Data Type Definitions That Can Be Used with the CREATE TABLE Statement</span>
<br>
<a  class="object-link" target="_blank"><IMG HEIGHT="11" BORDER="0" WIDTH="13" SRC="images/b24-bluearrow.gif" ALT=""> Open table as spreadsheet</a>
</caption>
<thead>
<tr valign="top">
<th class="th" scope="col" align="left">
<p class="table-para">
<b class="bold">Definition(s) <span class="unicode">&hellip;</span></b>
</p>
</th><th class="th" scope="col" align="left">
<p class="table-para">
<b class="bold">Data Type <span class="unicode">&hellip;</span></b>
</p>
</th>
</tr>
</thead>
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">SMALLINT</span>
</p>
</td><td class="td" align="left">
<p class="table-para">Numeric</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">INTEGER</span>
</p>
<p class="table-para">
<span class="fixed">INT</span>
</p>
</td><td class="td" align="left">
<p class="table-para">Numeric</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">BIGINT</span>
</p>
</td><td class="td" align="left">
<p class="table-para">Numeric</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">DECIMAL(<i class="emphasis">Precision, Scale</i>)</span>
</p>
<p class="table-para">
<span class="fixed">DEC(<i class="emphasis">Precision, Scale</i>)</span>
</p>
<p class="table-para">
<span class="fixed">NUMERIC(<i class="emphasis">Precision, Scale</i>)</span>
</p>
<p class="table-para">
<span class="fixed">NUM(Precision, Scale)</span>
</p>
<p class="table-para">where <i class="emphasis">Precision</i> is any number between 1 and 31; <i class="emphasis">Scale</i> is any number between 0 and <i class="emphasis">Precision</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Numeric</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">REAL</span>
</p>
<p class="table-para">
<span class="fixed">FLOAT(<i class="emphasis">Precision</i>)</span>
</p>
<p class="table-para">where <i class="emphasis">Precision</i> is any number between 1 and 24</p>
</td><td class="td" align="left">
<p class="table-para">Numeric</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">DOUBLE</span>
</p>
<p class="table-para">
<span class="fixed">DOUBLE PRECISION</span>
</p>
<p class="table-para">
<span class="fixed">FLOAT(<i class="emphasis">Precision</i>)</span>
</p>
<p class="table-para">where <i class="emphasis">Precision</i> is any number between 25 and 53</p>
</td><td class="td" align="left">
<p class="table-para">Numeric</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">CHARACTER(<i class="emphasis">Length</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">
<span class="fixed">CHAR(<i class="emphasis">Length</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">where <i class="emphasis">Length</i> is any number between 1 and 254. See note at bottom of table for the FOR BIT DATA clause.</p>
</td><td class="td" align="left">
<p class="table-para">Character/Character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">CHARACTER VARYING(<i class="emphasis">MaxLength</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">
<span class="fixed">CHAR VARYING(<i class="emphasis">MaxLength</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">
<span class="fixed">VARCHAR(<i class="emphasis">MaxLength</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">where <i class="emphasis">MaxLength</i> is any number between 1 and 32,672. See note at bottom of table for the FOR BIT DATA clause.</p>
</td><td class="td" align="left">
<p class="table-para">Character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">LONG VARCHAR &lt;FOR BIT DATA&gt;</p>
</td><td class="td" align="left">
<p class="table-para">Character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">GRAPHIC(<i class="emphasis">Length</i>)</span>
</p>
<p class="table-para">where <i class="emphasis">Length</i> is any number between 1 and 127</p>
</td><td class="td" align="left">
<p class="table-para">Double-byte character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">VARGRAPHIC(<i class="emphasis">MaxLength</i>)</span>
</p>
<p class="table-para">where <i class="emphasis">MaxLength</i> is any number between 1 and 16,336</p>
</td><td class="td" align="left">
<p class="table-para">Double-byte character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">LONG VARGRAPHIC</span>
</p>
</td><td class="td" align="left">
<p class="table-para">Double-byte character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">DATE</span>
</p>
</td><td class="td" align="left">
<p class="table-para">Date</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">TIME</span>
</p>
</td><td class="td" align="left">
<p class="table-para">Time</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">TIMESTAMP</span>
</p>
</td><td class="td" align="left">
<p class="table-para">Date and time</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">BINARY LARGE OBJECT(<i class="emphasis">Size</i> &lt;K | M | G&gt;)</span>
</p>
<p class="table-para">
<span class="fixed">BLOB(<i class="emphasis">Size</i> &lt;K | M | G&gt;)</span>
</p>
<p class="table-para">where <i class="emphasis">Length</i> is any number between 1 and 2,147,483,647; if K (for kilobyte) is specified, Length is any number between 1 and 2,097,152; if M (for megabyte) is specified, <i class="emphasis">Length</i> is any number between 1 and 2,048; if G (for gigabyte) is specified, Length is any number between 1 and 2.</p>
</td><td class="td" align="left">
<p class="table-para">Binary</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">CHARACTER LARGE OBJECT(<i class="emphasis">Size</i> &lt;K | M | G&gt;)</span>
</p>
<p class="table-para">
<span class="fixed">CHAR LARGE OBJECT(<i class="emphasis">Size</i> &lt;K | M | G&gt;)</span>
</p>
<p class="table-para">
<span class="fixed">CLOB(<i class="emphasis">Size</i> &lt;K | M | G&gt;)</span>
</p>
<p class="table-para">where <i class="emphasis">Length</i> is any number between 1 and 2,147,483,647; if K (for kilobyte) is specified, Length is any number between 1 and 2,097,152; if M (for megabyte) is specified, <i class="emphasis">Length</i> is any number between 1 and 2,048; if G (for gigabyte) is specified, Length is any number between 1 and 2.</p>
</td><td class="td" align="left">
<p class="table-para">Character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">DBCLOB(<i class="emphasis">Size</i> &lt;K | M | G&gt;)</span>
</p>
<p class="table-para">where <i class="emphasis">Length</i> is any number between 1 and 1,073,741,823; if K (for kilobyte) is specified, <i class="emphasis">Length</i> is any number between 1 and 1,048,576; if M (for megabyte) is specified, <i class="emphasis">Length</i> is any number between 1 and 1,024; if G (for gigabyte) is specified, <i class="emphasis">Length</i> is must be 1.</p>
</td><td class="td" align="left">
<p class="table-para">Double-byte character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="fixed">CHARACTER VARYING(<i class="emphasis">MaxLength</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">
<span class="fixed">CHAR VARYING(<i class="emphasis">MaxLength</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">
<span class="fixed">VARCHAR(<i class="emphasis">MaxLength</i>) &lt;FOR BIT DATA&gt;</span>
</p>
<p class="table-para">where <i class="emphasis">MaxLength</i> is any number between 1 and 32,672. See note at bottom of table for the FOR BIT DATA clause.</p>
</td><td class="td" align="left">
<p class="table-para">Character string</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">XML</p>
</td><td class="td" align="left">
<p class="table-para">XML Document</p>
</td>
</tr>
</tbody>
<tfoot>
<tr valign="">
<td class="td" align="left" colspan="2">
<p class="table-para">Note: If the FOR BIT DATA option is used with any character string data type definition, the contents of the column the data type is assigned to are treated as binary data.</p>
</td>
</tr>
</tfoot>
</table>
<a name="416"></a><a name=""></a><a name="417"></a><a name=""></a>
<p class="para">Thus, if you wanted to create a table named <span class="fixed">EMPLOYEES</span> that had three columns in it, two of which are used to store numeric values and one that is used to store character string values, you could do so by executing a <span class="fixed">CREATE TABLE</span> SQL statement that looks something like this:</p>
<a name="418"></a><a name=""></a>
<div class="informalexample">
<pre class="literallayout">
CREATE  TABLE employees
     (empid  INTEGER,
      name   CHAR(50),
      dept   INTEGER)
</pre>
</div>
<p class="para">It is important to note that this is an example of a relatively simple table. Table definitions can be quite complex; therefore, the <span class="fixed">CREATE TABLE</span> statement has several different permutations. Because the definition for a table object can be quite complex, and because the syntax for the <span class="fixed">CREATE TABLE</span> SQL statement can be complex as well, the <span class="fixed">CREATE TABLE</span> SQL statement is covered in much more detail in <a href="BBL0040.html#668" target="_parent" class="chapterjump">Chapter 6</a>, "Working with DB2 Tables, Views, and Indexes." (A detailed description of the data types available is presented in <a href="BBL0040.html#668" target="_parent" class="chapterjump">Chapter 6</a> as well.)</p>
<p class="para">Like schemas, tables can be created using a GUI tool that is accessible from the Control Center. In this case, the tool is the Create Table Wizard, and it can be activated by selecting the appropriate action from the Tables menu found in the Control Center. <a class="internaljump" href="#ch0">Figure 4-11</a> shows the Control Center menu items that must be selected to activate the Create Table Wizard; <a class="internaljump" href="#ch0">Figure 4-12</a> shows how the first page of the Create Table Wizard looks when it is first activated.</p>
<div class="figure">
<a name="419"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig220_01_0.jpg" NAME="IMG_66" target="_parent"><img alt="Image from book" id="IMG_66" src="images/fig220_01.jpg" height="260" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-11: </span>Invoking the Create Table Wizard from the Control Center.</span>
</div>
<div class="figure">
<a name="420"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig221_01_0.jpg" NAME="IMG_67" target="_parent"><img alt="Image from book" id="IMG_67" src="images/fig221_01.jpg" height="263" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-12: </span>The first page of the Create Table Wizard.</span>
</div>
<a name="421"></a><a name=""></a>
<div class="section">
<h4 class="sect4-title">
<a name="422"></a><a name="ch04le"></a>A Word About Declared Temporary Tables</h4>
<p class="first-para">Of the five different types of tables available, base tables are the most common type of table used, followed by declared temporary tables. Unlike base tables, whose descriptions and constraints are stored in the system catalog tables of the database to which they belong, declared temporary tables are not persistent and can only be used by the application that creates them-and only for the life of the application. When the application that creates a declared temporary table terminates, the rows of the table are deleted, and the description of the table is dropped. (However, data stored in a temporary table can exist across transaction boundaries.) Another significant difference focuses on naming conventions: base table names must be unique within a schema, but because each application that defines a declared temporary table has its own instance of that table, it is possible for many applications to create declared temporary tables that have the same name. Finally, while base tables are created with the <span class="fixed">CREATE TABLE</span> SQL statement, declared temporary tables are created with the <span class="fixed">DECLARE GLOBAL TEMPORARY TABLE</span> statement.</p>
<a name="423"></a><a name=""></a>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">Before an application can create and use a declared temporary table, a user temporary table space must be defined for the database the application will be working with.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="424"></a><a name="ch04lev"></a>Views</h3>
<p class="first-para">Views are used to provide a different way of looking at the data stored in one or more base tables. Essentially, a view is a named specification of a result table that is populated whenever the view is referenced in an SQL statement. (Each time a view is referenced, a query is executed and the results are returned in a table-like format.) Like base tables, views can be thought of as having columns and rows. And in most cases, data can be retrieved from a view the same way it can be retrieved from a table. However, whether or not a view can be used in insert, update, and delete operations depends upon how it was defined-views can be defined as being insertable, updatable, deletable, and read-only.</p>
<a name="425"></a><a name=""></a>
<p class="para">Although views look similar to base tables, they do not contain real data. Instead, views refer to data stored in other base tables. Only the view definition itself is actually stored in the database. (In fact, when changes are made to the data presented in a view, the changes are actually made to the data stored in the base table(s) the view references.) <a class="internaljump" href="#ch0">Figure 4-13</a> shows the structure of a simple view, along with its relationship to two base tables.</p>
<div class="figure">
<a name="426"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig222_01_0.jpg" NAME="IMG_68" target="_parent"><img alt="Image from book" id="IMG_68" src="images/fig222_01.jpg" height="296" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-13: </span>A simple view that references two base tables.</span>
</div>
<p class="para">Because views allow different users to see different presentations of the same data, they are often used to control access to data. For example, suppose you had a table that contained information about all employees who worked for a particular company. Department managers could be given access to this table using a view that allows them to see only information about the employees who work in their department. Members of the payroll department, on the other hand, could be given access to the table using a view that allows them to see only the information needed to generate employee paychecks. Both sets of users are given access to the same table; however, because each user works with a different view, it appears that they are working with their own tables.</p>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">Because there is no way to grant <span class="fixed">SELECT</span> privileges on specific columns within a table, the only way to prevent users from accessing every column in a table is by creating a result, summary, or declared temporary table that holds only the data a particular user needs, or by creating a view that contains only the table columns a user is allowed to access. Of the two, a view is easier to implement and manage.</p>
</td>
</tr>
</table>
<p class="para">Views can be created by executing the <span class="fixed">CREATE VIEW</span> SQL statement. The basic syntax for this statement is:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE VIEW [<i class="emphasis">ViewName</i>]
&lt;( [<i class="emphasis">ColumnName</i>], ... )&gt;
AS [<i class="emphasis">SELECTStatement</i>]
&lt;WITH &lt;LOCAL | CASCADED&gt; CHECK OPTION&gt;
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ViewName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the view to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ColumnName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the names of one or more columns that are to be included in the view to be created. If a list of column names is specified, the number of column names provided must match the number of columns that will be returned by the <span class="fixed">SELECT</span> statement used to create the view. (If a list of column names is not provided, the columns of the view will inherit the names that are assigned to the columns returned by the <span class="fixed">SELECT</span> statement used to create the view.)</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SELECTStatement</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies a <span class="fixed">SELECT</span> SQL statement that, when executed, will produce data that will populate the view.</p>
</td>
</tr>
</tbody>
</table>
</div>
<a name="427"></a><a name=""></a>
<p class="para">Thus, if you wanted to create a view that references all data stored in a table named <span class="fixed">DEPARTMENT</span> and assign it the name <span class="fixed">DEPT_VIEW</span>, you could do so by executing a <span class="fixed">CREATE VIEW</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE VIEW dept_view
AS SELECT * FROM department
</pre>
</div>
<p class="para">On the other hand, if you wanted to create a view that references specific data values stored in the table named <span class="fixed">DEPARTMENT</span> and assign it the name <span class="fixed">ADV_DEPT_VIEW</span>, you could do so by executing a <span class="fixed">CREATE VIEW</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE VIEW adv_dept_view
AS SELECT (dept_no, dept_name, dept_size) FROM department
     WHERE dept_size &gt; 25
</pre>
</div>
<p class="para">The view created by this statement would contain only department number, department name, and department size information for each department that has more than 25 people in it.</p>
<p class="para">Views can also be created using the Create View dialog, which can be activated by selecting the appropriate action from the Views menu found in the Control Center. <a class="internaljump" href="#ch0">Figure 4-14</a> shows the Control Center menu items that must be selected to activate the Create View dialog; <a class="internaljump" href="#ch0">Figure 4-15</a> shows how the Create View dialog looks when it is first activated.</p>
<div class="figure">
<a name="428"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig225_01_0.jpg" NAME="IMG_69" target="_parent"><img alt="Image from book" id="IMG_69" src="images/fig225_01.jpg" height="260" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-14: </span>Invoking the Create View dialog from the Control Center.</span>
</div>
<div class="figure">
<a name="429"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig225_02_0.jpg" NAME="IMG_70" target="_parent"><img alt="Image from book" id="IMG_70" src="images/fig225_02.jpg" height="292" width="231" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-15: </span>The Create View dialog.</span>
</div>
<a name="430"></a><a name=""></a><a name="431"></a><a name=""></a>
<p class="para">If the <span class="fixed">WITH LOCAL CHECK OPTION</span> clause of with the <span class="fixed">CREATE VIEW</span> SQL statement is specified (or if the Local Check option is selected on the Create View dialog), insert and update operations performed against the view that is created are validated to ensure that all rows being inserted into or updated in the base table the view refers to conform to the view's definition (otherwise, the insert/update operation will fail). So what exactly does this mean? Suppose a view was created using the following <span class="fixed">CREATE VIEW</span> statement:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE VIEW priority_orders
AS SELECT * FROM orders WHERE response_time &lt; 4
WITH LOCAL CHECK OPTION
</pre>
</div>
<p class="para">Now, suppose a user tries to insert a record into this view that has a <span class="fixed">RESPONSE_TIME</span> value of 6. The insert operation will fail because the record violates the view's definition. Had the view not been created with the <span class="fixed">WITH LOCAL CHECK OPTION</span> clause, the insert operation would have been successful, even though the new record would not be visible to the view that was used to add it. <a class="internaljump" href="#ch0">Figure 4-16</a> illustrates how the <span class="fixed">WITH LOCAL CHECK OPTION</span> clause works.</p>
<div class="figure">
<a name="432"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig226_01_0.jpg" NAME="IMG_71" target="_parent"><img alt="Image from book" id="IMG_71" src="images/fig226_01.jpg" height="271" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-16: </span>How the WITH LOCAL CHECK OPTION clause is used to ensure that insert and update operations conform to a view's definition.</span>
</div>
<a name="433"></a><a name=""></a>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">Views created with the WITH LOCAL CHECK OPTION clause specified are referred to as symmetric views, because every record that can be inserted into them can also be retrieved from them.</p>
</td>
</tr>
</table>
<p class="para">If the <span class="fixed">WITH CASCADED CHECK OPTION</span> clause of with the <span class="fixed">CREATE VIEW</span> SQL statement is specified (or if the Cascaded Check option is selected on the Create View dialog), the view created will inherit the search conditions of the <i class="emphasis">parent</i> <i class="emphasis">view</i> upon which the view is based and treat those conditions as one or more constraints that are used to validate insert and update operations that are performed against the view. Additionally, every view created that is a child of the view that was created with the <span class="fixed">WITH CASCADED CHECK OPTION</span> clause specified will inherit those constraints; the search conditions of both parent and child views are <span class="fixed">AND</span>ed together to form the constraints. To understand better what this means, let's look at an example. Suppose a view was created using the following <span class="fixed">CREATE VIEW</span> statement:</p>
<div class="informalexample">
<pre class="literallayout">
_________________________________________________
CREATE VIEW priority_orders
AS SELECT * FROM orders WHERE response_time &lt; 4
</pre>
</div>
<p class="para">Now, suppose a second view was created using this <span class="fixed">CREATE VIEW</span> statement:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE VIEW special_orders
AS SELECT * FROM priority_orders
WITH CASCADED CHECK OPTION
</pre>
</div>
<p class="para">If a user tries to insert a record into the <span class="fixed">SPECIAL_ORDERS</span> view that has a <span class="fixed">RESPONSE_TIME</span> value of 6, the insert operation will fail because the record violates the search condition of the <span class="fixed">PRIORITY_ORDERS</span> view's definition (which is a constraint for the <span class="fixed">SPECIAL_ORDERS</span> view). <a class="internaljump" href="#ch0">Figure 4-17</a> illustrates how the <span class="fixed">WITH CASCADED CHECK OPTION</span> clause works.</p>
<div class="figure">
<a name="434"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig228_01_0.jpg" NAME="IMG_72" target="_parent"><img alt="Image from book" id="IMG_72" src="images/fig228_01.jpg" height="452" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-17: </span>How the WITH CASCADED CHECK OPTION clause is used to ensure insert and update operations conform to a parent view's definition.</span>
</div>
<a name="435"></a><a name=""></a><a name="436"></a><a name=""></a>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="437"></a><a name="ch04lev"></a>Indexes</h3>
<p class="first-para">An index is an object that contains an ordered set of pointers that refer to rows in a base table. Each index is based upon one or more columns in the base table it refers to (known as <i class="emphasis">keys</i>), yet it is stored as separate entities. <a class="internaljump" href="#ch0">Figure 4-18</a> shows the structure of a simple index, along with its relationship to a base table.</p>
<div class="figure">
<a name="438"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig229_01_0.jpg" NAME="IMG_73" target="_parent"><img alt="Image from book" id="IMG_73" src="images/fig229_01.jpg" height="196" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-18: </span>A simple index.</span>
</div>
<p class="para">Indexes are important because:</p>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">They provide a fast, efficient method for locating specific rows of data in very large tables. (In some cases, all the information needed to resolve a query may be found in the index itself, in which case the actual table data does not have to be accessed.)</p>
</li>
<li class="listitem">
<p class="first-para">They provide a logical ordering of the rows of a table. (When indexes are used, the values of one or more columns can be sorted in ascending or descending order; this property is very beneficial when processing queries that contain <span class="fixed">ORDER BY</span> and <span class="fixed">GROUP BY</span> clauses.)</p>
</li>
<li class="listitem">
<p class="first-para">They can be used to enforce the uniqueness of records stored in a table.</p>
</li>
<li class="listitem">
<p class="first-para">They can force a table to use <i class="emphasis">clustering</i> storage, which causes the rows of a table to be physically arranged according to the ordering of their index column values. (Although all indexes provide a logical ordering of data, only a clustering index provides a physical ordering of data.)</p>
</li>
</ul>
<a name="439"></a><a name=""></a>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">A clustering index usually increases performance by decreasing the amount of I/O required to access data: When a logical set of rows are physically stored close together, a read operation on the set of rows will require less I/O, because adjacent rows are more likely to be found within the same extent (remember, data pages are written in batches called extents) instead of being widely distributed across multiple extents.</p>
</td>
</tr>
</table>
<p class="para">Whereas some indexes are created implicitly to provide support for a table's definition (for example, to provide support for a <i class="emphasis">primary</i> <i class="emphasis">key</i>), indexes are typically created explicitly, using tools available with DB2. One way to explicitly create an index is by executing the <span class="fixed">CREATE INDEX</span> SQL statement. The basic syntax for this statement is:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE &lt;<i class="emphasis">UNIQUE</i>&gt; INDEX <i class="emphasis">IndexName</i>]
ON [<i class="emphasis">TableName</i>] ( [<i class="emphasis">PriColumnName</i>] &lt;ASC | DESC&gt;, ... )
&lt;INCLUDE ( [<i class="emphasis">SecColumnName</i>], ... )&gt;
&lt;CLUSTER&gt;
&lt;DISALLOW REVERSE SCANS | ALLOW REVERSE SCANS&gt;
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">IndexName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the index to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">TableName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name assigned to the base table with which the index to be created is to be associated.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">PriColumnName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies one or more primary columns that are to be part of the index's key. (The combined values of each primary column specified will be used to enforce data uniqueness in the associated base table.)</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SecColumnName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies one or more secondary columns whose values are to be stored with the values of the primary columns specified, but are not to be used to enforce data uniqueness.</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">If the <span class="fixed">UNIQUE</span> clause is specified when the <span class="fixed">CREATE INDEX</span> statement is executed, rows in the table associated with the index to be created must not have two or <a name="440"></a><a name=""></a>more occurrences of the same values in the set of columns that make up the index key. If the base table the index is to be created for contains data, this uniqueness is checked when the DB2 Database Manager attempts to create the index specified; once the index has been created, this uniqueness is enforced each time an insert or update operation is performed against the table. In both cases, if the uniqueness of the index key is compromised, the index creation, insert, or update operation will fail and an error will be generated. It is important to keep in mind that when the <span class="fixed">UNIQUE</span> clause is used, it is possible to have an index key that contains one (and only one) <span class="fixed">NULL</span> value.</p>
<p class="para">So, if you had a base table named <span class="fixed">EMPLOYEES</span> that has the following characteristics:</p>
<div class="informaltable">
<table linktabletoexcel="yes" id="nr-N1648" border="1">
<a  class="object-link" target="_blank"><IMG HEIGHT="11" BORDER="0" WIDTH="13" SRC="images/b24-bluearrow.gif" ALT=""> Open table as spreadsheet</a>
<thead>
<tr valign="top">
<th class="th" scope="col" align="left">
<p class="table-para">
<b class="bold">Column Name <span class="unicode">&hellip;</span></b>
</p>
</th><th class="th" scope="col" align="left">
<p class="table-para">
<b class="bold">Data Type <span class="unicode">&hellip;</span></b>
</p>
</th>
</tr>
</thead>
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">EMPNO</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">INTEGER</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">FNAME</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(20)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">LNAME</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(30)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">TITLE</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(10)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">DEPARTMENT</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(20)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">SALARY</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">DECIMAL(6,2)</span>
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">and you wanted to create a index such that the index key consists of the column named EMPNO and all employee numbers entered will be guaranteed to be unique, you could do so by executing a <span class="fixed">CREATE INDEX</span> statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE UNIQUE INDEX empno_indx
ON employees(empno)
</pre>
</div>
<p class="para">Indexes can also be created using the Create Index wizard, which can be activated by selecting the appropriate action from the Indexes menu found in the Control Center. <a class="internaljump" href="#ch0">Figure 4-19</a> shows the Control Center menu items that must be selected to activate the Create Indexes dialog; <a class="internaljump" href="#ch0">Figure 4-20</a> shows how the Create Index wizard might look when it is first activated.</p>
<div class="figure">
<a name="441"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig232_01_0.jpg" NAME="IMG_74" target="_parent"><img alt="Image from book" id="IMG_74" src="images/fig232_01.jpg" height="259" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-19: </span>Invoking the Create Index dialog from the Control Center.</span>
</div>
<div class="figure">
<a name="442"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig232_02_0.jpg" NAME="IMG_75" target="_parent"><img alt="Image from book" id="IMG_75" src="images/fig232_02.jpg" height="263" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-20: </span>The Create Index wizard.</span>
</div>
<a name="443"></a><a name=""></a><a name="444"></a><a name=""></a>
<p class="last-para">If an index is created for an empty table, that index will not have any entries stored in it until the table the index is associated with is populated. On the other hand, if an index is created for a table that already contains data, index entries will be generated for the existing data and added to the index upon its creation. Any number of indexes can be created for a table, using a wide variety of combinations of columns. However, each index comes at a price in both storage requirements and performance. Since each index replicates its key values, and this replication requires additional storage space, and each modification to a table results in a similar modification to all indexes defined on the table, performance can decrease when insert, update, and delete operations are performed. In fact, if a large number of indexes are created for a table that is modified frequently, overall performance will decrease, rather than increase, for all operations <i class="emphasis">except</i> data retrieval. Tables that are used for data mining, business intelligence, business warehousing, and other applications that execute many (and often complex) queries while rarely modifying data are prime targets for multiple indexes. On the other hand, tables that are used in OLTP (On-Line Transactional Processing) environments or other environments where data throughput is high should use indexes sparingly.</p>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="445"></a><a name="ch04lev"></a>Aliases</h3>
<p class="first-para">An alias is simply an alternate name for a table or view. (Aliases can also be created for <i class="emphasis">nicknames</i> that refer to tables or views found on federated systems.) Once created, an alias can be referenced the same way the table or view the alias refers to can be referenced. However, an alias cannot be used in every context that a table or view name can. For example, an alias cannot be used in the check condition of a check constraint, nor can it be used to reference a user-defined temporary table.</p>
<p class="para">Like tables and views, an alias can be created, dropped, and have comments associated with it. Unlike tables (but similar to views), aliases can refer to other aliases-a process known as <i class="emphasis">chaining</i>. Aliases are publicly referenced names, so no special authority or privilege is required to use them. However, access to the table or view that an alias refers to still requires appropriate authorization.</p>
<p class="para">Aliases can be created by executing the <span class="fixed">CREATE ALIAS</span> SQL statement. The basic syntax for this statement is:</p>
<a name="446"></a><a name=""></a>
<div class="informalexample">
<pre class="literallayout">
CREATE [ALIAS | SYNONYM] [<i class="emphasis">AliasName</i>]
FOR [<i class="emphasis">TableName</i> | <i class="emphasis">ViewName</i> | <i class="emphasis">Nickname</i> | <i class="emphasis">ExistingAlias</i>]
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">AliasName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the alias to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">TableName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the table, by name, that the alias to be created is to reference.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ViewName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the view, by name, that the alias to be created is to reference.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">Nickname</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the nickname that the alias to be created is to reference.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ExistingAlias</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies an existing alias, by name, that the alias to be created is to reference.</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">Thus, if you wanted to create an alias that references a table named <span class="fixed">EMPLOYEES</span> and you wanted to assign it the name <span class="fixed">EMPINFO</span>, you could do so by executing a <span class="fixed">CREATE ALIAS</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE ALIAS empinfo FOR employees
</pre>
</div>
<p class="para">Aliases can also be created using the Create Alias dialog, which can be activated by selecting the appropriate action from the Alias menu found in the Control Center. <a class="internaljump" href="#ch0">Figure 4-21</a> shows the Control Center menu items that must be selected to activate the Create Alias dialog; <a class="internaljump" href="#ch0">Figure 4-22</a> shows how the Create Alias dialog might look when it is first activated.</p>
<div class="figure">
<a name="447"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig235_01_0.jpg" NAME="IMG_76" target="_parent"><img alt="Image from book" id="IMG_76" src="images/fig235_01.jpg" height="259" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-21: </span>Invoking the Create Alias dialog from the Control Center.</span>
</div>
<div class="figure">
<a name="448"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig235_02_0.jpg" NAME="IMG_77" target="_parent"><img alt="Image from book" id="IMG_77" src="images/fig235_02.jpg" height="172" width="213" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-22: </span>The Create Alias dialog.</span>
</div>
<a name="449"></a><a name=""></a>
<p class="para">So why would you want use an alias instead of the actual table/view name? By using aliases, SQL statements can be constructed such that they are independent of the qualified names that identify the base tables or views they reference.</p>
<a name="450"></a><a name=""></a>
<p class="last-para">Whenever an alias is used in an SQL statement, the behavior is the same as when the target (source table or view) of the alias is used instead. Therefore, any application that uses an alias to access data can easily be made to work with many different targets. That's because, when the target of an alias is changed, no changes to applications that use the alias are necessary.</p>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="451"></a><a name="ch04lev"></a>Sequences</h3>
<p class="first-para">A sequence is an object that is used to generate data values automatically. Unlike an identity column, which is used to generate data values for a specific column in a table, a sequence is not tied to any specific column or any specific table. Instead, a sequence behaves like a unique counter that resides outside the database, with the exception that it does not introduce the concurrency and performance problems that can exist when external counters are used.</p>
<p class="para">Sequences have the following characteristics:</p>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">Values generated can be any exact numeric data type that has a scale of zero (<span class="fixed">SMALLINT, BIGINT, INTEGER</span>, or <span class="fixed">DECIMAL</span>).</p>
</li>
<li class="listitem">
<p class="first-para">Consecutive values can differ by any specified increment value. The default increment value is 1.</p>
</li>
<li class="listitem">
<p class="first-para">Counter values are recoverable. Counter values are reconstructed from logs when recovery is required.</p>
</li>
<li class="listitem">
<p class="first-para">Values generated can be cached to improve performance.</p>
</li>
</ul>
<p class="para">In addition, sequences can generate values in one of three ways:</p>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">By incrementing or decrementing by a specified amount, without bounds</p>
</li>
<li class="listitem">
<p class="first-para">By incrementing or decrementing by a specified amount to a user-defined limit and stopping</p>
</li>
<li class="listitem">
<p class="first-para">By incrementing or decrementing by a specified amount to a user-defined limit, and then cycling back to the beginning and starting again</p>
</li>
</ul>
<p class="para">To facilitate the use of sequences in SQL operations, two expressions are available: <span class="fixed">PREVIOUS VALUE</span> and <span class="fixed">NEXT VALUE</span>. The <span class="fixed">PREVIOUS VALUE</span> expression returns the most recently generated value for the specified sequence, while the <span class="fixed">NEXT VALUE</span> expression returns the next sequence value.</p>
<a name="452"></a><a name=""></a>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">One important difference between a sequence and an identity column is that an identity column cannot be referenced by an INSERT SQL statement; a sequence, on the other hand, can.</p>
</td>
</tr>
</table>
<p class="para">Sequences can be created by executing the <span class="fixed">CREATE SEQUENCE</span> SQL statement. The basic syntax for this statement is:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SEQUENCE [<i class="emphasis">SequenceName</i>]
&lt;AS INTEGER | AS [<i class="emphasis">DataType</i>]&gt;
&lt;START WITH [<i class="emphasis">StartingNumber</i>]&gt;
&lt;INCREMENT BY [1 | <i class="emphasis">IncrementValue</i>]&gt;
&lt;NO MINVALUE | MINVALUE [<i class="emphasis">MinValue</i>]&gt;
&lt;NO MAXVALUE | MAXVALUE [<i class="emphasis">MaxValue</i>]&gt;
&lt;NO CYCLE | CYCLE&gt;
&lt;CACHE 20 | CACHE [<i class="emphasis">CacheValue</i>] | NO CACHE&gt;
&lt;NO ORDER | ORDER&gt;
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SequenceName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the sequence to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">DataType</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the data type to be used for the sequence's value. The data type specified can be any built-in numeric type with a scale of zero (<span class="fixed">SMALLINT, INTEGER, BIGINT</span>, or <span class="fixed">DECIMAL</span>), or a user-defined data type whose source is a built-in numeric type with a scale of zero.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">StartingValue</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the first value to be provided by the sequence being created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">IncrementValue</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the interval that is to be used to calculate the next consecutive value for the sequence being created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">MinValue</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Specifies the minimum value at which a descending sequence either cycles or stops generating values, or an ascending sequence cycles to after reaching the maximum value.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">MaxValue</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Specifies the maximum value at which an ascending sequence either cycles or stops generating values, or a descending sequence cycles to after reaching the minimum value. (It is possible for <i class="emphasis">MaxValue</i> to be equal to <i class="emphasis">MinValue</i>; if that is the case, the sequence will return a constant value.)</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">CacheSize</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the number of values of the identity sequence that are to be pre-generated and kept in memory. (Pregenerating and storing values in the cache reduces synchronous I/O to the log when values are generated for the sequence. However, in the event of a system failure, all cached sequence values that have not been used in committed statements are lost; that is, they can never be used.)</p>
</td>
</tr>
</tbody>
</table>
</div>
<a name="453"></a><a name=""></a>
<p class="para">Thus, if you wanted to create a sequence that generates numbers, starting with the number 100 and incrementing each subsequent number produced by 10, you could do so by executing a <span class="fixed">CREATE SEQUENCE</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SEQUENCE emp_id START WITH 100 INCREMENT BY 10
</pre>
</div>
<p class="para">Once this sequence is created, the first value returned by it will be 100. Subsequent values will be 110, 120, 130, 140, and so forth. Values are generated each time the sequence is queried (for example, by executing the statement <span class="fixed">VALUES NEXT VALUE FOR emp_id INTO :empid</span>) regardless of which user/application performs the query.</p>
<p class="para">On the other hand, if you wanted to create a sequence that generates numbers, starting with the number 5, incrementing each subsequent number produced by 5, and caching 5 numbers at a time, you could do so by executing a <span class="fixed">CREATE SEQUENCE</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE SEQUENCE dept_id START WITH 5 INCREMENT BY 5 CACHE 5
</pre>
</div>
<p class="last-para">In this case, the numbers returned by the sequence can vary, depending upon how the sequence is used. For example, if three different transactions were to access the sequence, because five values are generated at a time, the first transaction would get the numbers 5, 10, 15, 20, and 25; the second transaction would get the numbers 30, 35, 40, 45, and 50; while the third transaction would get the numbers 55, 60, 65, 70, and 75. If any one of these transactions terminates without using the full set of <a name="454"></a><a name=""></a>numbers available, those numbers are lost. (Because sequences are persistent across transaction boundaries, their behavior is not affected by commit or rollback operations.)</p>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="455"></a><a name="ch04lev"></a>Triggers</h3>
<p class="first-para">A trigger is used to define a set of actions that are to be executed whenever an insert, update, or delete operation is performed against a table or updatable view. Triggers are often used to enforce <i class="emphasis">data</i> <i class="emphasis">integrity</i> <i class="emphasis">rules</i> and <i class="emphasis">business</i> <i class="emphasis">rules</i>. (A data integrity rule might be that whenever the record for an employee is deleted from the table that holds employee information, the corresponding record will be deleted from the table that holds payroll information; a business rule might be that an employee's salary cannot be increased by more than 10 percent.) Triggers can also be used to update other tables, automatically generate or transform values for inserted or updated rows, and invoke functions to perform such tasks as issuing alerts.</p>
<p class="para">By using triggers, the logic needed to enforce business rules can be placed directly in the database, and applications that work with the database can concentrate solely on data storage, management, and retrieval. And by storing the logic needed to enforce data integrity and business rules directly in the database, it can be modified as those rules change without requiring applications to be recoded and recompiled.</p>
<p class="para">Before a trigger can be created, the following components must be identified:</p>
<ul class="simple-list">
<li class="first-listitem">
<p class="para">
<b>Subject table/view:</b> The table or view with which the trigger is to interact.</p>
</li>
<li class="listitem">
<p class="para">
<b>Trigger event:</b> An SQL operation that causes the trigger to be activated whenever the event is performed against the subject table/view. This operation can be an insert operation, an update operation, or a delete operation.</p>
</li>
<li class="listitem">
<p class="para">
<b>Trigger activation time:</b> Indicates whether the trigger should be activated before, after, or instead of the trigger event. A <span class="fixed">BEFORE</span> trigger will be activated before the trigger event occurs; therefore, it will be able to see new data values before they are inserted into the subject table. An <span class="fixed">AFTER</span> trigger will be activated after the trigger event occurs; therefore, it can see only data values that have already been inserted into the subject table. An <span class="fixed">INSTEAD OF</span> trigger will replace the trigger event made against the subject view. (A <span class="fixed">BEFORE</span> trigger might be used to trap and process unwanted values, while an <span class="fixed">AFTER</span> trigger could be used to copy data values entered to other tables or views.)</p>
<a name="456"></a><a name=""></a>
</li>
<li class="listitem">
<p class="para">
<b>Set of affected rows:</b> The rows of the subject table/view that are being inserted, updated, or deleted.</p>
</li>
<li class="listitem">
<p class="para">
<b>Trigger granularity:</b> Specifies whether the actions the trigger will perform are to be performed once for the entire insert, update, or delete operation or once for every row affected by the insert, update, or delete operation.</p>
</li>
<li class="listitem">
<p class="para">
<b>Triggered action:</b> An optional search condition and a set of SQL statements that are to be executed whenever the trigger is activated. (If a search condition is specified, the SQL statements will only be executed if the search condition evaluates to <span class="fixed">TRUE</span>.) If the trigger is a <span class="fixed">BEFORE</span> trigger, the triggered action can include statements that retrieve data, set transition variables, or signal SQL states. If the trigger is an <span class="fixed">AFTER</span> trigger, the triggered action can include statements that retrieve data, insert records, update records, delete records, or signal SQL states.</p>
</li>
</ul>
<p class="para">Triggered actions can refer to the values in the set of affected rows using what are known as <i class="emphasis">transition</i> <i class="emphasis">variables</i>. Transition variables use the names of the columns in the subject table, qualified by a specified name that indicates whether the reference is to the original value (before the insert, update, or delete operation is performed) or the new value (after the insert, update, or delete operation is performed). Another means of referring to values in the set of affected rows is through the use of <i class="emphasis">transition</i> <i class="emphasis">tables</i>. Transition tables also use the names of the columns in the subject table, but they allow the complete set of affected rows to be treated as a table. Transition tables can only be used in after triggers.</p>
<p class="para">Once the appropriate trigger components have been identified, a trigger can be created by executing the <span class="fixed">CREATE TRIGGER</span> SQL statement. The basic syntax for this statement is:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE TRIGGER [<i class="emphasis">TriggerName</i>]
[&lt;NO CASCADE&gt; BEFORE | AFTER | INSTEAD OF]
[INSERT | UPDATE | DELETE &lt;OF [<i class="emphasis">ColumnName</i>], ... &gt;]
ON [<i class="emphasis">TableName</i> | <i class="emphasis">ViewName</i>]
&lt;REFERENCING [<i class="emphasis">Reference</i>]&gt;
[FOR EACH ROW | FOR EACH STATEMENT]
&lt;WHEN ( [<i class="emphasis">SearchCondition</i>] )&gt;
[<i class="emphasis">TriggeredAction</i>]
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">TriggerName</i>
</p>
</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Identifies the name to be assigned to the trigger to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ColumnName</i>
</p>
</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Identifies one or more columns in the subject table or view of the trigger whose values must be updated before the trigger's triggered action (<i class="emphasis">TriggeredAction</i>) will be executed.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">TableName</i>
</p>
</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Identifies, by name, the subject table of the <span class="fixed">BEFORE</span> or <span class="fixed">AFTER</span> trigger to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ViewName</i>
</p>
</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Identifies, by name, the subject view of the <span class="fixed">INSTEAD OF</span> trigger to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">Reference</i>
</p>
</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Identifies one or more transition variables and/or transition tables that are to be used by the trigger's triggered action (<i class="emphasis">TriggeredAction</i>). The syntax used to create transition variables and/or transition tables that are to be used by the trigger's triggered action is:</p>
<p class="table-para">
<div class="informalexample">
<pre class="literallayout">
&lt;OLD &lt;AS&gt; [<i class="emphasis">CorrelationName</i>]&gt;
&lt;NEW &lt;AS&gt; [<i class="emphasis">CorrelationName</i>]&gt;
&lt;OLD TABLE &lt;AS&gt; [<i class="emphasis">Identifier</i>]&gt;
&lt;NEW TABLE &lt;AS&gt; [Identifier]&gt;
</pre>
</div>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">&nbsp;</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">where:</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">&nbsp;</td><td class="td" align="left">
<p class="table-para">
<i class="emphasis">CorrelationName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies a name to be used to identify a specific row in the subject table of the trigger, either before it was modified by the trigger's triggered action (<span class="fixed">OLD &lt;AS&gt;</span>) or after it has been modified by the trigger's triggered action (<span class="fixed">NEW &lt;AS&gt;</span>).</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">&nbsp;</td><td class="td" align="left">
<p class="table-para">
<i class="emphasis">Identifier</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies a name that is to be used to identify a temporary table that contains a set of rows found in the subject table of the trigger, either before they were modified by the trigger's triggered action (<span class="fixed">OLD TABLE &lt;AS&gt;</span>) or after they have been modified by the trigger's triggered action (<span class="fixed">NEW TABLE &lt;AS&gt;</span>).</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">&nbsp;</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Each column affected by an activation event (insert, update, or delete operation) can be made available to the trigger's triggered action by qualifying the column's name with the appropriate correlation name or table identifier.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SearchCondition</i>
</p>
</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Specifies a search condition that, when evaluated, will return either <span class="fixed">TRUE, FALSE</span>, or <span class="fixed">Unknown</span>. This condition is used to determine whether the trigger's triggered action (<i class="emphasis">TriggeredAction</i>) is to be performed.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">TriggeredAction</i>
</p>
</td><td class="td" align="left" valign="top" colspan="2">
<p class="table-para">Identifies the action to be performed when the trigger is activated. The triggered action must consist of one or more SQL statements; when multiple statements are specified, the first statement must be preceded by the keywords <span class="fixed">BEGIN ATOMIC</span>, the last statement must be followed by the keyword <span class="fixed">END</span>, and every statement between these keywords must be terminated with a semicolon (<span class="fixed">;</span>).</p>
</td>
</tr>
</tbody>
</table>
</div>
<a name="457"></a><a name="IDX-"></a><a name="458"></a><a name=""></a>
<p class="para">Thus, suppose you have a base table named <span class="fixed">EMPLOYEES</span> that has the following characteristics:</p>
<div class="informaltable">
<table linktabletoexcel="yes" id="nr-N2591" border="1">
<a  class="object-link" target="_blank"><IMG HEIGHT="11" BORDER="0" WIDTH="13" SRC="images/b24-bluearrow.gif" ALT=""> Open table as spreadsheet</a>
<thead>
<tr valign="top">
<th class="th" scope="col" align="left">
<p class="table-para">
<b class="bold">Column Name <span class="unicode">&hellip;</span></b>
</p>
</th><th class="th" scope="col" align="left">
<p class="table-para">
<b class="bold">Data Type <span class="unicode">&hellip;</span></b>
</p>
</th>
</tr>
</thead>
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">EMPNO</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">INTEGER</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">FNAME</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(20)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">LNAME</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(30)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">TITLE</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(10)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">DEPARTMENT</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">CHAR(20)</span>
</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">SALARY</p>
</td><td class="td" align="left">
<p class="table-para">
<span class="fixed">DECIMAL(6,2)</span>
</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">If you wanted to create a trigger for <span class="fixed">EMPLOYEES</span> that will cause the value for the column named <span class="fixed">EMPNO</span> to be incremented each time a row is added to the table, you could do so by executing a <span class="fixed">CREATE TRIGGER</span> statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE TRIGGER empno_inc
AFTER INSERT ON employees
FOR EACH ROW
UPDATE empno SET empno = empno + 1
</pre>
</div>
<p class="para">Triggers can also be created using the Create Trigger dialog, which can be activated by selecting the appropriate action from the Triggers menu found in the Control Center. <a class="internaljump" href="#ch0">Figure 4-23</a> shows the Control Center menu items that must be selected to activate the Create Trigger dialog; <a class="internaljump" href="#ch0">Figure 4-24</a> shows how the Create Trigger dialog might look when it is first activated.</p>
<div class="figure">
<a name="459"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig243_01_0.jpg" NAME="IMG_78" target="_parent"><img alt="Image from book" id="IMG_78" src="images/fig243_01.jpg" height="259" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-23: </span>Invoking the Create Trigger dialog from the Control Center.</span>
</div>
<div class="figure">
<a name="460"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig243_02_0.jpg" NAME="IMG_79" target="_parent"><img alt="Image from book" id="IMG_79" src="images/fig243_02.jpg" height="278" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-24: </span>The Create Trigger dialog.</span>
</div>
<a name="461"></a><a name=""></a><a name="462"></a><a name=""></a>
<p class="para">It is important to note that if you want a trigger to be fired whenever a Data Manipulation Language (DML) operation is performed against a table, you must create three separate triggers for that table: one that handles <span class="fixed">INSERT</span> events, one that handles <span class="fixed">UPDATE</span> events, and another that handles <span class="fixed">DELETE</span> events.</p>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">The activation of one trigger may result in the activation of other triggers (or even reactivation of the same trigger). This behavior is referred to as trigger cascading, and because trigger cascading can occur, a single insert, update, or delete operation can cause a significant number of changes to be made to a database.</p>
</td>
</tr>
</table>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="463"></a><a name="ch04lev"></a>User-Defined Data Types</h3>
<p class="first-para">As the name implies, user-defined data types (UDTs) are data types that are created (and named) by database users. With DB2 9, two types of UDTs are available: <i class="emphasis">distinct</i> and <i class="emphasis">structured</i>.</p>
<div class="section">
<h4 class="sect4-title">
<a name="464"></a><a name="ch04le"></a>Distinct Data Types</h4>
<p class="first-para">A distinct data type is a user-defined data type that is derived from one of the built-in data types available with DB2. Although a distinct data type shares a common internal representation with a built-in data type, it is considered a separate data type that is distinct from any other data type (hence, the "distinct" in the name). And even though distinct data types share the same representation as other built-in types, the DB2 Database Manager guarantees that <i class="emphasis">strong</i> <i class="emphasis">data</i> <i class="emphasis">typing</i> exists, which means that the value of a user-defined data type is compatible only with values of that same type. As a result, user-defined data types cannot be used as arguments for most of the built-in functions available. (Similarly, a built-in data type cannot be used in arguments or operands designed to use a distinct data type.) Instead, user-defined functions (or methods) that provide similar functionality must be developed when that kind of capability is needed.</p>
<p class="para">Distinct user-defined data types can be created by executing the <span class="fixed">CREATE DISTINCT TYPE</span> SQL statement. The basic syntax for this statement is:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE DISTINCT TYPE [<i class="emphasis">TypeName</i>]
AS [<i class="emphasis">SourceDataType</i>]
&lt;WITH COMPARISONS&gt;
<a name="465"></a><a name=""></a>
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">TypeName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the distinct data type to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SourceDataType</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the built-in data type that the distinct data type to be created is to be based on. (<a class="internaljump" href="#ch04t">Table 4-2</a> contains a list of valid built-in data type definitions.)</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">Thus, if you wanted to create a distinct data type named <span class="fixed">CURRENCY</span> that can be used to store numeric data, you could do so by executing a <span class="fixed">CREATE DISTINCT TYPE</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE DISTINCT TYPE currency AS NUMERIC(7,2)
WITH COMPARISONS
</pre>
</div>
<p class="para">Distinct data types can also be created using the Create Distinct Type dialog, which can be activated by selecting the appropriate action from the User Defined Distinct Datatypes menu found in the Control Center. <a class="internaljump" href="#ch0">Figure 4-25</a> shows the Control Center menu items that must be selected to activate the Create Distinct Type dialog; <a class="internaljump" href="#ch0">Figure 4-26</a> shows how the Create Distinct Type dialog might look when it is first activated.</p>
<div class="figure">
<a name="466"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig245_01_0.jpg" NAME="IMG_80" target="_parent"><img alt="Image from book" id="IMG_80" src="images/fig245_01.jpg" height="260" width="350" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-25: </span>Invoking the Create Distinct Type dialog from the Control Center.</span>
</div>
<div class="figure">
<a name="467"></a><a name="ch0"></a><span class="figuremediaobject"><a href="images/fig246_01_0.jpg" NAME="IMG_81" target="_parent"><img alt="Image from book" id="IMG_81" src="images/fig246_01.jpg" height="280" width="300" title="Click To expand" border="0"></a></span>
<br style="line-height: 1">
<span class="figure-title"><span class="figure-titlelabel">Figure 4-26: </span>The Create Distinct Type dialog.</span>
</div>
<a name="468"></a><a name=""></a>
<p class="para">When a distinct data type is created, six comparison functions (named <span class="fixed">=, &lt;&gt;, &lt;, &lt;=, &gt;</span>, and <span class="fixed">&gt;=</span>) may also be created. (Because <span class="fixed">BLOB, CLOB, DBCLOB, LONG VARCHAR</span> and <span class="fixed">LONG VARGRAPHIC</span> data types cannot be compared, comparison functions cannot be created for distinct data types that are based on these data types.) These functions allow two instances of the distinct data type to be compared in the same manner as any two values of the same built-in data type can be compared. Thus, the <span class="fixed">ORDER BY, GROUP BY</span>, and <span class="fixed">DISTINCT</span> clauses of a <span class="fixed">SELECT</span> SQL statement can be used with most columns that have been defined using a distinct data type.</p>
<p class="last-para">Two casting functions are also generated when a distinct data type is created. These functions are used to convert data between the new distinct data type and the built-in data type on which the distinct data type is based. The name of the casting function that will convert a built-in data type value to a distinct data type value is the same as that of the distinct data type itself. Thus, if a distinct data type named <span class="fixed">EMPID</span> that is based on an <span class="fixed">INTEGER</span> built-in data type is created, the DB2 Database Manager automatically generates the casting functions <span class="fixed">EMPID(INTEGER)</span> <a name="469"></a><a name=""></a>and <span class="fixed">INTEGER(EMPID)</span>. Both casting functions are extremely efficient because the distinct data type and the built-in type that the functions are based on share the same representation, and no real work is needed to convert values from one data type to the other.</p>
</div>
<div class="section">
<h4 class="sect4-title">
<a name="470"></a><a name="ch04le"></a>Structured Data Types</h4>
<p class="first-para">A structured data type is a user-defined data type that contains one or more attributes, each of which has a name and data type of its own. A structured data type often serves as the data type of a typed table or view, in which case each column of the table or view derives its name and data type from an attribute of the structured data type. A structured data type can also be created as a subtype of another structured type (referred to as its <i class="emphasis">supertype</i>). In this case, the subtype inherits all the attributes of the supertype and can optionally add additional attributes of its own.</p>
<p class="last-para">Just as six comparison functions and two casting functions are automatically created when a distinct data type is created, six comparison functions (also called <span class="fixed">=, &lt;&gt;, &lt;, &lt;=, &gt;</span>, and <span class="fixed">&gt;=</span>) and two casting functions can be created when a structured data type is created. (By default, the automatic creation of these functions is suppressed.) When created, these comparison functions are used to compare references to the structured data type, but not to the data type values themselves. Likewise, the two casting functions are used to cast between the generated reference type of the structured data type and the underlying data type that the structured data type uses as a reference type. Structured data types are created by executing the <span class="fixed">CREATE TYPE</span> SQL statement.</p>
</div>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="471"></a><a name="ch04lev"></a>User-Defined Functions (or Methods)</h3>
<p class="first-para">User-defined functions (UDFs) are special objects that are used to extend and enhance the support provided by the built-in functions available with DB2 9. Like user-defined data types, user-defined functions (or methods) are created and named by a database user. However, unlike DB2's built-in functions, user-defined functions can take advantage of system calls and DB2's administrative APIs, thereby providing more synergy between applications and databases.</p>
<p class="para">Five types of user-defined functions can be created:</p>
<a name="472"></a><a name=""></a>
<ul class="simple-list">
<li class="first-listitem">
<p class="para">
<b>Sourced (or Template).</b> A sourced function is constructed from a function that is already registered with a database (referred to as the <i class="emphasis">source</i> <i class="emphasis">function</i>). Sourced functions can be columnar, scalar, or table in nature or they can be designed to overload a specific operator such as <span class="fixed">+, -, *</span>, and <span class="fixed">/</span>. When a sourced function is invoked, all arguments passed to it are converted to the data types that are expected by the underlying source function, and the source function itself is invoked. Upon completion, the source function performs any conversions necessary on the results produced and returns them to the calling SQL statement. The most common use of sourced functions is to enable a user-defined distinct data type to inherit selectively some of the semantics of the built-in data type on which it is based.</p>
</li>
<li class="listitem">
<p class="para">
<b>SQL Scalar, Table, or Row.</b> Although a sourced function is constructed from a function that already exists, an SQL function is constructed from the ground up, using only SQL statements. An SQL function can be scalar in nature (scalar functions return a single value and can be specified in an SQL statement wherever a regular expression can be used) or can return a single row or an entire table.</p>
</li>
<li class="listitem">
<p class="para">
<b>External Scalar.</b> An external scalar function is a function that is written using a high-level programming language such as C, C++, or Java and returns a single value. The function itself resides in an external library and is registered in the database, along with any related attributes.</p>
</li>
<li class="listitem">
<p class="para">
<b>External Table.</b> Like external scalar functions, external table functions are written using a high-level programming language. But where an external scalar function returns a single value, an external table function returns a result data set, in the form of a table, to the SQL statement that references it. External table functions are powerful because they enable you to make almost any source of data appear to be a DB2 base table; the result data set returned can be used in join operations, grouping operations, set operations (for example, <span class="fixed">UNION</span>s), or any other operation that can be applied to a read-only view. Again, the function itself resides in an external library and is registered in the database, along with any related attributes.</p>
</li>
<li class="listitem">
<p class="para">
<b>OLE DB External Table.</b> Like external table functions, external Object Linking and Embedding (OLE) DB table functions are written using a high-level programming language and return a result data set, in the form of a table, to SQL statements that reference them. However, with OLE DB table functions, a generic built-in OLE DB consumer can be used to interface with any OLE DB provider to access data; you need only to register an OLE DB table function and refer to the appropriate OLE DB provider as the data source. No additional programming is needed. OLE DB is designed to provide access to all types of data in an OLE Component Object Model (COM) environment. Again, the function resides in an external library and is registered in the database, along with any related attributes.</p>
</li>
</ul>
<a name="473"></a><a name=""></a>
<p class="last-para">User-defined functions are created (or registered) by executing the <span class="fixed">CREATE FUNCTION</span> SQL statement. Several flavors of this statement are available, and the appropriate form to use is determined by the type of user-defined function to be created.</p>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="474"></a><a name="ch04lev"></a>Stored Procedures</h3>
<p class="first-para">In a basic DB2 client/server environment, each time an SQL statement is executed against a remote database, the statement itself is sent through a network from the client workstation to a database server. The database server then processes the statement, and the results are sent back, again through the network, to the client workstation. This means that two messages must go through the network for every SQL statement executed. Client/server application development focuses on breaking an application into two separate parts, storing those parts on two different platforms (the client and the server), and having them communicate with each other as the application executes. This allows the code that interacts directly with a database to reside on a database server, where computing power and centralized control can be used to provide quick, coordinated data access. At the same time, the application logic can reside on one or more client workstations so that it can make effective use of all the resources that a workstation has to offer without causing a bottleneck at the server.</p>
<p class="para">If you have an application that contains one or more transactions that perform a relatively large amount of database activity with little or no user interaction, those transactions can be stored on the database server as a <i class="emphasis">stored</i> <i class="emphasis">procedure</i>. When a stored procedure is used, all database processing done by the transaction can be performed directly at the database server. And, because a stored procedure is invoked by a single SQL statement, fewer messages have to be transmitted across the network-only the data that is actually needed at the client workstation has to be sent across. It is important to note that a stored procedure can be invoked by a user-defined function, and a user-defined function can be invoked as part of a stored procedure.</p>
<a name="475"></a><a name=""></a>
<p class="para">Just as there are different types of user-defined functions available, there are different types of stored procedures available. They are <i class="emphasis">SQL</i> and <i class="emphasis">external</i>.</p>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">User-defined functions and stored procedures are the only "executable" database objects available. For this reason, both are often referred to as "routines" or "routine objects."</p>
</td>
</tr>
</table>
<div class="section">
<h4 class="sect4-title">
<a name="476"></a><a name="ch04le"></a>SQL Stored Procedures</h4>
<p class="first-para">As the name implies, an SQL stored procedure is composed entirely of SQL statements. SQL stored procedures are created by executing one form of the <span class="fixed">CREATE PROCEDURE</span> SQL statement. (Two forms of this statement are available; we'll look at the other form a little later.) The basic syntax for the form of the <span class="fixed">CREATE PROCEDURE</span> statement that is used to create an SQL stored procedure looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE PROCEDURE [<i class="emphasis">ProcedureName</i>]
( [<i class="emphasis">ParamType</i>] [<i class="emphasis">ParamName</i>] [<i class="emphasis">DataType</i>], ...)
&lt;SPECIFIC [<i class="emphasis">SpecificName</i>]&gt;
&lt;DYNAMIC RESULT SETS [<i class="emphasis">NumResultSets</i>]&gt;
&lt;MODIFIES SQL DATA | CONTAINS SQL | READS SQL DATA&gt;
&lt;DETERMINISTIC | NOT DETERMINISTIC&gt;
&lt;CALLED ON NULL INPUT&gt;
&lt;INHERIT SPECIAL REGISTERS&gt;
&lt;[OLD | NEW] SAVEPOINT LEVEL&gt;
&lt;LANGUAGE SQL&gt;
&lt;&lt;NO&gt; EXTERNAL ACTION&gt;
[<i class="emphasis">SQLStatements</i>]
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ProcedureName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name that is to be assigned to the procedure to be created.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ParamType</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Indicates whether the parameter identified by <i class="emphasis">ParamName</i> is an input parameter (<span class="fixed">IN</span>), an output parameter (<span class="fixed">OUT</span>), or both an input and an output parameter (<span class="fixed">INOUT</span>).</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ParamName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name to be assigned to a procedure parameter.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">DataType</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the type of data the procedure expects to receive or send for the parameter identified by <i class="emphasis">ParamName</i>.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SpecificName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the specific name to be assigned to the procedure. This name can be used later to comment on the procedure or drop the procedure; however, it cannot be used to invoke the procedure.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">NumResultSets</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Specifies whether the procedure being created will return one or more result data sets and if so, how many. (The default value is 0.)</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SQLStatement</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Specifies an SQL statement or a compound SQL statement (i.e., two or more SQL statements enclosed with the keywords <span class="fixed">BEGIN ATOMIC</span> and <span class="fixed">END</span> and terminated with a semicolon) that is to be executed when the procedure is invoked.</p>
</td>
</tr>
</tbody>
</table>
</div>
<a name="477"></a><a name=""></a>
<table border="0" cellspacing="0" cellpadding="0" class="tip">
<tr>
<td valign="top" class="admon-check"></td><td valign="top" class="admon-title">Tip&nbsp;</td><td valign="top" class="admon-body">
<p class="first-para">When a specific name is assigned to a procedure, the procedure can be dropped by referencing the specific name in a special form of the DROP SQL statement (DROP SPECIFIC PROCEDURE [SpecificName]). However, if no specific name is assigned to a procedure, both the procedure name and the procedure's signature (a list of the data types used by each of the procedure's parameters) must be provided as input to the DROP PROCEDURE statement.</p>
</td>
</tr>
</table>
<p class="para">Thus, a simple SQL stored procedure could be created by executing a <span class="fixed">CREATE PROCEDURE</span> statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE PROCEDURE get_sales
   (IN quota INTEGER, OUT retcode CHAR(5))
   DYNAMIC RESULT SETS 1
   LANGUAGE SQL
   BEGIN
      DECLARE sqlstate CHAR(5);
      DECLARE sales_results CURSOR WITH RETURN FOR
         SELECT sales_person, SUM(sales) AS total_sales
         FROM sales
         GROUP BY sales_person
         HAVING SUM(sales) &gt; quota;
      DECLARE EXIT HANDLER FOR SQLEXCEPTION
         SET retcode = sqlstate;
      OPEN sales_results;
      SET retcode = sqlstate;
   END
<a name="478"></a><a name=""></a>
</pre>
</div>
<p class="para">The resulting SQL stored procedure, called <span class="fixed">GET_SALES</span>, accepts an integer input value (in an input parameter called <span class="fixed">QUOTA</span>) and returns a character value (in an output parameter called <span class="fixed">RETCODE</span>) that reports the procedure's success or failure. The procedure body consists of a compound SQL statement that returns a result data set (i.e., an open cursor) containing the name and total sales figures for each salesperson whose total sales exceed the quota specified. This is done by:</p>
<ol class="orderedlist">
<li class="first-listitem">
<p class="first-para">Indicating the SQL procedure is to return a result data set by specifying the <span class="fixed">DYNAMIC RESULT SETS</span> clause of the <span class="fixed">CREATE PROCEDURE</span> statement and assigning it the value 1.</p>
</li>
<li class="listitem">
<p class="first-para">Declaring a cursor within the procedure body (using the <span class="fixed">WITH RETURN FOR</span> clause) for the result data set that is to be returned. (A cursor is a named control structure that points to a specific row within a result data set and is used to retrieve values for each row in the set.)</p>
</li>
<li class="listitem">
<p class="first-para">Opening the cursor (which produces the result data set that is to be returned).</p>
</li>
<li class="listitem">
<p class="first-para">Leaving the cursor open when the SQL procedure ends.</p>
</li>
</ol>
<p class="last-para">It is important to note that when an SQL stored procedure is used to implement a business rule, the logic used to apply that business rule can be incorporated into any application simply by invoking the stored procedure. Thus, the same business rule logic is guaranteed to be enforced across all applications. When business rules change, only the logic in the SQL stored procedure needs to be changed; applications that call the procedure do not have to be modified. (The same can be said for external stored procedures, but the steps required to change the business logic coded in an external stored procedure are a little more complex.)</p>
</div>
<div class="section">
<h4 class="sect4-title">
<a name="479"></a><a name="ch04le"></a>External Stored Procedures</h4>
<p class="first-para">An external stored procedure is a stored procedure that is written using a high-level programming language such as C, C++, Java, or COBOL. Whereas SQL procedures offer rapid application development and considerable flexibility, external stored procedures can be much more powerful than SQL stored procedures because they can take advantage of system calls and administrative APIs, as well as execute SQL statements. However, this increase in functionality makes them more difficult to create; to create any external procedure, the following steps must be performed:</p>
<a name="480"></a><a name=""></a>
<ol class="orderedlist">
<li class="first-listitem">
<p class="first-para">Construct the body of the procedure, using a supported high-level programming language.</p>
</li>
<li class="listitem">
<p class="first-para">Compile the procedure.</p>
</li>
<li class="listitem">
<p class="first-para">Link the procedure to create a library (or dynamic-link library).</p>
</li>
<li class="listitem">
<p class="first-para">Debug the procedure and repeat steps 2 through 4 until all problems have been resolved.</p>
</li>
<li class="listitem">
<p class="first-para">Physically store the library containing the procedure on the database server. By default, the DB2 Database Manager looks for external user-defined functions in the <i class="emphasis"><span class="unicode">&hellip;</span>/sqllib/function</i> and <i class="emphasis"><span class="unicode">&hellip;</span>/sqllib/function/unfenced</i> subdirectories (<i class="emphasis"><span class="unicode">&hellip;</span>\sqllib\function</i> and <i class="emphasis"><span class="unicode">&hellip;</span>\sqllib\function\unfenced</i> subdirectories on Windows). Additionally, the system permissions for the library file containing the procedure must be modified so that all users can execute it. For example, in a UNIX environment, the <span class="fixed">chmod</span> command is used to make a file executable; in a Windows environment, the <span class="fixed">attrib</span> command is used for the same purpose.</p>
</li>
<li class="listitem">
<p class="first-para">Register the procedure with a DB2 database using the appropriate form of the <span class="fixed">CREATE PROCEDURE</span> SQL statement.</p>
</li>
</ol>
<p class="para">The basic syntax for the form of the <span class="fixed">CREATE PROCEDURE</span> statement that is used to register an external stored procedure (once it has been created as outlined above) looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
CREATE PROCEDURE [<i class="emphasis">ProcedureName</i>]
( [<i class="emphasis">ParamType</i>] [<i class="emphasis">ParamName</i>] [<i class="emphasis">DataType</i>], ...)
&lt;SPECIFIC [<i class="emphasis">SpecificName</i>]&gt;
&lt;DYNAMIC RESULT SETS [<i class="emphasis">NumResultSets</i>]&gt;
&lt;NO SQL | CONTAINS SQL | READS SQL DATA | MODIFIES SQL DATA &gt;
&lt;DETERMINISTIC | NOT DETERMINISTIC&gt;
&lt;CALLED ON NULL INPUT&gt;
&lt;[OLD | NEW] SAVEPOINT LEVEL&gt;
LANGUAGE [C | JAVA | COBOL | CLR | OLE]
EXTERNAL &lt;NAME [<i class="emphasis">ExternalName</i>] | [<i class="emphasis">Identifier</i>]&gt;
&lt;FENCED &lt;THREADSAFE | NOT THREADSAFE&gt; | NOT FENCED &lt;THREADSAFE&gt;&gt;
PARAMETER STYLE [DB2GENERAL | DB2SQL | GENERAL |
    GENERAL WITH NULLS | JAVA | SQL]
&lt;PROGRAM TYPE [SUB | MAIN]&gt;
&lt;DBINFO | NO DBINFO&gt;
<a name="481"></a><a name=""></a>
</pre>
</div>
<p class="para">where:</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ProcedureName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name to be assigned to the procedure to be registered.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ParamType</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Indicates whether the parameter identified by <i class="emphasis">ParamName</i> is an input parameter (<span class="fixed">IN</span>), an output parameter (<span class="fixed">OUT</span>), or both an input parameter and an output parameter (<span class="fixed">INOUT</span>).</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ParamName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name to be assigned to a procedure parameter.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">DataType</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the type of data the procedure expects to receive or send for the parameter identified by <i class="emphasis">ParamName</i>.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SpecificName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the specific name to be assigned to the procedure. This name can be used later to comment on or drop the procedure; however, it cannot be used to invoke the procedure.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">NumResultSets</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Specifies whether the procedure being registered will return one or more result data sets and if so, how many. (The default value is 0.)</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">SQLStatements</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Specifies one or more SQL statements that are to be executed when the procedure is invoked. These statements make up the body of the procedure.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">ExternalName</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name of the library, along with the name of the function in the library, that contains the executable code for the procedure being registered.</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">Identifier</i>
</p>
</td><td class="td" align="left">
<p class="table-para">Identifies the name of the library that contains the executable code of the procedure being registered, but only if the procedure was written using C or C++. The DB2 Database Manager will look for a function that has the same name as the library name specified.</p>
</td>
</tr>
</tbody>
</table>
</div>
<a name="482"></a><a name=""></a>
<p class="para">Many of the clauses used with this form of the <span class="fixed">CREATE PROCEDURE</span> SQL statement are similar to those used by the form of the <span class="fixed">CREATE PROCEDURE</span> SQL statement that is used to create an SQL procedure; others are new. The meaning of these clauses are as follows:</p>
<ul class="simple-list">
<li class="first-listitem">
<p class="first-para">
<b class="bold"><span class="fixed">&lt;NO SQL | CONTAINS SQL | READS SQL DATA | MODIFIES SQL DATA&gt;</span></b>:This clause is used to identify which types of SQL statements have been coded in the body of the external stored procedure. Four different values are available:</p>
<ul class="simple-list">
<li class="first-listitem">
<p class="para">
<b><span class="fixed">NO SQL.</span></b> The body of the stored procedure either does not contain any SQL or contains only nonexecutable SQL statements. (Examples of nonexecutable SQL statements are the <span class="fixed">INCLUDE</span> and <span class="fixed">WHENEVER</span> statements.)</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">CONTAINS SQL</span>.</b> The body of the stored procedure contains executable SQL statements that neither read nor modify data.</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">READS SQL DATA</span>.</b> The body of the stored procedure contains executable SQL statements that read but do not modify data.</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">MODIFIES SQL DATA</span>.</b> The body of the stored procedure contains executable SQL statements that both read and modify data.</p>
</li>
</ul>
</li>
<li class="listitem">
<p class="first-para">
<b class="bold"><span class="fixed">&lt;DETERMINISTIC | NOT DETERMINISTIC&gt;</span></b><b class="bold">:</b> This clause is used to identify whether the procedure will always return the same results when passed the same parameter values (<span class="fixed">DETERMINISTIC</span>) or not (<span class="fixed">NOT DETERMINISTIC</span>). (A stored procedure that applies a 15% increase to any value passed to it would be considered <span class="fixed">DETERMINISTIC</span>, whereas a stored procedure that generates a unique ID using the <span class="fixed">TIMESTAMP_ISO()</span> function would be considered <span class="fixed">NOT DETERMINISTIC</span>.)</p>
</li>
<li class="listitem">
<p class="first-para">
<b class="bold"><span class="fixed">&lt;CALLED ON NULL INPUT&gt;</span></b><b class="bold">:</b> When this clause is used, the stored procedure will always be invoked, even if a null value is passed for one or more of its input parameters.</p>
</li>
<li class="listitem">
<p class="first-para">
<b class="bold"><span class="fixed">&lt;[OLD | NEW] SAVEPOINT LEVEL&gt;</span></b><b class="bold">:</b> This clause is used to indicate whether or not the procedure is to establish a new "save point" within the transaction that invoked it. (Savepoints are used to shorten rollback recovery windows.)</p>
</li>
<li class="listitem">
<p class="first-para">
<b class="bold"><span class="fixed">EXTERNAL &lt;NAME [<i class="emphasis">ExternalName</i>] | [<i class="emphasis">Identifier</i>]&gt;</span></b><b class="bold">:</b> This clause is used to identify two things: the name of the library and, optionally, the name of the function within the library that contains the executable code for the procedure being registered. The high-level programming language used to construct the body of any external stored procedure determines how these names are provided. For example, if an external stored procedure is developed using the C or C++ programming language, the names of the library and function within the library that contains the body of the function can be specified in four different ways:</p>
<a name="483"></a><a name=""></a>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">' LibraryName '</p>
</li>
<li class="listitem">
<p class="first-para">' LibraryName ! FunctionName '</p>
</li>
<li class="listitem">
<p class="first-para">' AbsolutePath '</p>
</li>
<li class="listitem">
<p class="first-para">' AbsolutePath ! FunctionName '</p>
</li>
</ul>
<p class="last-para">If a library name is provided instead of an absolute path, the DB2 Database Manager will look in the <i class="emphasis"><span class="unicode">&hellip;</span>/sqllib/function</i> and <i class="emphasis"><span class="unicode">&hellip;</span>/sqllib/function/unfenced</i> subdirectories (<i class="emphasis"><span class="unicode">&hellip;</span>\sqllib\function</i> and <i class="emphasis"><span class="unicode">&hellip;</span>\sqllib\function\unfenced</i> subdirectories on Windows) for the library name specified. On the other hand, if an absolute path is provided, the name of the library must be appended to the path, and the DB2 Database Manager will look in the location specified for the appropriate library. (If neither a library name nor an absolute path is provided, the DB2 Database Manager will look in the default subdirectories shown earlier for a library and function that have the same name as the name that is to be assigned to the user-defined function being registered.) If a function name is provided, the DB2 Database Manager will look for a function that has the name specified within the library specified; if no function name is provided, the DB2 Database Manager will look for a function that has the same name as the library name specified.</p>
</li>
<li class="listitem">
<p class="first-para">
<b class="bold"><span class="fixed">&lt;FENCED | NOT FENCED&gt;</span></b><b class="bold">:</b> This clause is used to identify whether the external stored procedure is considered "safe" enough to be run in the DB2 Database Manager operating environment's process/address space (<span class="fixed">NOT FENCED</span>), or not (<span class="fixed">FENCED</span>). If the <span class="fixed">FENCED</span> clause is specified (or if neither clause is specified), the DB2 Database Manager will not allow the procedure to access its internal resources.</p>
</li>
<li class="listitem">
<p class="first-para">
<span class="fixed"><b class="bold">PARAMETER STYLE [DB2GENERAL | DB2SQL | GENERAL | GENERAL</b> <b class="bold">WITH NULLS | JAVA | SQL]&gt;</b></span><b class="bold">:</b> This clause is used to identify the parameter-passing style that the procedure expects the calling application to use when passing values to it. As you can see, there are six parameter-passing styles available:</p>
<a name="484"></a><a name=""></a>
<ul class="simple-list">
<li class="first-listitem">
<p class="para">
<b><span class="fixed">DB2GENERAL.</span></b> Values are passed and returned using the calling conventions that are used to call a method in a Java class. (This style can only be used when the procedure is written using Java.)</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">DB2SQL.</span></b> Values are passed and returned using calling conventions that are defined in the SQL/Persistent Stored Modules ISO working draft; along with the arguments identified, the following are passed to the procedure when it is called: a null indicator for each parameter passed, a placeholder for the SQLSTATE to be returned in, the qualified name of the procedure, the specific name of the procedure, and a placeholder for the SQL diagnostic string to be returned in. (This style can only be used when the procedure is written using C/C++, COBOL, or OLE.)</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">GENERAL.</span></b> Values are passed and returned exactly as they are specified when the procedure is invoked. (This style can only be used when the procedure is written using C/C++ or COBOL.)</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">GENERAL WITH NULLS.</span></b> Same as <span class="fixed">GENERAL</span>, with one major difference-an additional argument containing a vector of null indicators is also passed to and returned from the procedure. (This style can only be used when the procedure is written using C/C++ or COBOL.)</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">JAVA.</span></b> Values are passed and returned using calling conventions that conform to the Java language and SQLJ specifications. (This style can only be used when the procedure is written using Java.)</p>
</li>
<li class="listitem">
<p class="para">
<b><span class="fixed">SQL.</span></b> Same as <span class="fixed">DB2SQL</span>.</p>
</li>
</ul>
</li>
<li class="listitem">
<p class="first-para">
<b class="bold"><span class="fixed">&lt;PROGRAM TYPE [SUB | MAIN]&gt;</span></b><b class="bold">:</b> This clause is used to identify whether the procedure was defined as a main routine (<span class="fixed">MAIN</span>) or as a subroutine (<span class="fixed">SUB</span>). If the <span class="fixed">PROGRAM TYPE SUB</span> clause is specified, the DB2 Database Manager will pass all parameter values to the stored procedure as separate arguments. In this case, the stored procedure can be assigned any name that conforms to the function-naming conventions allowed by the high-level programming language used. On the other hand, if the <span class="fixed">PROGRAM TYPE MAIN</span> clause is specified, the DB2 Database Manager will pass all parameter values to the stored procedure as a combination of an argument counter and an array of argument values. In this case, the DB2 Database Manager expects the name of the stored procedure to be "<span class="fixed">main</span>."</p>
</li>
<li class="listitem">
<p class="first-para">
<span class="fixed"><b class="bold">&lt;DBINFO | NO DBINFO&gt;</b>:</span> This clause is used to identify whether information known by DB2 is to be passed to the stored procedure as an additional argument when it is invoked (<span class="fixed">DBINFO</span>) or not (<span class="fixed">NO DBINFO</span>). If the <span class="fixed">DB2INFO</span> clause is used, the DB2 Database Manager will pass a data structure that contains the following information to the stored procedure at the time it is invoked:</p>
<a name="485"></a><a name="IDX-"></a>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">The name of the currently connected database</p>
</li>
<li class="listitem">
<p class="first-para">The unique application ID that is established for each connection to the database</p>
</li>
<li class="listitem">
<p class="first-para">The application run-time authorization ID</p>
</li>
<li class="listitem">
<p class="first-para">The database code page</p>
</li>
<li class="listitem">
<p class="first-para">The version, release, and modification level of the database server invoking the stored procedure</p>
</li>
<li class="listitem">
<p class="first-para">The operating system being used by the server</p>
</li>
</ul>
</li>
</ul>
<p class="para">Thus, if you wanted to register an external stored procedure named <span class="fixed">EXTRACT_RESUME</span> that is stored as a function (written in C) named <span class="fixed">ExResume</span> in a library named <i class="emphasis">SProc</i> that resides in the directory <i class="emphasis">C:\StoredProcs</i>, you could do so by executing a <span class="fixed">CREATE PROCEDURE</span> SQL statement that looks something like this:</p>
<div class="informalexample">
<pre class="literallayout">
EXEC SQL CREATE PROCEDURE extract_resume
    (IN filename  VARCHAR(255),
     IN empno     CHAR(6))
SPECIFIC extract_resume
DYNAMIC RESULT SETS 0
EXTERNAL NAME 'C:\StoredProcs\SProc!ExResume'
LANGUAGE C
PARAMETER STYLE GENERAL
DETERMINISTIC
FENCED
CALLED ON NULL INPUT
PROGRAM TYPE SUB;
</pre>
</div>
<p class="para">When this particular <span class="fixed">CREATE PROCEDURE</span> SQL statement is executed, an external stored procedure will be registered that:</p>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">Has been assigned the name <span class="fixed">EXTRACT_RESUME</span>
</p>
</li>
<li class="listitem">
<p class="first-para">Has one input parameter called <span class="fixed">FILENAME</span> that expects a <span class="fixed">VARCHAR(255)</span> data value and another input parameter called <span class="fixed">EMPNO</span> that expects a <span class="fixed">CHAR(6)</span> data value</p>
</li>
<li class="listitem">
<p class="first-para">Has been assigned the specific name <span class="fixed">EXTRACT_RESUME</span>
</p>
<a name="486"></a><a name=""></a>
</li>
<li class="listitem">
<p class="first-para">Does not return a result data set</p>
</li>
<li class="listitem">
<p class="first-para">Was constructed using the C or C++ programming language</p>
</li>
<li class="listitem">
<p class="first-para">Expects calling applications to use the <span class="fixed">GENERAL</span> style when passing parameters</p>
</li>
<li class="listitem">
<p class="first-para">Will always return the same results if called with the same parameter values</p>
</li>
<li class="listitem">
<p class="first-para">Is to be run outside the DB2 Database Manager operating environment's address space</p>
</li>
<li class="listitem">
<p class="first-para">Is to be called, even if a null value has been provided for one of its parameters</p>
</li>
<li class="listitem">
<p class="first-para">Was written as a subroutine</p>
</li>
</ul>
</div>
</div>
<div class="section">
<h3 class="sect3-title">
<a name="487"></a><a name="ch04lev"></a>Packages</h3>
<p class="first-para">A package is an object that contains the information needed to process SQL statements associated with a source code file of an application program. High-level programming language compilers do not recognize, and therefore cannot interpret, SQL statements. Therefore, when SQL statements are embedded in a high-level programming language source code file, they must be converted to source code that a high-level programming language compiler can understand; this conversion process is performed by a tool known as the <i class="emphasis">SQL</i> <i class="emphasis">precompiler.</i> (An SQL precompiler is included with the DB2 Software Development Kit and is normally invoked from the Command Line Processor or a batch/make utility file.)</p>
<p class="para">During the precompile process, a source code file containing embedded SQL statements is converted into a source code file that is made up entirely of high-level programming language statements. At the same time, a corresponding package that contains, among other things, the access plans that will be used to process each SQL statement embedded in the source code file is also produced. (Access plans contain optimized information that the DB2 Database Manager uses to execute SQL statements.) This package must reside in a DB2 database that contains the data objects referenced by the package before the corresponding application can be executed against that database.</p>
<a name="488"></a><a name=""></a>
<p class="last-para">The process of creating and storing a package in a DB2 database is known as <i class="emphasis">binding</i>, and by default, packages are automatically bound to a database during the precompile process. However, by specifying the appropriate precompiler options, you can elect to store the steps needed to create a package in a file and complete the binding process at a later point in time, using a tool known as the <i class="emphasis">SQL</i> <i class="emphasis">Binder</i> (or simply the Binder). This approach is known as <i class="emphasis">deferred</i> <i class="emphasis">binding</i>.</p>
</div>
</div>
</div>
</div>
</DIV>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=BBL0026.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=BBL0028.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>