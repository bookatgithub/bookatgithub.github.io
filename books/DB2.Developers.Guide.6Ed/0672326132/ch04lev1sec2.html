<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Types of User-Defined Functions</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch04lev1sec1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch04lev1sec3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch04lev1sec2"></A><H3 class="docSection1Title" >Types of User-Defined Functions</H3>
<P class="docText">There are two ways of creating a user-defined function: You can code your own function program from scratch, or you can edit an existing function.</P>
<P class="docText">Two types of user-defined functions can be written from scratch: <span class="docEmphasis">scalar functions</span> and <span class="docEmphasis">table functions</span>. Recall from <A class="docLink" HREF="ch03.html#ch03">Chapter 3</A>, "Using DB2 Functions," that scalar functions are applied to a column or expression and operate on a single value. Table functions are a different type of function that, when invoked, return an entire table. A table function is specified in the <TT>WHERE</TT> clause of a <TT>SELECT</TT> statement taking the place of a table, view, synonym, or alias.<A NAME="ch04index04"></A><A NAME="ch04index05"></A><A NAME="ch04index06"></A><A NAME="ch04index07"></A></P>
<P class="docText">Scalar and table user-defined functions are referred to as <span class="docEmphasis">external functions</span> because they are written and developed outside of (or external to) DB2. External UDFs must be written in a host programming language. DB2 user-defined functions can be written in Assembler, C, C++, COBOL, Java, or PL/I.<A NAME="ch04index08"></A><A NAME="ch04index09"></A></P>
<P class="docText">A third type of user-defined function can be created from another existing function. This is a sourced function. A <span class="docEmphasis">sourced function</span> is based on a function that already exists—it can be based on a built-in function or another user-defined function that has already been created. A sourced function can be based on an existing scalar or column function. So, external functions are coded from scratch, whereas sourced functions are created based on a pre-existing function (see <A class="docLink" HREF="#ch04fig01">Figure 4.1</A>).<A NAME="ch04index10"></A><A NAME="ch04index11"></A></P>
<A NAME="ch04fig01"></A><p><CENTER><H5 class="docFigureTitle">Figure 4.1. Sourced versus external UDFs.</H5>
<p class="docText"><IMG BORDER="0"  width="400" height="314" SRC="images/0672326132/graphics/04fig01.gif" ALT="graphics/04fig01.gif"></p></CENTER></p><br>
<P class="docText">User-defined functions are similar in functionality to application subroutines, but user-defined functions are different because they can be used inside SQL statements. In fact, the only way that user-defined functions can be executed is from within an SQL statement. This gives them great power. A user-defined function is not a substitute for an application subroutine, subprogram, or procedure. Instead, user-defined functions are used to extend the functionality of the SQL language.</P>
<A NAME="ch04lev2sec1"></A><H4 class="docSection2Title">The Schema</H4>
<P class="docText">User-defined functions, user-defined distinct types, stored procedures, and triggers all are associated with a schema. By default, the schema name is the authid of the process that issues the <TT>CREATE FUNCTION</TT>, <TT>CREATE DISTINCT TYPE</TT>, <TT>CREATE PROCEDURE</TT>, or <TT>CREATE TRIGGER</TT> statement.<A NAME="ch04index12"></A><A NAME="ch04index13"></A></P>
<P class="docText">A schema, therefore, is simply a logical grouping of procedural database objects (user-defined functions, user-defined distinct types, stored procedures, and triggers).</P>
<P class="docText">You can specify a schema name when you create a user-defined function, type, or trigger. If the schema name is not the same as the SQL authorization ID, the issuer of the statement must have either <TT>SYSADM</TT> or <TT>SYSCTRL</TT> authority, or the authid of the issuing process must have the <TT>CREATEIN</TT> privilege on the schema.</P>
<P class="docText">For example, the following statement creates a user-defined function named <TT>NEWFUNC</TT> in the schema named <TT>MYSCHEMA</TT>:</P>
<pre>

</pre><BR><pre>
CREATE FUNCTION MYSCHEMA.NEWFUNC ...
</pre><BR>
<P class="docText">If the <TT>MYSCHEMA</TT> component was not included in the <TT>CREATE</TT> statement, the schema would default to the authid of the person (or process) that executed the <TT>CREATE</TT> statement. In short, the schema is set to the owner of the function. If the <TT>CREATE</TT> statement was embedded in a program, the owner is the authid of the owner of the plan or package; if the statement is dynamically prepared, the owner is the authid in the <TT>CURRENT SQLID</TT> special register.<A NAME="ch04index14"></A><A NAME="ch04index15"></A></P>
<A NAME="ch04lev2sec2"></A><H4 class="docSection2Title">Creating User-Defined Functions</H4>
<P class="docText">Before using DDL to create a user-defined function, the function program should be coded and prepared. This requires the developer to write the program, precompile, compile, link-edit the program, <TT>BIND</TT> the DBRM for the program (if the function contains SQL statements), and then test the program to be sure it is free of bugs.<A NAME="ch04index16"></A></P>
<P class="docText">Then, before the user-defined function can be used, it must be registered to DB2 using the <TT>CREATE FUNCTION</TT> DDL statement. For example, assume that you have written a user-defined function program. Further assume that the program returns the number of days in the month for a given date. The following is a simplified version of the <TT>CREATE FUNCTION</TT> statement that could be used to register the UDF to DB2:</P>
<pre>

</pre><BR><pre>
CREATE FUNCTION DAYSINMONTH(DATE)
  RETURNS INTEGER
  EXTERNAL NAME 'DAYMTH'
   LANGUAGE COBOL;
</pre><BR>
<P class="docText">This statement creates a UDF named <TT>DAYSINMONTH</TT>, with one parameter of <TT>DATE</TT> data type, that returns a single value of <TT>INTEGER</TT> data type. The external name for the function program is <TT>DAYMTH</TT> and it is coded in COBOL.</P>
<A NAME="ch04note01"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">Most of the parameters have been omitted from this simple <TT>CREATE FUNCTION</TT> example. The parameters available for the <TT>CREATE FUNCTION</TT> statement are discussed in depth later in this chapter.</P></div><br>
<P class="docText">After the user-defined function has been created, and the appropriate authority has been <TT>GRANT</TT>ed, the UDF can be used in an SQL statement as follows:</P>
<pre>

</pre><BR><pre>
SELECT EMPNO, LASTNME, BIRTHDATE, DAYSINMONTH(BIRTHDATE)
FROM   DSN8810.EMP
WHERE  DAYSINMONTH(BIRTHDATE) &lt; 31; 
</pre><BR>
<P class="docText">The result of this statement would be a list of employees whose birth date falls in a month having fewer than 31 days (that is, February, April, June, September, and November). This assumes that the program for the user-defined function <TT>DAYSINMONTH</TT> is correctly coded to examine the date specified as input and return the actual number of days in the month.</P>
<P class="docText">There are many different characteristics that need to be determined and specified when creating UDFs. <A class="docLink" HREF="#ch04table01">Table 4.1</A> outlines the characteristics and whether each applies to external functions, sourced functions, or both.<A NAME="ch04index17"></A></P>
<A NAME="ch04table01"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 4.1. Characteristics of DB2 User-Defined Functions</h5></CAPTION><COLGROUP><COL width="143"><COL width="264"><COL width="143"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Characteristic</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Definition</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Validity</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">UDF name (Input parameter types)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Name of the UDF and its B parameters.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">B</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RETURNS [TABLE]</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Output parameter types.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">B<A NAME="ch04index20"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPECIFIC</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Specific name.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">B<A NAME="ch04index21"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><IMG BORDER="0"  width="30" height="18" SRC="images/0672326132/graphics/V7_icon.gif" ALT="graphics/V7_icon.gif"> <TT>PARAMETER CCSID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Encoding scheme for string parameters: ASCII, EBCDIC, or UNICODE.<A NAME="ch04index22"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">B</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXTERNAL NAME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Name of the UDF program.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index23"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LANGUAGE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Programming language used to write the UDF program.<A NAME="ch04index24"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>[NOT] DETERMINISTIC</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether the UDF program is deterministic.<A NAME="ch04index25"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>...SQL...</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether or not SQL is issued in the UDF program and if SQL modifies or just reads DB2 data. Valid options are <TT>NO SQL</TT>, <TT>MODIFIES SQL DATA</TT>, <TT>READS SQL DATA</TT>, or <TT>CONTAINS SQL</TT>.<A NAME="ch04index26"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SOURCE</TT><A NAME="ch04index27"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Name of the source function.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">S</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PARAMETER STYLE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The linkage convention used by the UDF program. DB2 SQL indicates parameters for indicator variables are associated with each input value and the return value to allow for <TT>NULL</TT>s.<A NAME="ch04index28"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FENCED</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The UDF code cannot run in the DBMS address space.<A NAME="ch04index29"></A><A NAME="ch04index30"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>...NULL...</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether the function is called if any input arguments are <TT>NULL</TT> at execution time.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>[NO] EXTERNAL ACTION</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether the UDF performs an action that changes the state of objects that DB2 does not manage (such as files).</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>[NO] SCRATCHPAD</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether or not a scratchpad is used to save informationfrom one invocation of the UDF to the next.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>[NO] FINAL CALL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether or not a final call is made to the UDF program to free system resources.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>[DIS]ALLOW PARALLEL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether or not parallel processing is permitted.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>[NO] COLLID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Package collection ID of UDF package. <TT>NO</TT> indicates same as calling program.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>WLM ENVIRONMENT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The name of the WLM environment.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index31"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ASUTIME [NO] LIMIT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">CPU resource limit for an invocation of a UDF.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index32"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STAY RESIDENT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether or not the UDF load module stays in memory.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index33"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PROGRAM TYPE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether the program runs as a main routine (<TT>MAIN</TT>) or as a subroutine (<TT>SUB</TT>).<A NAME="ch04index34"></A><A NAME="ch04index35"></A><A NAME="ch04index36"></A></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SECURITY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Type of security to beused: <TT>DB2</TT>, <TT>USER</TT>, or <TT>DEFINER</TT>.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index37"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><IMG BORDER="0"  width="30" height="18" SRC="images/0672326132/graphics/V7_icon.gif" ALT="graphics/V7_icon.gif"> <TT>SPECIAL REGISTERS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Indicates whether values of special registers are inherited or defaulted.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index38"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><IMG BORDER="0"  width="30" height="18" SRC="images/0672326132/graphics/V7_icon.gif" ALT="graphics/V7_icon.gif"> <TT>STATIC DISPATCH</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">At function resolution time, DB2 chooses a function based on the static (or declared) types of the function parameters.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index39"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RUN OPTIONS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">LE/370 runtime options.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index40"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CARDINALITY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">An estimate of the expected number of rows returned by a table function.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index41"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>[NO] DBINFO</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether or not an additional argument is passed when the UDF is invoked.</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">X<A NAME="ch04index42"></A><A NAME="ch04index43"></A><A NAME="ch04index44"></A><A NAME="ch04index45"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch04note02"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">If the Validity column of <A class="docLink" HREF="#ch04table01">Table 4.1</A> contains the value X, the characteristic applies to external functions only; S means it applies to sourced functions only; and B means it applies to both external and sourced functions.</P></div><br>
<A NAME="ch04lev4sec1"></A><H5 class="docSection3Title">UDF Programming Language Options</H5>
<P class="docText">DB2 offers several application programming languages in which UDF programs can be written. The following languages are supported by DB2 for UDF creation:<A NAME="ch04index46"></A><A NAME="ch04index47"></A><A NAME="ch04index48"></A></P>
<UL><LI><P class="docList">Assembler</P></LI><LI><P class="docList">C</P></LI><LI><P class="docList">C++</P></LI><LI><P class="docList">COBOL</P></LI><LI><P class="docList">
<IMG BORDER="0"  width="30" height="18" SRC="images/0672326132/graphics/V7_icon.gif" ALT="graphics/V7_icon.gif"> Java (new as of DB2 V7)</P></LI><LI><P class="docList">PL/I</P></LI></UL>
<P class="docText">DB2 also supports SQL scalar functions that are written using only SQL functionality.</P>
<P class="docText">Keep in mind, too, that all UDF programs must be designed to run in IBM's Language Environment (LE/370).<A NAME="ch04index49"></A><A NAME="ch04index50"></A><A NAME="ch04index51"></A></P>
<A NAME="ch04lev2sec3"></A><H4 class="docSection2Title">How Functions Are Executed</H4>
<P class="docText">User-defined functions run in WLM-managed stored procedure address spaces. To execute a user-defined function, simply reference the function in an SQL statement. The SQL statement can be issued dynamically or statically, as part of an application program or via ad hoc SQL—anywhere SQL can be run, the UDF can be coded. External UDFs require WLM running in <TT>GOAL</TT> mode.<A NAME="ch04index52"></A><A NAME="ch04index53"></A></P>
<P class="docText">When a function is invoked in an SQL statement, DB2 must choose the correct function to run to satisfy the request. DB2 will check for candidate functions to satisfy the function request. The manner in which DB2 chooses which function to run is based on the following criteria:</P>
<UL><LI><P class="docList">First of all, the schema must match. If the function being invoked is fully qualified, the schema must match for the function to be considered a candidate for execution. If the function being invoked is not fully qualified, DB2 will check the SQL path of the invoking process to find a function with a matching schema.</P></LI><LI><P class="docList">Of course, the name must match the function being invoked for the user-defined function to be considered a candidate for execution.</P></LI><LI><P class="docList">The number of parameters for the user-defined function must match the number of parameters specified by the invoked function. Additionally, the data type of each parameter must match, or be promotable to, the data types specified for each parameter in the function being invoked. Refer to <A class="docLink" HREF="#ch04table02">Table 4.2</A> for a list of which data types are promotable to other data types. The data types in the first column can be promoted to the data types in the second column. When performing function resolution, the earlier the data type in the second column appears, the more preferable it is to the other promotable data types.</P><P class="docList">To clarify this requirement, consider the following example:</P><pre>

</pre><BR><pre>
SELECT XSCHEMA.FUNCX(COLA)
FROM   TABLE;
</pre><BR><P class="docList">The data type of <TT>COLA</TT> is <TT>SMALLINT</TT>. Furthermore, two user-defined functions have been created named <TT>FUNCX</TT>, both in the same schema, <TT>XSCHEMA</TT>. Both <TT>FUNCX</TT> UDFs require one parameter, but one is defined with an <TT>INTEGER</TT> data type and the other with a data type of <TT>REAL</TT>. The <TT>SMALLINT</TT> data type is promotable to both <TT>INTEGER</TT> and <TT>REAL</TT>, but, because <TT>INTEGER</TT> appears first in the promotion list, the <TT>FUNCX</TT> with the <TT>INTEGER</TT> parameter will be used instead of the one with the <TT>REAL</TT> parameter.</P></LI><LI><P class="docList">The appropriate authority must exist. That is, the invoking authid must have the authority to execute the user-defined function.</P></LI><LI><P class="docList">Finally, the timestamp of the <TT>BIND</TT> for the user-defined function must be older than the timestamp of the <TT>BIND</TT> for the package or plan that invokes the function.</P></LI></UL>
<A NAME="ch04note03"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">For a function that passes a transition table, the data type, length, precision, and scale of each column in the transition table must match the data type, length, precision, and scale of each column of the table specified in the function definition.</P></div><br>
<P class="docText">For unqualified UDFs, it is possible that two or more candidate functions will fit equally well. In this case, the user-defined function whose schema name is earliest in the SQL path will be chosen for execution.</P>
<P class="docText">For example, suppose functions <TT>XSCHEMA.FUNC1</TT> and <TT>YSCHEMA2.FUNC1</TT> both fit the function resolution criteria equally well. Both have the same function name but different schema names. Both also fit the rest of the criteria regarding number of parameters, parameter data types, and requisite authority. If the SQL path is<A NAME="ch04index54"></A><A NAME="ch04index55"></A></P>
<pre>

</pre><BR><pre>
"ZSCHEMA"; "YSCHEMA"; "SYSPROC"; "SYSIBM"; "XSCHEMA";
</pre><BR>
<P class="docText">DB2 will select function <TT>YSCHEMA.FUNC1</TT> because <TT>YSCHEMA</TT> is before <TT>XSCHEMA</TT> in the SQL path.</P>
<P class="docText">The SQL path is specified to DB2 in one of two ways. The SQL path is determined by the <TT>CURRENT PATH</TT> special register for dynamically prepared SQL statements. For dynamic SQL, the SQL path can be set by issuing the <TT>SET CURRENT PATH</TT> statement. The <TT>PATH</TT> parameter of the <TT>BIND</TT> and <TT>REBIND</TT> commands is used to specify the SQL path for SQL containing UDFs in plans and packages.</P>
<P class="docText">DB2 supports function overloading. This means that multiple functions can have the same name and DB2 will decide which one to run based on the parameters. Consider an example where an application developer writes a UDF that overloads the addition operator <TT>+</TT>. The UDF is created to concatenate text strings together. The <TT>+</TT> function is overloaded because if it is acting on numbers it adds them together; if the function is acting on text it concatenates the text strings.<A NAME="ch04index56"></A><A NAME="ch04index57"></A><A NAME="ch04index58"></A><A NAME="ch04index59"></A></P>
<A NAME="ch04table02"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 4.2. Data Type Promotability</h5></CAPTION><COLGROUP><COL width="275"><COL width="275"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Data Type</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Can Be Promoted to</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CHAR</TT> or <TT>GRAPHIC</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CHAR</TT> or <TT>GRAPHIC</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>VARCHAR</TT> or <TT>VARGRAPHIC</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CLOB</TT> or <TT>DBCLOB</TT><A NAME="ch04index63"></A><A NAME="ch04index64"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>VARCHAR</TT> or <TT>VARGRAPHIC</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>VARCHAR</TT> or <TT>VARGRAPHIC</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CLOB</TT> or <TT>DBCLOB</TT><A NAME="ch04index65"></A><A NAME="ch04index66"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CLOB</TT> or <TT>DBCLOB</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CLOB</TT> or <TT>DBCLOB</TT><A NAME="ch04index67"></A><A NAME="ch04index68"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>BLOB</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>BLOB</TT><A NAME="ch04index69"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SMALLINT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SMALLINT</TT><A NAME="ch04index70"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INTEGER</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECIMAL</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REAL</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DOUBLE</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INTEGER</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INTEGER</TT><A NAME="ch04index71"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECIMAL</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REAL</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DOUBLE</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECIMAL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECIMAL</TT><A NAME="ch04index72"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REAL</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DOUBLE</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REAL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REAL</TT><A NAME="ch04index73"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DOUBLE</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DOUBLE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DOUBLE</TT><A NAME="ch04index74"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DATE</TT><A NAME="ch04index75"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TIME</TT><A NAME="ch04index76"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TIMESTAMP</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TIMESTAMP</TT><A NAME="ch04index77"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ROWID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ROWID</TT><A NAME="ch04index78"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UDT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UDT</TT> (with the same name)<A NAME="ch04index79"></A><A NAME="ch04index80"></A><A NAME="ch04index81"></A><A NAME="ch04index82"></A></P></TD></TR></TABLE></P><br>
<P class="docText">The process of following these steps to determine which function to execute is called <span class="docEmphasis">function resolution</span>.<A NAME="ch04index83"></A><A NAME="ch04index84"></A><A NAME="ch04index85"></A><A NAME="ch04index86"></A></P>
<A NAME="ch04note04"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">When automatic rebind is invoked on a package or plan that contains UDFs, DB2 will not consider any UDF created after the original <TT>BIND</TT> or <TT>REBIND</TT> was issued. In other words, only those UDFs that existed at the time of the original <TT>BIND</TT> or <TT>REBIND</TT> are considered during function resolution for plans and packages bound as a result of automatic rebind.</P></div><br>
<A NAME="ch04lev4sec2"></A><H5 class="docSection3Title"><TT>DSN_FUNCTION_TABLE</TT> and <TT>EXPLAIN</TT></H5>
<P class="docText">You can use <TT>EXPLAIN</TT> to obtain information about DB2 function resolution. To use <TT>EXPLAIN</TT> to obtain function resolution information, you must create a special table called <TT>DSN_FUNCTION_TABLE</TT>. When <TT>EXPLAIN</TT> is executed and UDFs are used, DB2 will store function resolution details for each UDF in the statement, package, or plan, in <TT>DSN_FUNCTION_TABLE</TT>.<A NAME="ch04index87"></A><A NAME="ch04index88"></A><A NAME="ch04index89"></A><A NAME="ch04index90"></A><A NAME="ch04index91"></A></P>
<P class="docText">Information will be populated in <TT>DSN_FUNCTION_TABLE</TT> when you execute an <TT>EXPLAIN</TT> on an SQL statement that contains one or more UDFs, or when you run a program whose plan is bound with <TT>EXPLAIN(YES)</TT>, and the program executes an SQL statement that contains one or more UDFs.</P>
<A NAME="ch04note05"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText"><TT>EXPLAIN</TT> actually can be used to return a lot more information about SQL statements, including the actual access paths used by DB2 to run the SQL. Refer to <A class="docLink" HREF="ch25.html#ch25">Chapter 25</A>, "Using EXPLAIN," for an in-depth exploration of using <TT>EXPLAIN</TT> and interpreting its results.</P></div><br>
<P class="docText">Remember, you must create a table named <TT>DSN_FUNCTION_TABLE</TT> before you can use <TT>EXPLAIN</TT> to obtain function resolution details. A sample <TT>CREATE</TT> statement for this table follows:</P>
<pre>

</pre><BR><pre>
CREATE TABLE <span class="docEmphasis">userid</span>.DSN_FUNCTION_TABLE
  (QUERYNO        INTEGER      NOT NULL WITH DEFAULT,
   QBLOCKNO       INTEGER      NOT NULL WITH DEFAULT,
   APPLNAME       CHAR(8)      NOT NULL WITH DEFAULT,
   PROGNAME       CHAR(8)      NOT NULL WITH DEFAULT,
   COLLID         CHAR(18)     NOT NULL WITH DEFAULT,
   GROUP_MEMBER   CHAR(8)      NOT NULL WITH DEFAULT,
   EXPLAIN_TIME   TIMESTAMP    NOT NULL WITH DEFAULT,
   SCHEMA_NAME    CHAR(8)      NOT NULL WITH DEFAULT,
   FUNCTION_NAME  CHAR(18)     NOT NULL WITH DEFAULT,
   SPEC_FUNC_NAME CHAR(18)     NOT NULL WITH DEFAULT,
   FUNCTION_TYPE  CHAR(2)      NOT NULL WITH DEFAULT,
   VIEW_CREATOR   CHAR(8)      NOT NULL WITH DEFAULT,
   VIEW_NAME      CHAR(18)     NOT NULL WITH DEFAULT,
   PATH           VARCHAR(254) NOT NULL WITH DEFAULT,
   FUNCTION_TEXT  VARCHAR(254) NOT NULL WITH DEFAULT
  ) IN <span class="docEmphasis">database.tablespace</span>;
</pre><BR>
<P class="docText">After executing <TT>EXPLAIN</TT> for an SQL statement that uses a UDF, each of these columns will contain information about the UDF chosen during function resolution. The actual definition of the information contained in the columns of <TT>DSN_FUNCTION_TABLE</TT> is shown in <A class="docLink" HREF="#ch04table03">Table 4.3</A>.<A NAME="ch04index92"></A><A NAME="ch04index93"></A><A NAME="ch04index94"></A><A NAME="ch04index95"></A><A NAME="ch04index96"></A></P>
<A NAME="ch04table03"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 4.3. <TT>DSN_FUNCTION_TABLE</TT> Columns</h5></CAPTION><COLGROUP><COL width="181.5"><COL width="66"><COL width="302.5"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Column Name</span></P></TH><TH class="bottomBorder thead" align="left" valign="top" colspan="2"><P class="docText"><span class="docEmphStrong">Description</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>QUERYNO</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Indicates an integer value assigned by the user issuing the <TT>EXPLAIN</TT> or by DB2. Enables the user to differentiate between <TT>EXPLAIN</TT> statements.<A NAME="ch04index100"></A><A NAME="ch04index101"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>QBLOCKNO</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Indicates an integer value enabling the identification of subselects or a union in a given SQL statement. The first subselect is numbered <TT>1</TT>; the second, <TT>2</TT>; and so on.<A NAME="ch04index102"></A><A NAME="ch04index103"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>APPLNAME</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the plan name for rows inserted as a result of running <TT>BIND PLAN</TT> specifying <TT>EXPLAIN(YES)</TT>. Contains the package name for rows inserted as a result of running <TT>BIND PACKAGE</TT> with <TT>EXPLAIN(YES)</TT>. Otherwise, contains blanks for rows inserted as a result of dynamic <TT>EXPLAIN</TT> statements.<A NAME="ch04index104"></A><A NAME="ch04index105"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PROGNAME</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the name of the program in which the SQL statement is embedded.<A NAME="ch04index106"></A><A NAME="ch04index107"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COLLID</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the collection ID for the package.<A NAME="ch04index108"></A><A NAME="ch04index109"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>GROUP_MEMBER</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Indicates the member name of the DB2 that executed <TT>EXPLAIN</TT>. The column is blank if the DB2 subsystem was not in a data sharing environment when <TT>EXPLAIN</TT> was executed.<A NAME="ch04index110"></A><A NAME="ch04index111"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXPLAIN_TIME</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains a <TT>TIMESTAMP</TT> value indicating when the <TT>EXPLAIN</TT> that created this row was executed.<A NAME="ch04index112"></A><A NAME="ch04index113"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SCHEMA_NAME</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the name of the schema for the invoked function.<A NAME="ch04index114"></A><A NAME="ch04index115"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FUNCTION_NAME</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the name of the UDF to be invoked.<A NAME="ch04index116"></A><A NAME="ch04index117"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPEC_FUNC_NAME</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the specific name of the UDF to be invoked.<A NAME="ch04index118"></A><A NAME="ch04index119"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FUNCTION_TYPE</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains a value indicating the type of function to be invoked:<A NAME="ch04index120"></A><A NAME="ch04index121"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SU</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Scalar Function</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TU</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Table Function</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>VIEW_CREATOR</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">If the function is referenced in a <TT>CREATE VIEW</TT> statement, this column contains the creator name for the view. If not, the column is left blank.<A NAME="ch04index122"></A><A NAME="ch04index123"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>VIEW_NAME</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">If the function is referenced in a <TT>CREATE VIEW</TT> statement, this column contains the name for the view. If not, the column is left blank.<A NAME="ch04index124"></A><A NAME="ch04index125"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PATH</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the value of the SQL path at the time DB2 performed function resolution for this statement.<A NAME="ch04index126"></A><A NAME="ch04index127"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FUNCTION_TEXT</TT></P></TD><TD class="docTableCell" align="left" valign="top" colspan="2"><P class="docText">Contains the first 100 bytes of the actual text used to invoke the UDF, including the function name and all parameters.<A NAME="ch04index128"></A><A NAME="ch04index129"></A><A NAME="ch04index130"></A><A NAME="ch04index131"></A><A NAME="ch04index132"></A><A NAME="ch04index133"></A><A NAME="ch04index134"></A><A NAME="ch04index135"></A><A NAME="ch04index136"></A><A NAME="ch04index137"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch04note06"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">For UDFs specified in infix notation, the <TT>FUNCTION_TEXT</TT> column of <TT>DSN_FUNCTION_TABLE</TT> will contain the function name only. For example, suppose that <TT>*</TT> is UDF in the following reference:</P>
<pre>

</pre><BR><pre>
COL1*COL6
</pre><BR>
<P class="docText">In this case, the <TT>FUNCTION_TEXT</TT> column will contain only the value <TT>*</TT> and not the entire reference (<TT>COL1*COL6</TT>).</P></div><br>
<A NAME="ch04lev2sec4"></A><H4 class="docSection2Title">Table Functions</H4>
<P class="docText">Table functions are different in nature from scalar functions. A table function is designed to return multiple columns and rows. Its output is a table. An example using a table function follows:<A NAME="ch04index138"></A><A NAME="ch04index139"></A><A NAME="ch04index140"></A></P>
<pre>

</pre><BR><pre>
SELECT WINNER, WINNER_SCORE, LOSER, LOSER_SCORE
FROM   FOOTBALL_RESULTS(5)
WHERE  LOSER_SCORE = 0;
</pre><BR>
<P class="docText">In this case, the table function <TT>FOOTBALL_RESULTS()</TT> is used to return the win/loss statistics for football games. The table function can be used in SQL statements, just like a regular DB2 table. The function program is designed to fill the rows and columns of the "table." The input parameter is an <TT>INTEGER</TT> value corresponding to the week the game was played; if <TT>0</TT> is entered, all weeks are considered. The previous query would return all results where the losing team was shut out (had 0 points) during the fifth week of the season.</P>
<P class="docText">The following or similar <TT>CREATE FUNCTION</TT> statement could be used to define the <TT>FOOTBALL_RESULTS()</TT> function:</P>
<pre>

</pre><BR><pre>
CREATE FUNCTION FOOTBALL_RESULTS(INTEGER)
 RETURNS TABLE (WEEK INTEGER,
                WINNER CHAR(20),
                WINNER_SCORE INTEGER,
                LOSER CHAR(20),
                LOSER_SCORE INTEGER)
 EXTERNAL NAME FOOTBALL
   LANGUAGE C
 PARAMETER STYLE DB2SQL
   NO SQL
   DETERMINISTIC
 NO EXTERNAL ACTION
   FENCED
   SCRATCHPAD
   FINAL CALL
   DISALLOW PARALLEL
   CARDINALITY 300;
</pre><BR>
<P class="docText">The key parameter is the <TT>RETURNS TABLE</TT> parameter, which is used to define the columns of the table function. The function program must create these rows itself or from another data source, such as a flat file.</P>
<P class="docText">The value supplied for the <TT>CARDINALITY</TT> parameter is only an estimate. It is provided to help DB2 optimize statements using the table function. It is possible to return more or fewer rows than is specified in <TT>CARDINALITY</TT>.<A NAME="ch04index141"></A><A NAME="ch04index142"></A><A NAME="ch04index143"></A></P>
<A NAME="ch04lev2sec5"></A><H4 class="docSection2Title">Sourced Functions</H4>
<P class="docText">Sourced functions are created from already existing built-in (scalar and column) and user-defined (scalar) functions. The primary reason to create a sourced function is to enable functions for user-defined distinct data types. This is required because DB2 implements strong typing.<A NAME="ch04index144"></A><A NAME="ch04index145"></A><A NAME="ch04index146"></A></P>
<P class="docText">More information on sourced functions and strong typing is provided later in this chapter in the section "<A class="docLink" HREF="ch04lev1sec4.html#ch04lev1sec4">User-Defined Data Types and Strong Typing</A>." For now, though, the following is an example of creating a sourced UDF:</P>
<pre>

</pre><BR><pre>
CREATE FUNCTION FINDWORD (DOCUMENT, VARCHAR(50))
  RETURNS INTEGER
  SPECIFIC FINDWORDDOC
SOURCE SPECIFIC FINDWORDCLOB;
</pre><BR>
<P class="docText">In this example, a new function, <TT>FINDWORD</TT>, is created from an existing function, <TT>FINDWORDCLOB</TT>. The function finds the location of the supplied word (expressed as a <TT>VARCHAR(50)</TT> value) in the supplied <TT>DOCUMENT</TT>. The function returns an <TT>INTEGER</TT> indicating the location of the word in the <TT>DOCUMENT</TT>. <TT>DOCUMENT</TT> is a user-defined type based on a <TT>CLOB</TT> data type.</P>
<A NAME="ch04lev2sec6"></A><H4 class="docSection2Title">User-Defined Function Guidelines</H4>
<P class="docText">The following guidelines can be used to help you implement effective and efficient user-defined functions for your organization.</P>
<A NAME="ch04lev4sec3"></A><H5 class="docSection3Title">Naming User-Defined Functions</H5>
<P class="docText">The rules for naming user-defined functions are somewhat complex. The UDF name can be the same as another UDF, even if it is in the same schema. However, to give one function the same name as another function in the same schema, the number of parameters and the data type of the parameters must differ. DB2 will not allow a UDF to be created if the schema, UDF name, number of parameters, and data type of each parameter match another existing UDF.<A NAME="ch04index147"></A><A NAME="ch04index148"></A></P>
<P class="docText">Furthermore, the name of the user-defined function cannot be any of the following system defined key words:</P>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5"><COLGROUP><COL width="176"><COL width="374"></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ALL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AND</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ANY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>BETWEEN</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DISTINCT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXCEPT</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXISTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FALSE</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FOR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FROM</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IS</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LIKE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>MATCH</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NOT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NULL</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ONLY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>OR</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>OVERLAPS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SIMILAR</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SOME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TABLE</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TRUE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TYPE</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UNIQUE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UNKNOWN</TT><A NAME="ch04index149"></A><A NAME="ch04index150"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>=</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&#172;=</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&lt;</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&lt;=</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&gt;</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&gt;=</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&#172;&lt;</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&#172;&gt;</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>&lt;&gt;</TT><A NAME="ch04index151"></A><A NAME="ch04index152"></A></P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR></TABLE></P><br>
<A NAME="ch04lev4sec4"></A><H5 class="docSection3Title">External UDF Program Restrictions</H5>
<P class="docText">When you develop programs for external user-defined functions, DB2 places certain restrictions on the type of services and functions that can be used. Keep the following restrictions in mind as you code your external UDF programs:<A NAME="ch04index153"></A><A NAME="ch04index154"></A></P>
<UL><LI><P class="docList"><TT>COMMIT</TT> and <TT>ROLLBACK</TT> statements cannot be issued in a user-defined function. The UDF is part of the unit of work of the issuing SQL statement.</P></LI><LI><P class="docList">RRSAF calls cannot be used in user-defined functions. DB2 uses the RRSAF as its interface to user-defined functions. Therefore, any RRSAF calls made within the UDF code will be rejected.</P></LI><LI><P class="docList">If your user-defined function does not specify either the <TT>EXTERNAL ACTION</TT> or <TT>SCRATCHPAD</TT> parameter, the UDF may not execute under the same task each time it is invoked.</P></LI><LI><P class="docList">All open cursors in user-defined scalar functions must be closed before the function completes, or DB2 will return an SQL error.</P></LI><LI><P class="docList">The host language that is used to write UDF programs can impose restrictions on UDF development as well. Each programming language has its own restrictions and limits on the number of parameters that can be passed to a routine in that language. Be sure to read the programming guide for the language being used (before you begin coding) to determine the number of parameters allowed.</P></LI><LI><P class="docList">WLM running in <TT>GOAL</TT> mode is required for UDFs.<A NAME="ch04index155"></A><A NAME="ch04index156"></A></P></LI></UL>
<A NAME="ch04note07"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">The limitation on the number of parameters for the programming language to be used can impact table UDFs because table functions often require a large number of parameters (that is, at least one output parameter for every column of the table).</P></div><br>
<A NAME="ch04lev4sec5"></A><H5 class="docSection3Title">Starting and Stopping UDFs</H5>
<P class="docText">Starting and stopping external UDFs can be an administrative burden. When UDFs fail, they will be stopped (unless you specify otherwise when the UDF is created). In order for any application to call the UDF again, it must first be started again. You should develop administrative procedures such that appropriate personnel have the authority to start and stop UDFs.<A NAME="ch04index157"></A><A NAME="ch04index158"></A><A NAME="ch04index159"></A><A NAME="ch04index160"></A></P>
<P class="docText">To start a UDF, you must issue the following DB2 command:</P>
<pre>

</pre><BR><pre>
-START FUNCTION SPECIFIC
</pre><BR>
<P class="docText">This will cause the named UDF to be activated. You do not need to issue a <TT>START</TT> command for new UDFs; DB2 will automatically activate a new UDF the first time an SQL statement invokes the function. For example, the following command starts the function <TT>XFUNC</TT> in the schema <TT>XSCHEMA</TT>:<A NAME="ch04index161"></A><A NAME="ch04index162"></A></P>
<pre>

</pre><BR><pre>
-START FUNCTION SPECIFIC(XCHEMA.XFUNC)
</pre><BR>
<A NAME="ch04note08"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">The <TT>-START FUNCTION SPECIFIC</TT> command will not refresh the Language Environment in the WLM-established stored procedure address space. In order to refresh the Language Environment to establish a new load module for a UDF, you must issue the following WLM command:</P>
<pre>

</pre><BR><pre>
VARY WLM, APPLENV=applenv,REFRESH
</pre><BR></div><br>
<P class="docText">Similarly, you can issue the <TT>-STOP FUNCTION SPECIFIC</TT> command to stop a UDF. Stopping a UDF prevents DB2 from accepting SQL statements that invoke that function. Any SQL statements that have already been queued or scheduled by DB2 will continue to run. This command will not prevent these SQL statements from running.<A NAME="ch04index163"></A><A NAME="ch04index164"></A><A NAME="ch04index165"></A><A NAME="ch04index166"></A><A NAME="ch04index167"></A><A NAME="ch04index168"></A></P>
<P class="docText">UDF administration is complicated by the fact that only users with one of the following authorities (or qualities) can execute the <TT>START</TT> and <TT>STOP FUNCTION SPECIFIC</TT> commands:</P>
<UL><LI><P class="docList">The owner of the UDF</P></LI><LI><P class="docList"><TT>SYSOPR</TT> authority</P></LI><LI><P class="docList"><TT>SYSCTRL</TT> authority</P></LI><LI><P class="docList"><TT>SYSADM</TT> authority</P></LI></UL>
<A NAME="ch04note09"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">Remember, these commands (both <TT>START FUNCTION SPECIFIC</TT> and <TT>STOP FUNCTION SPECIFIC</TT>) apply to external UDFs only; built-in functions and sourced UDFs cannot be stopped and started using DB2 commands.<A NAME="ch04index169"></A><A NAME="ch04index170"></A><A NAME="ch04index171"></A><A NAME="ch04index172"></A></P></div><br>
<A NAME="ch04lev4sec6"></A><H5 class="docSection3Title">Starting and Stopping All Functions</H5>
<P class="docText">Issuing either the <TT>-START FUNCTION SPECIFIC</TT> or the <TT>–STOP FUNCTION SPECIFIC</TT> command without any arguments starts, or stops, all UDFs known to the system. For example<A NAME="ch04index173"></A><A NAME="ch04index174"></A><A NAME="ch04index175"></A><A NAME="ch04index176"></A></P>
<pre>

</pre><BR><pre>
-START FUNCTION SPECIFIC
</pre><BR>
<P class="docText">starts all UDFs for the DB2 subsystem on which the command was issued.</P>
<A NAME="ch04lev4sec7"></A><H5 class="docSection3Title">Exercise Control Over UDF Stopping</H5>

<P class="docText">In Version 8, DB2 for z/OS gives you greater control over UDF execution and utilization. You can now specify for each stored procedure or UDF the maximum number of failures that are allowed before DB2 stops the routine. Previously, when a UDF failed, DB2 stopped it, resulting in administrative overhead—particularly in a test environment.<A NAME="ch04index177"></A><A NAME="ch04index178"></A><A NAME="ch04index179"></A><A NAME="ch04index180"></A></P>
<P class="docText">By specifying the most appropriate value for an individual routine, you can let some routines continue to be invoked for development and debugging and stop other routines for maintenance before they cause problems in a production environment.</P>
<P class="docText">The available options that can be specified using <TT>CREATE</TT> or <TT>ALTER FUNCTION</TT> are</P>
<UL><LI><p class="docText">
<TT>STOP AFTER FAILURE</TT>:— 
Indicating that the UDF is to be stopped every time it fails</p></LI><LI><p class="docText">
<TT>STOP AFTER </TT><span class="docEmphasis"><TT>n</TT></span> <TT>FAILURES</TT>:— 
Indicating that the UDF is to be stopped only after every <span class="docEmphasis">n</span>th failure</p></LI><LI><p class="docText">
<TT>CONTINUE AFTER FAILURE</TT>:— 
Indicating that the UDF is not to be stopped when it fails</p></LI></UL>
<P class="docText">These options should only be specified on external UDFs, not on sourced UDFs.<A NAME="ch04index181"></A><A NAME="ch04index182"></A><A NAME="ch04index183"></A><A NAME="ch04index184"></A></P>
<A NAME="ch04lev4sec8"></A><H5 class="docSection3Title">Keep It Simple</H5>
<P class="docText">Each user-defined function program should be coded to perform one and only one task. The UDF program should be as simple as possible while still performing the desired task. Do not create overly complex UDF programs that perform multiple tasks based on the input. It is far better to have multiple UDFs, each performing one simple task, than to have a single, very complex UDF that performs multiple tasks. The UDF program will be easier to code, debug, understand, and maintain when it needs to be modified.<A NAME="ch04index185"></A><A NAME="ch04index186"></A></P>
<A NAME="ch04lev4sec9"></A><H5 class="docSection3Title">Use <TT>DSN_FUNCTION_TABLE</TT></H5>
<P class="docText">To be sure that the right UDF is being chosen during function resolution, use <TT>EXPLAIN</TT> to populate <TT>DSN_FUNCTION_TABLE</TT>. It is only by reading the contents of <TT>DSN_FUNCTION_TABLE</TT> that you can ascertain which UDF was chosen for execution by DB2 during function resolution.<A NAME="ch04index187"></A><A NAME="ch04index188"></A><A NAME="ch04index189"></A></P>
<A NAME="ch04lev4sec10"></A><H5 class="docSection3Title">Promote UDF Reuseability</H5>
<P class="docText">User-defined functions should be developed with reuseability in mind. After the UDF has been coded and registered to DB2, it can be shared by multiple applications. It is wise to code your UDFs such that they perform simple, useful tasks that can be used by many applications at your site.<A NAME="ch04index190"></A><A NAME="ch04index191"></A></P>
<P class="docText">Reusing UDFs in multiple applications is better than creating multiple UDFs having the same (or similar) functionality for each application. You should promote reuseability while at the same time keeping the UDF code as simple as possible.</P>
<A NAME="ch04lev4sec11"></A><H5 class="docSection3Title">Promote Consistent Enterprisewide SQL</H5>
<P class="docText">Consider replicating UDFs across subsystems in order to keep the SQL language consistent across the enterprise. This might add a few maintenance steps; however, the gain is a more mobile development staff.<A NAME="ch04index192"></A><A NAME="ch04index193"></A></P>
<A NAME="ch04lev4sec12"></A><H5 class="docSection3Title">Handle UDF Abends</H5>
<P class="docText">When an external UDF abends, the invoking statement in the calling program receives an error code, namely <TT>SQLCODE -430</TT>. The unit of work containing the invoking statement must be rolled back. The calling program should check for the <TT>–430 SQLCODE</TT> and issue a <TT>ROLLBACK</TT> when it is received.<A NAME="ch04index194"></A><A NAME="ch04index195"></A></P>
<P class="docText">Furthermore, the UDF might need to be restarted depending on the setting of the <TT>[STOP | CONTINUE] AFTER FAILURE</TT> option for the UDF.</P>
<A NAME="ch04lev4sec13"></A><H5 class="docSection3Title">Invoke UDFs Using Qualified Names</H5>
<P class="docText">Use the qualified name of a function in the invoking SQL statement. By doing so, you simplify function resolution. DB2 will only search for functions in the specific schema you code. Therefore, DB2 is more likely to choose the function you intend, and the function resolution process will take less time to complete, because fewer functions will qualify as candidates.<A NAME="ch04index196"></A><A NAME="ch04index197"></A><A NAME="ch04index198"></A></P>
<A NAME="ch04lev4sec14"></A><H5 class="docSection3Title">Consider Using <TT>SET CURRENT PACKAGE PATH</TT></H5>

<P class="docText">The new special register, <TT>CURRENT PACKAGE PATH</TT>, was added with DB2 Version 8. It is particularly useful for those organizations that use more than one collection for packages. In prior releases, applications that do not use plans must issue the <TT>SET CURRENT PACKAGE PATH</TT> statement each time a package from a different collection is used. With the <TT>CURRENT PACKAGE PATH</TT> special register, an application programmer can specify a list of package collections in one <TT>SET CURRENT PACKAGE PATH</TT> statement.<A NAME="ch04index199"></A><A NAME="ch04index200"></A><A NAME="ch04index201"></A></P>
<P class="docText">Using <TT>SET CURRENT PACKAGE PATH</TT> can reduce network traffic, simplify application coding, and result in improved processing and elapsed time.</P>
<A NAME="ch04lev4sec15"></A><H5 class="docSection3Title"><TT>CAST</TT> Parameters to the Right Data Type</H5>
<P class="docText">Use the <TT>CAST</TT> function to cast the parameters of the invoked UDF to the data types specified in the user-defined function definition. This assists the function resolution process to choose the correct function for execution.<A NAME="ch04index202"></A><A NAME="ch04index203"></A><A NAME="ch04index204"></A><A NAME="ch04index205"></A></P>
<P class="docText">For example, consider a sample UDF named <TT>TAXAMT</TT>. It requires one input parameter, which is defined as <TT>DECIMAL(9,2)</TT>. If you want to pass a column defined as <TT>INTEGER</TT> to the UDF, use the <TT>CAST</TT> function as follows to cast the value of the integer column to a <TT>DECIMAL(9,2)</TT> value:</P>
<pre>

</pre><BR><pre>
SELECT TAXAMT(CAST (INT_COL AS DECIMAL(9,2)))
FROM   TABLE;
</pre><BR>
<A NAME="ch04lev4sec16"></A><H5 class="docSection3Title">Define UDF Parameter Data Types Efficiently</H5>
<P class="docText">Avoid defining UDF parameters using the following data types: <TT>CHAR</TT>, <TT>GRAPHIC</TT>, <TT>SMALLINT</TT>, and <TT>REAL</TT>. Instead, use <TT>VARCHAR</TT>, <TT>VARGRAPHIC</TT>, <TT>INTEGER</TT>, and <TT>DOUBLE</TT>, respectively.<A NAME="ch04index206"></A><A NAME="ch04index207"></A></P>
<P class="docText">To clarify this guideline, consider a UDF named <TT>FUNCX</TT> that is defined with a parameter of data type <TT>SMALLINT</TT>. To invoke this UDF, the parameter must be of data type <TT>SMALLINT</TT>. Using a data type of <TT>INTEGER</TT> will not suffice. For example, the following statement will not resolve to <TT>FUNCX</TT>, because the constant <TT>500</TT> is of type <TT>INTEGER</TT>, not <TT>SMALLINT</TT>:</P>
<pre>

</pre><BR><pre>
SELECT FUNCX(500)
FROM   TABLE;
</pre><BR>
<P class="docText">The same line of thinking applies to <TT>CHAR</TT>, <TT>GRAPHIC</TT>, and <TT>REAL</TT> data types. Of course, you could use the <TT>CAST</TT> function as described previously to resolve this problem. But it is better to avoid the problem altogether by specifying <TT>VARCHAR</TT>, <TT>VARGRAPHIC</TT>, <TT>INTEGER</TT>, and <TT>DOUBLE</TT> as parameter data types instead.</P>
<A NAME="ch04lev4sec17"></A><H5 class="docSection3Title">Choose Parameter Data Types for Portability</H5>
<P class="docText">If you need to ensure that your UDFs are portable across platforms other than DB2 for z/OS, avoid defining UDFs with parameter data types of <TT>FLOAT</TT> or <TT>NUMERIC</TT>. Instead, use <TT>DOUBLE</TT> or <TT>REAL</TT> in place of <TT>FLOAT</TT>, and <TT>DECIMAL</TT> in place of <TT>NUMERIC</TT>.<A NAME="ch04index208"></A><A NAME="ch04index209"></A></P>
<A NAME="ch04lev4sec18"></A><H5 class="docSection3Title">UDFs Do Not Require Parameters</H5>
<P class="docText">It is possible to code user-defined functions that have no parameters. However, when creating and executing the UDF, you still need to specify the parentheses with no value supplied for a parameter. For example, to create a procedure named <TT>FLOWERS()</TT> that requires no parameters, you should code the following:<A NAME="ch04index210"></A><A NAME="ch04index211"></A></P>
<pre>

</pre><BR><pre>
CREATE FUNCTION FLOWERS(). . .
</pre><BR>
<P class="docText">Similarly, to execute the UDF, you would code it in an SQL statement with the parentheses, but without specifying any parameter values, as shown in the following:</P>
<pre>

</pre><BR><pre>
SELECT FLOWERS()
FROM   TABLE;
</pre><BR>
<A NAME="ch04lev4sec19"></A><H5 class="docSection3Title">Use the Sample User-Defined Functions As Templates</H5>
<P class="docText">IBM provides quite a few sample programs for user-defined functions. Examine these samples for examples of how to implement effective DB2 user-defined functions. There are sample function programs for<A NAME="ch04index212"></A><A NAME="ch04index213"></A></P>
<UL><LI><P class="docList">Converting date and time formats</P></LI><LI><P class="docList">Returning the name of the day or month for a specific date</P></LI><LI><P class="docList">Formatting floating point data as a currency value</P></LI><LI><P class="docList">Returning DB2 catalog information for DB2 objects</P></LI><LI><P class="docList">Returning a table of weather data</P></LI></UL>
<P class="docText">These functions can be used as samples to learn how to code function programs for your specific needs and requirements.</P>
<A NAME="ch04lev4sec20"></A><H5 class="docSection3Title">SQL Usage Options Within External UDFs</H5>
<P class="docText">There are four options for external functions regarding their usage of SQL:<A NAME="ch04index214"></A><A NAME="ch04index215"></A></P>
<UL><LI><p class="docText">
<TT>NO SQL</TT> 
Indicates that the function cannot execute SQL statements. However, non-executable SQL statements, such as <TT>DECLARE CURSOR</TT>, are not restricted.</p></LI><LI><p class="docText">
<TT>MODIFIES SQL DATA</TT> 
Indicates that the function can execute any legal SQL statement that can be issued by a UDF.</p></LI><LI><p class="docText">
<TT>READS SQL DATA</TT> 
Indicates that the function can execute SQL statements that access data, but cannot modify data (this is the default SQL usage option for UDFs).</p></LI><LI><p class="docText">
<TT>CONTAINS SQL</TT> 
Indicates that the function can execute SQL statements as long as data is neither read nor modified, and the SQL statement is legal for issuance by a UDF.</p></LI></UL>
<P class="docText"><A class="docLink" HREF="#ch04table04">Table 4.4</A> indicates which SQL statements are valid for each type of SQL usage just described.<A NAME="ch04index216"></A><A NAME="ch04index217"></A></P>
<A NAME="ch04table04"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 4.4. Using SQL Within User-Defined Functions</h5></CAPTION><COLGROUP><COL width="176"><COL width="93.5"><COL width="93.5"><COL width="77"><COL width="110"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">SQL Statement</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">NO SQL</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">CONTAINS SQL</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">READS SQL</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">MODIFIES SQL</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ALLOCATE CURSOR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ALTER</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ASSOCIATE LOCATORS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>BEGIN DECLARE SECTION</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CALL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CLOSE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COMMENT ON</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COMMIT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CONNECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CREATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECLARE CURSOR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECLARE GLOBAL</TT></P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TEMPORARY TABLE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECLARE STATEMENT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DECLARE TABLE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DELETE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DESCRIBE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DESCRIBE CURSOR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DESCRIBE INPUT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DESCRIBE PROCEDURE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DROP</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>END DECLARE SECTION</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXECUTE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXECUTE IMMEDIATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXPLAIN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FETCH</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FREE LOCATOR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>GRANT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>HOLD LOCATOR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INCLUDE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INSERT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LABEL ON</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LOCK TABLE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>OPEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PREPARE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RELEASE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RENAME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REVOKE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ROLLBACK</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT INTO</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SET</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SET CONNECTION</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SIGNAL SQLSTATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>VALUES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>VALUES INTO</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">N</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>WHENEVER</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Y<A NAME="ch04index218"></A><A NAME="ch04index219"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch04note10"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">When a stored procedure is called from a user-defined function, it must allow for the same or more restrictive data access as the calling UDF. For example, a UDF defined as <TT>READS SQL DATA</TT> can call a procedure defined as <TT>READS SQL DATA</TT> or <TT>CONTAINS SQL</TT>. It cannot call a procedure defined as <TT>MODIFIES SQL DATA</TT>. The hierarchy of data access from least to most restrictive is</P>
<pre>

</pre><BR><pre>
MODIFIES SQL DATA

READS SQL DATA

CONTAINS SQL
</pre><BR></div><br>
<A NAME="ch04lev4sec21"></A><H5 class="docSection3Title">When to <TT>DISALLOW PARALLEL</TT> Operations</H5>
<P class="docText">A table function cannot operate in parallel, so the <TT>DISABLE PARALLEL</TT> parameter should be specified when issuing a <TT>CREATE FUNCTION</TT> statement for a table UDF.<A NAME="ch04index220"></A><A NAME="ch04index221"></A><A NAME="ch04index222"></A><A NAME="ch04index223"></A><A NAME="ch04index224"></A></P>
<P class="docText">Some functions that are <TT>NOT DETERMINISTIC</TT> can receive incorrect results if the function is executed by parallel tasks. Specify the <TT>DISALLOW PARALLEL</TT> option for these functions.</P>
<P class="docText">Likewise, some functions that rely on a <TT>SCRATCHPAD</TT> to store data between UDF invocations might not function correctly in parallel. Specify the <TT>DISALLOW PARALLEL</TT> option for these functions, too.</P>
<A NAME="ch04lev4sec22"></A><H5 class="docSection3Title"><TT>DETERMINISTIC</TT> Versus <TT>NOT DETERMINISTIC</TT></H5>
<P class="docText">Be sure to specify accurately whether the UDF will always return the same result for identical input arguments. If the UDF always returns the same result for identical input arguments, the UDF is <TT>DETERMINISTIC</TT>. If not, the UDF should be identified as <TT>NOT DETERMINISTIC</TT>. Any UDF that relies on external data sources that can change should be specified as <TT>NOT DETERMINISTIC</TT>. Other examples of functions that are not deterministic include any UDF that contains SQL <TT>SELECT</TT>, <TT>INSERT</TT>, <TT>UPDATE</TT>, or <TT>DELETE</TT> statements or a random number generator.<A NAME="ch04index225"></A><A NAME="ch04index226"></A><A NAME="ch04index227"></A><A NAME="ch04index228"></A><A NAME="ch04index229"></A></P>
<P class="docText">DB2 uses the <TT>[NOT] DETERMINISTIC</TT> parameter to optimize view processing for SQL <TT>SELECT</TT>, <TT>INSERT</TT>, <TT>UPDATE</TT>, or <TT>DELETE</TT> statements that refer to the UDF. If the UDF is <TT>NOT DETERMINISTIC</TT>, view merge and parallelism will be disabled when the UDF is specified.<A NAME="ch04index230"></A><A NAME="ch04index231"></A></P>
<A NAME="ch04lev4sec23"></A><H5 class="docSection3Title">Choose the UDF <TT>SECURITY</TT> Option Wisely</H5>
<P class="docText">The <TT>SECURITY</TT> parameter indicates how the UDF will interact with an external security product, such as ACF2 or RACF. If <TT>SECURITY DB2</TT> is specified, the UDF does not require an external security environment.This is the default value for <TT>SECURITY</TT>. If the UDF accesses resources protected by an external security product, the access is performed using the authid that is associated with the WLM-established stored procedure address space.<A NAME="ch04index232"></A><A NAME="ch04index233"></A><A NAME="ch04index234"></A><A NAME="ch04index235"></A></P>
<P class="docText">If <TT>SECURITY USER</TT> is specified, an external security environment should be established for the function. If the function accesses resources that the external security product protects, the access is performed using the primary authid of the process that invoked the UDF.</P>
<P class="docText">The third and final option for <TT>SECURITY</TT> is <TT>DEFINER</TT>. If this option is chosen and the UDF accesses resources protected by an external security product, the access is performed using the primary authid of the owner of the UDF.</P>
<A NAME="ch04lev4sec24"></A><H5 class="docSection3Title">Handling Null Input Arguments</H5>
<P class="docText">There are two option for handling null input arguments in user-defined functions: <TT>RETURNS NULL ON NULL INPUT</TT> and <TT>CALLED ON NULL INPUT</TT>. If nulls are to be allowed to be specified as input to a UDF, the UDF must be programmed to test for and handle null inputs.<A NAME="ch04index236"></A><A NAME="ch04index237"></A><A NAME="ch04index238"></A></P>
<P class="docText">If <TT>RETURNS NULL ON INPUT</TT> is specified when the UDF is created, the function is not called if any of the input arguments are null. The result of the function call is null.</P>
<P class="docText">If <TT>CALLED ON NULL INPUT</TT> is specified when the UDF is created, the function is called whether any input arguments are null or not. In this case, the UDF must test for null input arguments in the function program.</P>
<A NAME="ch04lev4sec25"></A><H5 class="docSection3Title">UDF Scratchpads</H5>
<P class="docText">The <TT>[NO] SCRATCHPAD</TT> clause should be specified to indicate whether DB2 provides a scratchpad for the UDF to utilize. In general, external UDFs should be coded as reentrant, and a scratchpad can help to store data between invocations of the UDF. A scratchpad provides a storage area for the UDF to use from one invocation to the next.<A NAME="ch04index239"></A><A NAME="ch04index240"></A><A NAME="ch04index241"></A><A NAME="ch04index242"></A></P>
<P class="docText">If a scratchpad is specified, a length should be provided. The length can be from 1 to 32,767; the default is 100, if no length is specified.</P>
<P class="docText">The first time the UDF is invoked, DB2 allocates memory for the scratchpad and initializes it to contain all binary zeroes. The scope of a scratchpad is a single SQL statement. A separate scratchpad is allocated for each reference to the UDF in the SQL statement. So, if the UDF is specified once in the <TT>SELECT</TT>-list and once in the <TT>WHERE</TT> clause, two scratchpads would be allocated. Furthermore, if the UDF is run in parallel, one scratchpad is allocated for each parallel task.</P>
<A NAME="ch04note11"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">Take care when using <TT>SCRATCHPAD</TT> with <TT>ALLOW PARALLEL</TT> because results can be difficult to predict.Consider, for example, a UDF that uses the scratchpad to count the number of times it is invoked.The count would be thrown off if run in parallel because the count would be for the parallel task, not the UDF.For this reason, be sure to specify <TT>DISALLOW PARALLEL</TT> for UDFs that will not operate in parallel.</P></div><br>
<P class="docText">If the UDF acquires system resources, be sure to specify the <TT>FINAL CALL</TT> clause to make sure that DB2 calls the UDF one last time, so the UDF can free the system resources it acquired.</P>
<A NAME="ch04lev4sec26"></A><H5 class="docSection3Title">Specify <TT>EXTERNAL ACTION</TT> UDFs in <TT>SELECT</TT>-List to Ensure Processing</H5>
<P class="docText">To make sure that DB2 executes a UDF with external actions for each row of the result set, the UDF should be in the <TT>SELECT</TT>-list of the SQL statement. The access path chosen by DB2 determines whether UDFs in predicates are executed. Therefore, to be sure the external actions in a UDF are processed, the UDF should be invoked in the <TT>SELECT</TT>-list, not just in a predicate.<A NAME="ch04index243"></A><A NAME="ch04index244"></A><A NAME="ch04index245"></A></P>
<A NAME="ch04lev4sec27"></A><H5 class="docSection3Title">Specify <TT>CARDINALITY</TT> Option to Guide Results for Table UDFs</H5>

<P class="docText">DB2 Version 8 adds the capability to override the expected cardinality of a table UDF on a case-by-case basis. The cardinality of the UDF is specified in the <TT>SYSIBM.SYSROUTINES</TT> catalog table when the UDF is registered to DB2. Consider overriding cardinality when you expect the results to be significantly greater than or less than the documented cardinality. Doing so enables DB2 to better gauge the access path for SQL queries against table UDFs.<A NAME="ch04index246"></A><A NAME="ch04index247"></A><A NAME="ch04index248"></A></P>
<P class="docText">There are two options for using the <TT>CARDINALITY</TT> keyword:<A NAME="ch04index249"></A><A NAME="ch04index250"></A></P>
<UL><LI><p class="docText">
<TT>CARDINALITY </TT><span class="docEmphasis"><TT>n</TT></span> 
Indicates the expected number of rows to be returned by the table UDF. In this case, <span class="docEmphasis"><TT>n</TT></span> must be an integer constant.</p></LI><LI><p class="docText">
<TT>CARDINALITY MULTIPLIER </TT><span class="docEmphasis"><TT>n</TT></span> 
Indicates a multiplier for the cardinality (as stored in <TT>SYSIBM.SYSROUTINES</TT>); the result of multiplying the <TT>CARDINALITY</TT> column in the catalog by the multiplier <span class="docEmphasis"><TT>n</TT></span> specifies the expected number of rows to be returned by the UDF. In this case, <span class="docEmphasis"><TT>n</TT></span> can be any numeric constant.</p></LI></UL>
<P class="docText">Consider the following two examples:</P>
<pre>

</pre><BR><pre>
SELECT * FROM TABLE(FOOTBALL_RESULTS(0) CARDINALITY 28) AS WEEK2;

SELECT * FROM TABLE(FOOTBALL_RESULTS(0) CARDINALITY MULTIPLIER 2) AS WEEK2;
</pre><BR>
<P class="docText">For the sake of argument, let's assume that the <TT>CARDINALITY</TT> column in <TT>SYSIBM.SYSROUTINES</TT> for this UDF is 14 (the normal number of NFL games in a week). Either of the two SQL statements can be used to estimate the number of rows to be returned after two weeks of play.</P>
<P class="docText">For the <TT>MULTIPLIER</TT> option, we can specify non-integers. If only half a week's football results were available, we could change the cardinality using the multiplier as follows:</P>
<pre>

</pre><BR><pre>
SELECT * FROM TABLE(FOOTBALL_RESULTS(0) CARDINALITY MULTIPLIER 0.5) AS HALFWEEK;
</pre><BR>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch04lev1sec1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch04lev1sec3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
