<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>LOB Guidelines</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch09lev1sec2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch09lev1sec4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch09lev1sec3"></A><H3 class="docSection1Title" >LOB Guidelines</H3>
<P class="docText">The following guidelines can be used to help you implement multimedia object/relational databases using LOBs with DB2.</P>
<A NAME="ch09lev4sec2"></A><H4 class="docSection2Title">Do Not Edit the <TT>ROWID</TT></H4>
<P class="docText">The <TT>ROWID</TT> columns required for implementing LOBs should be generated by DB2. The <TT>ROWID</TT> column cannot be modified. When supplying a value to a <TT>ROWID</TT> column in a <TT>LOAD</TT>, the value should have been previously generated by DB2 and then unloaded at some point. Do not attempt to create a <TT>ROWID</TT> value; they should always be generated by DB2 to ensure accuracy.<A NAME="ch09index83"></A><A NAME="ch09index84"></A><A NAME="ch09index85"></A><A NAME="ch09index86"></A></P>
<A NAME="ch09note09"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">You cannot use <TT>LOAD</TT> to load <TT>ROWID</TT> values if the <TT>ROWID</TT> column was created with the <TT>GENERATED ALWAYS</TT> clause.</P></div><br>
<A NAME="ch09lev4sec3"></A><H4 class="docSection2Title">Define the <TT>ROWID</TT> Columns As <TT>NOT NULL</TT></H4>
<P class="docText">A <TT>ROWID</TT> column cannot be null. You should explicitly indicate <TT>NOT NULL</TT> when defining the column. If you do not DB2 will implicitly create the column as <TT>NOT NULL</TT>. This is the exact opposite of what DB2 will do for other columns that do not specify <TT>NOT NULL</TT>. That is, when <TT>NOT NULL</TT> is specified, DB2 will make the column nullable (except for a <TT>ROWID</TT> column). This is another good reason for never relying upon defaults—because defaults can be confusing.<A NAME="ch09index87"></A><A NAME="ch09index88"></A><A NAME="ch09index89"></A></P>
<A NAME="ch09lev4sec4"></A><H4 class="docSection2Title">Implement LOBs with Care</H4>
<P class="docText">When LOB columns are implemented and populated, they can consume a large amount of space. Be absolutely certain that the large objects are required by your applications before storing them using DB2.<A NAME="ch09index90"></A><A NAME="ch09index91"></A></P>
<A NAME="ch09lev4sec5"></A><H4 class="docSection2Title">Using LOBs Versus <TT>VARCHAR</TT> and <TT>VARGRAPHIC</TT> Data Types</H4>
<P class="docText">A column defined as a <TT>VARCHAR</TT> data type holds alphanumeric data. The size of a <TT>VARCHAR</TT> column can range from 1 byte to a maximum of 8 bytes less than the record size. The record size depends upon the size of the table space page and whether or not an <TT>EDITPROC</TT> is being used. <A class="docLink" HREF="#ch09table03">Table 9.3</A> outlines the maximum size of a <TT>VARCHAR</TT> column based on the page size of the table space.<A NAME="ch09index92"></A><A NAME="ch09index93"></A><A NAME="ch09index94"></A><A NAME="ch09index95"></A><A NAME="ch09index96"></A></P>
<A NAME="ch09table03"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 9.3. Maximum size of a <TT>VARCHAR</TT> column</h5></CAPTION><COLGROUP><COL width="188.88888888888889"><COL width="88.88888888888889"><COL width="83.33333333333333"><COL width="94.44444444444444"><COL width="94.44444444444444"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">EDITPROC Used?</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Page 4K</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Page 8K</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Page 16K</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Page 32K</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">YES</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">4046</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">8128</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">16320</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">32704</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">NO</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">4056</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">8138</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">16330</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">32714</P></TD></TR></TABLE></P><br>
<P class="docText">If the <TT>VARCHAR</TT> specifies a size greater than 255, it is considered a <TT>LONG VARCHAR</TT> column.</P>
<P class="docText">Similar to <TT>VARCHAR</TT> columns, <TT>VARGRAPHIC</TT> columns are variable in size, but are used to store binary data. The size of a <TT>VARGRAPHIC</TT> column can range from 1 byte to a maximum of 2 bytes less than one half the record size. If the <TT>VARGRAPHIC</TT> specifies a size greater than 127, it is considered a <TT>LONG VARGRAPHIC</TT> column.</P>
<P class="docText">In general, BLOBs are preferable to <TT>VARGRAPHIC</TT> data types, and CLOBs or DBCLOBs are preferable to large <TT>VARCHAR</TT> data types. The LOB data types can be used to store larger amounts of data and have less impact on the other data elements of the table because LOBs are not stored in the same physical table space.</P>
<P class="docText">However, for smaller amounts of data <TT>VARCHAR</TT> and <TT>VARGRAPHIC</TT> data types can be easier to implement, administer, and manage. When dealing with character data less than 255 bytes or graphic data less than 127 bytes, consider using <TT>VARCHAR</TT> and <TT>VARGRAPHIC</TT> data types.</P>
<A NAME="ch09lev4sec6"></A><H4 class="docSection2Title">Use LOBs with User-Defined Distinct Types</H4>
<P class="docText">Usually, you should not create tables with the LOB data types. Instead, for each LOB you wish to store, create a user-defined distinct type to use. Failure to do so can make it difficult to understand the type of data being stored in the table. For example, if you wish to store audio sound bites, consider creating a UDT such as<A NAME="ch09index99"></A><A NAME="ch09index100"></A></P>
<pre>

</pre><BR><pre>
CREATE DISTINCT TYPE SOUND_BITE AS BLOB(1M)
</pre><BR>
<P class="docText">Then, when you create the table, you can use the UDT. Instead of specifying <TT>BLOB(1M)</TT> as the data type you can specify <TT>SOUND_BITE</TT>, such as</P>
<pre>

</pre><BR><pre>
CREATE TABLE CAMPAIGN_DETAILS
(CANDIDATE_LNAME     CHAR(40) NOT NULL,
 CANDIDATE_FNAME     CHAR(25) NOT NULL,
 ELECTION_YR         INTEGER,
 SPEECH_SAMPLE       SOUND_BITE)
</pre><BR>
<P class="docText">Isn't it easier to determine that the <TT>SPEECH_SAMPLE</TT> column is actually audio because you used the <TT>SOUND_BITE</TT> data type? If you specified the underlying type, <TT>BLOB(1M)</TT> instead, it might be a photo or a movie of the candidate delivering the speech or some other binary object.</P>
<A NAME="ch09lev4sec7"></A><H4 class="docSection2Title">Use LOB Locators to Save Program Storage</H4>
<P class="docText">By using LOB locators instead of directly accessing the actual LOB data, you can manipulate LOB data in your programs without retrieving the data from the DB2 table. This is a good technique because it reduces the amount of storage required by your program.<A NAME="ch09index101"></A><A NAME="ch09index102"></A></P>
<A NAME="ch09lev4sec8"></A><H4 class="docSection2Title">Defer Evaluation of LOB Expressions</H4>
<P class="docText">LOB data is not moved until the program assigns a LOB expression to a target destination. So, when you use a LOB locator with string functions and operators, you can create an expression that DB2 does not evaluate until the time of assignment. This is called deferring evaluation of a LOB expression. Deferring evaluation can improve LOB I/O performance.<A NAME="ch09index103"></A><A NAME="ch09index104"></A></P>
<A NAME="ch09lev4sec9"></A><H4 class="docSection2Title">Use the Sample LOB Applications Shipped with DB2</H4>
<P class="docText">DB2 ships with several sample applications that use LOB columns. Use these samples as templates to assist you when writing applications that use LOB columns. The sample applications include<A NAME="ch09index105"></A><A NAME="ch09index106"></A></P>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5"><COLGROUP><COL width="110"><COL width="440"></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN8DLPL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">A C program that uses LOB locators and <TT>UPDATE</TT> statements to move binary data into a column of type BLOB.<A NAME="ch09index107"></A><A NAME="ch09index108"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN8DLRV</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">A C program that uses a LOB locator to manipulate CLOB data.<A NAME="ch09index109"></A><A NAME="ch09index110"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSNTEP2</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The dynamic SQL sample program written in PL/I allocates an SQLDA for rows that include LOB data and uses that SQLDA to describe a SQL statement and fetch data from LOB columns.<A NAME="ch09index111"></A><A NAME="ch09index112"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch09lev4sec10"></A><H4 class="docSection2Title">Consider Using UDFs to Limit LOB Overhead</H4>
<P class="docText">You can create and use UDFs designed to return only a portion of a LOB, thereby limiting the transfer of LOB data to only the portion that the application requires. This can greatly reduce the amount of traffic required between a client application and the database server.<A NAME="ch09index113"></A><A NAME="ch09index114"></A></P>
<P class="docText">For example, consider a query designed to return a CLOB column, for example the <TT>EMP_RESUME</TT> column in <TT>DSN8810.EMP</TT>. The CLOB column contains character text. You can select the <TT>CLOB_LOCATOR</TT> into a host variable and then use the <TT>POSSTR()</TT> function to find the offset of a specific string within the CLOB. The <TT>CLOB_LOCATOR</TT> in the host variable is passed as the argument to <TT>POSSTR()</TT>. Finally, the <TT>SUBSTR()</TT> function can be used to select a portion of the CLOB.</P>
<A NAME="ch09lev4sec11"></A><H4 class="docSection2Title">Use Indicator Variables with LOB Locators for Nullable LOBs</H4>
<P class="docText">DB2 uses indicator variables differently for LOB locators. When you <TT>SELECT</TT> a column that is null into a host variable (other than a LOB locator) an associated indicator variable is assigned a negative value to indicate that this column is set to null. But DB2 uses indicator variables a little differently for LOB locators because a LOB locator can never be null.<A NAME="ch09index115"></A><A NAME="ch09index116"></A><A NAME="ch09index117"></A><A NAME="ch09index118"></A></P>
<P class="docText">When you <TT>SELECT</TT> a LOB column using a LOB locator, and the LOB column is set to null, DB2 will assign a negative value to the associated indicator variable. But the LOB locator value does not change.</P>
<P class="docText">So, when using use LOB locators to retrieve data from columns that can contain nulls, always define indicator variables for the LOB locators. After fetching data into the LOB locators check the indicator variables. If the indicator variable indicates that the LOB column is null, do not use the value in the LOB locator. It is not valid because the LOB column is null.</P>
<A NAME="ch09lev4sec12"></A><H4 class="docSection2Title">Avoid Logging Large LOBs</H4>
<P class="docText">Because LOBs are typically very large, logging changes to LOBs can become quite inefficient. Avoid logging by specifying <TT>LOG NO</TT> when creating the LOB table space. The default is <TT>LOG YES</TT>. If the size of the LOB is greater than 1MB, favor specifying <TT>LOG NO</TT>. For smaller LOBs, specifying <TT>LOG NO</TT> still can be beneficial, though.<A NAME="ch09index119"></A><A NAME="ch09index120"></A></P>
<P class="docText">When <TT>LOG NO</TT> is specified for the LOB table space, changes to the LOB column are not written to the log. <TT>LOG NO</TT> has no effect on a commit or rollback operation; the consistency of the database is maintained regardless of whether the LOB value is logged. When <TT>LOG NO</TT> is specified, changes to system pages and to the auxiliary index are still logged.</P>
<P class="docText">Another consideration when deciding whether or not to log LOBs is how frequently the LOB column is updated. For LOBs that are rarely or never changed, logging does not provide any advantage. Many LOB columns, such as graphics, are just replaced entirely when changes need to be made.</P>
<P class="docText">Keep in mind, though, that whenever logging is turned off, some form of recoverability still needs to be established. This can be as simple as retaining the input documents somewhere so they can be re-inserted to the LOB column in case of a database problem.</P>
<A NAME="ch09lev4sec13"></A><H4 class="docSection2Title">Isolate LOBs in Their Own Buffer Pool</H4>
<P class="docText">Take special care when assigning LOBs to a buffer pool. Use a bufferpool that is not shared with other, non-LOB data. Additionally, assign the deferred write threshold (<TT>DWQT</TT>) to <TT>0</TT> for the LOB bufferpool(s).<A NAME="ch09index121"></A><A NAME="ch09index122"></A></P>
<P class="docText">For LOBs that are not logged, changed pages are written at <TT>COMMIT</TT>. With <TT>DWQT</TT> set to <TT>0</TT>, the writes will be processed in the background, continually, instead of all at once when committed. For LOBs that are logged, setting <TT>DWQT</TT> to <TT>0</TT> avoids huge amounts of data being written at DB2 checkpoints.</P>
<P class="docText">For more information on buffer pools and <TT>DWQT</TT>, refer to <A class="docLink" HREF="ch28.html#ch28">Chapter 28</A>, "Tuning DB2's Components."</P>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch09lev1sec2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch09lev1sec4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
