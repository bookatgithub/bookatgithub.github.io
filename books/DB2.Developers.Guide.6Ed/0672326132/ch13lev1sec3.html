<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Preparing a DB2 Program</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch13lev1sec2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch13lev1sec4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch13lev1sec3"></A><H3 class="docSection1Title" >Preparing a DB2 Program</H3>
<P class="docText">You can prepare a DB2 program in many ways. Following are the most common methods:</P>
<UL><LI><P class="docList">Using the DB2I panels</P></LI><LI><P class="docList">Using a standard DB2 program preparation procedure</P></LI><LI><P class="docList">Using a DB2 program preparation <TT>CLIST</TT> or REXX <TT>EXEC</TT></P></LI><LI><P class="docList">Any combination of the preceding methods</P></LI></UL>
<P class="docText">Each shop has its own standards. Consult your shop standards for the supported method or methods of DB2 program preparation. This section discusses each of the preceding methods.</P>
<A NAME="ch13lev2sec6"></A><H4 class="docSection2Title">Program Preparation Using DB2I</H4>
<P class="docText">DB2I, or DB2 Interactive, is an online, TSO/ISPF based interface to DB2 commands, DB2 administrative functions, and <TT>CLIST</TT>s provided with DB2. It is a panel-driven application that enables a user to prepare a DB2 program, among other things.<A NAME="ch13index65"></A><A NAME="ch13index66"></A><A NAME="ch13index67"></A><A NAME="ch13index68"></A><A NAME="ch13index69"></A></P>
<P class="docText">You can use eight DB2I panels to assist with DB2 program preparation. The DB2I main menu, shown in <A class="docLink" HREF="#ch13fig02">Figure 13.2</A>, appears when you select the DB2I option from the main menu.<A NAME="ch13index70"></A><A NAME="ch13index71"></A></P>
<A NAME="ch13fig02"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.2. The DB2I main menu.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig02_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig02.gif" ALT="graphics/13fig02.gif"></p></CENTER></p><br>
<A NAME="ch13note03"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">Some installations require the user to execute a preallocation <TT>CLIST</TT> before invoking DB2I. Consult your shop standards.</P></div><br>
<P class="docText">Before proceeding to the main task of program preparation using DB2I, you first must ensure that the DB2I defaults have been properly set. Option D from the main menu displays the DB2I Defaults panel, which is shown in <A class="docLink" HREF="#ch13fig03">Figure 13.3</A>. The default values usually are adequate. When you first enter DB2I, however, ensure that the correct DB2 subsystem name, application language, and delimiters are set.<A NAME="ch13index72"></A><A NAME="ch13index73"></A><A NAME="ch13index74"></A></P>
<A NAME="ch13fig03"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.3. The DB2I Defaults panel.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig03_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig03.gif" ALT="graphics/13fig03.gif"></p></CENTER></p><br>
<P class="docText">After checking the DB2I Defaults panel, you need to create <TT>DCLGEN</TT> members for all tables that will be accessed in application programs. You should do this before writing any application code.</P>
<P class="docText">Choosing option 2 from the DB2I main menu displays the <TT>DCLGEN</TT> panel (see <A class="docLink" HREF="#ch13fig04">Figure 13.4</A>). Specify the name of the table in option 1 and the name of the data set in which the DBRM will be placed in option 2. DB2 automatically creates the <TT>DCLGEN</TT> member, including <TT>WORKING-STORAGE</TT> fields and the <TT>DECLARE TABLE</TT> statement. <TT>DCLGEN</TT> will not allocate a new data set, so you must preallocate the data set specified in option 2 as a sequential data set with an <TT>LRECL</TT> of 80. Refer to the <TT>DCLGEN</TT> member (presented earlier in this chapter) for the <TT>DSN8810.DEPT</TT> table.<A NAME="ch13index75"></A><A NAME="ch13index76"></A><A NAME="ch13index77"></A><A NAME="ch13index78"></A><A NAME="ch13index79"></A><A NAME="ch13index80"></A></P>
<A NAME="ch13fig04"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.4. The DB2I <TT>DCLGEN</TT> panel.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig04_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig04.gif" ALT="graphics/13fig04.gif"></p></CENTER></p><br>
<P class="docText">You use option 3 of DB2I to precompile DB2 application programs. <A class="docLink" HREF="#ch13fig05">Figure 13.5</A> shows the Precompile panel. To precompile a program, provide the following information in the specified locations on the Precompile panel:<A NAME="ch13index81"></A><A NAME="ch13index82"></A><A NAME="ch13index83"></A></P>
<UL><LI><P class="docList">The name of the input data set containing the source code for the program you want to precompile</P></LI><LI><P class="docList">The name of the <TT>DCLGEN</TT> library that contains the table declarations to be used by this program</P></LI><LI><P class="docList">A <TT>DSNAME</TT> qualifier to be used by DB2I to build data set names for temporary work files required by the precompiler</P></LI><LI><P class="docList">The name of the DBRM library that the precompiler will write to (this must be a partitioned data set with 80-byte records)</P></LI></UL>
<A NAME="ch13fig05"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.5. The DB2I Precompile panel.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig05_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig05.gif" ALT="graphics/13fig05.gif"></p></CENTER></p><br>
<A NAME="ch13note04"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">You can run the precompiler in the foreground or the background.</P></div><br>
<P class="docText">You can bind, rebind, and free DB2 plans and packages using DB2I option 5. In this section, I discuss the <TT>BIND</TT> option because it is the only one needed for program preparation. Two bind panels are available: one for binding plans, as shown in <A class="docLink" HREF="#ch13fig06">Figure 13.6</A>, and one for binding packages, as shown in <A class="docLink" HREF="#ch13fig07">Figure 13.7</A>. The <TT>BIND</TT> process creates plans or packages or both from one or more DBRMs. You should not attempt binding until the precompile is completed successfully.<A NAME="ch13index84"></A><A NAME="ch13index85"></A><A NAME="ch13index86"></A></P>
<A NAME="ch13fig06"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.6. The DB2I Bind Plan panel.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig06_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig06.gif" ALT="graphics/13fig06.gif"></p></CENTER></p><br>
<A NAME="ch13fig07"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.7. The DB2I Bind Package panel.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig07_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="375" SRC="images/0672326132/graphics/13fig07.gif" ALT="graphics/13fig07.gif"></p></CENTER></p><br>
<P class="docText">You may have noticed that the compile and link edit steps are missing from the previous discussions of program preparation. DB2I option 3 takes you step-by-step through the entire DB2 program preparation procedure, displaying the previous panels (and an additional one). By entering the appropriate selections in the Program Preparation panel, shown in <A class="docLink" HREF="#ch13fig08">Figure 13.8</A>, you can completely prepare and then run a source program.<A NAME="ch13index87"></A><A NAME="ch13index88"></A><A NAME="ch13index89"></A><A NAME="ch13index90"></A><A NAME="ch13index91"></A><A NAME="ch13index92"></A></P>
<A NAME="ch13fig08"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.8. The DB2I Program Preparation panel.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig08_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig08.gif" ALT="graphics/13fig08.gif"></p></CENTER></p><br>
<P class="docText">After you enter the necessary information in the Program Preparation panel, you are navigated through the Precompile panel (refer to <A class="docLink" HREF="#ch13fig05">Figure 13.5</A>); a new panel for the specification of compilation, link edit, and run parameters (see <A class="docLink" HREF="#ch13fig09">Figure 13.9</A>), and the Bind panels (refer to <A class="docLink" HREF="#ch13fig06">Figures 13.6</A> and <A class="docLink" HREF="#ch13fig07">13.7</A>).</P>
<A NAME="ch13fig09"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.9. The DB2I Compile, Prelink, Link, and Run panels.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig09_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig09.gif" ALT="graphics/13fig09.gif"></p></CENTER></p><br>
<P class="docText">The panels are prefilled with the information provided in the Program Preparation panel. This probably is the easiest method of preparing a DB2 program. Following is a sample of the output generated by DB2I program preparation:</P>
<pre>

</pre><BR><pre>
 %DSNH  parameters
  SOURCE STATISTICS
     SOURCE LINES READ: 459
     NUMBER OF SYMBOLS: 77
     SYMBOL TABLE BYTES EXCLUDING ATTRIBUTES: 4928
THERE WERE 0 MESSAGES FOR THIS PROGRAM.
THERE WERE 0 MESSAGES SUPPRESSED BY THE FLAG OPTION.
101944 BYTES OF STORAGE WERE USED BY THE PRECOMPILER.
RETURN CODE IS 0
   DSNH740I ======= PRECOMPILER FINISHED, RC = 0 ======
            LISTING IN TEMP.PCLIST ====================
   DSNT252I - BIND OPTIONS FOR PLAN <span class="docEmphasis">planname</span>
          ACTION      ADD
          OWNER       <span class="docEmphasis">authid</span>
          VALIDATE    BIND
          ISOLATION   CS
          ACQUIRE     USE
          RELEASE     COMMIT
          EXPLAIN     YES
   DSNT253I - BIND OPTIONS FOR PLAN <span class="docEmphasis">planname</span>
          NODEFER     PREPARE
   DSNH740I ======= BIND FINISHED, RC = 0 =============
   DSNH740I ======= COB2 FINISHED, RC = 0 ======
            LISTING IN TEMP.LIST ====================
   DSNH740I ======= LINK FINISHED, RC = 0 ======
            LISTING IN TEMP.LINKLIST ====================
***
</pre><BR>
<P class="docText">When you're using the DB2I Program Preparation option, the status of the program preparation appears onscreen. The italicized sections in the listing are replaced by the options you select when preparing your programs. Additionally, if you set any return codes to a non-zero number, you will encounter program preparation warnings or errors.</P>
<P class="docText">You can run DB2 programs using DB2I only if they are TSO programs. You also can simply run a DB2 program from DB2I option 6 (see <A class="docLink" HREF="#ch13fig10">Figure 13.10</A>). Before you can run the program, however, you must first prepare it.<A NAME="ch13index93"></A><A NAME="ch13index94"></A><A NAME="ch13index95"></A><A NAME="ch13index96"></A><A NAME="ch13index97"></A><A NAME="ch13index98"></A></P>
<A NAME="ch13fig10"></A><p><CENTER><H5 class="docFigureTitle">Figure 13.10. The DB2I Run panel.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/13fig10_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="358" SRC="images/0672326132/graphics/13fig10.gif" ALT="graphics/13fig10.gif"></p></CENTER></p><br>
<A NAME="ch13lev2sec7"></A><H4 class="docSection2Title">Program Preparation Using Batch Procedures</H4>
<P class="docText">Some shops prefer to handle all DB2 program preparation with a batch job. The batch procedure handles all the steps required for DB2 program preparation, which results in an executable load module and plan.<A NAME="ch13index99"></A><A NAME="ch13index100"></A><A NAME="ch13index101"></A><A NAME="ch13index102"></A></P>
<P class="docText">Programmers often choose batch procedures to automate and standardize the specification of work data set names; compile, link, and bind parameters; and source, <TT>DBRM</TT>, and <TT>DCLGEN</TT> library names. A batch procedure invoked by common JCL with an override for the program name limits an application programmer's exposure to these miscellaneous program preparation factors. <A class="docLink" HREF="#ch13list02">Listing 13.2</A> shows a common batch procedure. Note that the data set names and libraries for your shop may be different, as may the COBOL compile step.</P>
<A NAME="ch13list02"></A><H5 class="docExampleTitle">Listing 13.2. Sample Program Preparation Procedure</H5><A NAME="ch13index103"></A>

<PRE>
//COMPBAT PROC MBR='XXXXXXXX',   ** MEMBER NAME        **
//     FLEVEL='APPL.ID'          ** LIBRARY PREFIX     **
//     DB2='SYS1.DB2V810',       ** DB2 SYSTEM PREFIX  **
//     WORK='SYSDA',             ** WORK FILES UNIT    **
//     SOURCE='APPL.ID.SOURCE',  ** SOURCE DATASET     **
//     SYSOUT='*'
//************************************************************
//*       DB2 PRECOMPILE STEP FOR COBOL—BATCH
//************************************************************
//DB2PC    EXEC  PGM=DSNHPC,
//         PARM='DATE(ISO),TIME(ISO),HOST(IBMCOB),APOST'
//STEPLIB  DD DSN=&amp;DB2..DSNEXIT,DISP=SHR
//         DD DSN=&amp;DB2..DSNLOAD,DISP=SHR
//SYSLIB   DD DSN=&amp;FLEVEL..INCLUDE,DISP=SHR
//         DD DSN=&amp;FLEVEL..DCLGENLB,DISP=SHR
//SYSCIN   DD DSN=&amp;&amp;SRCOUT,DISP=(NEW,PASS,DELETE),
//         UNIT=&amp;WORK,
//         DCB=BLKSIZE=800,SPACE=(800,(800,500))
//SYSIN    DD DSN=&amp;SOURCE(&amp;MBR),DISP=SHR
//DBRMLIB  DD DSN=&amp;FLEVEL..DBRMLIB(&amp;MBR),DISP=SHR
//SYSPRINT DD SYSOUT=&amp;SYSOUT
//SYSTERM  DD SYSOUT=&amp;SYSOUT
//SYSUT1   DD SPACE=(800,(500,500)),UNIT=&amp;WORK
//SYSUT2   DD SPACE=(800,(500,500)),UNIT=&amp;WORK
//************************************************************
//*     COBOL COMPILE
//************************************************************
//COB      EXEC PGM=IGYCRCTL,
//         COND=(5,LT,DB2PC),
//         PARM=('NODYNAM,LIB,OBJECT,RENT,RES,APOST',
//         'DATA(24),XREF')
//STEPLIB  DD DSN=SYS1.COBLIB,DISP=SHR
//SYSPRINT DD DSN=&amp;&amp;SPRNT,DISP=(MOD,PASS),UNIT=SYSDA,
//         SPACE=(TRK,(175,20)),DCB=BLKSIZE=16093
//SYSTERM  DD SYSOUT=&amp;SYSOUT
//SYSUT1   DD UNIT=&amp;WORK,SPACE=(CYL,(5,1))
//SYSUT2   DD UNIT=&amp;WORK,SPACE=(CYL,(5,1))
//SYSUT3   DD UNIT=&amp;WORK,SPACE=(CYL,(5,1))
//SYSUT4   DD UNIT=&amp;WORK,SPACE=(CYL,(5,1))
//SYSUT5   DD UNIT=&amp;WORK,SPACE=(CYL,(5,1))
//SYSUT6   DD UNIT=&amp;WORK,SPACE=(CYL,(5,1))
//SYSUT7   DD UNIT=&amp;WORK,SPACE=(CYL,(5,1))
//SYSLIN   DD DSN=&amp;&amp;OBJECT,DISP=(NEW,PASS,DELETE),
//         UNIT=&amp;WORK,SPACE=(TRK,(25,10),RLSE),
//         DCB=(RECFM=FB,LRECL=80,BLKSIZE=2960)<A NAME="ch13index104"></A>
//SYSLIB   DD DSN=&amp;FLEVEL..COPYLIB,DISP=SHR
//SYSIN    DD DSN=&amp;&amp;SRCOUT,DISP=(OLD,DELETE,DELETE)
//************************************************************
//*  PRINT THE SYSPRINT DATA SET IF THE RETURN CODE IS &gt; 4
//************************************************************
//GEN1     EXEC PGM=IEBGENER,COND=(5,GT,COB)
//SYSPRINT DD SYSOUT=*
//SYSUT3   DD UNIT=SYSDA,SPACE=(TRK,(10)),DISP=NEW
//SYSUT4   DD UNIT=SYSDA,SPACE=(TRK,(10)),DISP=NEW
//SYSIN    DD DUMMY
//SYSUT1   DD DSN=&amp;&amp;SPRNT,DISP=(OLD,PASS)
//SYSUT2   DD SYSOUT=*
//************************************************************
//*     LINK EDIT THE BATCH PROGRAM FOR DB2
//************************************************************
//LINKIT   EXEC PGM=HEWL,
//         COND=((5,LT,DB2PC),(5,LT,COB)),
//         PARM='LIST,XREF'
//SYSLIB   DD DSN=SYS1.COBLIB,DISP=SHR
//         DD DSN=SYS1.COBCOMP,DISP=SHR
//         DD DSN=&amp;DB2..DSNEXIT,DISP=SHR
//         DD DSN=&amp;DB2..DSNLOAD,DISP=SHR
//         DD DSN=&amp;FLEVEL..BATCH.LOADLIB,DISP=SHR
//DB2LOAD  DD DSN=&amp;DB2..DSNLOAD,DISP=SHR
//SYSLIN   DD DSN=&amp;&amp;OBJECT,DISP=(OLD,PASS)
//         DD DSN=&amp;FLEVEL..LINKLIB(&amp;MBR),DISP=SHR
//SYSLMOD  DD DSN=&amp;FLEVEL..BATCH.LOADLIB(&amp;MBR),DISP=SHR
//SYSPRINT DD SYSOUT=&amp;SYSOUT
//SYSUT1   DD UNIT=&amp;WORK,SPACE=(CYL,(1,2))
//************************************************************
//*     BIND PLAN FOR THE MODULE
//************************************************************
//BIND1    EXEC PGM=IKJEFT1B,DYNAMNBR=20,
//         COND=((5,LT,DB2PC),(5,LT,COB),(5,LT,LINKIT))
//STEPLIB  DD DSN=&amp;DB2..DSNEXIT,DISP=SHR
//         DD DSN=&amp;DB2..DSNLOAD,DISP=SHR
//SYSTSPRT DD SYSOUT=*
//SYSPRINT DD SYSOUT=*
//SYSUDUMP DD SYSOUT=*
//DBRMLIB  DD DSN=&amp;FLEVEL..DBRMLIB,DISP=SHR
//SYSTSIN  DD *
  DSN SYSTEM(DSN)
  BIND  PLAN(&amp;MEMBER.)   MEMBER(&amp;MEMBER.) -
        ACTION(REPLACE)  RETAIN           -
        VALIDATE(BIND)   ACQUIRE(USE)     -
        RELEASE(COMMIT)  ISOLATION(CS)    -
        DEGREE(1)        EXPLAIN(YES)
  END
//<A NAME="ch13index105"></A><A NAME="ch13index106"></A><A NAME="ch13index107"></A><A NAME="ch13index108"></A><A NAME="ch13index109"></A>
</PRE><BR>

<A NAME="ch13lev2sec8"></A><H4 class="docSection2Title">Program Preparation Using <TT>CLIST</TT> or REXX <TT>EXEC</TT></H4>
<P class="docText">Another common practice for some shops is to create a <TT>CLIST</TT> or REXX <TT>EXEC</TT> that can be invoked to prompt the user to enter program preparation options. The <TT>CLIST</TT> or <TT>EXEC</TT> reads the options as specified by the programmer and builds JCL to invoke program preparation using those parameters.<A NAME="ch13index110"></A><A NAME="ch13index111"></A><A NAME="ch13index112"></A><A NAME="ch13index113"></A><A NAME="ch13index114"></A><A NAME="ch13index115"></A></P>
<P class="docText">This method enables programmers to make quick changes to precompile, compile, and link edit parameters without requiring them to explicitly change parameters in JCL that they do not always fully understand. This method also can force specific options to be used, such as all binds must use <TT>ISOLATION(CS)</TT> or all links must use <TT>RMODE=31</TT>, by not allowing users to change them.</P>
<A NAME="ch13note05"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">Be aware that "forcing" the use of specific <TT>BIND</TT> parameters can result in subpar performance. The best approach for specifying <TT>BIND</TT> parameters is to determine the type of program including the work to be done, its environment, the number of times it will be executed, and the performance required. Only after obtaining and analyzing all of these issues can you appropriately determine the best parameters to use.</P></div><br>
<P class="docText">The <TT>CLIST</TT> or <TT>EXEC</TT> can use a standard procedure, as discussed in the preceding section, and automatically submit the job.</P>
<A NAME="ch13lev2sec9"></A><H4 class="docSection2Title">Program Preparation Using Multiple Methods</H4>
<P class="docText">When you develop program preparation standards, the following goals should be paramount:<A NAME="ch13index116"></A><A NAME="ch13index117"></A></P>
<UL><LI><P class="docList">Increase the understanding and usability of program preparation procedures</P></LI><LI><P class="docList">Disable dangerous and undesired program preparation parameters</P></LI><LI><P class="docList">Standardize the program preparation procedure</P></LI><LI><P class="docList">Enable fast turnaround for programmers using the procedures</P></LI></UL>
<P class="docText">To accomplish the preceding goals, using a combination of the techniques described in this chapter is probably best. The only DB2 program preparation steps that require DB2 to be operational, for example, are <TT>DCLGEN</TT> and <TT>BIND</TT>. <TT>DCLGEN</TT> is not a factor because it normally is invoked outside the program preparation loop. The <TT>BIND</TT> command, however, usually is embedded in the procedure, <TT>CLIST</TT>, or REXX <TT>EXEC</TT>. If this is true, as shown in <A class="docLink" HREF="#ch13list02">Listing 13.2</A>, you could be inhibiting your program preparation process.<A NAME="ch13index118"></A><A NAME="ch13index119"></A></P>
<P class="docText">If DB2 is not operational, all program preparation jobs will fail in the bind step. Additionally, if your shop is configured with multiple CPUs, a job with a bind step must be run on the CPU containing the DB2 subsystem that will perform the bind. Without the bind step, the job is free to execute in any available machine because DB2 resources are not required.</P>
<P class="docText">I recommend the establishment of a common procedure to run all program preparation, except the bind step. You then should code <TT>CLIST</TT> or REXX <TT>EXEC</TT> to prompt only for the parameters your shop allows to be changed. It then will build JCL using the common procedure (without the bind step). <TT>CLIST</TT> or <TT>EXEC</TT> can ask whether a bind step should be added. This way, application programmers can precompile, compile, and link edit programs when DB2 is not operational, but they have the option of binding when DB2 is operational. This can reduce the amount of downtime because a single machine running a test DB2 subsystem will not become a bottleneck due to a vast number of compiles being submitted to a single machine.</P>
<P class="docText">You can code a separate <TT>CLIST</TT> that enables programmers to bind after a successful execution of the precompile, compile, and link—or whenever a bind is required. It should accept only certain bind parameters as input, thereby enforcing your shop's bind standards. Ideally, the <TT>CLIST</TT> should be able to bind the program in the foreground or the background using batch JCL.<A NAME="ch13index120"></A><A NAME="ch13index121"></A></P>
<P class="docText"><A class="docLink" HREF="#ch13list03">Listings 13.3</A> and <A class="docLink" HREF="#ch13list04">13.4</A> are sample <TT>CLIST</TT>s to accomplish DB2 program preparation. You can use these samples as templates for creating your own program preparation <TT>CLIST</TT>s that follow your organization's standards and procedures.<A NAME="ch13index122"></A><A NAME="ch13index123"></A><A NAME="ch13index124"></A><A NAME="ch13index125"></A></P>
<A NAME="ch13list03"></A><H5 class="docExampleTitle">Listing 13.3. Precompile, Compile, and Link <TT>CLIST</TT></H5>

<PRE>
PROC 1 PLANNAME  JOB(BB)
/*     THIS CLIST ACCEPTS A PROGRAM NAME AS INPUT, PROMPTS
/*     FOR THE REQUIRED PROGRAM PREPARATION PARAMETERS,
/*     AND SUBMITS A BATCH JOB TO PREPARE THE PROGRAM
/*     FOR EXECUTION.
CONTROL PROMPT NOFLUSH END(DONE)
    K
    WRITE
ASKMSG:-
    WRITE
    WRITE     ENTER OUTPUT MESSAGE CLASS:
    WRITENR     =====&gt;
    READ &amp;MSG
    IF &amp;MSG NE X AND &amp;MSG NE A THEN DO-
        WRITE
        WRITE           INVALID MESSAGE CLASS ENTERED
        GOTO ASKMSG
    DONE
ASKSORC:-
    WRITE
    WRITE     ENTER NAME OF PROGRAM SOURCE LIBRARY TO USE:
    WRITE     (PRESS ENTER TO ACCEPT DEFAULT SOURCE LIBRARY)
    WRITENR     =====&gt;
    READ &amp;SORC
    IF &amp;SORC =      THEN SET &amp;SORCLB=&amp;STR(DEFAULT.SORCLIB)
    ELSE                 SET &amp;SORCLB=&amp;SORC
ASKPREFX:-
    WRITE
    WRITE     ENTER THE PREFIX FOR YOUR APPLICATION LINK
    WRITE     AND DBRM LIBRARIES:
    WRITE     (PRESS ENTER TO ACCEPT DEFAULT PREFIX)
    WRITENR     =====&gt;
    READ &amp;PREF
    IF &amp;PREF =      THEN SET &amp;PREFX=&amp;STR(DEFAULT.PREFIX)
    ELSE                 SET &amp;PREFX=&amp;PREF
BUILDJCL:-
    K
    WRITE          BUILDING PROGRAM PREPARATION JCL, PLEASE WAIT...
EDIT COMPLINK.CNTL NEW EMODE
10 //&amp;SYSUID.&amp;JOB JOB(<span class="docEmphasis">job information</span>),'PROG PREP &amp;PROGNAME',
11 //     MSGLEVEL=(1,1),NOTIFY=&amp;SYSUID.,MSGCLASS=&amp;MSG,CLASS=X
15 //JOBLIB DD DSN=SYS1.DB2V2R3.LINKLIB,DISP=SHR
20 //PROGPREP     EXEC      COMPBAT,MBR=&amp;PROGNAME.,FLEVEL=&amp;PREFIX.,
22 //          SOURCE=&amp;SORCLB.
24 /*
26 //
SUBM:-
    WRITE          PROGRAM, &amp;PROGNAME WILL BE
    WRITE               PRECOMPILED, COMPILED, AND LINKED
    WRITE               FROM &amp;SORCLB
    SUBMIT
    END NO
EXIT<A NAME="ch13index126"></A><A NAME="ch13index127"></A><A NAME="ch13index128"></A><A NAME="ch13index129"></A>
</PRE><BR>

<A NAME="ch13list04"></A><H5 class="docExampleTitle">Listing 13.4. Bind <TT>CLIST</TT></H5><A NAME="ch13index130"></A><A NAME="ch13index131"></A><A NAME="ch13index132"></A><A NAME="ch13index133"></A>

<PRE>
PROC 1 PLANNAME  JOB(BB)
/*     THIS CLIST ACCEPTS A PLANNAME AS INPUT, PROMPTS FOR  */
/*     THE REQUIRED BIND PARAMETERS, AND SUBMITS A BATCH    */
/*     JOB TO BIND THE PLAN                                 */
CONTROL PROMPT NOFLUSH END(DONE)
    K
    WRITE
ASKMSG:-
    WRITE
    WRITE     ENTER OUTPUT MESSAGE CLASS:
    WRITENR     =====&gt;
    READ &amp;MSG
    IF &amp;MSG NE X AND &amp;MSG NE A THEN DO-
        WRITE
        WRITE     INVALID MESSAGE CLASS ENTERED
        GOTO ASKMSG
    DONE
ASKLIB:-
    WRITE
    WRITE     ENTER NAME OF DBRM LIBRARY TO USE:
    WRITE     (PRESS ENTER TO ACCEPT DEFAULT DBRMLIB)
    WRITENR     =====&gt;
    READ &amp;LIB
    IF &amp;LIB =      THEN SET &amp;DLIB=&amp;STR(DEFAULT.DBRMLIB)
    ELSE                SET &amp;DLIB=&amp;LIB
ASKEXPL:-
    WRITE
    WRITE     DO YOU WANT TO DO AN EXPLAIN OF THIS PLAN (Y/N) ?
    WRITENR     =====&gt;
    READ &amp;EXP
    IF &amp;EXP NE Y AND &amp;EXP NE N THEN DO-
        WRITE
        WRITE      INVALID RESPONSE PLEASE ENTER ONLY Y OR N
        GOTO ASKEXPL
    DONE
    IF &amp;EXP = N THEN SET &amp;EXPL=&amp;STR(NO)
    ELSE             SET &amp;EXPL=&amp;STR(YES)
ASKDBRM:-
    K
    WRITE
    WRITE     ENTER THE NAME OF ALL DBRMS TO BE BOUND INTO THIS
    WRITE     PLAN. BE SURE TO PLACE A COMMA BETWEEN EACH DBRM &amp;
    WRITE     INCLUDE QUOTATION MARKS IF THERE IS MORE THAN ONE
    WRITE     DBRM. ( FOR EXAMPLE:: &amp;STR(')DBRM1,DBRM2&amp;STR(')  )
    WRITE     OR PRESS ENTER TO DEFAULT DBRM TO &amp;PLANNAME
    WRITENR     =====&gt;
    READ &amp;DLIST
    IF &amp;DLIST =      THEN SET &amp;DBRM=&amp;PLANNAME
    ELSE                  SET &amp;DBRM=&amp;LIST
BUILDJCL:-
    K
    WRITE     BUILDING BIND JCL, PLEASE WAIT...
EDIT BIND.CNTL NEW EMODE
10 //&amp;SYSUID.&amp;JOB JOB(<span class="docEmphasis">job information</span>),'BIND &amp;PLANNAME',
11 //     MSGLEVEL=(1,1),NOTIFY=&amp;SYSUID.,MSGCLASS=&amp;MSG,CLASS=X
15 //JOBLIB DD DSN=SYS1.DB2V5R1.LINKLIB,DISP=SHR
20 //BIND      EXEC      PGM=IKJEFT1B,DYNAMBR=20
22 //SYSTSPRT     DD     SYSOUT=*
24 //SYSPRINT     DD     SYSOUT=*
26 //SYSABOUT  DD     SYSOUT=*
28 //SYSTSIN     DD     *
30 DSN SYSTEM(DSN)
32     BIND PLAN (&amp;PLANNAME)    &amp;STR(-)
34          MEMBER (&amp;DBRM)      &amp;STR(-)
36          LIBRARY (&amp;DLIB)     &amp;STR(-)
38          ACTION (REPLACE)    &amp;STR(-)
40          VALIDATE (BIND)     &amp;STR(-)
42          ISOLATION (CS)      &amp;STR(-)
44          FLAG (I)            &amp;STR(-)
46          ACQUIRE (USE)       &amp;STR(-)
48          RELEASE (COMMIT)    &amp;STR(-)
50          DEGREE (1)          &amp;STR(-)
52          EXPLAIN (&amp;EXPL)
54 END
56 /*
58 //
SUBM:-
    WRITE          &amp;PLANNAME WILL BE BOUND
    WRITE               USING &amp;DBRM
    WRITE               FROM &amp;DLIB
    SUBMIT
    END NO
EXIT<A NAME="ch13index134"></A><A NAME="ch13index135"></A><A NAME="ch13index136"></A><A NAME="ch13index137"></A>
</PRE><BR>

<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch13lev1sec2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch13lev1sec4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
