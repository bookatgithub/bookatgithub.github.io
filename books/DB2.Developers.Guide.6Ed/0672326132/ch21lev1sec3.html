<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Filter Factors</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch21lev1sec2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch21lev1sec4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch21lev1sec3"></A><H3 class="docSection1Title">Filter Factors</H3>
<P class="docText">Do you recall the discussion of filter factors from <A class="docLink" HREF="ch01.html#ch01">Chapter 1</A>, "The Magic Words"? The optimizer calculates the filter factor for a query's predicates based on the number of rows that will be filtered out by the predicates.</P>
<P class="docText">The filter factor is a ratio (a number between 0 and 1) that estimates I/O costs. It is an estimate of the proportion of table rows for which a predicate is true. The formulas used by the optimizer to calculate the filter factor are proprietary IBM information, but <A class="docLink" HREF="#ch21table02">Table 21.2</A> provides rough estimates for the formulas based on the type of predicate. These formulas assume uniform data distribution, so they should be used only when determining the filter factor for static SQL queries or queries on tables having no distribution statistics stored in the DB2 Catalog. The filter factor for dynamic SQL queries is calculated using the distribution statistics, in <TT>SYSCOLDIST</TT>, if available.<A NAME="ch21index50"></A><A NAME="ch21index51"></A><A NAME="ch21index52"></A></P>
<A NAME="ch21table02"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 21.2. Filter Factor Formulas</h5></CAPTION><COLGROUP><COL width="181.5"><COL width="203.5"><COL width="165"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Predicate Type</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Formula</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Default FF</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL = value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1/<TT>FIRSTKEYCARDF [COL]</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.04</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL = :host-var</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1/<TT>FIRSTKEYCARDF [COL]</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.04</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &lt;&gt; value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1-(1/<TT>FIRSTKEYCARDF [COL]</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.96</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &lt;&gt; :host-var</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1-(1/<TT>FIRSTKEYCARDF [COL]</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.96</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL IN (list of values)</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(list size)?(1/<TT>FIRSTKEYCARDF [COL]</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.04?(list size)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL NOT IN</TT> <TT>(list of values)</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1-[(list size)?(1/<TT>FIRSTKEYCARDF [COL]</TT>)]</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1-[.04?(list size)]</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL IS NULL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1/<TT>FIRSTKEYCARDF [COL]</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.04</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL IS NOT NULL</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1-(1/<TT>FIRSTKEYCARDF [COL]</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.96</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COLA = COLB</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">smaller of</P>
<P class="docText">1/<TT>FIRSTKEYCARDF [COLA]</TT></P>
<P class="docText">1/<TT>FIRSTKEYCARDF [COLB]</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.04</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COLA &lt;&gt; COLB</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">smaller of</P>
<P class="docText">1/<TT>FIRSTKEYCARDF [COLA]</TT></P>
<P class="docText">1/<TT>FIRSTKEYCARDF [COLB]</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.96</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &lt; value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>LOW2KEY</TT>-value)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.33</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &lt;= value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>LOW2KEY</TT>-value)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.33</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &#172;&gt; value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>LOW2KEY</TT>-value)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.33</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &gt; value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>HIGH2KEY</TT>-value)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.33</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &gt;= value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>HIGH2KEY</TT>-value)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.33</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL &#172;&lt; value</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>HIGH2KEY</TT>-value)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.33</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL BETWEEN val1 AND val2</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>val2-val1</TT>)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.01</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL LIKE 'char%'</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">(<TT>val2-val1</TT>)/(<TT>HIGH2KEY</TT>-<TT>LOW2KEY</TT>)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.01</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL LIKE '%char'</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL LIKE '_char'</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL op ANY</TT> <TT>(non-corr. sub)</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">- - -</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.83</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL op ALL (non-corr. sub)</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">- - -</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.16</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL IN (non-corr. sub)</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">FF(noncor. subquery)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.90</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COL NOT IN (non-corr. sub)</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">1-FF(noncor. subquery)</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">.10</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>predicate1 AND predicate2</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Multiply the filter factors of the two predicates, FF1?FF2</P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>predicate1 OR predicate2</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Add filter factors and subtract the product, FF1+FF2-(FF1?FF2)<A NAME="ch21index56"></A><A NAME="ch21index57"></A><A NAME="ch21index58"></A><A NAME="ch21index59"></A></P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR></TABLE></P><br>
<P class="docText">For example, consider the following query:</P>
<pre>

</pre><BR><pre>
SELECT   EMPNO, LASTNAME, SEX
FROM     DSN8810.EMP
WHERE    WORKDEPT = 'A00';
</pre><BR>
<P class="docText">The column has an index called <TT>DSN8810.XEMP2</TT>. If this query were being optimized by DB2, the filter factor for the <TT>WORKDEPT</TT> predicate would be calculated to estimate the number of I/Os needed to satisfy this request.</P>
<P class="docText">Using the information in <A class="docLink" HREF="#ch21table02">Table 21.2</A>, you can see that the filter factor for this predicate is 1/<TT>FIRSTKEYCARDF</TT>. So, if the value of the <TT>FIRSTKEYCARDF</TT> column in the <TT>SYSIBM.SYSINDEXES</TT> DB2 Catalog table is <TT>9</TT>, the filter factor for this query is 1/9, or .1111. In other words, DB2 assumes that approximately 11% of the rows from this table will satisfy this request.</P>
<P class="docText">You might be wondering how this information helps you. Well, with a bit of practical knowledge, you can begin to determine how your SQL statements will perform before executing them. If you remember nothing else about filter factors, remember this: <span class="docEmphasis">The lower the filter factor, the lower the cost and, in general, the more efficient your query will be.</span><A NAME="ch21index60"></A><A NAME="ch21index61"></A><A NAME="ch21index62"></A></P>
<P class="docText">Therefore, you can easily see that as you further qualify a query with additional predicates, you make it more efficient because more data is filtered out and I/O requirements diminish.</P>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch21lev1sec2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch21lev1sec4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
