<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Table Space Locks</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch23lev1sec3.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch23lev1sec5.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch23lev1sec4"></A><H3 class="docSection1Title">Table Space Locks</H3>
<P class="docText">A table space lock is acquired when a DB2 table or index is accessed. Note that I said <span class="docEmphasis">accessed,</span> not <span class="docEmphasis">updated</span>. The table space is locked even when simple read-only access is occurring.</P>
<P class="docText">Refer to <A class="docLink" HREF="#ch23table01">Table 23.1</A> for a listing of the types of table space locks that can be acquired during the execution of an SQL statement. Every table space lock implies two types of access: the access acquired by the lock requester and the access allowed to other subsequent, concurrent processes.<A NAME="ch23index91"></A><A NAME="ch23index92"></A></P>
<A NAME="ch23table01"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.1. Table Space Locks</h5></CAPTION><COLGROUP><COL width="126.5"><COL width="198"><COL width="110"><COL width="115.5"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Lock</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Meaning</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Access Acquired</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Access Allowed to Others</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SHARE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read with intent to update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXCLUSIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No access</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INTENT SHARE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Update</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IX</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INTENT EXCLUSIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Update</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SIX</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SHARE/INTENT EXCLUSIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read or Update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD></TR></TABLE></P><br>
<P class="docText">When an SQL statement is issued and first accesses data, it takes an intent lock on the table space. Later in the process, actual <TT>S</TT>-, <TT>U</TT>-, or <TT>X</TT>-locks are taken. The intent locks (<TT>IS</TT>, <TT>IX</TT>, and <TT>SIX</TT>) enable programs to wait for the required <TT>S</TT>-, <TT>U</TT>-, or <TT>X</TT>-lock that needs to be taken until other processes have released competing locks.</P>
<P class="docText">The type of table space lock used by DB2 during processing is contingent on several factors, including the table space <TT>LOCKSIZE</TT> specified in the DDL, the bind parameters chosen for the plan being run, and the type of processing requested. <A class="docLink" HREF="#ch23table02">Table 23.2</A> provides a synopsis of the initial table space locks acquired under certain conditions.<A NAME="ch23index93"></A><A NAME="ch23index94"></A></P>
<A NAME="ch23table02"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.2. How Table Space Locks Are Acquired</h5></CAPTION><COLGROUP><COL width="110"><COL width="198"><COL width="132"><COL width="110"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Type of Processing</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><TT>LOCKSIZE</TT></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Isolation</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Initial Lock Acquired</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>MODIFY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ANY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IX</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>MODIFY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PAGE/ROW</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IX</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>MODIFY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TABLESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>MODIFY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ANY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>MODIFY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PAGE/ROW</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>MODIFY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TABLESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ANY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IS</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PAGE/ROW</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IS</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TABLESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ANY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PAGE/ROW</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TABLESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD></TR></TABLE></P><br>
<P class="docText">A table space <TT>U</TT>-lock indicates intent to update, but an update has not occurred. This is caused by using a cursor with the <TT>FOR UPDATE OF</TT> clause. A <TT>U</TT>-lock is non-exclusive because it can be taken while tasks have <TT>S</TT>-locks on the same table space. More information on table space lock compatibility follows in <A class="docLink" HREF="#ch23table03">Table 23.3</A>.</P>
<P class="docText">An additional consideration is that table space locks are usually taken in combination with table and page locks, but they can be used on their own. When you specify the <TT>LOCKSIZE TABLESPACE</TT> DDL parameter, table space locks alone are used as the locking mechanism for the data in that table space. This way, concurrent access is limited and concurrent update processing is eliminated.</P>
<P class="docText">Similar in function to the <TT>LOCKSIZE</TT> DDL parameter is the <TT>LOCK TABLE</TT> statement. The <TT>LOCK TABLE</TT> statement requests an immediate lock on the specified table. The <TT>LOCK TABLE</TT> statement has two forms—one to request a share lock and one to request an exclusive lock.<A NAME="ch23index95"></A><A NAME="ch23index96"></A><A NAME="ch23index97"></A><A NAME="ch23index98"></A></P>
<pre>

</pre><BR><pre>
LOCK TABLE <span class="docEmphasis">table_name</span> IN SHARE MODE;
LOCK TABLE <span class="docEmphasis">table_name</span> IN EXCLUSIVE MODE;
</pre><BR>
<A NAME="ch23note02"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">The <TT>LOCK TABLE</TT> statement locks all tables in a simple table space even though only one table is specified.</P></div><br>
<P class="docText">A locking scheme is not effective unless multiple processes can secure different types of locks on the same resource concurrently. With DB2 locking, some types of table space locks can be acquired concurrently by discrete processes. Two locks that can be acquired concurrently on the same resource are said to be compatible with one another.</P>
<P class="docText">Refer to <A class="docLink" HREF="#ch23table03">Table 23.3</A> for a breakdown of DB2 table space lock compatibility. A <span class="docEmphasis">Yes</span> in the matrix indicates that the two locks are compatible and can be acquired by distinct processes on the same table space concurrently. A <span class="docEmphasis">No</span> indicates that the two locks are incompatible. In general, two locks cannot be taken concurrently if they allow concurrent processes to negatively affect the integrity of data in the table space.<A NAME="ch23index99"></A><A NAME="ch23index100"></A><A NAME="ch23index101"></A></P>
<A NAME="ch23table03"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.3. Table Space Lock Compatibility Matrix</h5></CAPTION><COLGROUP><COL width="115.5"><COL width="55"><COL width="66"><COL width="66"><COL width="71.5"><COL width="71.5"><COL width="104.5"></COLGROUP><THEAD><TR><TH class="thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Locks for PGM2</span></P></TH><TH class="thead" align="left" valign="top" colspan="6"><P class="docText"><span class="docEmphStrong">Locks for PGM1</span></P></TH></TR><TR><TH class="bottomBorder thead" align="left" valign="top">&nbsp;</TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>S</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>U</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>X</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>IS</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>IX</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>SIX</TT></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>IX</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SIX</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No<A NAME="ch23index102"></A><A NAME="ch23index103"></A></P></TD></TR></TABLE></P><br>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch23lev1sec3.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch23lev1sec5.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
