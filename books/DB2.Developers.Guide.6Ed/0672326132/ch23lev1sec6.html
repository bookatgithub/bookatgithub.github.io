<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Page Locks</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch23lev1sec5.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch23lev1sec7.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch23lev1sec6"></A><H3 class="docSection1Title">Page Locks</H3>
<P class="docText">The types of page locks that DB2 can take are outlined in <A class="docLink" HREF="#ch23table05">Table 23.5</A>. <TT>S</TT>-locks allow data to be read concurrently but not modified. With an <TT>X</TT>-lock, data on a page can be modified (with <TT>INSERT</TT>, <TT>UPDATE</TT>, or <TT>DELETE</TT>), but concurrent access is not allowed. <TT>U</TT>-locks enable <TT>X</TT>-locks to be queued, whereas <TT>S</TT>-locks exist on data that must be modified.<A NAME="ch23index110"></A><A NAME="ch23index111"></A></P>
<A NAME="ch23table05"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.5. Page Locks</h5></CAPTION><COLGROUP><COL width="77.77777777777777"><COL width="127.77777777777777"><COL width="138.88888888888889"><COL width="205.55555555555554"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Lock</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Meaning</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Access Acquired</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Access Allowed to Others</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SHARE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read with intent to update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXCLUSIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No access</P></TD></TR></TABLE></P><br>
<P class="docText">As with table space locks, concurrent page locks can be acquired but only with compatible page locks. The compatibility matrix for page locks is shown in <A class="docLink" HREF="#ch23table06">Table 23.6</A>.</P>
<A NAME="ch23table06"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.6. Page Lock Compatibility Matrix</h5></CAPTION><COLGROUP><COL width="137.5"><COL width="66"><COL width="71.5"><COL width="275"></COLGROUP><THEAD><TR><TH class="thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Locks for PGM2</span></P></TH><TH class="thead" align="left" valign="top" colspan="3"><P class="docText"><span class="docEmphStrong">Locks for PGM1</span></P></TH></TR><TR><TH class="bottomBorder thead" align="left" valign="top">&nbsp;</TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>S</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>U</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>X</TT></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR></TABLE></P><br>
<P class="docText">When are these page locks taken? Page locks can be acquired only under the following conditions:</P>
<UL><LI><P class="docList">The DDL for the object requesting a lock specifies <TT>LOCKSIZE PAGE</TT> or <TT>LOCKSIZE ANY</TT>.</P></LI><LI><P class="docList">If <TT>LOCKSIZE ANY</TT> was specified, the <TT>NUMLKTS</TT> threshold or the table space <TT>LOCKMAX</TT> specification must not have been exceeded. You learn more about these topics later in this section.</P></LI><LI><P class="docList">If <TT>ISOLATION(RR)</TT> was used when the plan was bound, the optimizer might decide not to use page locking.</P></LI></UL>
<P class="docText">If all these factors are met, page locking progresses as outlined in <A class="docLink" HREF="#ch23table07">Table 23.7</A>. The type of processing in the left column causes the indicated page lock to be acquired for the scope of pages identified in the right column. DB2 holds each page lock until it is released as specified in the <TT>ISOLATION</TT> level of the plan requesting the particular lock.<A NAME="ch23index115"></A><A NAME="ch23index116"></A></P>
<A NAME="ch23note03"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">Page locks can be promoted from one type of lock to another based on the type of processing that is occurring. A program can <TT>FETCH</TT> a row using a cursor with the <TT>FOR UPDATE OF</TT> clause, causing a <TT>U</TT>-lock to be acquired on that row's page. Later, the program can modify that row, causing the <TT>U</TT>-lock to be promoted to an <TT>X</TT>-lock.</P></div><br>
<A NAME="ch23table07"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.7. How Page Locks Are Acquired</h5></CAPTION><COLGROUP><COL width="144.44444444444443"><COL width="138.88888888888889"><COL width="266.66666666666663"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Type of Processing</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Page Lock Acquired</span></P></TH><TH class="bottomBorder thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Pages Affected</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT/FETCH</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Page by page as they are fetched</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>OPEN CURSOR</TT> for <TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">All pages affected</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT/FETCH </TT></P>
<P class="docText"><TT>FOR UPDATE OF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Page by page as they are fetched</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Page by page</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INSERT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Page by page</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DELETE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Page by page<A NAME="ch23index117"></A><A NAME="ch23index118"></A></P></TD></TR></TABLE></P><br>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch23lev1sec5.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch23lev1sec7.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
