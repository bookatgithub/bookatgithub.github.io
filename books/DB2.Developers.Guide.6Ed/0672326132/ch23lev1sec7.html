<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Row Locks</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch23lev1sec6.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch23lev1sec8.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch23lev1sec7"></A><H3 class="docSection1Title">Row Locks</H3>
<P class="docText">The smallest piece of DB2 data that you can lock is the individual row. The types of row locks that DB2 can take are similar to the types of page locks that it can take. Refer to <A class="docLink" HREF="#ch23table08">Table 23.8</A>. <TT>S</TT>-locks allow data to be read concurrently but not modified. With an <TT>X</TT>-lock, you can modify data in that row (using <TT>INSERT</TT>, <TT>UPDATE</TT>, or <TT>DELETE</TT>), but concurrent access is not allowed. <TT>U</TT>-locks enable <TT>X</TT>-locks to be queued, whereas <TT>S</TT>-locks exist on data that must be modified.<A NAME="ch23index119"></A><A NAME="ch23index120"></A></P>
<A NAME="ch23table08"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.8. Row Locks</h5></CAPTION><COLGROUP><COL width="132"><COL width="132"><COL width="132"><COL width="154"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Lock</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Meaning</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Access Acquired</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Access Allowed to Others</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SHARE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read with intent to update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Read only</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXCLUSIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Update</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No access</P></TD></TR></TABLE></P><br>
<P class="docText">Once again, concurrent row locks can be acquired but only with compatible row locks. <A class="docLink" HREF="#ch23table09">Table 23.9</A> shows the compatibility matrix for row locks.</P>
<A NAME="ch23table09"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 23.9. Row Lock Compatibility Matrix</h5></CAPTION><COLGROUP><COL width="225.5"><COL width="104.5"><COL width="110"><COL width="110"></COLGROUP><THEAD><TR><TH class="thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Locks for PGM2</span></P></TH><TH class="thead" align="left" valign="top" colspan="3"><P class="docText"><span class="docEmphStrong">Locks for PGM1</span></P></TH></TR><TR><TH class="bottomBorder thead" align="left" valign="top">&nbsp;</TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>S</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>U</TT></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><TT>X</TT></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">No</P></TD></TR></TABLE></P><br>
<P class="docText">When are these row locks taken? Row locks can be acquired when the DDL for the object requesting a lock specifies <TT>LOCKSIZE ROW.</TT> (Although it is theoretically possible for <TT>LOCKSIZE ANY</TT> to choose row locks, in practice I have yet to see this happen.) Row locking progresses as outlined in <A class="docLink" HREF="#ch23table10">Table 23.10</A>. The type of processing in the left column causes the indicated row lock to be acquired for the scope of rows identified in the right column. A row lock is held until it is released as specified by the <TT>ISOLATION</TT> level of the plan requesting the particular lock.</P>
<A NAME="ch23note04"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">Row locks can be promoted from one type of lock to another based on the type of processing that is occurring. A program can <TT>FETCH</TT> a row using a cursor with the <TT>FOR UPDATE OF</TT> clause, causing a <TT>U</TT>-lock to be acquired on that row. Later, the program can modify that row, causing the <TT>U</TT>-lock to be promoted to an <TT>X</TT>-lock.</P></div><br>
<A NAME="ch23table10"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="rows" CELLPADDING="4"><CAPTION><h5 class="docTableTitle">Table 23.10. How Row Locks Are Acquired</h5></CAPTION><COLGROUP><COL width="115.5"><COL width="99"><COL width="335.5"></COLGROUP><THEAD><TR><TH class="thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Type of Processing</span></P></TH><TH class="thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Row Lock Acquired</span></P></TH><TH class="thead" align="left" valign="bottom"><P class="docText"><span class="docEmphStrong">Rows Affected</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT/FETCH</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Row by row as they are fetched</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>OPEN CURSOR</TT> for <TT>SELECT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>S</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">All rows affected</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SELECT/FETCH FOR UPDATE OF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>U</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Row by row as they are fetched</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Row by row</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>INSERT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Row by row</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DELETE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>X</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Row by row<A NAME="ch23index124"></A><A NAME="ch23index125"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch23lev2sec3"></A><H4 class="docSection2Title">Page Locks Versus Row Locks</H4>
<P class="docText">The answer to the question of whether to use page locks or row locks is, of course, "It depends!" The nature of your specific data and applications determines whether page or row locks are most applicable.<A NAME="ch23index126"></A><A NAME="ch23index127"></A><A NAME="ch23index128"></A><A NAME="ch23index129"></A></P>
<P class="docText">The resources required to acquire, maintain, and release a row lock are just about the same as the resources required for a page lock. Therefore, the number of rows per page must be factored into the row-versus-page locking decision. The more rows per page, the more resources row locking will consume. For example, a table space with a single table that houses 25 rows per page can consume as much as 25 times more resources for locking if row locks are chosen over page locks. Of course, this estimate is very rough, and other factors (such as lock avoidance) can reduce the number of locks acquired, and thereby reduce the overhead associated with row locking. However, locking a row-at-a-time instead of a page-at-a-time can reduce contention. Row locking almost always consumes more resources than page locking. Likewise, if two applications running concurrently access the same data in different orders, row locking might actually decrease concurrent data access.</P>
<P class="docText">You must therefore ask these questions:</P>
<UL><LI><P class="docList">What is the nature of the applications that access the objects in question? Of course, the answer to this question differs not only from organization to organization, but also from application to application within the same organization.</P></LI><LI><P class="docList">Which is more important, reducing the resources required to execute an application or increasing data availability? The answer to this question will depend upon the priorities set by your organization and any application teams accessing the data.</P></LI></UL>
<P class="docText">As a general rule of thumb, favor specifying <TT>LOCKSIZE PAGE</TT>, as page locking is generally the most practical locking strategy for most applications. If you're experiencing severe contention problems on a table space that is currently using <TT>LOCKSIZE PAGE</TT>, consider changing to <TT>LOCKSIZE ROW</TT> and gauging the impact on performance, resource consumption, and concurrent data access. Alternatively, you also might choose to specify <TT>LOCKSIZE ANY</TT> and let DB2 choose the type of locking to be performed.<A NAME="ch23index130"></A><A NAME="ch23index131"></A><A NAME="ch23index132"></A><A NAME="ch23index133"></A></P>
<A NAME="ch23note05"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">A possible alternative to row locking is to specify <TT>MAXROWS 1</TT> for the table space and use <TT>LOCKSIZE PAGE</TT> (or <TT>LOCKSIZE ANY</TT>), instead of <TT>LOCKSIZE ROW</TT>.</P></div><br>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch23lev1sec6.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch23lev1sec8.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
