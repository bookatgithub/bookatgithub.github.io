<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>DB2 Traces</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch24.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch24lev1sec2.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch24lev1sec1"></A><H3 class="docSection1Title">DB2 Traces</H3>
<P class="docText">The first type of performance monitoring I discuss here is monitoring based on reading trace information. You can think of a DB2 trace as a window into the performance characteristics of aspects of the DB2 workload. DB2 traces record diagnostic information describing particular events. As DB2 operates, it writes trace information that can be read and analyzed to obtain performance information.<A NAME="ch24index06"></A><A NAME="ch24index07"></A><A NAME="ch24index08"></A></P>
<P class="docText">DB2 provides six types of traces, and each describes information about the DB2 environment. These six types of traces are outlined in <A class="docLink" HREF="#ch24table01">Table 24.1</A>.</P>
<A NAME="ch24table01"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 24.1. DB2 Trace Types</h5></CAPTION><COLGROUP><COL width="99"><COL width="198"><COL width="253"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Trace</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Started By</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Description</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">Accounting</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">DSNZPARM or <TT>-START TRACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Records performance information about the execution of DB2 application programs<A NAME="ch24index09"></A><A NAME="ch24index10"></A><A NAME="ch24index11"></A><A NAME="ch24index12"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">Audit</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">DSNZPARM or <TT>-START TRACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Provides information about DB2 DDL, security, utilities, and data modification<A NAME="ch24index13"></A><A NAME="ch24index14"></A><A NAME="ch24index15"></A><A NAME="ch24index16"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">Global</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">DSNZPARM or <TT>-START TRACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Provides information for the servicing of DB2<A NAME="ch24index17"></A><A NAME="ch24index18"></A><A NAME="ch24index19"></A><A NAME="ch24index20"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">Monitor</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">DSNZPARM or <TT>-START TRACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Records data useful for online monitoring of the DB2 subsystem and DB2 application programs<A NAME="ch24index21"></A><A NAME="ch24index22"></A><A NAME="ch24index23"></A><A NAME="ch24index24"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">Performance</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>-START TRACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Collects detailed data about DB2 events, enabling database and performance analysts to pinpoint the causes of performance problems<A NAME="ch24index25"></A><A NAME="ch24index26"></A><A NAME="ch24index27"></A><A NAME="ch24index28"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText">Statistics</P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">DSNZPARM or <TT>-START TRACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Records information regarding the DB2 subsystem's use of resources<A NAME="ch24index29"></A><A NAME="ch24index30"></A><A NAME="ch24index31"></A><A NAME="ch24index32"></A></P></TD></TR></TABLE></P><br>
<P class="docText">Note that you start DB2 traces in two ways: by specifying the appropriate DSNZPARMs at DB2 startup or by using the <TT>-START TRACE</TT> command to initiate specific traces when DB2 is already running.</P>
<P class="docText">Each trace is broken down further into classes, each of which provides information about aspects of that trace. Classes are composed of IFCIDs. An IFCID (sometimes pronounced <span class="docEmphasis">if-kid</span>) is an Instrumentation Facility Component Identifier. An IFCID defines a record that represents a trace event. IFCIDs are the single smallest unit of tracing that can be invoked by DB2.</P>
<P class="docText">The six DB2 trace types are discussed in the following sections.<A NAME="ch24index33"></A><A NAME="ch24index34"></A><A NAME="ch24index35"></A></P>
<A NAME="ch24lev2sec1"></A><H4 class="docSection2Title">Accounting Trace</H4>
<P class="docText">The accounting trace is probably the single most important trace for judging the performance of DB2 application programs. Using the accounting trace records, DB2 writes data pertaining to the following:<A NAME="ch24index36"></A><A NAME="ch24index37"></A><A NAME="ch24index38"></A><A NAME="ch24index39"></A></P>
<UL><LI><P class="docList">CPU and elapsed time of the program</P></LI><LI><P class="docList">EDM pool use</P></LI><LI><P class="docList">Locks and <TT>GETPAGE</TT> page requests, by buffer pool, issued by the program</P></LI><LI><P class="docList">Number of synchronous writes</P></LI><LI><P class="docList">Thread wait times</P></LI><LI><P class="docList">Type of SQL issued by the program</P></LI><LI><P class="docList">Number of <TT>COMMIT</TT>s and <TT>ABORT</TT>s issued by the program</P></LI><LI><P class="docList">Program's use of sequential prefetch and other DB2 performance features (RLF, distributed processing, and so on)</P></LI></UL>
<P class="docText">There are ten groups of DB2 accounting trace classes:<A NAME="ch24index40"></A></P>
<BLOCKQUOTE><P><p class="docText"><span class="docEmphRoman">Class 1</span>— 
Standard accounting information</p></P><P><p class="docText"><span class="docEmphRoman">Class 2</span>— 
Entry or exit from DB2 events</p></P><P><p class="docText"><span class="docEmphRoman">Class 3</span>— 
Elapsed wait time in DB2</p></P><P><p class="docText"><span class="docEmphRoman">Class 4</span>— 
Installation-defined accounting record</p></P><P><p class="docText"><span class="docEmphRoman">Class 5</span>— 
Time spent processing IFI requests</p></P><P><p class="docText"><span class="docEmphRoman">Class 6</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 7</span>— 
Entry or exit from event signaling package or DBRM accounting</p></P><P><p class="docText"><span class="docEmphRoman">Class 8</span>— 
Wait time for a package</p></P><P><p class="docText"><span class="docEmphRoman">Class 10 thru 29</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 30 thru 32</span>— 
Local use</p></P></BLOCKQUOTE>
<p class="docText"><span class="docEmphasis">Estimated overhead</span>: 
DB2 accounting class 1 adds approximately 3% CPU overhead. DB2 accounting classes 1, 2, and 3 together add approximately 5% CPU overhead. You cannot run class 2 or 3 without also running class 1.<A NAME="ch24index41"></A></p>
<P class="docText">Accounting trace classes 7 and 8 provide performance trace information at the package level. Enabling this level of tracing can cause significant overhead.<A NAME="ch24index42"></A><A NAME="ch24index43"></A><A NAME="ch24index44"></A><A NAME="ch24index45"></A></P>
<A NAME="ch24lev2sec2"></A><H4 class="docSection2Title">Audit Trace</H4>
<P class="docText">The audit trace is useful for installations that must meticulously track specific types of DB2 events. Not every shop needs the audit trace. However, those wanting to audit by <TT>AUTHID</TT>, specific table accesses, and other DB2 events will find the audit trace invaluable. Eight categories of audit information are provided:<A NAME="ch24index46"></A><A NAME="ch24index47"></A><A NAME="ch24index48"></A><A NAME="ch24index49"></A></P>
<UL><LI><P class="docList">All instances in which an authorization failure occurs, for example, if <TT>USER1</TT> attempts to <TT>SELECT</TT> information from a table for which he or she has not been granted the appropriate authority</P></LI><LI><P class="docList">All executions of the DB2 data control language <TT>GRANT</TT> and <TT>REVOKE</TT> statements</P></LI><LI><P class="docList">Every DDL statement issued for specific tables created by specifying <TT>AUDIT CHANGES</TT> or <TT>AUDIT ALL</TT></P></LI><LI><P class="docList">The first <TT>DELETE</TT>, <TT>INSERT</TT>, or <TT>UPDATE</TT> for an audited table</P></LI><LI><P class="docList">The first <TT>SELECT</TT> for only the tables created specifying <TT>AUDIT ALL</TT></P></LI><LI><P class="docList">DML statements encountered by DB2 when binding</P></LI><LI><P class="docList">All AUTHID changes resulting from execution of the <TT>SET CURRENT SQLID</TT> statement</P></LI><LI><P class="docList">All execution of IBM DB2 utilities</P></LI></UL>
<P class="docText">This type of data is often required of critical DB2 applications housing sensitive data, such as payroll or billing applications.</P>
<P class="docText">There are eleven groups of DB2 audit trace classes:</P>
<BLOCKQUOTE><P><p class="docText"><span class="docEmphRoman">Class 1</span>— 
Attempted access denied due to lack of authority<A NAME="ch24index50"></A></p></P><P><p class="docText"><span class="docEmphRoman">Class 2</span>— 
<TT>GRANT</TT> and <TT>REVOKE</TT> statements</p></P><P><p class="docText"><span class="docEmphRoman">Class 3</span>— 
<TT>CREATE</TT>, <TT>ALTER</TT>, and <TT>DROP</TT> statements against audited tables</p></P><P><p class="docText"><span class="docEmphRoman">Class 4</span>— 
First change made to an audited object</p></P><P><p class="docText"><span class="docEmphRoman">Class 5</span>— 
First read made against an audited object</p></P><P><p class="docText"><span class="docEmphRoman">Class 6</span>— 
<TT>BIND</TT> information for SQL statements on audited objects</p></P><P><p class="docText"><span class="docEmphRoman">Class 7</span>— 
Assignment or change of an <TT>AUTHID</TT></p></P><P><p class="docText"><span class="docEmphRoman">Class 8</span>— 
Utility execution</p></P><P><p class="docText"><span class="docEmphRoman">Class 9</span>— 
Installation-defined audit trace record</p></P><P><p class="docText"><span class="docEmphRoman">Class 10 thru 29</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 30 thru 32</span>— 
Local use</p></P></BLOCKQUOTE>
<p class="docText"><span class="docEmphasis">Estimated overhead</span>: 
Approximately 5% CPU overhead per transaction is added when all audit trace classes are started. See the "<A class="docLink" HREF="ch24lev1sec3.html#ch24lev1sec3">Tracing Guidelines</A>" section later in this chapter for additional information on audit trace overhead.<A NAME="ch24index51"></A><A NAME="ch24index52"></A><A NAME="ch24index53"></A><A NAME="ch24index54"></A><A NAME="ch24index55"></A></p>
<A NAME="ch24lev2sec3"></A><H4 class="docSection2Title">Global Trace</H4>
<P class="docText">Global trace information is used to service DB2. Global trace records information regarding entries and exits from internal DB2 modules as well as other information about DB2 internals. It is not accessible through tools that monitor DB2 performance. Most sites will never need to use the DB2 global trace. You should avoid it unless an IBM representative requests that your shop initiate it.<A NAME="ch24index56"></A><A NAME="ch24index57"></A><A NAME="ch24index58"></A><A NAME="ch24index59"></A></P>
<A NAME="ch24note02"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">IBM states that the global trace can add up to 100% CPU overhead to your DB2 subsystem.</P></div><br>
<A NAME="ch24lev2sec4"></A><H4 class="docSection2Title">Monitor Trace</H4>
<P class="docText">An amalgamation of useful performance monitoring information is recorded by the DB2 monitor trace. Most of the information in a monitor trace is also provided by other types of DB2 traces. The primary reason for the existence of the monitor trace type is to enable you to write application programs that provide online monitoring of DB2 performance.<A NAME="ch24index60"></A><A NAME="ch24index61"></A><A NAME="ch24index62"></A><A NAME="ch24index63"></A></P>
<P class="docText">Information provided by the monitor trace includes the following:</P>
<UL><LI><P class="docList">DB2 statistics trace information</P></LI><LI><P class="docList">DB2 accounting trace information</P></LI><LI><P class="docList">Information about current SQL statements</P></LI></UL>
<P class="docText">There are ten groups of DB2 monitor trace classes:</P>
<BLOCKQUOTE><P><p class="docText"><span class="docEmphRoman">Class 1</span>— 
Activate the READS IFCIDs<A NAME="ch24index64"></A></p></P><P><p class="docText"><span class="docEmphRoman">Class 2</span>— 
Entry or exit from DB2 events</p></P><P><p class="docText"><span class="docEmphRoman">Class 3</span>— 
DB2 wait for I/O or locks</p></P><P><p class="docText"><span class="docEmphRoman">Class 4</span>— 
Installation-defined monitor trace record</p></P><P><p class="docText"><span class="docEmphRoman">Class 5</span>— 
Time spent processing IFI requests</p></P><P><p class="docText"><span class="docEmphRoman">Class 6</span>— 
Changes to tables created with <TT>DATA CAPTURE CHANGES</TT></p></P><P><p class="docText"><span class="docEmphRoman">Class 7</span>— 
Entry or exit from event signaling package or DBRM accounting</p></P><P><p class="docText"><span class="docEmphRoman">Class 8</span>— 
Wait time for a package</p></P><P><p class="docText"><span class="docEmphRoman">Class 9 thru 29</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 30 thru 32</span>— 
Local use</p></P></BLOCKQUOTE>
<p class="docText"><span class="docEmphasis">Estimated overhead</span>: 
The overhead that results from the monitor trace depends on how it is used at your site. If, as recommended, class 1 is always active, and classes 2 and 3 are started and stopped as required, the overhead is minimal (approximately 2 to 5%, depending on the activity of the DB2 system and the number of times that the other classes are started and stopped). However, if your installation makes use of the reserved classes (30 through 32) or additional classes (as some vendors do), your site will incur additional overhead.<A NAME="ch24index65"></A><A NAME="ch24index66"></A><A NAME="ch24index67"></A><A NAME="ch24index68"></A><A NAME="ch24index69"></A></p>
<A NAME="ch24note03"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">Some online performance monitoring tools do not use the monitor trace; instead, they read the information directly from the DB2 control blocks. Sampling DB2 control blocks requires less overhead than a monitor trace.<A NAME="ch24index70"></A><A NAME="ch24index71"></A><A NAME="ch24index72"></A><A NAME="ch24index73"></A></P></div><br>
<A NAME="ch24lev2sec5"></A><H4 class="docSection2Title">Performance Trace</H4>
<P class="docText">The DB2 performance trace records an abundance of information about all types of DB2 events. You should use it only after you have exhausted all other avenues of monitoring and tuning because it consumes a great deal of system resources.<A NAME="ch24index74"></A><A NAME="ch24index75"></A><A NAME="ch24index76"></A><A NAME="ch24index77"></A></P>
<P class="docText">When a difficult problem persists, the performance trace can provide valuable information, including the following:</P>
<UL><LI><P class="docList">Text of the SQL statement</P></LI><LI><P class="docList">Complete trace of the execution of SQL statements, including details of all events (cursor creation and manipulation, actual reads and writes, fetches, and so on) associated with the execution of the SQL statement</P></LI><LI><P class="docList">All index accesses</P></LI><LI><P class="docList">All data access due to referential constraints</P></LI></UL>
<P class="docText">There are twenty groups of DB2 performance trace classes:<A NAME="ch24index78"></A></P>
<BLOCKQUOTE><P><p class="docText"><span class="docEmphRoman">Class 1</span>— 
Background events</p></P><P><p class="docText"><span class="docEmphRoman">Class 2</span>— 
Subsystem events</p></P><P><p class="docText"><span class="docEmphRoman">Class 3</span>— 
<TT>SQL events</TT></p></P><P><p class="docText"><span class="docEmphRoman">Class 4</span>— 
Reads to and writes from buffer pools and the EDM pool</p></P><P><p class="docText"><span class="docEmphRoman">Class 5</span>— 
Writes to log or archive log</p></P><P><p class="docText"><span class="docEmphRoman">Class 6 and 7</span>— 
Summary (6) and detailed (7) lock information</p></P><P><p class="docText"><span class="docEmphRoman">Class 8</span>— 
Data scanning detail</p></P><P><p class="docText"><span class="docEmphRoman">Class 9</span>— 
Sort detail</p></P><P><p class="docText"><span class="docEmphRoman">Class 10</span>— 
Detail on <TT>BIND</TT>, commands, and utilities</p></P><P><p class="docText"><span class="docEmphRoman">Class 11</span>— 
Execution</p></P><P><p class="docText"><span class="docEmphRoman">Class 12</span>— 
Storage manager</p></P><P><p class="docText"><span class="docEmphRoman">Class 13</span>— 
Edit and validation exits</p></P><P><p class="docText"><span class="docEmphRoman">Class 14</span>— 
Entry from and exit to an application</p></P><P><p class="docText"><span class="docEmphRoman">Class 15</span>— 
Installation-defined performance trace record</p></P><P><p class="docText"><span class="docEmphRoman">Class 16</span>— 
Distributed processing</p></P><P><p class="docText"><span class="docEmphRoman">Class 17</span>— 
Claim and drain information</p></P><P><p class="docText"><span class="docEmphRoman">Class 18 thru 19</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 20 and 21</span>— 
Data sharing coherency summary (20) and detail (21)</p></P><P><p class="docText"><span class="docEmphRoman">Class 23 thru 29</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 30 thru 32</span>— 
Local use</p></P></BLOCKQUOTE>
<p class="docText"><span class="docEmphasis">Estimated overhead</span>: 
When all DB2 performance trace classes are active, as much as 100% CPU overhead can be incurred by each program being traced. The actual overhead might be greater if the system has a large amount of activity. Furthermore, due to the large number of trace records cut by the DB2 performance trace, systemwide (DB2 and non-DB2) performance might suffer because of possible SMF or GTF contention. The overhead when using only classes 1, 2, and 3, however, ranges from 20 to 30% rather than 100%<A NAME="ch24index79"></A><A NAME="ch24index80"></A><A NAME="ch24index81"></A><A NAME="ch24index82"></A><A NAME="ch24index83"></A></p>
<A NAME="ch24lev2sec6"></A><H4 class="docSection2Title">Statistics Trace</H4>
<P class="docText">Information pertaining to the entire DB2 subsystem is recorded in statistics trace records. This information is particularly useful for measuring the activity and response of DB2 as a whole. Information on the utilization and status of the buffer pools, DB2 locking, DB2 logging, and DB2 storage is accumulated.<A NAME="ch24index84"></A><A NAME="ch24index85"></A><A NAME="ch24index86"></A><A NAME="ch24index87"></A></P>
<P class="docText">There are ten groups of DB2 statistics trace classes:<A NAME="ch24index88"></A></P>
<BLOCKQUOTE><P><p class="docText"><span class="docEmphRoman">Class 1</span>— 
Statistics data</p></P><P><p class="docText"><span class="docEmphRoman">Class 2</span>— 
Installation-defined statistics record</p></P><P><p class="docText"><span class="docEmphRoman">Class 3</span>— 
Data on deadlocks, lock escalation, group buffers, data set extension, long-running units of recovery, and active log shortage</p></P><P><p class="docText"><span class="docEmphRoman">Class 4</span>— 
Exceptional conditions</p></P><P><p class="docText"><span class="docEmphRoman">Class 5</span>— 
Data sharing statistics</p></P><P><p class="docText"><span class="docEmphRoman">Class 6</span>— 
Storage usage</p></P><P><p class="docText"><span class="docEmphRoman">Class 7</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 8</span>— 
Data set I/O</p></P><P><p class="docText"><span class="docEmphRoman">Class 9 thru 29</span>— 
Reserved</p></P><P><p class="docText"><span class="docEmphRoman">Class 30 thru 32</span>— 
Local use</p></P></BLOCKQUOTE>
<p class="docText"><span class="docEmphasis">Estimated overhead</span>: 
An average of 2% CPU overhead per transaction.<A NAME="ch24index89"></A></p>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch24.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch24lev1sec2.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
