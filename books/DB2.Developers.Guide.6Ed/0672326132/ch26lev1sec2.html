<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Real Time Statistics</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch26lev1sec1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch26lev1sec3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch26lev1sec2"></A><H3 class="docSection1Title">Real Time Statistics</H3>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td width="60" valign="top"><IMG BORDER="0" width="30" height="18" SRC="images/0672326132/graphics/V7_icon.gif" ALT="graphics/V7_icon.gif"></td><td valign="top"><P class="docText"> Real Time Statistics (RTS) is the first step in IBM's grand plans to automate parts of DB2 database administration. Introduced after the general availability of Version 7, but before Version 8, RTS provides functionality that maintains statistics about DB2 databases "on the fly," without having to run a utility program.<A NAME="ch26index211"></A><A NAME="ch26index212"></A><A NAME="ch26index213"></A></P></td></tr></table><br>
<P class="docText">Prior to the introduction of RTS, the only way to gather statistics about DB2 database structures was by running the <TT>RUNSTATS</TT> utility. As discussed in <A class="docLink" HREF="ch34.html#ch34">Chapter 34</A>, "Catalog Manipulation Utilities," <TT>RUNSTATS</TT> collects statistical information about DB2 database objects and stores this data in the DB2 Catalog. RTS, on the other hand, runs in the background and automatically updates statistics in two special tables as the data in DB2 databases is modified. Where <TT>RUNSTATS</TT> is a hands-on administrative process, RTS is hands-off.</P>
<A NAME="ch26note16"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">Real Time Statistics was announced with APARs <TT>PQ48447</TT>, <TT>PQ48448</TT>, <TT>PQ46859</TT>, and <TT>PQ56256</TT>.</P></div><br>
<A NAME="ch26lev2sec9"></A><H4 class="docSection2Title">The RTS Tables</H4>
<P class="docText">Although DB2 is always collecting RTS data, nothing is externalized until you set up the RTS database and tables to store the real time statistics. The RTS database is named <TT>DSNRTSDB</TT> and there is one table space (<TT>DSNRTSTS</TT>) with two tables:<A NAME="ch26index214"></A><A NAME="ch26index215"></A></P>
<BLOCKQUOTE><P><p class="docText"><TT>SYSIBM.TABLESPACESTATS</TT>— 
Contains statistics on tablespaces and tablespace partitions</p></P><P><p class="docText"><TT>SYSIBM.INDEXSPACESTATS</TT>— 
Contains statistics on index spaces and index space partitions</p></P></BLOCKQUOTE>
<P class="docText"><A class="docLink" HREF="#ch26table02">Tables 26.2</A> and <A class="docLink" HREF="#ch26table03">26.3</A> describe the columns of these two tables. Each table has a unique index defined on it. Both are defined on the <TT>DBID</TT>, <TT>PSID</TT>, and <TT>PARTITION</TT> columns. The indexes' names are</P>
<BLOCKQUOTE><P><P class="docList"><TT>SYSIBM.TABLESPACESTATS_IX</TT></P></P><P><P class="docList"><TT>SYSIBM.INDEXSPACESTATS_IX</TT></P></P></BLOCKQUOTE>
<A NAME="ch26table02"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 26.2. <TT>SYSIBM.TABLESPACESTATS</TT> Columns</h5></CAPTION><COLGROUP><COL width="137.5"><COL width="412.5"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Column</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Description</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DBNAME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Database name.<A NAME="ch26index221"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NAME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Tablespace name.<A NAME="ch26index222"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PARTITION</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The data set number within the tablespace. For partitioned tablespaces, contains the partition number for a single partition. For non-partitioned tablespaces, contains 0.<A NAME="ch26index223"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DBID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Internal database identifier.<A NAME="ch26index224"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PSID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Internal page set identifier (for the tablespace).<A NAME="ch26index225"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATESTATSTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The timestamp when this statistics row was inserted or last updated.<A NAME="ch26index226"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TOTALROWS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The total number of rows or LOBs in the tablespace or partition. Indicates the number of rows in all tables for multi-table tablespaces.<A NAME="ch26index227"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NACTIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of active pages in the tablespace or partition. Indicates the total number of preformatted pages in all data sets for multi-piece tablespaces.<A NAME="ch26index228"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The amount of space (in kilobytes) that is allocated to the tablespace or partition. Indicates the amount of space in all data sets for multi-piece linear page sets.<A NAME="ch26index229"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXTENTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of extents used by the tablespace or partition. Indicates the number of extents for the last data set for multi-piece tablespaces. For a data set that is striped across multiple volumes, the value is the number of logical extents.<A NAME="ch26index230"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LOADRLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The timestamp when the last <TT>LOAD REPLACE</TT> was run for the tablespace or partition.<A NAME="ch26index231"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The timestamp when the last <TT>REORG</TT> was run on the tablespace or partition.<A NAME="ch26index232"></A><A NAME="ch26index233"></A><A NAME="ch26index234"></A><A NAME="ch26index235"></A><A NAME="ch26index236"></A><A NAME="ch26index237"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGINSERTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of records or LOBs that have been inserted since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> was run on the tablespace or partition.<A NAME="ch26index238"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGDELETES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of records or LOBs that have been deleted since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> on the tablespace or partition.<A NAME="ch26index239"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGUPDATES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of rows that have been updated since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> was run on the tablespace or partition. Does not include LOB updates because they are implemented as deletions followed by insertions.<A NAME="ch26index240"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGDISORGLOB</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of LOBs that were inserted since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> that are not perfectly chunked. A LOB is perfectly chunked if the allocated pages are in the minimum number of chunks.<A NAME="ch26index241"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGUNCLUSTINS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of records that were inserted since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> that are not <span class="docEmphasis">well-clustered</span> with respect to the clustering index. A record is well-clustered if the record is inserted into a page that is within 16 pages of the ideal candidate page.<A NAME="ch26index242"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGMASSDELETE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of mass deletes from a segmented or LOB tablespace, or the number of dropped tables from a segmented tablespace, since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> was run.<A NAME="ch26index243"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGNEARINDREF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of overflow records created and relocated near the pointer record since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> was run. For non-segmented tablespaces, a page is near the present page if the two page numbers differ by 16 or less. For segmented tablespaces, a page is near the present page if the two page numbers differ by <TT>SEGSIZE*2</TT> or less.<A NAME="ch26index244"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGFARINDREF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of overflow records created and relocated far from the pointer record since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT> was run. For non-segmented tablespaces, a page is far the present page if the two page numbers differ by more than 16. For segmented tablespaces, a page is far from the present page if the two page numbers differ by more than <TT>SEGSIZE*2</TT>.<A NAME="ch26index245"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The timestamp when <TT>RUNSTATS</TT> was last run on this tablespace or partition.<A NAME="ch26index246"></A><A NAME="ch26index247"></A><A NAME="ch26index248"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSINSERTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of records or LOBs that have been inserted since the last <TT>RUNSTATS</TT> was executed on this tablespace or partition.<A NAME="ch26index249"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSDELETES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of records or LOBs that have been deleted since the last <TT>RUNSTATS</TT> was executed on this tablespace or partition.<A NAME="ch26index250"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSUPDATES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of records or LOBs that have been updated since the last <TT>RUNSTATS</TT> was executed on this tablespace or partition.<A NAME="ch26index251"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSMASSDELETE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of mass deletes from a segmented or LOB tablespace, or the number of dropped tables from a segmented tablespace, since the last <TT>RUNSTATS</TT> was run.<A NAME="ch26index252"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The timestamp of the last full or incremental image copy on the tablespace or partition.<A NAME="ch26index253"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYUPDATEDPAGES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of distinct pages that have been updated since the last <TT>COPY</TT> was run.<A NAME="ch26index254"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYCHANGES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of <TT>INSERT</TT>, <TT>UPDATE</TT>, and <TT>DELETE</TT> operations since the last <TT>COPY</TT> was run.<A NAME="ch26index255"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYUPDATELRSN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The LRSN or RBA of the first update after the last <TT>COPY</TT> was run.<A NAME="ch26index256"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYUPDATETIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Specifies the timestamp of the first <TT>UPDATE</TT> made after the last <TT>COPY</TT> was run.<A NAME="ch26index257"></A><A NAME="ch26index258"></A><A NAME="ch26index259"></A><A NAME="ch26index260"></A><A NAME="ch26index261"></A><A NAME="ch26index262"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch26table03"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 26.3. <TT>SYSIBM.INDEXSPACESTATS</TT> Columns</h5></CAPTION><COLGROUP><COL width="154"><COL width="396"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Column</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Description</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DBNAME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Database name.<A NAME="ch26index268"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NAME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Index space name.<A NAME="ch26index269"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PARTITION</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The data set number within the index space. For partitioned index spaces, contains the partition number for a single partition. For non-partitioned index spaces, contains 0.<A NAME="ch26index270"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DBID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Internal database identifier.<A NAME="ch26index271"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ISOBID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Internal identifier of the index space page set descriptor.<A NAME="ch26index272"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PSID</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Internal page set identifier (for the tablespace holding the table on which this index was created).<A NAME="ch26index273"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UPDATESTATSTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The timestamp when this statistics row was inserted or last updated.<A NAME="ch26index274"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>TOTALENTRIES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of entries, including duplicates, in the index space or partition.<A NAME="ch26index275"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NLEVELS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of levels in the index tree.<A NAME="ch26index276"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NACTIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of active pages in the index space or partition.<A NAME="ch26index277"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The amount of space (in kilobytes) that is allocated to the index space or partition. Indicates the amount of space in all data sets for multi-piece linear page sets.<A NAME="ch26index278"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXTENTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of extents used by the index space or partition. Indicates the number of extents for the last data set for multi-piece tablespaces. For a data set that is striped across multiple volumes, the value is the number of logical extents.<A NAME="ch26index279"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LOADRLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Timestamp of the last <TT>LOAD REPLACE</TT> on the index space or partition.<A NAME="ch26index280"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REBUILDLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Timestamp of the last <TT>REBUILD INDEX</TT> on the index space or partition.<A NAME="ch26index281"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Timestamp of the last <TT>REORG INDEX</TT> on the index space or partition.<A NAME="ch26index282"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGINSERTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index entries that have been inserted since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT> on the index space or partition.<A NAME="ch26index283"></A><A NAME="ch26index284"></A><A NAME="ch26index285"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGDELETES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index entries that have been deleted since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT> on the index space or partition.<A NAME="ch26index286"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGAPPENDINSERT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index entries that have been inserted since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT> on the index space or partition that have a key value greater than the maximum key value in the index or partition.<A NAME="ch26index287"></A><A NAME="ch26index288"></A><A NAME="ch26index289"></A><A NAME="ch26index290"></A><A NAME="ch26index291"></A><A NAME="ch26index292"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGPSEUDODELETES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index entries that have been pseudo-deleted since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT> on the index space or partition.<A NAME="ch26index293"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGMASSDELETE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of times that an index or index space partition was mass deleted since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT>.<A NAME="ch26index294"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGLEAFNEAR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index page splits that occurred since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT> in which the higher part of the split page was near the location of the original page. The higher part is near the original page if the two page numbers differ by 16 or less.<A NAME="ch26index295"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGLEAFFAR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index page splits that occurred since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT> in which the higher part of the split page was far from the location of the original page. The higher part is far from the original page if the two page numbers differ by more than 16.<A NAME="ch26index296"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>REORGNUMLEVELS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of levels in the index tree that were added or removed since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT>.<A NAME="ch26index297"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Timestamp of the last <TT>RUNSTATS</TT> on the index space or partition.<A NAME="ch26index298"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSINSERTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index entries that have been inserted since the last <TT>RUNSTATS</TT> on the index space or partition.<A NAME="ch26index299"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSDELETES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of index entries that have been deleted since the last <TT>RUNSTATS</TT> on the index space or partition.<A NAME="ch26index300"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>STATSMASSDELETE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of times that the index or index space partition was mass deleted since the last <TT>RUNSTATS</TT>.<A NAME="ch26index301"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYLASTTIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Timestamp of the last full image copy on the index space or partition.<A NAME="ch26index302"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYUPDATEDPAGES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of distinct pages that have been updated since the last <TT>COPY</TT>.<A NAME="ch26index303"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYCHANGES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The number of <TT>INSERT</TT> and <TT>DELETE</TT> operations since the last <TT>COPY</TT>.<A NAME="ch26index304"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYUPDATELRSN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The LRSN or RBA of the first update after the last <TT>COPY</TT>.<A NAME="ch26index305"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COPYUPDATETIME</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Timestamp of the first update after the last <TT>COPY</TT>.<A NAME="ch26index306"></A><A NAME="ch26index307"></A><A NAME="ch26index308"></A><A NAME="ch26index309"></A><A NAME="ch26index310"></A><A NAME="ch26index311"></A><A NAME="ch26index312"></A><A NAME="ch26index313"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch26lev2sec10"></A><H4 class="docSection2Title">When Are Real Time Stats Externalized?</H4>
<P class="docText">As soon as RTS is applied (by running the proper version or maintenance level of DB2), DB2 begins to gather real-time statistics. However, the RTS tables must exist in order for DB2 to externalize the real-time statistics that it gathers.<A NAME="ch26index314"></A><A NAME="ch26index315"></A></P>
<P class="docText">After the RTS tables have been created and started, DB2 externalizes real-time statistics to the tables at the following times:</P>
<UL><LI><P class="docList">When the RTS database is stopped, DB2 first externalizes all RTS values from memory into the RTS tables before stopping the database.</P></LI><LI><P class="docList">When an individual RTS tablespace is stopped, DB2 first externalizes all RTS values for that particular tablespace from memory into the RTS tables before stopping the database. Keep in mind, though, that the default installation uses only a single tablespace to store both RTS tables.</P></LI><LI><P class="docList">When you issue <TT>-STOP DB2 MODE(QUIESCE)</TT>, DB2 first externalizes all RTS values. Of course, if you stop using <TT>MODE(FORCE)</TT>, no RTS values are externalized; instead, they are lost when DB2 comes down.</P></LI><LI><P class="docList">As specified by the DSNZPARM <TT>STATSINT</TT> value. The default is every 30 minutes.</P></LI><LI><P class="docList">During <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, <TT>COPY</TT>, and <TT>LOAD REPLACE</TT> utility operations, DB2 externalizes the appropriate RTS values affected by running that utility.</P></LI></UL>
<A NAME="ch26lev4sec5"></A><H5 class="docSection3Title">RTS Accuracy</H5>
<P class="docText">In certain situations, the RTS values might not be 100% accurate. Situations that can cause the real-time statistics to be off include<A NAME="ch26index316"></A><A NAME="ch26index317"></A></P>
<UL><LI><P class="docList">Sometimes a restarted utility can cause the RTS values to be wrong.</P></LI><LI><P class="docList">Utility operations that leave indexes in a restrictive state, such as <TT>RECOVER</TT> pending (<TT>RECP</TT>), will cause stats to be inaccurate.</P></LI><LI><P class="docList">A DB2 subsystem failure.</P></LI><LI><P class="docList">A notify failure in a data sharing environment.</P></LI></UL>
<P class="docText">To fix RTS statistics that are inaccurate, run a <TT>REORG</TT>, <TT>RUNSTATS</TT>, or <TT>COPY</TT> on the objects for which those stats are suspect.<A NAME="ch26index318"></A><A NAME="ch26index319"></A></P>
<A NAME="ch26note17"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">If you are using DB2 utilities from a third-party vendor other than IBM, be sure that those utilities work with RTS. The third-party utilities should be able both to reset the RTS values and use the RTS stats for recommending when to run utilities.</P></div><br>
<A NAME="ch26lev2sec11"></A><H4 class="docSection2Title"><TT>DSNACCOR</TT>: The RTS Stored Procedure</H4>
<P class="docText">IBM supplies a sample stored procedure called <TT>DSNACCOR</TT> that can be used to query the RTS tables and make recommendations based on the statistics. You can use <TT>DSNACCOR</TT> to recommend when to run a <TT>REORG</TT>, take an image copy, or run <TT>RUNSTATS</TT>. Additionally, <TT>DSNACCOR</TT> can report on the data set extents of tablespaces and index spaces as well as on objects in a restricted state.<A NAME="ch26index320"></A><A NAME="ch26index321"></A><A NAME="ch26index322"></A></P>
<P class="docText">You can specify parameters to indicate to <TT>DSNACCOR</TT> which tablespaces and indexes to analyze, or just run it without parameters to evaluate all tablespaces and index spaces in the subsystem.</P>
<A NAME="ch26note18"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">If the RTS values are inaccurate, the recommendations made by <TT>DSNACCOR</TT> will not be correct.</P>
<P class="docText">Also, <TT>DSNACCOR</TT> makes recommendations based on general formulas requiring user input about your maintenance policies. These recommendations might not be accurate for every installation or subsystem.</P></div><br>
<P class="docText">You should consider using <TT>DSNACCOR</TT> in conjunction with DB2 Control Center. Control Center provides a nice GUI interface to the parameters of <TT>DSNACCOR</TT>, making it easier to use than directly calling the procedure would be.<A NAME="ch26index323"></A><A NAME="ch26index324"></A><A NAME="ch26index325"></A></P>
<A NAME="ch26lev2sec12"></A><H4 class="docSection2Title">Using the Real Time Statistics</H4>
<P class="docText">The following RTS guidelines and queries can be used to help you identify maintenance and administration that needs to be carried out for database objects in your DB2 subsystems.</P>
<A NAME="ch26lev4sec6"></A><H5 class="docSection3Title">Checking for Activity</H5>
<P class="docText">Because real-time statistics are updated in an ongoing manner as DB2 operates, you can use them to see if any activity has occurred during a specific timeframe. To determine whether any activity has happened in the past several days for a particular tablespace or index, use the <TT>UPDATESTATSTIME</TT> column. Here is an example checking whether any activity has occurred in the past ten days for a tablespace (just supply the tablespace name):<A NAME="ch26index326"></A><A NAME="ch26index327"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, NAME, PARTITION, UPDATESTATSTIME
FROM     SYSIBM.TABLESPACESTATS
WHERE    UPDATESTATSTIME &gt; CURRENT TIMESTAMP - 10 DAYS
AND      NAME = ?;
</pre><BR>
<A NAME="ch26lev4sec7"></A><H5 class="docSection3Title">Basic Tablespace Information</H5>
<P class="docText">The RTS tables contain some good basic information about tablespaces. The following query can be run to report on the number of rows, active pages, space used, number of extents, and when the <TT>COPY</TT>, <TT>REORG</TT>, <TT>LOAD REPLACE</TT>, and <TT>RUNSTATS</TT> were last run:<A NAME="ch26index328"></A><A NAME="ch26index329"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, NAME, PARTITION, TOTALROWS, NACTIVE, 
         SPACE, EXTENTS, UPDATESTATSTIME, STATSLASTTIME,
         LOADRLASTTIME, REORGLASTTIME, COPYLASTTIME
FROM     SYSIBM.TABLESPACESTATS
ORDER BY DBNAME, NAME, PARTITION;
</pre><BR>
<P class="docText">You can add a <TT>WHERE</TT> clause to this query to limit the output to only a certain database or for specific tablespaces.</P>
<P class="docText">Pay particular attention to the timestamps indicating the last time that <TT>COPY</TT>, <TT>REORG</TT>, and <TT>RUNSTATS</TT> were run. If the date is sufficiently old, consider further investigating whether you should take an image copy, reorganize the tablespace, or run <TT>RUNSTATS</TT>.</P>
<P class="docText">Keep in mind though, that the span of time between utility runs is not the only indicator for when to copy, reorganize, or capture statistics. For example, <TT>RUNSTATS</TT> might need to be run only once on static data; similar caveats apply to <TT>COPY</TT> and <TT>REORG</TT> when data does not change.</P>
<A NAME="ch26lev4sec8"></A><H5 class="docSection3Title">Reorganizing Tablespaces</H5>
<P class="docText">Statistics that can help determine when to reorganize a tablespace include space allocated, extents, number of <TT>INSERT</TT>s, <TT>UPDATE</TT>s, and <TT>DELETE</TT>s since the last <TT>REORG</TT> or <TT>LOAD REPLACE</TT>, number of unclustered <TT>INSERT</TT>s, number of disorganized LOBs, and number of near and far indirect references created since the last <TT>REORG</TT>. The following query can be used to monitor reorganization RTS statistics:<A NAME="ch26index330"></A><A NAME="ch26index331"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, NAME, PARTITION, SPACE, EXTENTS, 
         REORGLASTTIME, REORGINSERTS, REORGDELETES, REORGUPDATES,
         REORGINSERTS+REORGDELETES+REORGUPDATES AS TOTAL_CHANGES,
         REORGDISORGLOB, REORGUNCLUSTINS, REORGMASSDELETE,
         REORGNEARINDREF, REORGFARINDREF
FROM     SYSIBM.TABLESPACESTATS
ORDER BY DBNAME, NAME, PARTITION;
</pre><BR>
<P class="docText">You might want to add a <TT>WHERE</TT> clause that limits the tablespaces returned to just those that exceed a particular limit. For example,</P>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="groups" CELLPADDING="5"><COLGROUP><COL width="253"><COL width="297"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Specify</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Description</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>WHERE EXTENTS &gt; 20</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Tablespaces having more than 20 extents</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>WHERE TOT_CHANGES &gt; 100000</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Tablespaces with more than 100K changes</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>WHERE REORGFARINDREF &gt; 50</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Tablespaces with more than 50 far indirect references</P></TD></TR></TABLE></P><br>
<P class="docText">Another way to get more creative with your RTS queries is to build formulas into them to retrieve only those tablespaces that need to be reorganized. For example, the following query will return only those tablespaces having more than 10% of their rows as near or far indirect references:</P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, NAME, PARTITION, SPACE, EXTENTS
FROM     SYSIBM.TABLESPACESTATS
WHERE    TOTALROWS &gt; 0
AND      (((REORGNEARINDREF + REORGFARINDREF)*100)/TOTALROWS) &gt; 10
ORDER BY DBNAME, NAME, PARTITION;
</pre><BR>
<P class="docText">Of course, you can change the percentage as you wish. After running the query, you have a list of tablespaces meeting your criteria for reorganization.</P>
<A NAME="ch26lev4sec9"></A><H5 class="docSection3Title">Examining the Impact of a Program</H5>
<P class="docText">You can use the <TT>TOTALROWS</TT> column of <TT>SYSIBM.TABLESPACESTATS</TT> to determine how many rows were impacted by a particular program or process. Simply check <TT>TOTALROWS</TT> for the tablespace both before and after the process; the difference between the values is the number of rows impacted.<A NAME="ch26index332"></A><A NAME="ch26index333"></A></P>
<A NAME="ch26lev4sec10"></A><H5 class="docSection3Title">When to Run <TT>RUNSTATS</TT> for a Tablespace</H5>
<P class="docText">There are also statistics to help in determining when <TT>RUNSTATS</TT> should be executed. Run the following query to show the number of <TT>INSERT</TT>s, <TT>UPDATE</TT>s, and <TT>DELETE</TT>s since the last <TT>RUNSTATS</TT> execution:<A NAME="ch26index334"></A><A NAME="ch26index335"></A><A NAME="ch26index336"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, NAME, PARTITION, STATSLASTTIME, 
         STATSINSERTS, STATSDELETES, STATSUPDATES,
         STATSINSERTS+STATSDELETES+STATSUPDATES AS TOTAL_CHANGES,
         STATSMASSDELETE
FROM     SYSIBM.TABLESPACESTATS
ORDER BY DBNAME, NAME, PARTITION;
</pre><BR>
<A NAME="ch26lev4sec11"></A><H5 class="docSection3Title">When to Take an Image Copy for a Tablespace</H5>
<P class="docText">You can issue the following query to report on statistics that will help you to determine whether a <TT>COPY</TT> is required: <A NAME="ch26index337"></A><A NAME="ch26index338"></A><A NAME="ch26index339"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, NAME, PARTITION, COPYLASTTIME, COPYUPDATEDPAGES, 
         COPYCHANGES, COPYUPDATELRSN, COPYUPDATETIME
FROM     SYSIBM.TABLESPACESTATS
ORDER BY DBNAME, NAME, PARTITION;
</pre><BR>
<P class="docText">Basically, as the number of distinct updated pages and changes since the last <TT>COPY</TT> execution increases, the need to take an image copy increases. A good rule of thumb to follow is when the percentage of updated pages since the last <TT>COPY</TT> is more than 25% of the active pages, then it is time to <TT>COPY</TT> the tablespace. You can add the following <TT>WHERE</TT> clause to the previous query to limit the output to only these tablespaces:</P>
<pre>

</pre><BR><pre>
WHERE ((COPYUPDATEDPAGES*100) / NACTIVE) &gt; 25
</pre><BR>
<A NAME="ch26lev4sec12"></A><H5 class="docSection3Title">Basic Index Space Information</H5>
<P class="docText">Do not forget that there are also RTS statistics gathered on indexes. The following query can be run to report on the number of rows, active pages, space used, number of extents, and when the <TT>COPY</TT>, <TT>REORG</TT>, <TT>LOAD REPLACE</TT>, and <TT>RUNSTATS</TT> were last run:<A NAME="ch26index340"></A><A NAME="ch26index341"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, INDEXSPACE, PARTITION, TOTALENTRIES, NLEVELS, NACTIVE, 
         SPACE, EXTENTS, UPDATESTATSTIME, LOADRLASTTIME, REBUILDLASTTIME,
         REORGLASTTIME, STATSLASTTIME, COPYLASTTIME
FROM     SYSIBM.INDEXSPACESTATS
ORDER BY DBNAME, INDEXSPACE, PARTITION;
</pre><BR>
<A NAME="ch26lev4sec13"></A><H5 class="docSection3Title">Reorganizing Index Spaces</H5>
<P class="docText">Just like the tablespace stats, there are index space statistics that can be used to determine when to reorganize indexes. These statistics include the last time <TT>REBUILD</TT>, <TT>REORG</TT>, or <TT>LOAD REPLACE</TT> occurred, as well as statistics showing the number of <TT>INSERT</TT>s and <TT>DELETE</TT>s since the last <TT>REORG</TT> or <TT>REBUILD</TT>. RTS does not skimp in the details. You get both real and pseudo <TT>DELETE</TT>s, as well as both singleton and mass <TT>DELETE</TT> information. RTS also tracks both the number of index levels and index page split information resulting in near and far indirect references since the last <TT>REORG</TT>, <TT>REBUILD INDEX</TT>, or <TT>LOAD REPLACE</TT>. The following query can be used to return this information:<A NAME="ch26index342"></A><A NAME="ch26index343"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, INDEXSPACE, PARTITION, 
         REORGLASTTIME, LOADRLASTTIME, REBUILDLASTTIME,
         TOTALENTRIES, NACTIVE, SPACE, EXTENTS, 
         NLEVELS, REORGNUMLEVELS, 
         REORGINSERTS, REORGAPPENDINSERT,
         REORGDELETES, REORGPSEUDODELETES, REORGMASSDELETE, 
         REORGLEAFNEAR, REORGLEAFFAR
FROM     SYSIBM.INDEXSPACESTATS
ORDER BY DBNAME, INDEXSPACE, PARTITION;
</pre><BR>
<P class="docText">These statistics can be examined after running jobs or processes that cause heavy data modification.</P>
<A NAME="ch26note19"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">Pay particular attention to the <TT>REORGAPPENDINSERT</TT> column. It contains the number of inserts into an index since the last <TT>REORG</TT> for which the index key was higher than any existing key value. If this column consistently grows, you have identified an object where data is inserted using an ascending key sequence. Think about lowering the free space for such objects, because the free space is wasted space if inserts are always done in ascending key sequence.</P></div><br>
<A NAME="ch26lev4sec14"></A><H5 class="docSection3Title">When to Run <TT>RUNSTATS</TT> for an Index Space</H5>
<P class="docText">RTS provides index space statistics to help determine when to run <TT>RUNSTATS</TT> similar to the tablespace statistics. Run the following query to show the number of <TT>INSERT</TT>s, <TT>UPDATE</TT>s, and <TT>DELETE</TT>s since the last <TT>RUNSTATS</TT> execution:<A NAME="ch26index344"></A><A NAME="ch26index345"></A><A NAME="ch26index346"></A></P>
<pre>

</pre><BR><pre>
SELECT   DBNAME, NAME, PARTITION, STATSLASTTIME, 
         STATSINSERTS, STATSDELETES, STATSMASSDELETE
FROM     SYSIBM.TABLESPACESTATS
ORDER BY DBNAME, NAME, PARTITION;
</pre><BR>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch26lev1sec1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch26lev1sec3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
