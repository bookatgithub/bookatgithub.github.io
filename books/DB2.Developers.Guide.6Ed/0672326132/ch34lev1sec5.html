<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>The RUNSTATS Utility</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch34lev1sec4.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch34lev1sec6.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch34lev1sec5"></A><H3 class="docSection1Title">The <TT>RUNSTATS</TT> Utility</H3>
<P class="docText">The <TT>RUNSTATS</TT> utility collects statistical information for DB2 tables, table spaces, partitions, indexes, and columns. It can place this information into DB2 Catalog tables or simply produce a report of the statistical information. The statistics in these tables are used for two primary reasons: to provide organizational information for DBAs and to be used as input to the DB2 optimizer during the <TT>BIND</TT> process to determine optimal access paths for SQL queries. The statistical information can also be queried using SQL. Several sample DB2 Catalog queries were presented in <A class="docLink" HREF="ch26.html#ch26">Chapter 26</A>, "DB2 Object Monitoring Using the DB2 Catalog and RTS." The diagram in <A class="docLink" HREF="#ch34fig01">Figure 34.1</A> details the functionality of the <TT>RUNSTATS</TT> utility.<A NAME="ch34index111"></A><A NAME="ch34index112"></A><A NAME="ch34index113"></A><A NAME="ch34index114"></A><A NAME="ch34index115"></A><A NAME="ch34index116"></A></P>
<A NAME="ch34fig01"></A><p><CENTER><H5 class="docFigureTitle">Figure 34.1. The <TT>RUNSTATS</TT> utility.</H5>
<p class="docText"><div class="v1"><a target="_blank" href="images/0672326132/graphics/34fig01_alt.gif">[View full size image]</a></div><IMG BORDER="0"  width="500" height="498" SRC="images/0672326132/graphics/34fig01.gif" ALT="graphics/34fig01.gif"></p></CENTER></p><br>
<P class="docText">You can use the <TT>RUNSTATS</TT> utility to</P>
<UL><LI><P class="docList">Produce a statistics report without updating the DB2 Catalog tables</P></LI><LI><P class="docList">Update the DB2 Catalog with only DB2 optimizer statistics</P></LI><LI><P class="docList">Update the DB2 Catalog with only DBA monitoring statistics</P></LI><LI><P class="docList">Update the DB2 Catalog with all the statistics that have been gathered</P></LI></UL>
<P class="docText">This flexibility can be useful when you want to determine the effect of <TT>RUNSTATS</TT> on specific SQL queries—without updating the current useable statistics. Also, if the statistics used by the DB2 optimizer have been modified, <TT>RUNSTATS</TT> can still be run to gather the DBA monitoring statistics.</P>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td width="60" valign="top"><IMG BORDER="0"  width="30" height="18" SRC="images/0672326132/graphics/V8_icon.gif" ALT="graphics/V8_icon.gif"></td><td valign="top"><P class="docText"> Additionally, as of DB2 V8, you can execute <TT>RUNSTATS</TT> specifying <TT>UPDATE NONE</TT> and <TT>REPORT NO</TT>. In this case, <TT>RUNSTATS</TT> neither reports on, nor updates the statistics in the catalog. This option is available to simply invalidate the dynamic SQL statement cache. Executing <TT>RUNSTATS</TT> always invalidates the dynamic cache, but prior to V8 you were forced either to update the statistics in the DB2 Catalog or produce a report of the statistics.<A NAME="ch34index117"></A><A NAME="ch34index118"></A><A NAME="ch34index119"></A><A NAME="ch34index120"></A><A NAME="ch34index121"></A><A NAME="ch34index122"></A><A NAME="ch34index123"></A></P></td></tr></table><br>
<P class="docText">Consult <A class="docLink" HREF="#ch34table01">Tables 34.1</A> and <A class="docLink" HREF="#ch34table02">34.2</A> for a breakdown of the types of statistics gathered by <TT>RUNSTATS</TT>. The information in this table is accurate as of DB2 V8.</P>
<A NAME="ch34table01"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 34.1. <TT>RUNSTATS</TT> Statistics Used to Determine Access Paths</h5></CAPTION><COLGROUP><COL width="165"><COL width="143"><COL width="242"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">DB2 Catalog Table</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Column</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Description</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top" rowspan="4"><P class="docText"><TT>SYSIBM.SYSTABLES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of rows for a table</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NPAGES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of pages on which rows of this table appear</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NPAGESF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Total number of pages used by the table</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PCTROWCOMP</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Percentage of total active rows that are compressed for this table</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top" rowspan="2"><P class="docText"><TT>SYSIBM.SYSTABSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of rows in the table space partition</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NPAGES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of pages used by the table spacepartition</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NACTIVEF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of allocated table space pages (or <TT>NACTIVE</TT>)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top" rowspan="3"><P class="docText"><TT>SYSIBM.SYSCOLUMNS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LOW2KEY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Second lowest value for the column</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>HIGH2KEY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Second highest value for the column</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COLCARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of distinct values for the column</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top" rowspan="5"><P class="docText"><TT>SYSIBM.SYSCOLDIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of distinct values for the column group</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COLVALUE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Nonuniform distribution column value</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FREQUENCYF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Percentage (* 100) that the value in <TT>EXITPARM</TT> exists in the column</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NUMCOLUMNS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of columns associated with the statistics</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>COLGROUPCOLNO</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Identifies the set of columns associated with the statistics</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top" rowspan="6"><P class="docText"><TT>SYSIBM.SYSINDEXES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CLUSTERRATIOF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Percentage of rows in clustered order (when multiplied by 100)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CLUSTERING</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Whether <TT>CLUSTER</TT> was specified when the index was created</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FIRSTKEYCARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of distinct values for the first column of the index key</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FULLKEYCARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of distinct values for the full index key</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NLEAF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of active leaf pages</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NLEVELS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of index b-tree levels<A NAME="ch34index128"></A><A NAME="ch34index129"></A><A NAME="ch34index130"></A><A NAME="ch34index131"></A><A NAME="ch34index132"></A><A NAME="ch34index133"></A><A NAME="ch34index134"></A><A NAME="ch34index135"></A><A NAME="ch34index136"></A><A NAME="ch34index137"></A><A NAME="ch34index138"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch34table02"></A><P><TABLE CELLSPACING="0" FRAME="hsides" RULES="groups" CELLPADDING="5"><CAPTION><h5 class="docTableTitle">Table 34.2. <TT>RUNSTATS</TT> Statistics Used by DBAs for Monitoring and Tuning</h5></CAPTION><COLGROUP><COL width="183.33333333333331"><COL width="183.33333333333331"><COL width="183.33333333333331"></COLGROUP><THEAD><TR><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">DB2 Catalog Table</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Column</span></P></TH><TH class="bottomBorder thead" align="left" valign="top"><P class="docText"><span class="docEmphStrong">Description</span></P></TH></TR></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGROWLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average length of the rows for all tables in this table space</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGROWLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average length of the rows for this table</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLES_HIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGROWLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Historical average lengths of the rows for this table</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top" rowspan="14"><P class="docText"><TT>SYSIBM.SYSTABLEPART</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGROWLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average length of the rows for the tables in the table space</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of rows in the table space orpartition; or number of LOBs in the LOB table space</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSNUM</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of data sets</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXTENTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of data set extents</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NEARINDREF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of rows between 2 and 16 pages from their original page</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FARINDREF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of rows more than 16 pages from their original page</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PAGESAVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Percentage of pages saved due to data compression</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PERCACTIVE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Percentage of space that contains table rows in this table space</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PERCDROP</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Percentage of space used by rows from dropped tables</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The currently allocated space for all extents, in K; a value of <TT>–1</TT> means the data set was defined using <TT>DEFINE NO</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPACEF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The currently allocated space for all extents, in K</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PQTY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Primary space allocation in 4K blocks for the data set</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SQTY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Secondary space allocation in 4K blocks for the data set (<TT>SMALLINT</TT> format)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SQTYI</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Secondary space allocation in 4K blocks for the data set (<TT>INTEGER</TT> format)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLEPARTHIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGROWLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average length of the rows for the tables in the table space</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGKEYLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average length of the keys in the index</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXESHIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGKEYLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average historical length of the keys in the index</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top" rowspan="15"><P class="docText"><TT>SYSIBM.SYSINDEXPART</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGKEYLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average length of the keys in the index</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>CARDF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of rows referenced by the index or partition</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSNUM</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of data sets</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>EXTENTS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of data set extents</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LEAFDIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average distance between successive pages multiplied by 100<A NAME="ch34index143"></A><A NAME="ch34index144"></A><A NAME="ch34index145"></A><A NAME="ch34index146"></A><A NAME="ch34index147"></A><A NAME="ch34index148"></A><A NAME="ch34index149"></A><A NAME="ch34index150"></A><A NAME="ch34index151"></A><A NAME="ch34index152"></A><A NAME="ch34index153"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LEAFNEAR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of leaf pages located physically near a previous leaf page for successive active leaf pages</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>LEAFFAR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of leaf pages located physically far from a previous leaf page for successive active leaf pages</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The currently allocated space for all extents, in K; a value of <TT>–1</TT> means the data set was defined using <TT>DEFINE NO</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SPACEF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">The currently allocated space for all extents, in K</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PSEUDO_DEL_ENTRIES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of pseudo-deleted keys (that is, marked for deletion, but the data has not yet been deleted)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>NEAROFFPOSF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of times you must access a near-off page when accessing all rows in indexed order</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FAROFFPOSF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Number of times you must access a far-off page when accessing all rows in indexed order</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>PQTY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Primary space allocation in 4K blocks for the data set</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SQTY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Secondary space allocation in 4K blocks for the data set (<TT>SMALLINT</TT> format)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SQTYI</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Secondary space allocation in 4K blocks for the data set (<TT>INTEGER</TT> format)</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXPART_HIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>AVGKEYLEN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Average historical length of the keys in the index</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top" rowspan="2"><P class="docText"><TT>SYSIBM.SYSLOBSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>FREESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Amount of free space in the LOB table space</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>ORGRATIO</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Ratio of organization for the LOB table space; the greater the value exceeds 1, the lessorganized the LOB table space<A NAME="ch34index154"></A><A NAME="ch34index155"></A><A NAME="ch34index156"></A><A NAME="ch34index157"></A><A NAME="ch34index158"></A><A NAME="ch34index159"></A><A NAME="ch34index160"></A><A NAME="ch34index161"></A><A NAME="ch34index162"></A><A NAME="ch34index163"></A><A NAME="ch34index164"></A></P></TD></TR></TABLE></P><br>
<A NAME="ch34lev2sec5"></A><H4 class="docSection2Title">The Two Options for Running <TT>RUNSTATS</TT></H4>
<P class="docText">There are two options for running <TT>RUNSTATS</TT>: You can collect statistics either at the table space level or at the index level. Additionally, you can execute <TT>RUNSTATS</TT> at the partition level for both table spaces and indexes (including data-partitioned secondary indexes).<A NAME="ch34index165"></A><A NAME="ch34index166"></A><A NAME="ch34index167"></A><A NAME="ch34index168"></A><A NAME="ch34index169"></A><A NAME="ch34index170"></A><A NAME="ch34index171"></A></P>
<A NAME="ch34note07"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">When <TT>RUNSTATS</TT> are collects on a single partition, the partition-level statistics are used to update the aggregate statistics for the entire object.</P></div><br>
<P class="docText">When collecting statistics at the table space level, you can optionally specify tables, indexes, and specific columns. <A class="docLink" HREF="#ch34list04">Listing 34.4</A> shows <TT>RUNSTATS</TT> JCL executing the <TT>RUNSTATS</TT> utility twice: once for the <TT>DSN8810.DEPT</TT> table space and all its indexes and a second time for the <TT>DSN8810.EMP</TT> table and several of its columns.<A NAME="ch34index172"></A><A NAME="ch34index173"></A><A NAME="ch34index174"></A><A NAME="ch34index175"></A><A NAME="ch34index176"></A></P>
<A NAME="ch34list04"></A><H5 class="docExampleTitle">Listing 34.4. <TT>RUNSTATS TABLESPACE</TT> JCL</H5>

<PRE>
//DB2JOBU  JOB (UTILITY),'DB2 RUNSTATS',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*
//*            DB2 RUNSTATS TABLESPACE UTILITY
//*
//****************************************************************
//*
//UTIL EXEC DSNUPROC,SYSTEM=DSN,UID='STATSTS',UTPROC="
//*
//*  UTILITY INPUT CONTROL STATEMENTS
//*    1. The first statement accumulates statistics for the
//*       given table space based on the named index columns.
//*    2. The second statement accumulates statistics only for
//*       the named table and columns in the named table space.
//*
//DSNUPROC.SYSIN    DD  *
    RUNSTATS TABLESPACE DSN8D81A.DSN8S81D
        INDEX (ALL)     SHRLEVEL REFERENCE
    RUNSTATS TABLESPACE DSN8D81A.DSN8S81E
        TABLE (DSN8810.EMO)
        COLUMN (FIRSTNME,MIDINIT,LASTNAME,SALARY,BONUS,COMM)
        SHRLEVEL REFERENCE
/*
//
</PRE><BR>

<P class="docText">The other form of <TT>RUNSTATS</TT> operates at the index level. <A class="docLink" HREF="#ch34list05">Listing 34.5</A> offers sample JCL to execute <TT>RUNSTATS</TT> for a specific DB2 index.<A NAME="ch34index177"></A><A NAME="ch34index178"></A><A NAME="ch34index179"></A><A NAME="ch34index180"></A><A NAME="ch34index181"></A></P>
<A NAME="ch34list05"></A><H5 class="docExampleTitle">Listing 34.5. <TT>RUNSTATS INDEX</TT> JCL</H5>

<PRE>
//DB2JOBU  JOB (UTILITY),'DB2 RUNS IX',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*
//*            DB2 RUNSTATS INDEX UTILITY
//*
//****************************************************************
//*
//UTIL EXEC DSNUPROC,SYSTEM=DSN,UID='STATSIX',UTPROC="
//*
//*  UTILITY INPUT CONTROL STATEMENTS
//*       The RUNSTATS statement accumulates statistics for the
//*       given index.
//*
//DSNUPROC.SYSIN    DD  *
    RUNSTATS INDEX (DSN8810.XEMPPROJACT2)
/*
//<A NAME="ch34index182"></A><A NAME="ch34index183"></A><A NAME="ch34index184"></A><A NAME="ch34index185"></A><A NAME="ch34index186"></A><A NAME="ch34index187"></A><A NAME="ch34index188"></A>
</PRE><BR>

<A NAME="ch34lev2sec6"></A><H4 class="docSection2Title"><TT>RUNSTATS</TT> Phases</H4>
<P class="docText">The <TT>RUNSTATS</TT> utility has three phases:<A NAME="ch34index189"></A><A NAME="ch34index190"></A><A NAME="ch34index191"></A><A NAME="ch34index192"></A><A NAME="ch34index193"></A><A NAME="ch34index194"></A><A NAME="ch34index195"></A></P>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5"><COLGROUP><COL width="275"><COL width="275"></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UTILINIT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Sets up and initializes the <TT>RUNSTATS</TT> utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>RUNSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Samples the table space data, the index data, or both, and then updates the DB2 Catalog tables with the statistical information</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>UTILTERM</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Performs the final utility cleanup</P></TD></TR></TABLE></P><br>
<A NAME="ch34lev2sec7"></A><H4 class="docSection2Title"><TT>RUNSTATS</TT> Locking Considerations</H4>
<P class="docText">The <TT>RUNSTATS</TT> utility, regardless of whether it is being run to collect <TT>TABLESPACE</TT> statistics or <TT>INDEX</TT> statistics, can operate concurrently with the following utilities:<A NAME="ch34index196"></A><A NAME="ch34index197"></A><A NAME="ch34index198"></A><A NAME="ch34index199"></A><A NAME="ch34index200"></A><A NAME="ch34index201"></A><A NAME="ch34index202"></A><A NAME="ch34index203"></A></P>
<UL><LI><P class="docList"><TT>CHECK DATA DELETE NO</TT></P></LI><LI><P class="docList"><TT>CHECK INDEX</TT></P></LI><LI><P class="docList"><TT>CHECK LOB</TT></P></LI><LI><P class="docList"><TT>COPY</TT></P></LI><LI><P class="docList"><TT>DIAGNOSE</TT></P></LI><LI><P class="docList"><TT>MERGECOPY</TT></P></LI><LI><P class="docList"><TT>MODIFY RECOVERY</TT></P></LI><LI><P class="docList"><TT>QUIESCE</TT></P></LI><LI><P class="docList"><TT>REORG TABLESPACE UNLOAD ONLY</TT></P></LI><LI><P class="docList"><TT>REPAIR</TT> (<TT>DUMP</TT> or <TT>MODIFY</TT>)</P></LI><LI><P class="docList"><TT>REPORT</TT></P></LI><LI><P class="docList"><TT>RUNSTATS</TT></P></LI><LI><P class="docList"><TT>STOSPACE</TT></P></LI><LI><P class="docList"><TT>UNLOAD</TT></P></LI></UL>
<P class="docText">Furthermore, <TT>RUNSTATS TABLESPACE</TT> can operate concurrently with <TT>RECOVER INDEX</TT>, <TT>REBUILD INDEX</TT>, <TT>REORG INDEX</TT>, and <TT>REPAIR LOCATE INDEX PAGE REPLACE</TT>.<A NAME="ch34index204"></A><A NAME="ch34index205"></A><A NAME="ch34index206"></A><A NAME="ch34index207"></A><A NAME="ch34index208"></A><A NAME="ch34index209"></A><A NAME="ch34index210"></A><A NAME="ch34index211"></A></P>
<P class="docText"><TT>RUNSTATS INDEX</TT> can be run concurrently with the following:</P>
<UL><LI><P class="docList"><TT>RECOVER TABLESPACE</TT> (no options)</P></LI><LI><P class="docList"><TT>RECOVER ERROR RANGE</TT></P></LI><LI><P class="docList"><TT>REPAIR LOCATE KEY</TT> or <TT>RID</TT> (<TT>DELETE</TT> or <TT>REPLACE</TT>), only if <TT>SHRLEVEL CHANGE</TT> is specified</P></LI><LI><P class="docList"><TT>REPAIR LOCATE TABLESPACE PAGE REPLACE</TT></P></LI></UL>
<P class="docText">When the <TT>RUNSTATS</TT> utility is executed with the <TT>SHRLEVEL REFERENCE</TT> option, it drains write claim classes to the table space, table space partition, index, or index partition. If <TT>SHRLEVEL CHANGE</TT> is specified, the <TT>RUNSTATS</TT> utility will claim the read claim class for the object being operated upon; however, no locking occurs if the object is a type 2 index.</P>
<A NAME="ch34lev2sec8"></A><H4 class="docSection2Title">DB2 Catalog Tables Updated by <TT>RUNSTATS</TT></H4>
<P class="docText">The actual DB2 Catalog tables and statistics that get updated by <TT>RUNSTATS</TT> vary depending on the <TT>RUNSTATS</TT> options specified, primarily the <TT>UPDATE</TT> option. There are three options that can be specified on the <TT>UPDATE</TT> parameter:<A NAME="ch34index212"></A><A NAME="ch34index213"></A><A NAME="ch34index214"></A><A NAME="ch34index215"></A><A NAME="ch34index216"></A><A NAME="ch34index217"></A><A NAME="ch34index218"></A><A NAME="ch34index219"></A></P>
<UL><LI><p class="docText">
<TT>ALL</TT>— 
Accumulates and updates all statistics related to the specified database object.</p></LI><LI><p class="docText">
<TT>ACCESSPATH</TT>— 
Accumulates and updates only the statistics that are relevant for access path determination for the specified database object.</p></LI><LI><p class="docText">
<TT>SPACE</TT>— 
Accumulates and updates only the space tuning statistics for the specified database object.</p></LI></UL>
<P class="docText">Now, if you execute <TT>RUNSTATS TABLESPACE</TT> using the <TT>UPDATE ALL</TT> option, the following DB2 Catalog tables are updated:</P>
<UL><LI><P class="docList"><TT>SYSTABLESPACE</TT></P></LI><LI><P class="docList"><TT>SYSTABLEPART</TT></P></LI><LI><P class="docList"><TT>SYSTABLES</TT></P></LI><LI><P class="docList"><TT>SYSTABSTATS</TT></P></LI><LI><P class="docList"><TT>SYSLOBSTATS</TT></P></LI></UL>
<P class="docText">However, if <TT>RUNSTATS TABLESPACE</TT> is run with the <TT>UPDATE ACCESSPATH</TT> option, only<TT>SYSTABLESPACE</TT>, <TT>SYSTABLES</TT>, and <TT>SYSTABSTATS</TT> are updated. If <TT>RUNSTATS TABLESPACE</TT> is run specifying <TT>UPDATE SPACE</TT>, then <TT>SYSTABSTATS</TT>, <TT>SYSTABLEPART</TT>, <TT>SYSTABLES</TT>, and <TT>SYSLOBSTATS</TT> are updated.</P>
<P class="docText">For <TT>RUNSTATS TABLE</TT> using either the <TT>UPDATE ALL</TT> or <TT>UPDATE ACCESSPATH</TT> option, <TT>SYSCOLUMNS</TT> and <TT>SYSCOLSTATS</TT> are updated.</P>
<P class="docText">When executing <TT>RUNSTATS INDEX</TT> using the <TT>UPDATE ACCESSPATH</TT> option, the following DB2 Catalog tables are updated:</P>
<UL><LI><P class="docList"><TT>SYSCOLUMNS</TT></P></LI><LI><P class="docList"><TT>SYSCOLDIST</TT></P></LI><LI><P class="docList"><TT>SYSCOLDISTSTATS</TT></P></LI><LI><P class="docList"><TT>SYSCOLSTATS</TT></P></LI><LI><P class="docList"><TT>SYSINDEXES</TT></P></LI><LI><P class="docList"><TT>SYSINDEXSTATS</TT></P></LI></UL>
<P class="docText"><TT>RUNSTATS INDEX</TT> specifying <TT>UPDATE SPACE</TT> modifies the <TT>SYSINDEXPART</TT> and <TT>SYSINDEXES</TT> DB2 Catalog tables. When specifying <TT>UPDATE ALL</TT>, all seven of these DB2 Catalog tables are updated.<A NAME="ch34index220"></A><A NAME="ch34index221"></A><A NAME="ch34index222"></A><A NAME="ch34index223"></A><A NAME="ch34index224"></A><A NAME="ch34index225"></A><A NAME="ch34index226"></A><A NAME="ch34index227"></A></P>
<A NAME="ch34lev2sec9"></A><H4 class="docSection2Title"><TT>RUNSTATS</TT> Guidelines</H4>
<P class="docText">Use the following tips and techniques to implement effective <TT>RUNSTATS</TT> jobs at your shop.</P>
<A NAME="ch34lev4sec11"></A><H5 class="docSection3Title">Execute <TT>RUNSTATS</TT> During Off-Peak Hours</H5>
<P class="docText"><TT>RUNSTATS</TT> can cause DB2 Catalog contention problems for a DB2 subsystem because it can update the following DB2 Catalog tables:<A NAME="ch34index228"></A><A NAME="ch34index229"></A><A NAME="ch34index230"></A></P>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5"><COLGROUP><COL width="275"><COL width="275"></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLDIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLDIST_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLDISTSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLUMNS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLUMNS_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXES_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXPART</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXPART_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXSTATS_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLES</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLES_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLEPART</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLEPART_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLESPACE</TT></P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABSTATS_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSLOBSTATS</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSLOBSTATS_HIST</TT></P></TD></TR></TABLE></P><br>
<P class="docText">Whenever possible, execute <TT>RUNSTATS</TT> during an off-peak period to avoid performance degradation.</P>
<A NAME="ch34lev4sec12"></A><H5 class="docSection3Title">Execute <TT>RUNSTATS</TT> Multiple Times for Long Column Lists</H5>
<P class="docText">A limit of 10 columns can be specified per <TT>RUNSTATS</TT> execution. If you must gather statistics on more than 10 columns, issue multiple executions of the <TT>RUNSTATS</TT> utility, specifying as many as 10 columns per run.<A NAME="ch34index231"></A><A NAME="ch34index232"></A><A NAME="ch34index233"></A></P>
<P class="docText">Of course, if you specify <TT>TABLE ALL</TT> (which is the default), information will be gathered for all columns of all tables in the table space. The above guidance to run <TT>RUNSTATS</TT> multiple times should be applied only if you are gathering statistics for more than 10 columns, but fewer than all of the columns.</P>
<A NAME="ch34lev4sec13"></A><H5 class="docSection3Title">Be Aware of DB2's Notion of Clustering</H5>
<P class="docText">Although the calculation of <TT>CLUSTER RATIO</TT> has not been published by IBM, DB2 does not weigh duplicate values the same as unique values. For example, consider a table with a <TT>SMALLINT</TT> column that contains the following values in the physical sequence indicated:<A NAME="ch34index234"></A><A NAME="ch34index235"></A><A NAME="ch34index236"></A></P>
<BLOCKQUOTE><P><P class="docList">1</P></P><P><P class="docList">3</P></P><P><P class="docList">4</P></P><P><P class="docList">95 occurrences of 7</P></P><P><P class="docList">6</P></P><P><P class="docList">9</P></P></BLOCKQUOTE>
<P class="docText">This would seem to be 99% clustered because 6 is the only value out of sequence. This is not the case, however, because of the complex algorithm DB2 uses for factoring duplicates into the <TT>CLUSTER RATIO</TT>.</P>
<A NAME="ch34lev4sec14"></A><H5 class="docSection3Title">Execute <TT>RUNSTATS</TT> After Significant Data Changes</H5>
<P class="docText">Run the <TT>RUNSTATS</TT> utility liberally. The cost of <TT>RUNSTATS</TT> usually is negligible for small- to medium-size table spaces. Moreover, the payback in optimized dynamic SQL, and static SQL when plans are re-bound using valid statistics, can be significant.<A NAME="ch34index237"></A><A NAME="ch34index238"></A><A NAME="ch34index239"></A></P>
<P class="docText">Running <TT>RUNSTATS</TT> can take longer on larger table spaces, so plan wisely before executing <TT>RUNSTATS</TT> for very large table spaces and indexes. However, you cannot avoid running <TT>RUNSTATS</TT> for larger objects because DB2 requires the statistics for formulating efficient access paths, perhaps even more so for larger objects.</P>
<P class="docText">Always schedule the running of the <TT>RUNSTATS</TT> utility for dynamic production data. This gives DB2 the most accurate volume data on which to base its access path selections. Discuss the frequency of production <TT>RUNSTATS</TT> jobs with your database administration unit.</P>
<P class="docText">For volatile tables, be sure to execute the <TT>RUNSTATS</TT> utility at least monthly.</P>
<A NAME="ch34note08"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">Be aware that <TT>RUNSTATS</TT> changes your statistics, which can change your DB2 access paths. If you are satisfied with the performance of your production, static SQL, you should use caution when rebinding those packages and plans against changed statistics.</P></div><br>
<A NAME="ch34lev4sec15"></A><H5 class="docSection3Title">Favor Using <TT>SHRLEVEL REFERENCE</TT></H5>
<P class="docText">To ensure the accuracy of the statistics gathered by <TT>RUNSTATS</TT>, favor the use of the <TT>SHRLEVEL REFERENCE</TT> option. For table spaces that must be online 24 hours a day, however, execute <TT>RUNSTATS</TT> with the <TT>SHRLEVEL CHANGE</TT> option during off-peak processing periods.<A NAME="ch34index240"></A><A NAME="ch34index241"></A><A NAME="ch34index242"></A><A NAME="ch34index243"></A></P>
<A NAME="ch34lev4sec16"></A><H5 class="docSection3Title">Use Good Judgment When Scheduling <TT>RUNSTATS</TT></H5>
<P class="docText">Although it may seem best to execute <TT>RUNSTATS</TT> to record each and every modification to DB2 table data, it is probably overkill. Not every data modification will affect performance. Deciding which will and which won't, however, is an arduous task requiring good judgment. Before running <TT>RUNSTATS</TT>, analyze the type of data in the table space, the scope of the change, and the number of changes. The overhead of running the <TT>RUNSTATS</TT> utility and the data availability needs of the application could make it impossible to run the utility as frequently as you want.<A NAME="ch34index244"></A><A NAME="ch34index245"></A><A NAME="ch34index246"></A><A NAME="ch34index247"></A><A NAME="ch34index248"></A><A NAME="ch34index249"></A><A NAME="ch34index250"></A><A NAME="ch34index251"></A></P>
<P class="docText">It is good practice to execute <TT>RUNSTATS</TT> in the following situations:</P>
<UL><LI><P class="docList">When new data is loaded into a table</P></LI><LI><P class="docList">When a new column is added to a table and is at least partially populated</P></LI><LI><P class="docList">When a new index is created</P></LI><LI><P class="docList">When a table space or index is reorganized</P></LI><LI><P class="docList">When a large number of data modifications have been applied to a particular table (updates, deletions, and/or insertions)</P></LI><LI><P class="docList">After recovering a table space or index</P></LI></UL>
<A NAME="ch34lev4sec17"></A><H5 class="docSection3Title">Do Not Avoid <TT>RUNSTATS</TT> Even When Changing Statistics Using SQL</H5>
<P class="docText">The DB2 optimizer is not perfect. Sometimes, DBAs alter the <TT>RUNSTATS</TT> information stored in the DB2 Catalog. This should be done only as a last resort.<A NAME="ch34index252"></A><A NAME="ch34index253"></A></P>
<P class="docText">Also, do not forgo the execution of <TT>RUNSTATS</TT> after modifying the DB2 Catalog statistics. At the least, <TT>RUNSTATS</TT> should be run to report on the current statistics, without updating the DB2 Catalog. However, this will make all the DB2 Catalog statistics for the table space outdated, not just the ones that need to be static. Therefore, consider running <TT>RUNSTATS</TT> to update the DB2 Catalog, regardless of whether the statistics have been modified, but follow the <TT>RUNSTATS</TT> job with a SQL <TT>UPDATE</TT>, <TT>INSERT</TT>, or <TT>DELETE</TT> statement to make the changes.</P>
<A NAME="ch34lev4sec18"></A><H5 class="docSection3Title">Consider Collecting Partition-Level Statistics</H5>
<P class="docText"><TT>RUNSTATS</TT> can be executed by partition, thereby collecting statistics for a table space a partition at a time. Employ this technique to collect statistics (over time) while increasing data availability. Additionally, consider collecting <TT>RUNSTATS</TT> more frequently for volatile partitions, and less frequently for other partitions.<A NAME="ch34index254"></A><A NAME="ch34index255"></A><A NAME="ch34index256"></A><A NAME="ch34index257"></A></P>
<A NAME="ch34lev4sec19"></A><H5 class="docSection3Title">Consider Sampling</H5>
<P class="docText">The <TT>SAMPLE</TT> parameter enables the <TT>RUNSTATS</TT> utility to use sampling methods to collect statistics instead of scanning every row in the table space, tables, and indexes specified. When sampling is specified, the overall resource consumption, CPU time, and elapsed time required by <TT>RUNSTATS</TT> can be substantially reduced. However, the accuracy of the collected statistics is impacted because only a subset of the rows are read to estimate statistics such as cardinality, high key value, and low key value.<A NAME="ch34index258"></A><A NAME="ch34index259"></A><A NAME="ch34index260"></A></P>
<P class="docText">In general, consider sampling only when <TT>RUNSTATS</TT> takes too much time to execute within the structure of your environment. Additionally, specify as high a sampling percentage as possible because the more data that is sampled, the more accurate the statistics are. For example</P>
<pre>

</pre><BR><pre>
RUNSTATS TABLESPACE DSN8D51A.DSN8S51D
    TABLE (ALL)     SAMPLE 50
</pre><BR>
<P class="docText">This statement causes <TT>RUNSTATS</TT> to use a sampling rate of 50% for the specified table space and tables.</P>
<A NAME="ch34lev4sec20"></A><H5 class="docSection3Title">Consider Collecting Frequent Value Statistics</H5>
<P class="docText">The <TT>KEYCARD</TT> and <TT>FREQVAL</TT> parameters can be used with <TT>RUNSTATS</TT> to gather frequent value statistics. DB2 typically views any two columns as independent from one another. However, frequent value statistics enable DB2 to capture information about correlated columns. Columns are considered to be correlated with one another when their values are related in some manner. Consider, for example, <TT>CITY</TT> and <TT>STATE</TT> columns. If the <TT>CITY</TT> column is set to <TT>CHICAGO</TT> it is much more common for the <TT>STATE</TT> to be set to <TT>IL</TT> than any other state. However, without frequent value statistics, DB2 would consider Chicago, FL to be just as common as Chicago, IL.<A NAME="ch34index261"></A><A NAME="ch34index262"></A><A NAME="ch34index263"></A><A NAME="ch34index264"></A><A NAME="ch34index265"></A><A NAME="ch34index266"></A><A NAME="ch34index267"></A><A NAME="ch34index268"></A></P>
<P class="docText">With a multi-column index for <TT>CITY</TT> and <TT>STATE</TT>, the <TT>RUNSTATS</TT> utility can be used to collect frequent value statistics to learn about the correlation between the two columns. For example, consider the following <TT>RUNSTATS</TT> specification for <TT>DSN8810.XEMPPROJACT1</TT> (a unique index on <TT>PROJNO</TT>, <TT>ACTNO</TT>, <TT>EMSTDATE</TT>, and <TT>EMPNO</TT>):<A NAME="ch34index269"></A><A NAME="ch34index270"></A><A NAME="ch34index271"></A><A NAME="ch34index272"></A><A NAME="ch34index273"></A></P>
<pre>

</pre><BR><pre>
RUNSTATS INDEX DSN8810.XEMPPROJACT1
    KEYCARD
    FREQVAL NUMCOLS 2 COUNT 15
</pre><BR>
<P class="docText">This statement causes the cardinality values to be collected for the concatenation of the first and second columns of the index (in this case, <TT>PROJNO</TT> and <TT>ACTNO</TT>). The top 15 most frequently occurring values will be collected. These statistics are most useful for queries against columns which are actually correlated in some manner where a matching index scan is used for the columns indicated.</P>
<A NAME="ch34note09"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">The default for <TT>NUMCOLS</TT> is 1 and the default for <TT>COUNT</TT> is 15. This means that <TT>RUNSTATS</TT> will collect the 15 most frequent values for the first key column of the index.</P>
<P class="docText">Also, please note that the value for <TT>NUMCOLS</TT> cannot be larger than the number of columns in the index. If you specify a number greater than the number of indexed columns, <TT>RUNSTATS</TT> will simply use the number of columns in the index.</P></div><br>
<A NAME="ch34lev4sec21"></A><H5 class="docSection3Title">Consider Collecting Column and Column Group Statistics</H5>

<P class="docText">You can use the <TT>COLUMN</TT> keyword of <TT>RUNSTATS</TT> to collect statistics for non-leading index columns or columns not indexed at all. But sometimes it is necessary to collect statistics for columns as a set, instead of individually. This is accomplished using the <TT>COLGROUP</TT> keyword.<A NAME="ch34index274"></A><A NAME="ch34index275"></A><A NAME="ch34index276"></A><A NAME="ch34index277"></A><A NAME="ch34index278"></A></P>
<A NAME="ch34note10"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">For versions of DB2 prior to V8 IBM provided <TT>DSTATS</TT>, a separate utility program for accumulating column statistics. For those readers not yet using DB2 V8, <TT>DSTATS</TT> can be downloaded free-of-charge at the following link:</P>
<P class="docText"><A class="docLink" target="_blank" HREF="ftp://www.redbooks.ibm.com/redbooks/dstats/">ftp://www.redbooks.ibm.com/redbooks/dstats/</A></P>
<P class="docText">Be aware, though, that <TT>DSTATS</TT> does not update the DB2 Catalog. It creates a user work table of data similar to <TT>SYSIBM.SYSCOLDIST</TT>. A user with <TT>SYSADM</TT> authority must insert these entries manually into the DB2 Catalog.</P></div><br>
<P class="docText">Collecting column and column group statistics can greatly improve DB2's ability to correctly formulate access paths—and therefore, improve query performance. This is particularly so for tables accessed frequently in an ad hoc manner. If the application is planned, it is relatively easy to build the correct indexes, and then to capture statistics on those indexes using <TT>RUNSTATS</TT>. But for ad hoc queries, just about any column can appear in a query predicate. Therefore, consider capturing statistics on non-indexed columns to improve performance.</P>
<P class="docText">To collect distribution statistics for non-indexed or non-leading indexed columns, specify the <TT>COLGROUP</TT> keyword. Simply specify the list of grouped columns using the <TT>COLGROUP</TT> keyword. This causes <TT>RUNSTATS</TT> to calculate a single cardinality value for the group of columns.</P>
<P class="docText">You can also collect frequency statistics for the grouped columns by specifying <TT>FREQVAL</TT> with <TT>COLGROUP</TT>. When using <TT>FREQVAL</TT> with <TT>COLGROUP</TT>, you must also specify <TT>COUNT </TT><span class="docEmphasis"><TT>n</TT></span> to tell <TT>RUNSTATS</TT> how many frequently occurring values should be collected for the specified group of columns.<A NAME="ch34index279"></A><A NAME="ch34index280"></A><A NAME="ch34index281"></A><A NAME="ch34index282"></A><A NAME="ch34index283"></A></P>
<P class="docText">Additionally, you will need to indicate whether the most frequently occurring values or the least frequently occurring values are to be stored for the group of columns. This is accomplished using one of the following parameters:</P>
<UL><LI><p class="docText">
<TT>MOST</TT>— 
<TT>RUNSTATS</TT> will collect the most frequently occurring values for the set of specified columns.</p></LI><LI><p class="docText">
<TT>LEAST</TT>— 
<TT>RUNSTATS</TT> will collect the least frequently occurring values for the set of specified columns.</p></LI><LI><p class="docText">
<TT>BOTH</TT>— 
<TT>RUNSTATS</TT> will collect both the most and the least frequently occurring values for the set of specified columns.<A NAME="ch34index284"></A><A NAME="ch34index285"></A><A NAME="ch34index286"></A><A NAME="ch34index287"></A><A NAME="ch34index288"></A></p></LI></UL>
<A NAME="ch34lev4sec22"></A><H5 class="docSection3Title">Consider Collecting Inline Statistics</H5>
<P class="docText">Instead of executing <TT>RUNSTATS</TT> after loading tables, reorganizing table spaces and indexes, or rebuilding indexes, consider collecting statistics as those utilities run. You can use the <TT>STATISTICS</TT> keyword with <TT>LOAD</TT>, <TT>REBUILD INDEX</TT>, and <TT>REORG</TT>, causing catalog statistics to be collected as part of the utility processing. This eliminates the need to execute <TT>RUNSTATS</TT> after those utilities.<A NAME="ch34index289"></A><A NAME="ch34index290"></A><A NAME="ch34index291"></A><A NAME="ch34index292"></A></P>
<A NAME="ch34note11"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">If you restart a <TT>LOAD</TT> or <TT>REBUILD INDEX</TT> utility that uses the <TT>STATISTICS</TT> keyword, inline statistics collection will not occur. You will need to run <TT>RUNSTATS</TT> to update the DB2 Catalog statistics after the restarted utility completes.</P></div><br>
<A NAME="ch34note12"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">You cannot collect column group statistics with the <TT>STATISTICS</TT> keyword. Instead, you must use <TT>RUNSTATS</TT>.</P></div><br>
<A NAME="ch34lev4sec23"></A><H5 class="docSection3Title">Consider Accumulating Historical Statistics</H5>

<P class="docText">As of DB2 V7, <TT>RUNSTATS</TT> can be used to accumulate additional statistics in several DB2 Catalog tables reserved for historical statistics. It is a good idea to accumulate these statistics, especially for very volatile objects, to help analyze data growth over time.<A NAME="ch34index293"></A><A NAME="ch34index294"></A><A NAME="ch34index295"></A><A NAME="ch34index296"></A><A NAME="ch34index297"></A><A NAME="ch34index298"></A></P>
<P class="docText">Historical statistics will be accumulated by <TT>RUNSTATS</TT> when you specify the <TT>HISTORY</TT> parameter. The following options are available with the <TT>HISTORY</TT> parameter:</P>
<UL><LI><p class="docText">
<TT>ALL</TT>— 
Specifies that all the statistics are to be recorded in the DB2 Catalog history tables</p></LI><LI><p class="docText">
<TT>ACCESSPATH</TT>— 
Specifies that only those columns that store statistics used for access path selection are to be recorded in the DB2 Catalog history tables</p></LI><LI><p class="docText">
<TT>SPACE</TT>— 
Specifies that only those columns that store space-related statistics are to be recorded in the DB2 Catalog history tables</p></LI><LI><p class="docText">
<TT>NONE</TT>— 
Specifies that no historical statistics are to be saved in the DB2 Catalog history tables</p></LI></UL>
<P class="docText">Of course, <TT>RUNSTATS</TT> will continue to collect the current statistics regardless of which option is chosen for the <TT>HISTORY</TT> parameter. But the utility will also record the historical statistics using the follow DB2 Catalog tables:<A NAME="ch34index299"></A><A NAME="ch34index300"></A><A NAME="ch34index301"></A><A NAME="ch34index302"></A><A NAME="ch34index303"></A></P>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5"><COLGROUP><COL width="275"><COL width="275"></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLDIST_HIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSCOLUMNS_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXES_HIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXPART_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSINDEXSTATS_HIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSLOBSTATS_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLEPART_HIST</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABSTATS_HIST</TT></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSIBM.SYSTABLES_HIST</TT></P></TD><TD class="docTableCell" align="left" valign="top">&nbsp;</TD></TR></TABLE></P><br>
<P class="docText">These historical statistics can be cleaned up using the <TT>MODIFY STATISTICS</TT> utility, as detailed earlier in this chapter.<A NAME="ch34index304"></A><A NAME="ch34index305"></A><A NAME="ch34index306"></A><A NAME="ch34index307"></A><A NAME="ch34index308"></A><A NAME="ch34index309"></A></P>
<A NAME="ch34lev4sec24"></A><H5 class="docSection3Title">Consider Collecting Statistics on a List of Objects</H5>

<P class="docText">Remember, that as of DB2 V7 you can specify a list of objects to be operated on by IBM utilities. Collecting statistics for a list of objects is accomplished using the <TT>LISTDEF</TT> statement in conjunction with <TT>RUNSTATS</TT>. Usage of <TT>LISTDEF</TT> is covered in <A class="docLink" HREF="ch30.html#ch30">Chapter 30</A>, "An Introduction to DB2 Utilities."<A NAME="ch34index310"></A><A NAME="ch34index311"></A><A NAME="ch34index312"></A><A NAME="ch34index313"></A><A NAME="ch34index314"></A><A NAME="ch34index315"></A></P>
<A NAME="ch34lev4sec25"></A><H5 class="docSection3Title">Use <TT>RUNSTATS</TT> to Generate DB2 Statistics Reports</H5>
<P class="docText">You can use the <TT>REPORT YES</TT> option, along with the <TT>UPDATE NONE</TT> option, to use <TT>RUNSTATS</TT> as a DB2 statistics reporting tool. The <TT>REPORT YES</TT> option causes <TT>RUNSTATS</TT> to generate a report of the statistics it collects, and the <TT>UPDATE NONE</TT> clause signals <TT>RUNSTATS</TT> to collect the statistics without updating the DB2 Catalog.<A NAME="ch34index316"></A><A NAME="ch34index317"></A><A NAME="ch34index318"></A><A NAME="ch34index319"></A></P>
<P class="docText">The reports, however, will contain information about the actual condition of the DB2 objects for which <TT>RUNSTATS</TT> was run. The reports will not contain the information as it exists in the DB2 Catalog because the statistics were not updated due to the <TT>UPDATE NONE</TT> keyword. You can use the report to compare the statistics against the statistics in the DB2 Catalog to determine how the data has changed since the last <TT>RUNSTATS</TT> was executed.</P>
<A NAME="ch34lev4sec26"></A><H5 class="docSection3Title">Use <TT>RUNSTATS</TT> to Invalidate Statements in the Dynamic SQL Cache</H5>
<P class="docText">Executing the <TT>RUNSTATS</TT> utility will invalidate cached dynamic SQL statements. Any cached dynamic SQL statements that access objects for which <TT>RUNSTATS</TT> is being run will be invalidated.<A NAME="ch34index320"></A><A NAME="ch34index321"></A><A NAME="ch34index322"></A></P>
<table width="90%" border="0" cellspacing="0" cellpadding="1"><tr><td width="60" valign="top"><IMG BORDER="0"  width="30" height="18" SRC="images/0672326132/graphics/V8_icon.gif" ALT="graphics/V8_icon.gif"></td><td valign="top"><P class="docText"> As of DB2 Version 8, you can run the <TT>RUNSTATS</TT> utility with both the <TT>UPDATE NONE</TT> and <TT>REPORT NO</TT> parameters. This combination of parameters can be used to invalidate dynamic SQL statements without the overhead of running a full <TT>RUNSTATS</TT>. By specifying both of these parameters, <TT>RUNSTATS</TT> will not update statistics, nor will it produce a report; instead, just the dynamic SQL cache will be affected.<A NAME="ch34index323"></A><A NAME="ch34index324"></A><A NAME="ch34index325"></A><A NAME="ch34index326"></A><A NAME="ch34index327"></A></P></td></tr></table><br>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch34lev1sec4.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch34lev1sec6.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
