<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>The Stand-alone Utilities</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch35.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch35lev1sec2.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch35lev1sec1"></A><H3 class="docSection1Title">The Stand-alone Utilities</H3>
<P class="docText">The DB2 stand-alone utilities are batch-oriented utilities that perform DB2 administrative activities outside the control of the DB2 subsystem (with the exception of <TT>DSN1SDMP</TT>). This can be useful if an error makes the DB2 system inactive. For example, stand-alone utilities can be used to copy DB2 data sets and print formatted dumps of their contents without DB2 being active. Every DB2 specialist should have a working knowledge of the stand-alone utilities. The stand-alone utilities are<A NAME="ch35index01"></A><A NAME="ch35index02"></A></P>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5"><COLGROUP><COL width="176"><COL width="374"></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSNJLOGF</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Log pre-format utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSNJU003</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Change log inventory utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSNJU004</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Print log map utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN1CHKR</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">DB2 Catalog and DB2 Directory verification utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN1COMP</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Data compression analysis utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN1COPY</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Offline table space copy utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN1SDMP</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Dump and trace utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN1LOGP</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Recovery log extractor utility</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN1PRNT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Formatted table space dump utility</P></TD></TR></TABLE></P><br>
<P class="docText">Only technical support personnel who understand the intricacies of DB2 logging should use these utilities. As such, only the DB2 systems programmer or DBA who installs and maintains the DB2 system should use these utilities. A brief introduction to these utilities, however, should increase your overall understanding of DB2 logging.<A NAME="ch35index03"></A><A NAME="ch35index04"></A></P>
<A NAME="ch35lev2sec1"></A><H4 class="docSection2Title">The DB2 Log Preformat Utility (<TT>DSNJLOGF</TT>)</H4>
<P class="docText"><TT>DSNJLOGF</TT>, the DB2 log preformat utility, preformats DB2 active log data sets. The execution of this utility is not mandatory for new active log data sets. However, if <TT>DSNJLOGF</TT> has not been run prior to the first write activity for the log, DB2 will preformat the log at that time, incurring a delay. Sample JCL is provided in <A class="docLink" HREF="#ch35list01">Listing 35.1</A>.<A NAME="ch35index05"></A><A NAME="ch35index06"></A><A NAME="ch35index07"></A><A NAME="ch35index08"></A><A NAME="ch35index09"></A><A NAME="ch35index10"></A><A NAME="ch35index11"></A><A NAME="ch35index12"></A><A NAME="ch35index13"></A></P>
<A NAME="ch35list01"></A><H5 class="docExampleTitle">Listing 35.1. <TT>DSNJLOGF</TT> JCL</H5>

<PRE>
//DB2JOBU  JOB (UTILITY),'DSNJLOGF',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*       DB2 LOG PREFORMAT
//****************************************************************
//*
//*  Preformat the DB2 active log data sets
//*
//PREF11 EXEC PGM=DSNJLOGF
//SYSPRINT DD SYSOUT=*
//SYSUDUMP DD SYSOUT=*
//SYSUT1  DD  DSN=DSN510.LOGCOPY1.DS01,DISP=SHR
//*
//PREF12 EXEC PGM=DSNJLOGF
//SYSPRINT DD SYSOUT=*
//SYSUDUMP DD SYSOUT=*
//SYSUT1  DD  DSN=DSN510.LOGCOPY1.DS02,DISP=SHR
//*
//PREF21 EXEC PGM=DSNJLOGF
//SYSPRINT DD SYSOUT=*
//SYSUDUMP DD SYSOUT=*
//SYSUT1  DD  DSN=DSN510.LOGCOPY2.DS01,DISP=SHR
//*
//PREF22 EXEC PGM=DSNJLOGF
//SYSPRINT DD SYSOUT=*
//SYSUDUMP DD SYSOUT=*
//SYSUT1  DD  DSN=DSN510.LOGCOPY2.DS02,DISP=SHR
//
</PRE><BR>

<A NAME="ch35lev2sec2"></A><H4 class="docSection2Title"><TT>DSNJLOGF</TT> Guidelines</H4>
<P class="docText">Use the following guidelines when running <TT>DSNJLOGF</TT>.</P>
<A NAME="ch35lev4sec1"></A><H5 class="docSection3Title">Use <TT>DSNJLOGF</TT></H5>
<P class="docText">Execute the <TT>DSNJLOGF</TT> utility instead of allowing DB2 to preformat the active log data set during processing. This will eliminate delays due to log data set preformatting.<A NAME="ch35index14"></A><A NAME="ch35index15"></A><A NAME="ch35index16"></A></P>
<A NAME="ch35lev4sec2"></A><H5 class="docSection3Title">Interpret Timestamps in the Log Map Correctly</H5>
<P class="docText">The timestamps shown in the reports produced by <TT>DSNJLOGF</TT> can be confusing to interpret properly. Timestamps in the column labeled <TT>LTIME</TT> are in local time; all other timestamps are in Greenwich Mean Time (GMT).<A NAME="ch35index17"></A><A NAME="ch35index18"></A><A NAME="ch35index19"></A><A NAME="ch35index20"></A></P>
<A NAME="ch35lev2sec3"></A><H4 class="docSection2Title">The Change Log Inventory Utility (<TT>DSNJU003</TT>)</H4>
<P class="docText"><TT>DSNJU003</TT>, better known as the Change Log Inventory utility, modifies the bootstrap data set (BSDS). Its primary function is to add or delete active and archive logs for the DB2 subsystem. Sample JCL to add an archive log data set is provided in <A class="docLink" HREF="#ch35list02">Listing 35.2</A>.<A NAME="ch35index21"></A><A NAME="ch35index22"></A><A NAME="ch35index23"></A><A NAME="ch35index24"></A><A NAME="ch35index25"></A><A NAME="ch35index26"></A><A NAME="ch35index27"></A><A NAME="ch35index28"></A><A NAME="ch35index29"></A></P>
<A NAME="ch35list02"></A><H5 class="docExampleTitle">Listing 35.2. <TT>DSNJU003</TT> JCL (Change Log Inventory)</H5>

<PRE>
//DB2JOBU  JOB (UTILITY),'DSNJU003',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*       DB2 CHANGE LOG INVENTORY
//****************************************************************
//*
//DSNJU003 EXEC PGM=DSNJU003
//SYSUT1  DD  DSN=DB2CAT.BSDS01,DISP=OLD
//SYSUT2  DD  DSN=DB2CAT.BSDS02,DISP=OLD
//SYSIN    DD  *
NEWLOG DSNAME=DB2CAT.FIRST.COPY,COPY1
NEWLOG DSNAME=DB2CAT.SECOND.COPY,COPY2
/*
//
</PRE><BR>

<A NAME="ch35lev2sec4"></A><H4 class="docSection2Title"><TT>DSNJU003</TT> Utility Guidelines</H4>
<P class="docText">Use the following tips when running <TT>DSNJU003</TT>.</P>
<A NAME="ch35lev4sec3"></A><H5 class="docSection3Title">Be Sure DB2 Is Down Before Using <TT>DSNJU003</TT></H5>
<P class="docText">It is best to run the <TT>DSNJU003</TT> utility in batch only when DB2 is not running. Although you can run <TT>DSNJU003</TT> when DB2 is up and running, the results can be inconsistent.<A NAME="ch35index30"></A><A NAME="ch35index31"></A><A NAME="ch35index32"></A></P>
<A NAME="ch35lev4sec4"></A><H5 class="docSection3Title">Use Caution with Data Sharing</H5>
<P class="docText">Using <TT>DSNJU003</TT> to change a BSDS for a data sharing member can cause a log read request from another data sharing member to fail. This will happen when the second member tries to access the changed BSDS before the first member is started.<A NAME="ch35index33"></A><A NAME="ch35index34"></A><A NAME="ch35index35"></A><A NAME="ch35index36"></A></P>
<A NAME="ch35lev4sec5"></A><H5 class="docSection3Title">Use <TT>DSNJU003</TT> with <TT>RESTORE SYSTEM</TT></H5>

<P class="docText">DB2 V8 adds a new option to <TT>DSNJU003</TT> so that it can be used in conjunction with the new <TT>RESTORE SYSTEM</TT> utility. Before running <TT>RESTORE SYSTEM</TT>, run <TT>DSNJU003</TT> with the <TT>SYSPITR</TT> option to specify the log truncation point for the point in time that you want to use for system recovery. Specify either the log RBA (if you are not data sharing) or the log LRSN (if you are data sharing) to the <TT>SYSPITR</TT> parameter.<A NAME="ch35index37"></A><A NAME="ch35index38"></A><A NAME="ch35index39"></A></P>
<A NAME="ch35lev4sec6"></A><H5 class="docSection3Title">Consider Using <TT>DSNJU003</TT> to Rectify <TT>CCSID</TT> Information</H5>

<P class="docText">You can use <TT>DSNJU003</TT> with the <TT>CCSID</TT> parameter on a <TT>DELETE</TT> statement to remove the <TT>CCSID</TT> information in the BSDS.<A NAME="ch35index40"></A><A NAME="ch35index41"></A><A NAME="ch35index42"></A><A NAME="ch35index43"></A><A NAME="ch35index44"></A></P>
<A NAME="ch35note02"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">This option should only be attempted under direction from IBM technical support and only when the <TT>CCSID</TT> information in the BSDS is incorrect.</P></div><br>
<A NAME="ch35lev2sec5"></A><H4 class="docSection2Title">The Print Log Map Utility (<TT>DSNJU004</TT>)</H4>
<P class="docText"><TT>DSNJU004</TT>, also referred to as the Print Log Map utility, is used to list the contents of the BSDS, which includes a status of the logs. All of the following information will be output by <TT>DSNJU004</TT>:<A NAME="ch35index45"></A><A NAME="ch35index46"></A><A NAME="ch35index47"></A><A NAME="ch35index48"></A><A NAME="ch35index49"></A></P>
<UL><LI><P class="docList">Log data set name, log RBA association, and log LRSN for both copies of all active and archive log data sets</P></LI><LI><P class="docList">Active log data sets that are available for new log data</P></LI><LI><P class="docList">Status of all conditional restart control records in the bootstrap data set</P></LI><LI><P class="docList">Contents of the queue of checkpoint records in the BSDS</P></LI><LI><P class="docList">The communication record of the BSDS (if one exists)</P></LI><LI><P class="docList">Contents of the quiesce history record</P></LI><LI><P class="docList">System and utility timestamps</P></LI><LI><P class="docList">Contents of the checkpoint queue</P></LI><LI><P class="docList">Archive log command history</P></LI><LI><P class="docList"><TT>BACKUP SYSTEM</TT> utility history</P></LI><LI><P class="docList">System <TT>CCSID</TT> information</P></LI></UL>
<P class="docText">Sample JCL for <TT>DSNJU004</TT> is provided in <A class="docLink" HREF="#ch35list03">Listing 35.3</A>.<A NAME="ch35index50"></A></P>
<A NAME="ch35list03"></A><H5 class="docExampleTitle">Listing 35.3. <TT>DSNJU004</TT> JCL (Print Log Map)</H5>

<PRE>
//DB2JOBU  JOB (UTILITY),'DSNJU004',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*       DB2 PRINT LOG MAP
//****************************************************************
//*
//DSNJU004 EXEC PGM=DSNJU004
//SYSUT1  DD  DSN=DB2CAT.BSDS01,DISP=SHR
//SYSPRINT DD SYSOUT=*
//
</PRE><BR>

<A NAME="ch35lev2sec6"></A><H4 class="docSection2Title"><TT>DSNJU004</TT> Utility Guideline</H4>
<P class="docText">Use the following tip when running <TT>DSNJU004</TT>.</P>
<A NAME="ch35lev4sec7"></A><H5 class="docSection3Title">Use <TT>DSNJU004</TT> for Documentation</H5>
<P class="docText">Run <TT>DSNJU004</TT>, the print log map utility, before and after running the change log utility. You can use the output of <TT>DSNJU004</TT> to document the log change being implemented.<A NAME="ch35index51"></A><A NAME="ch35index52"></A><A NAME="ch35index53"></A></P>
<A NAME="ch35lev2sec7"></A><H4 class="docSection2Title">The Catalog Integrity Verification Utility (<TT>DSN1CHKR</TT>)</H4>
<P class="docText"><TT>DSN1CHKR</TT>, the Catalog Integrity Verification utility, verifies the integrity of the DB2 Catalog and DB2 Directory. Sample JCL is provided in <A class="docLink" HREF="#ch35list04">Listing 35.4</A>.<A NAME="ch35index54"></A><A NAME="ch35index55"></A><A NAME="ch35index56"></A><A NAME="ch35index57"></A><A NAME="ch35index58"></A></P>
<A NAME="ch35list04"></A><H5 class="docExampleTitle">Listing 35.4. <TT>DSN1CHKR</TT> JCL</H5><A NAME="ch35index59"></A><A NAME="ch35index60"></A><A NAME="ch35index61"></A><A NAME="ch35index62"></A>

<PRE>
//DB2JOBU  JOB (UTILITY),'DSN1CHKR',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*       DB2 CATALOG CHECK UTILITY
//****************************************************************
//*
//*  Verifies the integrity of the SYSPLAN table space
//*
//CHECK EXEC PGM=DSN1CHKR,PARM='FORMAT'
//SYSUT1  DD  DSN=DB2CAT.DSNDBC.DSNDB06.SYSPLAN.I0001.A001,DISP=SHR
//SYSPRINT DD SYSOUT=*
//
</PRE><BR>

<A NAME="ch35note03"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">The <TT>SYSUTILX</TT> and <TT>SYSLGRNX</TT> tables are not checkable using <TT>DSN1CHKR</TT>. This is true even though the predecessors to these tables were checkable (<TT>SYSUTIL</TT> prior to DB2 V3 and <TT>SYSLGRNG</TT> prior to DB2 V4).</P></div><br>
<A NAME="ch35lev2sec8"></A><H4 class="docSection2Title"><TT>DSN1CHKR</TT> Guidelines</H4>
<P class="docText">Review the following techniques when using <TT>DSN1CHKR</TT> to verify the integrity of DB2 Catalog table spaces.<A NAME="ch35index63"></A><A NAME="ch35index64"></A><A NAME="ch35index65"></A></P>
<A NAME="ch35lev4sec8"></A><H5 class="docSection3Title">Schedule <TT>DSN1CHKR</TT> Runs Regularly</H5>
<P class="docText">Execute the <TT>DSN1CHKR</TT> utility for the DB2 Catalog and DB2 Directory weekly to catch problems early, before they affect program development and testing in your test DB2 subsystems or business availability and production processing in your production DB2 subsystems.<A NAME="ch35index66"></A><A NAME="ch35index67"></A><A NAME="ch35index68"></A><A NAME="ch35index69"></A></P>
<A NAME="ch35lev4sec9"></A><H5 class="docSection3Title">Consider Starting the DB2 Catalog in Read-Only Mode</H5>
<P class="docText">For the results of <TT>DSN1CHKR</TT> to be 100 percent accurate, DB2 must be down or the table spaces being checked must be started in read-only mode (or stopped). To minimize the outage, consider copying the table spaces to be checked to VSAM files. The VSAM files can be checked instead of the actual DB2 Catalog table spaces. It should take less time to copy the files to VSAM than to check the actual table space data sets. You can also run <TT>DSN1CHKR</TT> against a copy created using <TT>DSN1COPY</TT>.<A NAME="ch35index70"></A><A NAME="ch35index71"></A><A NAME="ch35index72"></A></P>
<A NAME="ch35note04"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">Regardless of the status of the catalog, you must be able to verify that the catalog files being checked do not have pages in the buffer pool that might have been modified.</P></div><br>
<A NAME="ch35lev4sec10"></A><H5 class="docSection3Title">Take Additional DB2 Catalog Verification Steps</H5>
<P class="docText">In addition to running <TT>DSN1CHKR</TT>, consider the following steps to ensure DB2 Catalog integrity:<A NAME="ch35index73"></A><A NAME="ch35index74"></A><A NAME="ch35index75"></A></P>
<A NAME="ch35pr01"></A><UL class="doclist" START=""><LI>Run <TT>DSN1COPY</TT> with the check option against all DB2 Catalog indexes and table spaces.<BR><BR></LI><LI>Run the <TT>CHECK INDEX</TT> utility against all catalog indexes.<BR><BR></LI></UL>
<A NAME="ch35lev4sec11"></A><H5 class="docSection3Title">Use <TT>DSN1CHKR</TT> on Valid Table Spaces Only</H5>
<P class="docText">Several of the DB2 Catalog and DB2 Directory table spaces are not able to be checked using <TT>DSN1CHKR</TT>. Therefore, be sure to execute <TT>DSN1CHKR</TT> only on the following system table spaces:<A NAME="ch35index76"></A><A NAME="ch35index77"></A><A NAME="ch35index78"></A><A NAME="ch35index79"></A></P>
<pre>

</pre><BR><pre>
DSNDB01.DBD01
DSNDB06.SYSDBASE
DSNDB06.SYSDBAUT
DSNDB06.SYSGROUP
DSNDB06.SYSPLAN
DSNDB06.SYSVIEWS
</pre><BR>
<A NAME="ch35lev2sec9"></A><H4 class="docSection2Title">The Compression Analyzer (<TT>DSN1COMP</TT>)</H4>
<P class="docText">The <TT>DSN1COMP</TT> utility can be used to analyze DB2 data and approximate the results of DB2 data compression. <TT>DSN1COMP</TT> can be run on a table space data set, a sequential data set containing a DB2 table space or partition, a full image copy data set, or an incremental image copy data set. It will provide the following statistics:<A NAME="ch35index80"></A><A NAME="ch35index81"></A><A NAME="ch35index82"></A><A NAME="ch35index83"></A><A NAME="ch35index84"></A></P>
<UL><LI><P class="docList">Space used with compression</P></LI><LI><P class="docList">Space used without compression</P></LI><LI><P class="docList">Percentage of bytes saved by using compression</P></LI><LI><P class="docList">Total pages required with compression</P></LI><LI><P class="docList">Total pages required without compression</P></LI><LI><P class="docList">Percentage of pages saved by using compression</P></LI><LI><P class="docList">Number of dictionary entries</P></LI><LI><P class="docList">Number of dictionary pages required</P></LI><LI><P class="docList">Average size of a compressed row</P></LI></UL>
<A NAME="ch35note05"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText"><TT>DSN1COMP</TT> cannot be run against compressed objects. Because the compression dictionary can age, it can be difficult to determine when to replace the dictionary because <TT>DSN1COMP</TT> cannot be used for this purpose.</P></div><br>
<P class="docText">Sample <TT>DSN1COMP</TT> JCL is provided in <A class="docLink" HREF="#ch35list05">Listing 35.5</A>. This job reads the VSAM data set for the <TT>DSN8D81A.DSN8S81D</TT> table space specified in the <TT>SYSUT1 DD</TT> statement and analyzes the data producing estimated compression statistics.</P>
<A NAME="ch35list05"></A><H5 class="docExampleTitle">Listing 35.5. <TT>DSN1COMP</TT> JCL</H5><A NAME="ch35index85"></A><A NAME="ch35index86"></A><A NAME="ch35index87"></A><A NAME="ch35index88"></A>

<PRE>
//DB2JOBU  JOB (UTILITY),'DB2 DSN1COMP',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*
//*       DB2 DSN1COMP UTILITY
//*
//****************************************************************
//*
//JOBLIB DD DSN=DSN810.DSNLOAD,DISP=SHR
//DSN1COMP EXEC PGM=DSN1COMP,PARM='ROWLIMIT(20000)'
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSUT1 DD DSN=DB2CAT.DSNDBC.DSN8D81A.DSN8S81D.I0001.A001,DISP=SHR,AMP=('BUFND=181')
//
</PRE><BR>

<P class="docText">There are numerous parameters that can be supplied to the <TT>DSN1COMP</TT> utility. The following are the most commonly used parameters:<A NAME="ch35index89"></A><A NAME="ch35index90"></A><A NAME="ch35index91"></A><A NAME="ch35index92"></A></P>
<UL><LI><p class="docText">
<TT>FREEPAGE</TT> 
Indicates the frequency of inserting a completely blank page when calculating the percentage of pages saved. The default is 0. You should specify the same value used for <TT>FREEPAGE</TT> in the <TT>CREATE TABLESPACE DDL</TT> for the table space being analyzed.<A NAME="ch35index93"></A></p></LI><LI><p class="docText">
<TT>PCTFREE</TT> 
Specifies the percentage of each page to leave free when calculating the percentage of pages saved. The default is 5. Once again, you should specify the same value used for <TT>PCTFREE</TT> in the <TT>CREATE TABLESPACE DDL</TT> for the table space being analyzed.<A NAME="ch35index94"></A></p></LI><LI><p class="docText">
<TT>FULLCOPY</TT> 
Indicates that a full image copy is being used as input. If the table space is partitioned, you should also use the <TT>NUMPARTS</TT> parameter.<A NAME="ch35index95"></A></p></LI><LI><p class="docText">
<TT>INCRCOPY</TT> 
Indicates that an incremental image copy is used as input. Once again, for partitioned table spaces, you should also specify the <TT>NUMPARTS</TT> parameter.<A NAME="ch35index96"></A></p></LI><LI><p class="docText">
<TT>REORG</TT> 
Indicates that the estimate should be based on the compression savings achievable by the <TT>REORG</TT> utility. If <TT>REORG</TT> is not specified, the estimate is the savings that the <TT>LOAD</TT> utility would achieve.<A NAME="ch35index97"></A></p></LI><LI><p class="docText">
<TT>ROWLIMIT</TT> 
Specifies the maximum number of rows to evaluate to provide the compression estimate. You should use this option to limit the elapsed and processor time required by <TT>DSN1COMP</TT>.<A NAME="ch35index98"></A></p></LI></UL>
<A NAME="ch35lev2sec10"></A><H4 class="docSection2Title"><TT>DSN1COMP</TT> Guidelines</H4>
<P class="docText">To ensure effective compression planning, consider the following guidelines as you execute the <TT>DSN1COMP</TT> utility.</P>
<A NAME="ch35lev4sec12"></A><H5 class="docSection3Title">Utilize <TT>DSN1COMP</TT> to Plan for Compression</H5>
<P class="docText">Execute the <TT>DSN1COMP</TT> utility for table spaces that are candidates for compression. The statistics provided by this utility can be analyzed to determine whether compression will be cost-effective.<A NAME="ch35index99"></A><A NAME="ch35index100"></A><A NAME="ch35index101"></A><A NAME="ch35index102"></A></P>
<P class="docText">In general, contrast the percentage of pages saved when using compression against the anticipated increase in CPU time to determine whether compression is desirable. The CPU increase should be negligible when DB2 is using hardware compression.</P>
<A NAME="ch35lev4sec13"></A><H5 class="docSection3Title">Determine Proper Prefix</H5>
<P class="docText">Before running <TT>DSN1COMP</TT> on a table space, first you must determine the actual data set name for the table space to be examined. This information can be found in <TT>SYSIBM.SYSTABLEPART</TT>; for example:<A NAME="ch35index103"></A><A NAME="ch35index104"></A><A NAME="ch35index105"></A><A NAME="ch35index106"></A></P>
<pre>

</pre><BR><pre>
SELECT DBNAME, TSNAME, PARTITION, IPREFIX
FROM   SYSIBM.SYSTABLEPART
WHERE  DBNAME = ?
AND    TSNAME = ?;
</pre><BR>
<P class="docText">Substitute the database name and table space name for the <TT>DBNAME</TT> and <TT>TSNAME</TT> predicates. Then, use the <TT>IPREFIX</TT> results to code the appropriate data set name. <TT>IPREFIX</TT> will contain either an "I" or a "J" depending on which version of the data set is currently active. If <TT>IPREFIX</TT> contains "J" then the data set should be coded as:</P>
<pre>

</pre><BR><pre>
//SYSUT1 DD DSN=DB2CAT.DSNDBC.dbname.tsname.<span class="docEmphStrong">J</span>0001.A001,DISP=SHR
</pre><BR>
<P class="docText">If <TT>IPREFIX</TT> contains "I" then the data set should be coded as:</P>
<pre>

</pre><BR><pre>
//SYSUT1 DD DSN=DB2CAT.DSNDBC.dbname.tsname.<span class="docEmphStrong">I</span>0001.A001,DISP=SHR
</pre><BR>
<A NAME="ch35lev4sec14"></A><H5 class="docSection3Title">Use the <TT>DSSIZE</TT> Parameter for Large Table Spaces</H5>
<P class="docText">The <TT>DSSIZE</TT> parameter is used to specify the data set size in gigabytes. The preferred method of specifying a large table space is to use the <TT>DSSIZE</TT> parameter instead of the <TT>LARGE</TT> parameter.<A NAME="ch35index107"></A><A NAME="ch35index108"></A><A NAME="ch35index109"></A><A NAME="ch35index110"></A><A NAME="ch35index111"></A></P>
<P class="docText">So, you should specify <TT>DSSIZE(4G)</TT> or greater to <TT>DSN1COMP</TT> when you are analyzing a large table space. If you omit <TT>DSSIZE</TT>, DB2 assumes that the input data set size is 2GB. Of course, if <TT>DSSIZE</TT> is not specified and the data set is not one of the default sizes, the results of <TT>DSN1COMP</TT> will be unpredictable.</P>
<A NAME="ch35lev4sec15"></A><H5 class="docSection3Title">Use the <TT>PAGESIZE</TT> Parameter</H5>
<P class="docText">The <TT>PAGESIZE</TT> parameter of <TT>DSN1COMP</TT> should be used to specify the page size of the input data set for <TT>SYSUT1</TT>. Any of the valid page sizes—4K, 8K, 16K, or 32K—are valid. If you specify an incorrect page size, the results of <TT>DSN1COMP</TT> will be unpredictable.<A NAME="ch35index112"></A><A NAME="ch35index113"></A><A NAME="ch35index114"></A><A NAME="ch35index115"></A><A NAME="ch35index116"></A></P>
<P class="docText"><TT>DSN1COMP</TT> will try to determine the proper page size if you fail to specify a <TT>PAGESIZE</TT> value. If <TT>DSN1COMP</TT> cannot determine the page size, then the utility will fail and an error message will be issued.</P>
<A NAME="ch35lev2sec11"></A><H4 class="docSection2Title">The Offline Copy Utility (<TT>DSN1COPY</TT>)</H4>
<P class="docText">The Offline Copy utility, better known as <TT>DSN1COPY</TT>, has a multitude of uses. For example, it can be used to copy data sets or check the validity of table space and index pages. Another use is to translate DB2 object identifiers for the migration of objects between DB2 subsystems or to recover data from accidentally dropped objects. <TT>DSN1COPY</TT> also can print hexadecimal dumps of DB2 table space and index data sets.<A NAME="ch35index117"></A><A NAME="ch35index118"></A><A NAME="ch35index119"></A><A NAME="ch35index120"></A><A NAME="ch35index121"></A></P>
<P class="docText">Its first function, however, is to copy data sets. <TT>DSN1COPY</TT> can be used to copy VSAM data sets to sequential data sets, and vice versa. It also can copy VSAM data sets to other VSAM data sets and can copy sequential data sets to other sequential data sets. As such, <TT>DSN1COPY</TT> can be used to</P>
<UL><LI><P class="docList">Create a sequential data set copy of a DB2 table space or index data set.</P></LI><LI><P class="docList">Create a sequential data set copy of another sequential data set copy produced by <TT>DSN1COPY</TT>.</P></LI><LI><P class="docList">Create a sequential data set copy of an image copy data set produced using the DB2 <TT>COPY</TT> utility, except for segmented table spaces. (The DB2 <TT>COPY</TT> utility skips empty pages, thereby rendering the image copy data set incompatible with <TT>DSN1COPY</TT>.)</P></LI><LI><P class="docList">Restore a DB2 table space or index using a sequential data set produced by <TT>DSN1COPY</TT>.</P></LI><LI><P class="docList">Restore a DB2 table space using a full image copy data set produced using the DB2 <TT>COPY</TT> utility.</P></LI><LI><P class="docList">Move DB2 data sets from one disk pack to another to replace DASD (such as migrating from 3380s to 3390s).</P></LI><LI><P class="docList">Move a DB2 table space or index space from a smaller data set to a larger data set to eliminate extents. Or, move a DB2 table space or index space from a larger data set to a smaller data set to eliminate wasted space.</P></LI></UL>
<A NAME="ch35note06"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">If you change the allocation size of a DB2 data set using <TT>DSN1COPY</TT>, be sure also to change the <TT>PRIQTY</TT> and <TT>SECQTY</TT> values for the object to reflect the change in the DB2 Catalog.</P></div><br>
<P class="docText"><TT>DSN1COPY</TT> runs as an MVS batch job, so it can run as an offline utility when the DB2 subsystem is inactive. It can run also when the DB2 subsystem is active, but the objects it operates on should be stopped to ensure that <TT>DSN1COPY</TT> creates valid output.</P>
<A NAME="ch35note07"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText"><TT>DSN1COPY</TT> performs a page-by-page copy. Therefore, you cannot use <TT>DSN1COPY</TT> to alter the structure of DB2 data sets. For example, you cannot copy a partitioned tablespace into a simple tablespace.</P></div><br>
<P class="docText"><TT>DSN1COPY</TT> does not check to see whether an object is stopped before carrying out its task. <TT>DSN1COPY</TT> does not directly communicate with DB2.</P>
<A NAME="ch35note08"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText">If DB2 is operational and an object is not stopped, <TT>DSN1COPY</TT> cannot use <TT>DISP=OLD</TT> for the data set being copied.</P></div><br>
<P class="docText">Sample <TT>DSN1COPY</TT> JCL is provided in <A class="docLink" HREF="#ch35list06">Listing 35.6</A>. This job reads the VSAM data set for the <TT>DSN8D81A.DSN8S81D</TT> table space specified in the <TT>SYSUT1 DD</TT> statement and then copies it to the sequential data set specified in the <TT>SYSUT2 DD</TT> statement.<A NAME="ch35index122"></A><A NAME="ch35index123"></A><A NAME="ch35index124"></A><A NAME="ch35index125"></A></P>
<A NAME="ch35list06"></A><H5 class="docExampleTitle">Listing 35.6. <TT>DSN1COPY</TT> JCL</H5>

<PRE>
//DB2JOBU  JOB (UTILITY),'DB2 DSN1COPY',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*
//*       DB2 DSN1COPY UTILITY
//*
//****************************************************************
//*
//JOBLIB DD DSN=DSN810.DSNLOAD,DISP=SHR
//STOPDB EXEC PGM=IKJEFT01,DYNAMNBR=20
//STEPLIB DD DSN=DSN810.DSNEXIT,DISP=SHR
//        DD DSN=DSN810.DSNLOAD,DISP=SHR
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSOUT  DD SYSOUT=*
//SYSUDUMP DD SYSOUT=*
//SYSTSIN  DD *
DSN SYSTEM (DSN)
-STOP DATABASE (DSN8D81A) SPACENAM(DSN8S81D)
END
/*
//DSN1COPY EXEC PGM=DSN1COPY,PARM='CHECK'
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSUT1 DD DSN=DB2CAT.DSNDBC.DSN8D81A.DSN8S81D.I0001.A001,DISP=OLD,AMP=('BUFND=181')
//SYSUT2 DD DSN=OUTPUT.SEQ.DATASET,DISP=OLD,DCB=BUFNO=20
/*
//STARTRW EXEC PGM=IKJEFT01,DYNAMNBR=20,COND=EVEN
//STEPLIB DD DSN=DSN810.DSNEXIT,DISP=SHR
//        DD DSN=DSN810.DSNLOAD,DISP=SHR
//*
//SYSPRINT DD SYSOUT=*
//SYSTSPRT DD SYSOUT=*
//SYSOUT  DD SYSOUT=*
//SYSUDUMP DD SYSOUT=*
//SYSTSIN  DD *
DSN SYSTEM (DSN)
-START DATABASE (DSN8D81A) SPACENAM(DSN8S81D)
END
/*
//
</PRE><BR>

<P class="docText">One of the best features of the <TT>DSN1COPY</TT> utility is its capability to modify the internal object identifier stored in DB2 table space and index data sets, as well as in data sets produced by <TT>DSN1COPY</TT> and the DB2 <TT>COPY</TT> utility. When you specify the <TT>OBIDXLAT</TT> option, <TT>DSN1COPY</TT> reads a data set specified by the <TT>SYSXLAT DD</TT> statement. This data set lists source and target <TT>DBIDs</TT>, <TT>PSIDs</TT> or <TT>ISOBIDs</TT>, and <TT>OBIDs</TT>.<A NAME="ch35index126"></A><A NAME="ch35index127"></A><A NAME="ch35index128"></A></P>
<A NAME="ch35note09"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">The <TT>DSN1COPY</TT> utility can only translate up to 500 record <TT>OBIDs</TT> at a time.<A NAME="ch35index129"></A><A NAME="ch35index130"></A><A NAME="ch35index131"></A><A NAME="ch35index132"></A><A NAME="ch35index133"></A></P></div><br>
<A NAME="ch35note10"></A><div class="docNote"><p class="docNoteTitle">NOTE</p>

<P class="docText"><TT>DBIDs</TT>, <TT>PSIDs</TT> or <TT>ISOBIDs</TT>, and <TT>OBIDs</TT> are internal identifiers used by DB2 internally to uniquely identify database objects.</P></div><br>
<P class="docText">Each record in the <TT>SYSXLAT</TT> file must contain a pair of integers separated by a comma. The first integer is the source ID and the second integer is the target ID. The first record in the <TT>SYSXLAT</TT> file contains the source and target <TT>DBIDs</TT>. The second record contains the source and target <TT>PSIDs</TT> or <TT>ISOBIDs</TT> for indexes. All subsequent records in the <TT>SYSXLAT</TT> data set are OBIDs for tables.<A NAME="ch35index134"></A><A NAME="ch35index135"></A><A NAME="ch35index136"></A><A NAME="ch35index137"></A><A NAME="ch35index138"></A></P>
<A NAME="ch35note11"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">Be careful with type 2 indexes when using old JCL that worked with type 1 indexes. Only the first two records were required for a type 1 index. For a type 2 index, the <TT>SYSXLAT</TT> data set must contain the table <TT>OBID</TT> in addition to the <TT>DBID</TT> and <TT>ISOBID</TT>.</P></div><br>
<P class="docText">For example, assume that you accidentally dropped the <TT>DSN8D81A</TT> database after the JCL in <A class="docLink" HREF="#ch35list06">Listing 35.6</A> was run. Because this database uses <TT>STOGROUP</TT>-defined objects, all the data has been lost. However, after re-creating the database, table spaces, tables, and other objects for <TT>DSN8D81A</TT>, you can restore the <TT>DSN8S81D</TT> table space using <TT>DSN1COPY</TT> with the <TT>OBIDXLAT</TT> option. Consider the sample JCL using this option as shown in <A class="docLink" HREF="#ch35list07">Listing 35.7</A>. It is operating on the sequential data set produced in <A class="docLink" HREF="#ch35list06">Listing 35.6</A>, copying it back to the data set for the <TT>DSN8D81A.DSN8S81D</TT> table space. This job translates the <TT>DBID</TT> for database <TT>DSN8D81A</TT> from 283 to 201, the <TT>PSID</TT> for the <TT>DSN8S81D</TT> table space from 0002 to 0003, and the <TT>OBID</TT> for the <TT>DSN8810.DEPT</TT> table from 0020 to 0008.<A NAME="ch35index139"></A><A NAME="ch35index140"></A><A NAME="ch35index141"></A><A NAME="ch35index142"></A></P>
<A NAME="ch35list07"></A><H5 class="docExampleTitle">Listing 35.7. <TT>DSN1COPY</TT> JCL (Using the <TT>OBIDXLAT</TT> Option)</H5><A NAME="ch35index143"></A><A NAME="ch35index144"></A><A NAME="ch35index145"></A><A NAME="ch35index146"></A>

<PRE>
//DB2JOBU  JOB (UTILITY),'DB2 DSN1COPY',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*
//*       DB2 DSN1COPY UTILITY
//*
//****************************************************************
//*
//JOBLIB DD DSN=DSN810.DSNEXIT,DISP=SHR
//       DD DSN=DSN810.DSNLOAD,DISP=SHR
//DSN1COPY EXEC PGM=DSN1COPY,PARM='OBIDXLAT'
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SYSUT1 DD DSN=DB2CAT.DSNDBC.DSN8D81A.DSN8S81D.I0001.A001,DISP=OLD,AMP=(''BUFND=81')
//SYSUT2 DD DSN=DB2CATP.DSNDBC.DSN8D81A.DSN8S81D.I0001.A001,DISP=OLD,AMP=('BUFND=181')
//*
//*  The SYSXLAT input will ::
//*       Translate the DBID 283 (sending) into 201 on
//*       the receiving end.
//*       Translate the OBID 2 (sending) into 3 on the
//*       receiving end.
//*       Translate the PSID 20 (sending) into 8 on the
//*       receiving end.
//*
//SYSXLAT DD *
283  201
2    3
20   8
/*
//
</PRE><BR>

<P class="docText">The object identifiers for the old objects can be found in two ways. First, you can scan old <TT>DBID</TT>/<TT>PSID</TT>/<TT>OBID</TT> reports. Second, you can use <TT>DSN1PRNT</TT> to list the first three pages of the copy data set. The object identifiers are shown in the formatted listing produced for those pages. Obtain the new object identifiers using the DB2 Catalog reports listed in <A class="docLink" HREF="ch26.html#ch26">Chapter 26</A>, "DB2 Object Monitoring Using the DB2 Catalog and RTS."</P>
<A NAME="ch35lev2sec12"></A><H4 class="docSection2Title"><TT>DSN1COPY</TT> Guidelines</H4>
<P class="docText">When planning your <TT>DSN1COPY</TT> jobs, be sure to consult the following tips and guidelines.</P>
<A NAME="ch35lev4sec16"></A><H5 class="docSection3Title">Issue the Stop Command Before Running <TT>DSN1COPY</TT></H5>
<P class="docText">Never run the <TT>DSN1COPY</TT> utility for a DB2 object until it has been explicitly stopped for all access in the appropriate DB2 subsystem. This advice can be ignored if DB2 is not active.<A NAME="ch35index147"></A><A NAME="ch35index148"></A><A NAME="ch35index149"></A></P>
<A NAME="ch35lev4sec17"></A><H5 class="docSection3Title">Use <TT>DSN1PRNT</TT> Instead of <TT>DSN1COPY</TT> for Hex Dumps</H5>
<P class="docText">Although <TT>DSN1COPY</TT> can be used to obtain a hex dump of a DB2 data set, favor the use of <TT>DSN1PRNT</TT> because it produces a listing that is formatted, and thus easier to use.<A NAME="ch35index150"></A><A NAME="ch35index151"></A><A NAME="ch35index152"></A><A NAME="ch35index153"></A></P>
<A NAME="ch35lev4sec18"></A><H5 class="docSection3Title">Estimate the Size of <TT>SYSUT2</TT> Based on 4KB Pages</H5>
<P class="docText">When the <TT>SYSUT2</TT> data set is a sequential data set, estimate its size using the following formula:<A NAME="ch35index154"></A><A NAME="ch35index155"></A><A NAME="ch35index156"></A><A NAME="ch35index157"></A><A NAME="ch35index158"></A><A NAME="ch35index159"></A></P>
<pre>

</pre><BR><pre>
(Number of pages) x 4096
</pre><BR>
<P class="docText">Specify the space parameter in cylinders by rounding this number up to the next whole cylinder. If the object being copied uses a page size other than 4KB, use the following formulas:</P>
<BLOCKQUOTE><P><P class="docList">For 8KB pages, multiply the number by two</P></P><P><P class="docList">For 16KB pages, multiply the number by four</P></P><P><P class="docList">For 32KB pages multiply the number by eight</P></P></BLOCKQUOTE>
<P class="docText">Also, remember to specify the appropriate <TT>PAGESIZE</TT> option of <TT>DSN1COPY</TT>: 4KB, 8KB, 16KB, or 32KB.</P>
<P class="docText">The total number of pages used by a table space can be retrieved from the VSAM <TT>LISTCAT</TT> command or the DB2 Catalog as specified in the <TT>NACTIVE</TT> column of <TT>SYSIBM.SYSTABLESPACE</TT>. If you are using the DB2 catalog method, ensure that the statistics are current by running the <TT>RUNSTATS</TT> utility.</P>
<A NAME="ch35lev4sec19"></A><H5 class="docSection3Title">Optimize the <TT>BUFND</TT> Parameter</H5>
<P class="docText">The default for the <TT>BUFND</TT> parameter is 2, which is too low. In order to boost I/O performance, change the <TT>BUFND</TT> parameter to a larger value. <TT>BUFND</TT> specifies the number of I/O buffers that VSAM will use for data records.<A NAME="ch35index160"></A><A NAME="ch35index161"></A><A NAME="ch35index162"></A><A NAME="ch35index163"></A><A NAME="ch35index164"></A></P>
<P class="docText">When using 3390 disk devices, consider coding <TT>BUFND=181</TT> which will hold a complete cylinder.</P>
<A NAME="ch35note12"></A><div class="docNote"><p class="docNoteTitle">CAUTION</p>

<P class="docText">Be sure to provide an adequate region size for your job to use 181 buffers. If the region size for your job is too small to allocate 181 data buffers, your job will fail. The message returned will be a <TT>DSN1996I</TT> indicating VSAM open error for the data set.</P></div><br>
<A NAME="ch35lev4sec20"></A><H5 class="docSection3Title">Use the <TT>PAGESIZE</TT> Parameter</H5>
<P class="docText">The <TT>PAGESIZE</TT> parameter of <TT>DSN1COPY</TT> should be used to specify the page size of the input data set for <TT>SYSUT1</TT>. Any of the valid page sizes—4K, 8K, 16K, or 32K—are valid. If you specify an incorrect page size, the results of <TT>DSN1COPY</TT> will be unpredictable.<A NAME="ch35index165"></A><A NAME="ch35index166"></A><A NAME="ch35index167"></A><A NAME="ch35index168"></A><A NAME="ch35index169"></A></P>
<P class="docText"><TT>DSN1COPY</TT> will try to determine the proper page size if you fail to specify a <TT>PAGESIZE</TT> value. If <TT>DSN1COPY</TT> cannot determine the page size then the utility will fail and an error message will be issued.</P>
<A NAME="ch35lev4sec21"></A><H5 class="docSection3Title">Determine Proper Prefix</H5>
<P class="docText">Before running <TT>DSN1COPY</TT> on a table space, first you must determine the actual data set name for the table space to be examined. This information in <TT>SYSIBM.SYSTABLEPART</TT>. For example,<A NAME="ch35index170"></A><A NAME="ch35index171"></A><A NAME="ch35index172"></A><A NAME="ch35index173"></A></P>
<pre>

</pre><BR><pre>
SELECT DBNAME, TSNAME, PARTITION, IPREFIX
FROM   SYSIBM.SYSTABLEPART
WHERE  DBNAME = ?
AND    TSNAME = ?;
</pre><BR>
<P class="docText">Substitute the database name and table space name for the <TT>DBNAME</TT> and <TT>TSNAME</TT> predicates. Then, use the <TT>IPREFIX</TT> results to code the appropriate data set name. <TT>IPREFIX</TT> will contain either an "I" or a "J" depending on which version of the data set is currently active. If <TT>IPREFIX</TT> contains "J" then the data set should be coded as</P>
<pre>

</pre><BR><pre>
//SYSUT1 DD DSN=DB2CAT.DSNDBC.dbname.tsname.<span class="docEmphStrong">J</span>0001.A001,DISP=SHR
</pre><BR>
<P class="docText">If <TT>IPREFIX</TT> contains "I" then the data set should be coded as</P>
<pre>

</pre><BR><pre>
//SYSUT1 DD DSN=DB2CAT.DSNDBC.dbname.tsname.<span class="docEmphStrong">I</span>0001.A001,DISP=SHR
</pre><BR>
<P class="docText">You must specify the correct fifth level qualifier in the data set name for <TT>DSN1COPY</TT> to successfully copy the table space data.</P>
<A NAME="ch35lev4sec22"></A><H5 class="docSection3Title">Do Not Use <TT>DSN1COPY</TT> on Log Data Sets</H5>
<P class="docText">Avoid using the <TT>DSN1COPY</TT> utility on DB2 log data sets because certain options can invalidate the log data.<A NAME="ch35index174"></A><A NAME="ch35index175"></A><A NAME="ch35index176"></A><A NAME="ch35index177"></A><A NAME="ch35index178"></A></P>
<A NAME="ch35lev4sec23"></A><H5 class="docSection3Title">Use Appropriate Options with <TT>LOB</TT> Table Spaces</H5>
<P class="docText">You can use <TT>DSN1COPY</TT> on <TT>LOB</TT> table spaces, but you cannot specify the <TT>SEGMENT</TT> or <TT>INLCOPY</TT> options. Use the <TT>LOB</TT> keyword to use <TT>DSN1COPY</TT> with a <TT>LOB</TT> table space.<A NAME="ch35index179"></A><A NAME="ch35index180"></A><A NAME="ch35index181"></A><A NAME="ch35index182"></A><A NAME="ch35index183"></A></P>
<A NAME="ch35lev4sec24"></A><H5 class="docSection3Title">Use Appropriate Options with Large Table Spaces</H5>
<P class="docText">Use the <TT>DSSIZE</TT> parameter to specify the size of data sets that exceed 2GB (4GB for <TT>LOB</TT> table spaces). If you fail to specify this parameter, DB2 will assume that the size of the input data set is 2GB. <TT>DSN1COPY</TT> results will be unpredictable if the <TT>DSSIZE</TT> parameter is not coded for data sets that exceed 2GB.<A NAME="ch35index184"></A><A NAME="ch35index185"></A><A NAME="ch35index186"></A><A NAME="ch35index187"></A><A NAME="ch35index188"></A><A NAME="ch35index189"></A></P>
<P class="docText">When specifying the <TT>DSSIZE</TT> parameter, the size specified must match exactly the value used when the table space was defined.</P>
<P class="docText">You can specify <TT>LARGE</TT> instead of <TT>DSSIZE</TT> if the table space was defined with the <TT>LARGE</TT> parameter. However, it is better to use <TT>DSSIZE(4G)</TT> instead of <TT>LARGE</TT> because the <TT>LARGE</TT> parameter is being phased out in favor of <TT>DSSIZE</TT>.</P>
<A NAME="ch35lev4sec25"></A><H5 class="docSection3Title">Use Caution When Copying Data with an Identity Column</H5>

<P class="docText">When you are using <TT>DSN1COPY</TT> to copy table data where an identity column exists, you must take extra steps to set up the identity values appropriately. To accomplish this, the following steps should be taken:<A NAME="ch35index190"></A><A NAME="ch35index191"></A><A NAME="ch35index192"></A><A NAME="ch35index193"></A><A NAME="ch35index194"></A></P>
<A NAME="ch35pr02"></A>






<div style="font-weight:bold"><OL class="docList" START="1"><LI value="1"><div style="font-weight:normal">Be sure to stop the table space on the source DB2 subsystem.<BR><BR></div></LI><LI value="2"><div style="font-weight:normal">Find the sequence information in the DB2 Catalog for the identity column being copied. That information can be retrieved from <TT>SYSIBM.SYSSEQUENCES</TT>. Add the <TT>INCREMENT</TT> value to the <TT>MAXASSIGNEDVAL</TT> to let <TT>DSN1COPY</TT> assign the next value.<BR><BR></div></LI><LI value="3"><div style="font-weight:normal">Create the table on the target subsystem. On the identity column specification, specify that previously calculate the next value for the <TT>START WITH</TT> value. Also, be sure to code all of the other attributes of the identity column exactly as coded for the table on the source subsystem.<BR><BR></div></LI><LI value="4"><div style="font-weight:normal">Stop the table space on the target subsystem.<BR><BR></div></LI><LI value="5"><div style="font-weight:normal">Copy the data using <TT>DSN1COPY</TT>.<BR><BR></div></LI><LI value="6"><div style="font-weight:normal">Restart the table space on the source subsystem with the appropriate level of access.<BR><BR></div></LI><LI value="7"><div style="font-weight:normal">Start the table space on the target subsystem.<BR><BR></div></LI></OL></div>
<A NAME="ch35lev2sec13"></A><H4 class="docSection2Title">The DB2 Dump and Trace Program (<TT>DSN1SDMP</TT>)</H4>
<P class="docText"><TT>DSN1SDMP</TT> is the IFC selective dump utility. Although technically defined by IBM to be a service aid utility, <TT>DSN1SDMP</TT> is actually a DB2 application program. It must be run under the TSO terminal monitor program, <TT>IKJEFT01</TT>. <TT>DSN1SDMP</TT>, unlike the other service aids, can be run only when DB2 is operational.<A NAME="ch35index195"></A><A NAME="ch35index196"></A><A NAME="ch35index197"></A><A NAME="ch35index198"></A><A NAME="ch35index199"></A></P>
<P class="docText">Using the Instrumentation Facility Interface, <TT>DSN1SDMP</TT> can write DB2 trace records to a sequential data set named in the <TT>SDMPTRAC DD</TT> statement. It can also force system dumps for DB2 utilities or when specific DB2 events occur. For shops without a DB2 performance monitor, <TT>DSN1SDMP</TT> can come in handy in trying to resolve system problems. Sample JCL is shown in <A class="docLink" HREF="#ch35list08">Listing 35.8</A>.<A NAME="ch35index200"></A><A NAME="ch35index201"></A><A NAME="ch35index202"></A><A NAME="ch35index203"></A></P>
<A NAME="ch35list08"></A><H5 class="docExampleTitle">Listing 35.8. <TT>DSN1SDMP</TT> JCL</H5>

<PRE>
//DB2JOBU  JOB  (UTILITY),'DSN1SDMP',MSGCLASS=X,CLASS=X,
//        NOTIFY=USER
//*
//****************************************************************
//*
//*       DB2 FORCE DUMP UTILITY  : :
//*         CONSULT IBM BEFORE RUNNING
//*
//****************************************************************
//*
//JOBLIB DD DSN=DSN810.DSNLOAD,DISP=SHR
//DUMPER EXEC PGM=IKJEFT01,DYNAMNBR=20
//SYSTSPRT DD  SYSOUT=*
//SYSPRINT DD  SYSOUT=*
//SYSUDUMP DD  SYSOUT=*
//SDMPPRNT DD SYSOUT=*
//SDMPTRAC DD DSN=CAT.TRACE.SEQ.DATASET,
//        DISP=(MOD,CATLG,CATLG),SPACE=(8192,(100,100)),UNIT=SYSDA,
//        DCB=(DSORG=PS,RECFM=VB,LRECL=8188,BLKSIZE=8192)
//SYSTSIN  DD  *
DSN SYSTEM(DSN)
RUN PROGRAM(DSN1SDMP)  PLAN(DSN1SDMP)  -
LIB('DSN810.RUNLIB.LOAD')
END
/*
//SDMPDD  *
CONSULT IBM BEFORE USING
IBM SUPPORT CENTER WILL PROVIDE OPTIONS
/*
//
</PRE><BR>

<A NAME="ch35lev2sec14"></A><H4 class="docSection2Title"><TT>DSN1SDMP</TT> Data Sets</H4>
<P><TABLE CELLSPACING="0" FRAME="void" RULES="none" CELLPADDING="5"><COLGROUP><COL width="170.5"><COL width="379.5"></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SDMPIN</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Input parameters to the <TT>DSN1SDMP</TT> utility<A NAME="ch35index204"></A><A NAME="ch35index205"></A><A NAME="ch35index206"></A><A NAME="ch35index207"></A></P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SDMPPRNT</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>DSN1SDMP</TT> output messages</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SYSABEND</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">System dump if <TT>DSN1SDMP</TT> abends</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><P class="docText"><TT>SDMPTRAC</TT></P></TD><TD class="docTableCell" align="left" valign="top"><P class="docText">Output trace records</P></TD></TR></TABLE></P><br>
<A NAME="ch35lev2sec15"></A><H4 class="docSection2Title"><TT>DSN1SDMP</TT> Guidelines</H4>
<P class="docText">You can use the following guidelines as a blueprint for effective <TT>DSN1SDMP</TT> usage.</P>
<A NAME="ch35lev4sec26"></A><H5 class="docSection3Title">Use <TT>DSN1SDMP</TT> Only As Directed</H5>
<P class="docText"><TT>DSN1SDMP</TT> should be used only under instructions from the IBM Support Center.<A NAME="ch35index208"></A><A NAME="ch35index209"></A><A NAME="ch35index210"></A></P>
<A NAME="ch35lev4sec27"></A><H5 class="docSection3Title">Be Sure That the User Has the Authority to Run <TT>DSN1SDMP</TT></H5>
<P class="docText">To execute the <TT>DSN1SDMP</TT> service aid, the requester must have the requisite authority to start and stop the DB2 traces, as well as the <TT>MONITOR1</TT> or <TT>MONITOR2</TT> privilege.<A NAME="ch35index211"></A><A NAME="ch35index212"></A><A NAME="ch35index213"></A><A NAME="ch35index214"></A><A NAME="ch35index215"></A></P>
<A NAME="ch35lev4sec28"></A><H5 class="docSection3Title">The Recovery Log Extractor (<TT>DSN1LOGP</TT>)</H5>
<P class="docText"><TT>DSN1LOGP</TT>, otherwise known as the Recovery Log Extractor, produces a formatted listing of a specific DB2 recovery log. When an active log is operated on by <TT>DSN1LOGP</TT>, an active DB2 subsystem must not be currently processing the log. Any archive log can be processed at any time—whether DB2 is operational or not.<A NAME="ch35index216"></A><A NAME="ch35index217"></A><A NAME="ch35index218"></A><A NAME="ch35index219"></A><A NAME="ch35index220"></A></P>
<P class="docText"><TT>DSN1LOGP</TT> produces a detailed or a summary report. The detailed report displays entire log records. The summary report condenses the log records, displaying only the information necessary to request a partial recovery. As such, the detailed report is rarely used. Sample JCL is shown in <A class="docLink" HREF="#ch35list09">Listing 35.9</A>.</P>
<A NAME="ch35list09"></A><H5 class="docExampleTitle">Listing 35.9. <TT>DSN1LOGP</TT> JCL</H5><A NAME="ch35index221"></A><A NAME="ch35index222"></A><A NAME="ch35index223"></A><A NAME="ch35index224"></A>

<PRE>
//DB2JOBU  JOB (UTILITY),'DSN1LOGP',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*
//*       DB2 RECOVERY LOG EXTRACTOR
//*
//****************************************************************
//*
//DSN1LOGP PGM=DSN1LOGP
//SYSPRINT DD SYSOUT=*
//SYSABEND DD SYSOUT=*
//SYSSUMRY DD SYSOUT=*
//BSDS DD DSN=DB2CAT.BSDS01,DISP=SHR
//SYSIN DD *
RBASTART(E300F4)
RBAEND(F40000)
SUMMARY(YES)
/*
//
</PRE><BR>

<A NAME="ch35lev2sec16"></A><H4 class="docSection2Title"><TT>DSN1LOGP</TT> Guidelines</H4>
<P class="docText">The following techniques can be used to produce effective log extract reports using the <TT>DSN1LOGP</TT> service aid.</P>
<A NAME="ch35lev4sec29"></A><H5 class="docSection3Title">Do Not Run <TT>DSN1LOGP</TT> on the Active Log</H5>
<P class="docText"><TT>DSN1LOGP</TT> cannot be run on the active log that DB2 is currently using for logging. It can be run on the other active logs as well as on the archive logs. Given this caveat, <TT>DSN1LOGP</TT> can be run while DB2 is operational.<A NAME="ch35index225"></A><A NAME="ch35index226"></A><A NAME="ch35index227"></A><A NAME="ch35index228"></A><A NAME="ch35index229"></A></P>
<A NAME="ch35lev4sec30"></A><H5 class="docSection3Title">Use the <TT>DSN1LOGP</TT> Output to Assist in Recovery</H5>
<P class="docText">You can use the output report produced by the <TT>DSN1LOGP</TT> service aid utility to determine an appropriate log RBA for partial recovery by the <TT>RECOVER TORBA</TT> utility. This method should be used only when an appropriate log RBA is available in the <TT>SYSIBM.SYSCOPY</TT> table as the result of running the <TT>QUIESCE</TT> utility.<A NAME="ch35index230"></A><A NAME="ch35index231"></A><A NAME="ch35index232"></A></P>
<A NAME="ch35lev2sec17"></A><H4 class="docSection2Title">The DB2 Data Set Dump Creator (<TT>DSN1PRNT</TT>)</H4>
<P class="docText">The program name for the DB2 Data Set Dump Creator is <TT>DSN1PRNT</TT>. It can be used to print hexadecimal and formatted dumps of DB2 table space, indexspace, and image copy data sets. It is useful for searching for values and dumping only the pages containing the specified value. Sample JCL is in <A class="docLink" HREF="#ch35list10">Listing 35.10</A>.<A NAME="ch35index233"></A><A NAME="ch35index234"></A><A NAME="ch35index235"></A><A NAME="ch35index236"></A><A NAME="ch35index237"></A></P>
<A NAME="ch35list10"></A><H5 class="docExampleTitle">Listing 35.10. <TT>DSN1PRNT</TT> JCL</H5><A NAME="ch35index238"></A><A NAME="ch35index239"></A><A NAME="ch35index240"></A><A NAME="ch35index241"></A>

<PRE>
//DB2JOBU  JOB (UTILITY),'DSN1PRNT',MSGCLASS=X,CLASS=X,
//          NOTIFY=USER
//*
//****************************************************************
//*
//*       DB2 DATA SET DUMP SERVICE AID
//*
//****************************************************************
//*
//DSN1PRNT PGM=DSN1PRNT,PARM='PRINT,FORMAT'
//SYSPRINT DD SYSOUT=*
//SYSUT1 DD DSN=DB2CAT.DSNDBC.DSN8D81A.DSN8S81D.I0001.A001,DISP=SHR,AMP=('BUFND=181')
//
</PRE><BR>

<A NAME="ch35lev2sec18"></A><H4 class="docSection2Title"><TT>DSN1PRNT</TT> Guidelines</H4>
<P class="docText">Consider the following guidelines when using <TT>DNS1PRNT</TT> to dump DB2 data sets.</P>
<A NAME="ch35lev4sec31"></A><H5 class="docSection3Title">Analyze Problems Using <TT>DSN1PRNT</TT> Output</H5>
<P class="docText">Use <TT>DSN1PRNT</TT> to track down data problems and page errors. By scanning the dump of a DB2 data set, you can view the format of the page and the data on the page.<A NAME="ch35index242"></A><A NAME="ch35index243"></A><A NAME="ch35index244"></A></P>
<A NAME="ch35lev4sec32"></A><H5 class="docSection3Title">Be Aware of Potential Errors</H5>
<P class="docText">If <TT>DSN1PRNT</TT> encounters an error on a page of a DB2 data set, an error message is printed. If you specified the <TT>FORMAT</TT> option, the output is not formatted. All pages without errors are formatted.<A NAME="ch35index245"></A><A NAME="ch35index246"></A><A NAME="ch35index247"></A><A NAME="ch35index248"></A></P>
<A NAME="ch35lev4sec33"></A><H5 class="docSection3Title">Use <TT>DSN1PRNT</TT> for All DB2 Data Set Dumps</H5>
<P class="docText">Favor the use of <TT>DSN1PRNT</TT> over other data set dump utilities (such as <TT>DSN1COPY</TT>) because of the formatting feature of <TT>DSN1PRNT</TT>.<A NAME="ch35index249"></A><A NAME="ch35index250"></A><A NAME="ch35index251"></A></P>
<A NAME="ch35lev4sec34"></A><H5 class="docSection3Title">Run <TT>DSN1PRNT</TT> Only for Stopped DB2 Objects</H5>
<P class="docText">When running <TT>DSN1PRNT</TT> when DB2 is active, be sure that the data set being dumped has been stopped. This ensures that the data being dumped is accurate and unchanging.<A NAME="ch35index252"></A><A NAME="ch35index253"></A><A NAME="ch35index254"></A></P>
<P class="docText">Of course, if your shop requires 24x7 availability stopping DB2 is not an option. You can run <TT>DSN1PRNT</TT> with DB2 up and running, but you will have to live with the possibility of data anomalies.</P>
<A NAME="ch35lev4sec35"></A><H5 class="docSection3Title">Be Aware of Data Set Page Sizes</H5>
<P class="docText">If the object being dumped uses non-4KB pages, remember to specify the <TT>PAGESIZE</TT> option of <TT>DSN1PRNT</TT>. Specify the appropriate page size for the data set being printed: 4KB, 8KB, 16KB, or 32KB.<A NAME="ch35index255"></A><A NAME="ch35index256"></A><A NAME="ch35index257"></A><A NAME="ch35index258"></A></P>
<A NAME="ch35lev4sec36"></A><H5 class="docSection3Title">Use the <TT>PAGESIZE</TT> Parameter</H5>
<P class="docText">The <TT>PAGESIZE</TT> parameter of <TT>DSN1PRNT</TT> should be used to specify the page size of the input data set for <TT>SYSUT1</TT>. Any of the valid page sizes—4K, 8K, 16K, or 32K—are valid. If you specify an incorrect page size, the results of <TT>DSN1PRNT</TT> will be unpredictable.<A NAME="ch35index259"></A><A NAME="ch35index260"></A><A NAME="ch35index261"></A><A NAME="ch35index262"></A><A NAME="ch35index263"></A></P>
<P class="docText"><TT>DSN1PRNT</TT> will try to determine the proper page size if you fail to specify a <TT>PAGESIZE</TT> value. If <TT>DSN1PRNT</TT> cannot determine the page size, then the utility will fail and an error message will be issued.</P>
<A NAME="ch35lev4sec37"></A><H5 class="docSection3Title">Use Appropriate Options for <TT>LOB</TT> Table Spaces</H5>
<P class="docText">You can use <TT>DSN1PRNT</TT> with <TT>LOB</TT> table spaces. To do so, be sure to specify the <TT>LOB</TT> parameter, and do not specify the <TT>INLCOPY</TT> parameter.<A NAME="ch35index264"></A><A NAME="ch35index265"></A><A NAME="ch35index266"></A><A NAME="ch35index267"></A><A NAME="ch35index268"></A></P>
<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="ch35.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="ch35lev1sec2.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
