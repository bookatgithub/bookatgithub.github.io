<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>31.8 &#9733; Primality testing</title>
<link rel="STYLESHEET" type="text/css" href="images/xpolecat.css">
<link rel="STYLESHEET" type="text/css" href="images/ie.content.books24x7.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td align="left" width="30%">
<div STYLE="MARGIN-LEFT: 0.15in;">
<a href="DDU0206.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</div></td>
<td align="center" width="40%">
<a href="toc.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td align="right" width="30%">
<div STYLE="MARGIN-RIGHT: 0.15in"><a href="DDU0208.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr>
</table>
<hr size="1">
<br>
<div class="chapter">
<a name="ch31"></a>
<div class="section">
<h2 class="first-section-title">
<a name="2780"></a><a name="ch31lev1sec8"></a><span class="section-titlelabel">31.8 </span><span class="unicode">&#9733;</span> Primality testing</h2>
<p class="first-para">In this section, we consider the problem of finding large primes. We begin with a discussion of the density of primes, proceed to examine a plausible (but incomplete) approach to primality testing, and then present an effective randomized primality test due to Miller and Rabin.</p>
<div class="section">
<h4 class="sect4-title">
<a name="2781"></a><a name="ch31lev3sec18"></a>The density of prime numbers</h4>
<p class="first-para">For many applications (such as cryptography), we need to find large "random" primes. Fortunately, large primes are not too rare, so that it is not too time-<a name="2782"></a><a name="IDX-888"></a>consuming to test random integers of the appropriate size until a prime is found. The <b class="bold"><i class="emphasis">prime distribution function</i></b> <span class="unicode">&pi;</span>(<i class="emphasis">n</i>) specifies the number of primes that are less than or equal to <i class="emphasis">n</i>. For example, <span class="unicode">&pi;</span>(10) = 4, since there are 4 prime numbers less than or equal to 10, namely, 2, 3, 5, and 7. The prime number theorem gives a useful approximation to <span class="unicode">&pi;</span>(<i class="emphasis">n</i>).</p>
<div class="example">
<span class="example-title"><span class="example-titlelabel">Theorem 31.37: </span>(Prime number theorem)</span>
<div class="formalbody">
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="Start example" border="0"></b></font></td>
</tr>
</table>
<div class="informalequation">
<span class="equation-image"><img src="images/fig910_01.jpg" height="37" width="108" alt="" border="0"></span>
</div>
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="End example" border="0"></b></font></td>
</tr>
</table>
<table class="BlankSpace" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td height="16"></td>
</tr>
</table>
</div>
</div>
<p class="para">The approximation <i class="emphasis">n</i>/ ln <i class="emphasis">n</i> gives reasonably accurate estimates of <span class="unicode">&pi;</span>(<i class="emphasis">n</i>) even for small <i class="emphasis">n</i>. For example, it is off by less than 6% at <i class="emphasis">n</i> = 109, where <span class="unicode">&pi;</span>(<i class="emphasis">n</i>) = 50,847,534 and <i class="emphasis">n</i>/ ln <i class="emphasis">n</i> <span class="unicode">&asymp;</span> 48,254,942. (To a number theorist, 10<sup>9</sup> is a small number.)</p>
<p class="para">We can use the prime number theorem to estimate the probability that a randomly chosen integer <i class="emphasis">n</i> will turn out to be prime as 1/ ln <i class="emphasis">n</i>. Thus, we would need to examine approximately ln <i class="emphasis">n</i> integers chosen randomly near <i class="emphasis">n</i> in order to find a prime that is of the same length as <i class="emphasis">n</i>. For example, to find a 512-bit prime might require testing approximately ln 2<sup>512</sup> <span class="unicode">&asymp;</span> 355 randomly chosen 512-bit numbers for primality. (This figure can be cut in half by choosing only odd integers.)</p>
<p class="para">In the remainder of this section, we consider the problem of determining whether or not a large odd integer <i class="emphasis">n</i> is prime. For notational convenience, we assume that <i class="emphasis">n</i> has the prime factorization</p>
<div class="equation">
<table border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><span class="equation-label">(31.37)&nbsp;</span></td><td valign="top"><span class="equation-image"><img src="images/fig910_02.jpg" height="21" width="118" alt="" border="0"></span></td>
</tr>
</table>
</div>
<p class="para">where <i class="emphasis">r</i> <span class="unicode">&ge;</span> 1, <i class="emphasis">p</i><sub>1</sub>, <i class="emphasis">p</i><sub>2</sub>, ..., <i class="emphasis">p<sub>r</sub></i> are the prime factors of <i class="emphasis">n</i>, and <i class="emphasis">e</i><sub>1</sub>, <i class="emphasis">e</i><sub>2</sub>, ..., <i class="emphasis">e<sub>r</sub></i> are positive integers. Of course, <i class="emphasis">n</i> is prime if and only if <i class="emphasis">r</i> = 1 and <i class="emphasis">e</i><sub>1</sub> = 1.</p>
<p class="para">One simple approach to the problem of testing for primality is <b class="bold"><i class="emphasis">trial division</i></b>. We try dividing <i class="emphasis">n</i> by each integer 2, 3, ..., <span class="inlinemediaobject"><img src="images/fig910_03.jpg" height="18" width="30" alt="" border="0"></span>. (Again, even integers greater than 2 may be skipped.) It is easy to see that <i class="emphasis">n</i> is prime if and only if none of the trial divisors divides <i class="emphasis">n</i>. Assuming that each trial division takes constant time, the worst-case running time is <span class="inlinemediaobject"><img src="images/fig910_04.jpg" height="18" width="45" alt="" border="0"></span>, which is exponential in the length of <i class="emphasis">n</i>. (Recall that if <i class="emphasis">n</i> is encoded in binary using <i class="emphasis"><span class="unicode">&beta;</span></i> bits, then <i class="emphasis"><span class="unicode">&beta;</span></i> = <span class="unicode">&lceil;</span>lg(<i class="emphasis">n</i> + 1)<span class="unicode">&rceil;</span>, and so <span class="inlinemediaobject"><img src="images/fig910_05.jpg" height="14" width="67" alt="" border="0"></span>.) Thus, trial division works well only if <i class="emphasis">n</i> is very small or happens to have a small prime factor. When it works, trial division has the advantage that it not only determines whether <i class="emphasis">n</i> is prime or composite, but also determines one of <i class="emphasis">n</i>'s prime factors if <i class="emphasis">n</i> is composite.</p>
<p class="last-para">In this section, we are interested only in finding out whether a given number <i class="emphasis">n</i> is prime; if <i class="emphasis">n</i> is composite, we are not concerned with finding its prime factorization. As we shall see in <a href="DDU0208.html#2799" target="_parent" class="chapterjump">Section 31.9</a>, computing the prime factorization of a number is computationally expensive. It is perhaps surprising that it is much easier <a name="2783"></a><a name="IDX-889"></a>to tell whether or not a given number is prime than it is to determine the prime factorization of the number if it is not prime.</p>

</div>
<div class="section">
<h4 class="sect4-title">
<a name="2784"></a><a name="ch31lev3sec19"></a>Pseudoprimality testing</h4>
<p class="first-para">We now consider a method for primality testing that "almost works" and in fact is good enough for many practical applications. A refinement of this method that removes the small defect will be presented later. Let <span class="inlinemediaobject"><img src="images/fig911_01.jpg" height="13" width="15" alt="" border="0"></span> denote the nonzero elements of <b class="bold">Z</b><sub><i class="emphasis">n</i></sub>:</p>
<div class="informalequation">
<span class="equation-image"><img src="images/fig911_02.jpg" height="18" width="149" alt="" border="0"></span>
</div>
<p class="para">If <i class="emphasis">n</i> is prime, then <span class="inlinemediaobject"><img src="images/fig911_03.jpg" height="14" width="41" alt="" border="0"></span>.</p>
<p class="para">We say that <i class="emphasis">n</i> is a <b class="bold"><i class="emphasis">base-a pseudoprime</i></b> if <i class="emphasis">n</i> is composite and</p>
<div class="equation">
<table border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><span class="equation-label">(31.38)&nbsp;</span></td><td valign="top"><span class="equation-image"><img src="images/fig911_04.jpg" height="19" width="122" alt="" border="0"></span></td>
</tr>
</table>
</div>
<p class="para">Fermat's theorem (<a href="DDU0205.html#2748" target="_parent" class="chapterjump">Theorem 31.31</a>) implies that if <i class="emphasis">n</i> is prime, then <i class="emphasis">n</i> satisfies <a href="DDU0202.html#2706" target="_parent" class="chapterjump">equation (31.38)</a> for every <i class="emphasis">a</i> in <span class="inlinemediaobject"><img src="images/fig911_05.jpg" height="14" width="15" alt="" border="0"></span>. Thus, if we can find any <span class="inlinemediaobject"><img src="images/fig911_06.jpg" height="14" width="35" alt="" border="0"></span> such that <i class="emphasis">n</i> does <i class="emphasis">not</i> satisfy <a href="DDU0202.html#2706" target="_parent" class="chapterjump">equation (31.38)</a>, then <i class="emphasis">n</i> is certainly composite. Surprisingly, the converse <i class="emphasis">almost</i> holds, so that this criterion forms an almost perfect test for primality. We test to see if <i class="emphasis">n</i> satisfies <a href="DDU0202.html#2706" target="_parent" class="chapterjump">equation (31.38)</a> for <i class="emphasis">a</i> = 2. If not, we declare <i class="emphasis">n</i> to be composite. Otherwise, we output a guess that <i class="emphasis">n</i> is prime (when, in fact, all we know is that <i class="emphasis">n</i> is either prime or a base-2 pseudoprime).</p>
<p class="para">The following procedure pretends in this manner to be checking the primality of <i class="emphasis">n</i>. It uses the procedure MODULAR-EXPONENTIATION from <a href="DDU0205.html#2746" target="_parent" class="chapterjump">Section 31.6.</a> The input <i class="emphasis">n</i> is assumed to be an odd integer greater than 2.</p>
<div class="informalexample">
<pre class="literallayout-normal">
PSEUDOPRIME(<i class="emphasis">n</i>)
1  <b class="bold">if</b> MODULAR-EXPONENTIATION(2 = <i class="emphasis">n</i> - 1, <i class="emphasis">n</i>) <span class="unicode">&#8802;</span> 1 (mod <i class="emphasis">n</i>)
2     <b class="bold">then return</b> COMPOSITE         <span class="unicode">&#9657;</span> Definitely.
3     <b class="bold">else return</b> PRIME                   <span class="unicode">&#9657;</span> We hope!
</pre>
</div>
<p class="para">This procedure can make errors, but only of one type. That is, if it says that <i class="emphasis">n</i> is composite, then it is always correct. If it says that <i class="emphasis">n</i> is prime, however, then it makes an error only if <i class="emphasis">n</i> is a base-2 pseudoprime.</p>
<p class="para">How often does this procedure err? Surprisingly rarely. There are only 22 values of <i class="emphasis">n</i> less than 10,000 for which it errs; the first four such values are 341, 561, 645, and 1105. It can be shown that the probability that this program makes an error on a randomly chosen <i class="emphasis"><span class="unicode">&beta;</span></i>-bit number goes to zero as <i class="emphasis"><span class="unicode">&beta;</span></i> <span class="unicode">&larr;</span> <span class="unicode">&infin;</span>. Using more precise estimates due to <a href="DDU0259.html#3799" target="_parent" class="chapterjump">Pomerance [244]</a> of the number of base-2 pseudoprimes of a given size, we may estimate that a randomly chosen 512-bit number that is called prime by the above procedure has less than one chance in 10<sup>20</sup> of being a base-2 pseudoprime, and a randomly chosen 1024-bit number that is called prime <a name="2785"></a><a name="IDX-890"></a>has less than one chance in 10<sup>41</sup> of being a base-2 pseudoprime. So if you are merely trying to find a large prime for some application, for all practical purposes you almost never go wrong by choosing large numbers at random until one of them causes PSEUDOPRIME to output PRIME. But when the numbers being tested for primality are not randomly chosen, we need a better approach for testing primality. As we shall see, a little more cleverness, and some randomization, will yield a primality-testing routine that works well on all inputs.</p>
<p class="para">Unfortunately, we cannot entirely eliminate all the errors by simply checking <a href="DDU0202.html#2706" target="_parent" class="chapterjump">equation (31.38)</a> for a second base number, say <i class="emphasis">a</i> = 3, because there are composite integers <i class="emphasis">n</i> that satisfy <a href="DDU0202.html#2706" target="_parent" class="chapterjump">equation (31.38)</a> for <i class="emphasis">all</i> <span class="inlinemediaobject"><img src="images/fig912_01.jpg" height="13" width="35" alt="" border="0"></span>. These integers are known as <b class="bold"><i class="emphasis">Carmichael numbers</i></b>. The first three Carmichael numbers are 561, 1105, and 1729. Carmichael numbers are extremely rare; there are, for example, only 255 of them less than 100,000,000. <a class="internaljump" href="#ch31ex81">Exercise 31.8-2</a> helps explain why they are so rare.</p>
<p class="last-para">We next show how to improve our primality test so that it won't be fooled by Carmichael numbers.</p>

</div>
<div class="section">
<h4 class="sect4-title">
<a name="2786"></a><a name="ch31lev3sec20"></a>The Miller-Rabin randomized primality test</h4>
<p class="first-para">The Miller-Rabin primality test overcomes the problems of the simple test PSEUDOPRIME with two modifications:</p>
<ul class="itemizedlist">
<li class="first-listitem">
<p class="first-para">It tries several randomly chosen base values <i class="emphasis">a</i> instead of just one base value.</p>
</li>
<li class="listitem">
<p class="first-para">While computing each modular exponentiation, it notices if a nontrivial square root of 1, modulo <i class="emphasis">n</i>, is discovered during the final set of squarings. If so, it stops and outputs COMPOSITE. <a href="DDU0205.html#2753" target="_parent" class="chapterjump">Corollary 31.35</a> justifies detecting composites in this manner.</p>
</li>
</ul>
<p class="para">The pseudocode for the Miller-Rabin primality test follows. The input <i class="emphasis">n</i> <span class="unicode">&gt;</span> 2 is the odd number to be tested for primality, and <i class="emphasis">s</i> is the number of randomly chosen base values from <span class="inlinemediaobject"><img src="images/fig912_02.jpg" height="14" width="14" alt="" border="0"></span> to be tried. The code uses the random-number generator RANDOM described on page 94: RANDOM(1, <i class="emphasis">n</i> - 1) returns a randomly chosen integer <i class="emphasis">a</i> satisfying 1 <span class="unicode">&le;</span> <i class="emphasis">a</i> <span class="unicode">&le;</span> <i class="emphasis">n</i> - 1. The code uses an auxiliary procedure WITNESS such that WITNESS(<i class="emphasis">a</i>, <i class="emphasis">n</i>) is TRUE if and only if <i class="emphasis">a</i> is a "witness" to the compositeness of <i class="emphasis">n</i><span class="unicode">-</span>that is, if it is possible using <i class="emphasis">a</i> to prove (in a manner that we shall see) that <i class="emphasis">n</i> is composite. The test WITNESS(<i class="emphasis">a</i>, <i class="emphasis">n</i>) is an extension of, but more effective than, the test</p>
<p class="para">
<i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> <span class="unicode">&#8802;</span> 1 (mod <i class="emphasis">n</i>)</p>
<p class="para">that formed the basis (using <i class="emphasis">a</i> = 2) for PSEUDOPRIME. We first present and justify the construction of WITNESS, and then show how it is used in the Miller-Rabin primality test. Let <i class="emphasis">n</i> -1 = 2<sup><i class="emphasis">t</i></sup><i class="emphasis">u</i> where <i class="emphasis">t</i> <span class="unicode">&ge;</span> 1 and <i class="emphasis">u</i> is odd; i.e., the binary representation of <i class="emphasis">n</i> - 1 is the binary representation of the odd integer <i class="emphasis">u</i> followed by exactly <i class="emphasis">t</i> <a name="2787"></a><a name="IDX-891"></a>zeros. Therefore, <span class="inlinemediaobject"><img src="images/fig913_01.jpg" height="14" width="62" alt="" border="0"></span> (mod <i class="emphasis">n</i>), so that we can compute <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> mod <i class="emphasis">n</i> by first computing <i class="emphasis">a<sup>u</sup></i> mod <i class="emphasis">n</i> and then squaring the result <i class="emphasis">t</i> times successively.</p>
<div class="informalexample">
<pre class="literallayout-normal">
WITNESS(<i class="emphasis">a</i>, <i class="emphasis">n</i>)
1  let <i class="emphasis">n</i> - 1 = 2<sup><i class="emphasis">t</i></sup><i class="emphasis">u</i>, where <i class="emphasis">t</i> <span class="unicode">&ge;</span> 1 and <i class="emphasis">u</i> is odd
2  <i class="emphasis">x</i><sub>0</sub> <span class="unicode">&larr;</span> MODULAR-EXPONENTIATION(<i class="emphasis">a</i>, <i class="emphasis">u</i>, <i class="emphasis">n</i>)
3  <b class="bold">for</b> <i class="emphasis">i</i> <span class="unicode">&larr;</span> 1 <b class="bold">to</b> <i class="emphasis">t</i>
4       <b class="bold">do</b><span class="inlinemediaobject"><img src="images/fig913_02.jpg" height="14" width="46" alt="" border="0"></span> mod <i class="emphasis">n</i>
5          <b class="bold">if</b> <i class="emphasis">x<sub>i</sub></i> = 1 and <i class="emphasis">x</i><sub><i class="emphasis">i</i>-1</sub> <span class="unicode">&ne;</span> 1 and <i class="emphasis">x</i><sub><i class="emphasis">i</i>-1</sub> <span class="unicode">&ne;</span> <i class="emphasis">n</i> - 1
6             <b class="bold">then return</b> TRUE
7  <b class="bold">if</b> <i class="emphasis">x<sub>t</sub></i> <span class="unicode">&ne;</span> 1
8     <b class="bold">then return</b> TRUE
9  <b class="bold">return</b> FALSE
</pre>
</div>
<p class="para">This pseudocode for WITNESS computes <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> mod <i class="emphasis">n</i> by first computing the value <i class="emphasis">x</i><sub>0</sub> = <i class="emphasis">a<sup>u</sup></i> mod <i class="emphasis">n</i> in line 2, and then squaring the result <i class="emphasis">t</i> times in a row in the <b class="bold">for</b> loop of lines 3<span class="unicode">-</span>6. By induction on <i class="emphasis">i</i>, the sequence <i class="emphasis">x</i><sub>0</sub>, <i class="emphasis">x</i><sub>1</sub>, ..., <i class="emphasis">x<sub>t</sub></i> of values computed satisfies the equation <span class="inlinemediaobject"><img src="images/fig913_03.jpg" height="15" width="43" alt="" border="0"></span> (mod <i class="emphasis">n</i>) for <i class="emphasis">i</i> = 0, 1, ..., <i class="emphasis">t</i>, so that in particular <i class="emphasis">x<sub>t</sub></i> <span class="unicode">&#8802;</span> <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> (mod <i class="emphasis">n</i>). Whenever a squaring step is performed on line 4, however, the loop may terminate early if lines 5<span class="unicode">-</span>6 detect that a nontrivial square root of 1 has just been discovered. If so, the algorithm stops and returns TRUE. Lines 7<span class="unicode">-</span>8 return TRUE if the value computed for <i class="emphasis">x<sub>t</sub></i> <span class="unicode">&#8802;</span> <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> (mod <i class="emphasis">n</i>) is not equal to 1, just as the PSEUDOPRIME procedure returns COMPOSITE in this case. Line 9 returns FALSE if we haven't returned TRUE in lines 6 or 8.</p>
<p class="para">We now argue that if WITNESS(<i class="emphasis">a</i>, <i class="emphasis">n</i>) returns TRUE, then a proof that <i class="emphasis">n</i> is composite can be constructed using <i class="emphasis">a</i>.</p>
<p class="para">If WITNESS returns TRUE from line 8, then it has discovered that <i class="emphasis">x<sub>t</sub></i> = <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> mod <i class="emphasis">n</i> <span class="unicode">&ne;</span> 1. If <i class="emphasis">n</i> is prime, however, we have by Fermat's theorem (<a href="DDU0205.html#2748" target="_parent" class="chapterjump">Theorem 31.31</a>) that <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> <span class="unicode">&#8802;</span> 1 (mod <i class="emphasis">n</i>) for all <span class="inlinemediaobject"><img src="images/fig913_04.jpg" height="14" width="34" alt="" border="0"></span>. Therefore, <i class="emphasis">n</i> cannot be prime, and the equation <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> mod <i class="emphasis">n</i> <span class="unicode">&ne;</span> 1 is a proof of this fact.</p>
<p class="para">If WITNESS returns TRUE from line 6, then it has discovered that <i class="emphasis">x</i><sub><i class="emphasis">i</i>-1</sub> is a nontrivial square root of <i class="emphasis">x<sub>i</sub></i> = 1, modulo <i class="emphasis">n</i>, since we have that <i class="emphasis">x</i><sub><i class="emphasis">i</i>-1</sub> <span class="unicode">&#8802;</span> <span class="unicode">&plusmn;</span>1 (mod <i class="emphasis">n</i>) yet <span class="inlinemediaobject"><img src="images/fig913_05.jpg" height="14" width="64" alt="" border="0"></span> (mod <i class="emphasis">n</i>). <a href="DDU0205.html#2753" target="_parent" class="chapterjump">Corollary 31.35</a> states that only if <i class="emphasis">n</i> is composite can there be a nontrivial square root of 1 modulo <i class="emphasis">n</i>, so that a demonstration that <i class="emphasis">x</i><sub><i class="emphasis">i</i>-1</sub> is a nontrivial square root of 1 modulo <i class="emphasis">n</i> is a proof that <i class="emphasis">n</i> is composite.</p>
<p class="para">This completes our proof of the correctness of WITNESS. If the invocation WITNESS(<i class="emphasis">a</i>, <i class="emphasis">n</i>) outputs TRUE, then <i class="emphasis">n</i> is surely composite, and a proof that <i class="emphasis">n</i> is composite can be easily determined from <i class="emphasis">a</i> and <i class="emphasis">n</i>.</p>
<p class="para">At this point we briefly present an alternative description of the behavior of WITNESS as a function of the sequence <i class="emphasis">X</i> = <span class="unicode">&#12296;</span><i class="emphasis">x</i><sub>0</sub>, <i class="emphasis">x</i><sub>1</sub>, ..., <i class="emphasis">x<sub>t</sub></i><span class="unicode">&#12297;</span>, which you may find useful later on, when we analyze the efficiency of the Miller-Rabin primality test. Note that if <i class="emphasis">x<sub>i</sub></i> = 1 for some 0 <span class="unicode">&le;</span> <i class="emphasis">i</i> <span class="unicode">&lt;</span> <i class="emphasis">t</i>, WITNESS might not compute the rest <a name="2788"></a><a name="IDX-892"></a>of the sequence. If it were to do so, however, each value <i class="emphasis">x</i><sub><i class="emphasis">i</i>+1</sub>, <i class="emphasis">x</i><sub><i class="emphasis">i</i>+2</sub>, ..., <i class="emphasis">x<sub>t</sub></i> would be 1, and we consider these positions in the sequence <i class="emphasis">X</i> as being all 1's. We have four cases:</p>
<ol class="orderedlist">
<li class="first-listitem">
<p class="first-para">
<i class="emphasis">X</i> = <span class="unicode">&#12296;</span>..., <i class="emphasis">d</i><span class="unicode">&#12297;</span>, where <i class="emphasis">d</i> <span class="unicode">&ne;</span> 1: the sequence <i class="emphasis">X</i> does not end in 1. Return TRUE; <i class="emphasis">a</i> is a witness to the compositeness of <i class="emphasis">n</i> (by Fermat's Theorem).</p>
</li>
<li class="listitem">
<p class="first-para">
<i class="emphasis">X</i> = <span class="unicode">&#12296;</span>1, 1, ..., 1<span class="unicode">&#12297;</span>: the sequence <i class="emphasis">X</i> is all 1's. Return FALSE; <i class="emphasis">a</i> is not a witness to the compositeness of <i class="emphasis">n</i>.</p>
</li>
<li class="listitem">
<p class="first-para">
<i class="emphasis">X</i> = <span class="unicode">&#12296;</span>..., -1, 1, ..., 1<span class="unicode">&#12297;</span>: the sequence <i class="emphasis">X</i> ends in 1, and the last non-1 is equal to -1. Return FALSE; <i class="emphasis">a</i> is not a witness to the compositeness of <i class="emphasis">n</i>.</p>
</li>
<li class="listitem">
<p class="first-para">
<i class="emphasis">X</i> = <span class="unicode">&#12296;</span>..., <i class="emphasis">d</i>, 1, ..., 1<span class="unicode">&#12297;</span>, where <i class="emphasis">d</i> <span class="unicode">&ne;</span> <span class="unicode">&plusmn;</span>1: the sequence <i class="emphasis">X</i> ends in 1, but the last non-1 is not -1. Return TRUE; <i class="emphasis">a</i> is a witness to the compositeness of <i class="emphasis">n</i>, since <i class="emphasis">d</i> is a nontrivial square root of 1.</p>
</li>
</ol>
<p class="para">We now examine the Miller-Rabin primality test based on the use of WITNESS. Again, we assume that <i class="emphasis">n</i> is an odd integer greater than 2.</p>
<div class="informalexample">
<pre class="literallayout-normal">
MILLER-RABIN(<i class="emphasis">n</i>, <i class="emphasis">s</i>)
1  <b class="bold">for</b> <i class="emphasis">j</i> <span class="unicode">&larr;</span> 1 <b class="bold">to</b> <i class="emphasis">s</i>
2       <b class="bold">do</b> <i class="emphasis">a</i> <span class="unicode">&larr;</span> RANDOM(1, <i class="emphasis">n</i> - 1)
3          <b class="bold">if</b> WITNESS(<i class="emphasis">a</i>, <i class="emphasis">n</i>)
4            <b class="bold">then return</b> COMPOSITE   <span class="unicode">&#9657;</span> Definitely.
5  <b class="bold">return</b> PRIME                              <span class="unicode">&#9657;</span> Almost surely.
</pre>
</div>
<p class="para">The procedure MILLER-RABIN is a probabilistic search for a proof that <i class="emphasis">n</i> is composite. The main loop (beginning on line 1) picks <i class="emphasis">s</i> random values of <i class="emphasis">a</i> from <span class="inlinemediaobject"><img src="images/fig914_01.jpg" height="13" width="14" alt="" border="0"></span> (line 2). If one of the <i class="emphasis">a</i>'s picked is a witness to the compositeness of <i class="emphasis">n</i>, then MILLER-RABIN outputs COMPOSITE on line 4. Such an output is always correct, by the correctness of WITNESS. If no witness can be found in <i class="emphasis">s</i> trials, MILLER-RABIN assumes that this is because there are no witnesses to be found, and therefore <i class="emphasis">n</i> is assumed to be prime. We shall see that this output is likely to be correct if <i class="emphasis">s</i> is large enough, but that there is a small chance that the procedure may be unlucky in its choice of <i class="emphasis">a</i>'s and that witnesses do exist even though none has been found.</p>
<p class="para">To illustrate the operation of MILLER-RABIN, let <i class="emphasis">n</i> be the Carmichael number 561, so that <i class="emphasis">n</i> - 1 = 560 = 2<sup>4</sup> <span class="unicode">&middot;</span> 35. Supposing that <i class="emphasis">a</i> = 7 is chosen as a base, <a href="DDU0205.html#2756" target="_parent" class="chapterjump">Figure 31.4</a> shows that WITNESS computes <i class="emphasis">x</i><sub>0</sub> = <i class="emphasis">a</i><sup>35</sup> = 241 (mod 561) and thus computes the sequence <i class="emphasis">X</i> = <span class="unicode">&#12296;</span>241, 298, 166, 67, 1<span class="unicode">&#12297;</span>. Thus, a nontrivial square root of 1 is discovered in the last squaring step, since <i class="emphasis">a</i><sup>280</sup> <span class="unicode">&equiv;</span> 67 (mod <i class="emphasis">n</i>) and <i class="emphasis">a</i><sup>560</sup> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i>). Therefore, <i class="emphasis">a</i> = 7 is a witness to the compositeness of <i class="emphasis">n</i>, WITNESS(7, <i class="emphasis">n</i>) returns TRUE, and MILLER-RABIN returns COMPOSITE.<a name="2789"></a><a name="IDX-893"></a>
</p>
<p class="last-para">If <i class="emphasis">n</i> is a <i class="emphasis"><span class="unicode">&beta;</span></i>-bit number, MILLER-RABIN requires <i class="emphasis">O</i>(<i class="emphasis">s<span class="unicode">&beta;</span></i>) arithmetic operations and <i class="emphasis">O</i>(<i class="emphasis">s<span class="unicode">&beta;</span></i><sup>3</sup>) bit operations, since it requires asymptotically no more work than <i class="emphasis">s</i> modular exponentiations.</p>

</div>
<div class="section">
<h4 class="sect4-title">
<a name="2790"></a><a name="ch31lev3sec21"></a>Error rate of the Miller-Rabin primality test</h4>
<p class="first-para">If MILLER-RABIN outputs PRIME, then there is a small chance that it has made an error. Unlike PSEUDOPRIME, however, the chance of error does not depend on <i class="emphasis">n</i>; there are no bad inputs for this procedure. Rather, it depends on the size of <i class="emphasis">s</i> and the "luck of the draw" in choosing base values <i class="emphasis">a</i>. Also, since each test is more stringent than a simple check of <a href="DDU0202.html#2706" target="_parent" class="chapterjump">equation (31.38)</a>, we can expect on general principles that the error rate should be small for randomly chosen integers <i class="emphasis">n</i>. The following theorem presents a more precise argument.</p>
<div class="example">
<span class="example-title"><span class="example-titlelabel">Theorem 31.38</span></span><a name="2791"></a><a name="ch31ex78"></a>
<div class="formalbody">
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="Start example" border="0"></b></font></td>
</tr>
</table>
<p class="first-para">If <i class="emphasis">n</i> is an odd composite number, then the number of witnesses to the compositeness of <i class="emphasis">n</i> is at least (<i class="emphasis">n</i> - 1)/2.</p>
<p class="para">
<b class="bold"><i class="emphasis">Proof</i></b> The proof shows that the number of nonwitnesses is at most (<i class="emphasis">n</i> - 1)/2, which implies the theorem.</p>
<p class="para">We start by claiming that any nonwitness must be a member of <span class="inlinemediaobject"><img src="images/fig915_03.jpg" height="12" width="13" alt="" border="0"></span>. Why? Consider any nonwitness <i class="emphasis">a</i>. It must satisfy <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i>) or, equivalently, <i class="emphasis">a</i> <span class="unicode">&middot;</span> <i class="emphasis">a</i><sup><i class="emphasis">n</i>-2</sup> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i>). Thus, there is a solution to the equation <i class="emphasis">ax</i> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i>), namely <i class="emphasis">a</i><sup><i class="emphasis">n</i>-2</sup>. By <a href="DDU0203.html#2720" target="_parent" class="chapterjump">Corollary 31.21</a>, gcd(<i class="emphasis">a</i>, <i class="emphasis">n</i>) | 1, which in turn implies that gcd(<i class="emphasis">a</i>, <i class="emphasis">n</i>) = 1. Therefore, <i class="emphasis">a</i> is a member of <span class="inlinemediaobject"><img src="images/fig915_01.jpg" height="13" width="13" alt="" border="0"></span>; all nonwitnesses belong to <span class="inlinemediaobject"><img src="images/fig915_02.jpg" height="13" width="13" alt="" border="0"></span>.</p>
<p class="para">To complete the proof, we show that not only are all nonwitnesses contained in <span class="inlinemediaobject"><img src="images/fig915_04.jpg" height="13" width="13" alt="" border="0"></span>, they are all contained in a proper subgroup <i class="emphasis">B</i> of <span class="inlinemediaobject"><img src="images/fig915_05.jpg" height="12" width="13" alt="" border="0"></span> (recall that we say <i class="emphasis">B</i> is a <i class="emphasis">proper</i> subgroup of <span class="inlinemediaobject"><img src="images/fig915_06.jpg" height="13" width="13" alt="" border="0"></span> when <i class="emphasis">B</i> is subgroup of <span class="inlinemediaobject"><img src="images/fig915_07.jpg" height="13" width="13" alt="" border="0"></span> but <i class="emphasis">B</i> is not equal to <span class="inlinemediaobject"><img src="images/fig915_08.jpg" height="13" width="13" alt="" border="0"></span>). By <a href="DDU0202.html#2703" target="_parent" class="chapterjump">Corollary 31.16</a>, we then have <span class="inlinemediaobject"><img src="images/fig915_09.jpg" height="13" width="62" alt="" border="0"></span>. Since <span class="inlinemediaobject"><img src="images/fig915_10.jpg" height="13" width="59" alt="" border="0"></span>, we obtain |<i class="emphasis">B</i>| <span class="unicode">&le;</span> (<i class="emphasis">n</i> - 1)/2. Therefore, the number of nonwitnesses is at most (<i class="emphasis">n</i> - 1)/2, so that the number of witnesses must be at least (<i class="emphasis">n</i> - 1)/2.</p>
<p class="para">We now show how to find a proper subgroup <i class="emphasis">B</i> of <span class="inlinemediaobject"><img src="images/fig915_11.jpg" height="13" width="13" alt="" border="0"></span> containing all of the nonwitnesses. We break the proof into two cases.</p>
<p class="para">
<i class="emphasis">Case 1:</i> There exists an <span class="inlinemediaobject"><img src="images/fig915_12.jpg" height="13" width="33" alt="" border="0"></span> such that</p>
<p class="para">
<i class="emphasis">x</i><sup><i class="emphasis">n</i>-1</sup> <span class="unicode">&#8802;</span> 1 (mod <i class="emphasis">n</i>).</p>
<p class="para">In other words, <i class="emphasis">n</i> is not a Carmichael number. Because, as we noted earlier, Carmichael numbers are extremely rare, case 1 is the main case that arises "in practice" (e.g., when <i class="emphasis">n</i> has been chosen randomly and is being tested for primality).</p>
<p class="para">Let <span class="inlinemediaobject"><img src="images/fig915_13.jpg" height="14" width="157" alt="" border="0"></span>. Clearly, <i class="emphasis">B</i> is nonempty, since 1 <span class="unicode">&isin;</span> <i class="emphasis">B</i>. Since <i class="emphasis">B</i> is closed under multiplication modulo <i class="emphasis">n</i>, we have that <i class="emphasis">B</i> is a subgroup <a name="2792"></a><a name="IDX-894"></a>of <span class="inlinemediaobject"><img src="images/fig916_01.jpg" height="14" width="13" alt="" border="0"></span> by <a href="DDU0202.html#2701" target="_parent" class="chapterjump">Theorem 31.14</a>. Note that every nonwitness belongs to <i class="emphasis">B</i>, since a nonwitness <i class="emphasis">a</i> satisfies <i class="emphasis">a</i><sup><i class="emphasis">n</i>-1</sup> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i>). Since <span class="inlinemediaobject"><img src="images/fig916_02.jpg" height="13" width="54" alt="" border="0"></span>, we have that <i class="emphasis">B</i> is a proper subgroup of <span class="inlinemediaobject"><img src="images/fig916_03.jpg" height="14" width="13" alt="" border="0"></span>.</p>
<p class="para">
<i class="emphasis">Case 2:</i> For all <span class="inlinemediaobject"><img src="images/fig916_04.jpg" height="14" width="32" alt="" border="0"></span>,</p>
<p class="para">
<div class="equation">
<table border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><span class="equation-label">(31.39)&nbsp;</span></td><td valign="top"><span class="equation-image"><img src="images/fig916_05.jpg" height="18" width="123" alt="" border="0"></span></td>
</tr>
</table>
</div>
</p>
<p class="para">In other words, <i class="emphasis">n</i> is a Carmichael number. This case is extremely rare in practice. However, the Miller-Rabin test (unlike a pseudo-primality test) can efficiently determine the compositeness of Carmichael numbers, as we now show.</p>
<p class="para">In this case, <i class="emphasis">n</i> cannot be a prime power. To see why, let us suppose to the contrary that <i class="emphasis">n</i> = <i class="emphasis">p<sup>e</sup></i>, where <i class="emphasis">p</i> is a prime and <i class="emphasis">e</i> <span class="unicode">&gt;</span> 1. We derive a contradiction as follows. Since <i class="emphasis">n</i> is assumed to be odd, <i class="emphasis">p</i> must also be odd. <a href="DDU0205.html#2749" target="_parent" class="chapterjump">Theorem 31.32</a> implies that <span class="inlinemediaobject"><img src="images/fig916_06.jpg" height="13" width="14" alt="" border="0"></span> is a cyclic group: it contains a generator <i class="emphasis">g</i> such that <span class="inlinemediaobject"><img src="images/fig916_07.jpg" height="13" width="122" alt="" border="0"></span> <span class="inlinemediaobject"><img src="images/fig916_08.jpg" height="13" width="129" alt="" border="0"></span>. By <a href="DDU0202.html#2708" target="_parent" class="chapterjump">equation (31.39)</a>, we have <i class="emphasis">g</i><sup><i class="emphasis">n</i>-1</sup> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i>). Then the discrete logarithm theorem (<a href="DDU0205.html#2750" target="_parent" class="chapterjump">Theorem 31.33</a>, taking <i class="emphasis">y</i> = 0) implies that <i class="emphasis">n</i> - 1 <span class="unicode">&equiv;</span> 0 (mod <i class="emphasis"><span class="unicode">&phi;</span></i>(<i class="emphasis">n</i>)), or</p>
<p class="para">(<i class="emphasis">p</i> - 1)<i class="emphasis">p</i><sup><i class="emphasis">e</i>-1</sup> | <i class="emphasis">p<sup>e</sup></i> - 1.</p>
<p class="para">This is a contradiction for <i class="emphasis">e</i> <span class="unicode">&gt;</span> 1, since (<i class="emphasis">p</i> - 1) <i class="emphasis">p</i><sup><i class="emphasis">e</i></sup>-1 is divisible by the prime <i class="emphasis">p</i> but <i class="emphasis">p</i><sup><i class="emphasis">e</i></sup> - 1 is not. Thus, <i class="emphasis">n</i> is not a prime power.</p>
<p class="para">Since the odd composite number <i class="emphasis">n</i> is not a prime power, we decompose it into a product <i class="emphasis">n</i><sub>1</sub><i class="emphasis">n</i><sub>2</sub>, where <i class="emphasis">n</i><sub>1</sub> and <i class="emphasis">n</i><sub>2</sub> are odd numbers greater than 1 that are relatively prime to each other. (There may be several ways to do this, and it doesn't matter which one we choose. For example, if <span class="inlinemediaobject"><img src="images/fig916_09.jpg" height="14" width="84" alt="" border="0"></span>, then we can choose <span class="inlinemediaobject"><img src="images/fig916_10.jpg" height="14" width="39" alt="" border="0"></span> and <span class="inlinemediaobject"><img src="images/fig916_11.jpg" height="14" width="84" alt="" border="0"></span>.)</p>
<p class="para">Recall that we define <i class="emphasis">t</i> and <i class="emphasis">u</i> so that <i class="emphasis">n</i> - 1 = 2<sup><i class="emphasis">t</i></sup><i class="emphasis">u</i>, where <i class="emphasis">t</i> <span class="unicode">&ge;</span> 1 and <i class="emphasis">u</i> is odd, and that for an input <i class="emphasis">a</i>, the procedure WITNESS computes the sequence</p>
<p class="para">
<span class="inlinemediaobject"><img src="images/fig916_12.jpg" height="21" width="170" alt="" border="0"></span>
</p>
<p class="para">(all computations are performed modulo <i class="emphasis">n</i>).</p>
<p class="para">Let us call a pair (<i class="emphasis">v</i>, <i class="emphasis">j</i>) of integers <b class="bold"><i class="emphasis">acceptable</i></b> if <span class="inlinemediaobject"><img src="images/fig916_13.jpg" height="13" width="32" alt="" border="0"></span>, <i class="emphasis">j</i> <span class="unicode">&isin;</span> {0, 1, ..., <i class="emphasis">t</i>}, and</p>
<p class="para">
<span class="inlinemediaobject"><img src="images/fig916_14.jpg" height="15" width="48" alt="" border="0"></span> (mod <i class="emphasis">n</i>).</p>
<p class="para">Acceptable pairs certainly exist since <i class="emphasis">u</i> is odd; we can choose <i class="emphasis">v</i> = <i class="emphasis">n</i> -1 and <i class="emphasis">j</i> = 0, so that (<i class="emphasis">n</i> - 1, 0) is an acceptable pair. Now pick the largest possible <i class="emphasis">j</i> such that there exists an acceptable pair (<i class="emphasis">v</i>, <i class="emphasis">j</i>), and fix <i class="emphasis">v</i> so that (<i class="emphasis">v</i>, <i class="emphasis">j</i>) is an acceptable pair. Let</p>
<p class="para">
<span class="inlinemediaobject"><img src="images/fig916_15.jpg" height="23" width="216" alt="" border="0"></span>.</p>
<p class="para">Since <i class="emphasis">B</i> is closed under multiplication modulo <i class="emphasis">n</i>, it is a subgroup of <span class="inlinemediaobject"><img src="images/fig916_16.jpg" height="14" width="14" alt="" border="0"></span>. By <a href="DDU0202.html#2703" target="_parent" class="chapterjump">Corollary 31.16</a>, therefore, |<i class="emphasis">B</i>| divides <span class="inlinemediaobject"><img src="images/fig916_17.jpg" height="13" width="17" alt="" border="0"></span>. Every nonwitness must be a member of <i class="emphasis">B</i>, <a name="2793"></a><a name="IDX-895"></a>since the sequence <i class="emphasis">X</i> produced by a nonwitness must either be all 1's or else contain a -1 no later than the <i class="emphasis">j</i>th position, by the maximality of <i class="emphasis">j</i>. (If (<i class="emphasis">a</i>, <i class="emphasis">j</i><span class="unicode">&prime;</span>) is acceptable, where <i class="emphasis">a</i> is a nonwitness, we must have <i class="emphasis">j</i><span class="unicode">&prime;</span> <span class="unicode">&le;</span> <i class="emphasis">j</i> by how we chose <i class="emphasis">j</i>.)</p>
<p class="para">We now use the existence of <i class="emphasis">v</i> to demonstrate that there exists a <span class="inlinemediaobject"><img src="images/fig917_01.jpg" height="14" width="58" alt="" border="0"></span>. Since <span class="inlinemediaobject"><img src="images/fig917_02.jpg" height="13" width="48" alt="" border="0"></span> (mod <i class="emphasis">n</i>), we have <span class="inlinemediaobject"><img src="images/fig917_03.jpg" height="13" width="48" alt="" border="0"></span> (mod <i class="emphasis">n</i><sub>1</sub>) by <a href="DDU0204.html#2739" target="_parent" class="chapterjump">Corollary 31.29</a> to the Chinese remainder theorem. By <a href="DDU0204.html#2737" target="_parent" class="chapterjump">Corollary 31.28</a>, there is a <i class="emphasis">w</i> simultaneously satisfying the equations</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">w</i>
</p>
</td><td class="td" align="center">
<p class="table-para">
<span class="unicode">&equiv;</span>
</p>
</td><td class="td" align="left">
<p class="table-para">
<i class="emphasis">v</i>
</p>
</td><td class="td" align="left">
<p class="table-para">(mod <i class="emphasis">n</i><sub>1</sub>),</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<i class="emphasis">w</i>
</p>
</td><td class="td" align="center">
<p class="table-para">
<span class="unicode">&equiv;</span>
</p>
</td><td class="td" align="left">
<p class="table-para">1</p>
</td><td class="td" align="left">
<p class="table-para">(mod <i class="emphasis">n</i><sub>2</sub>).</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">Therefore,</p>
<div class="informaltable">
<table border="0">
<tbody>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="inlinemediaobject"><img src="images/fig917_04.jpg" height="16" width="23" alt="" border="0"></span>
</p>
</td><td class="td" align="center">
<p class="table-para">
<span class="unicode">&equiv;</span>
</p>
</td><td class="td" align="left">
<p class="table-para">-1</p>
</td><td class="td" align="left">
<p class="table-para">(mod <i class="emphasis">n</i><sub>1</sub>),</p>
</td>
</tr>
<tr valign="top">
<td class="td" align="left">
<p class="table-para">
<span class="inlinemediaobject"><img src="images/fig917_05.jpg" height="15" width="23" alt="" border="0"></span>
</p>
</td><td class="td" align="center">
<p class="table-para">
<span class="unicode">&equiv;</span>
</p>
</td><td class="td" align="left">
<p class="table-para">1</p>
</td><td class="td" align="left">
<p class="table-para">(mod <i class="emphasis">n</i><sub>2</sub>).</p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="para">By <a href="DDU0204.html#2739" target="_parent" class="chapterjump">Corollary 31.29</a>, <span class="inlinemediaobject"><img src="images/fig917_06.jpg" height="15" width="50" alt="" border="0"></span> (mod <i class="emphasis">n</i><sub>1</sub>) implies <span class="inlinemediaobject"><img src="images/fig917_07.jpg" height="15" width="51" alt="" border="0"></span> (mod <i class="emphasis">n</i>), and <span class="inlinemediaobject"><img src="images/fig917_08.jpg" height="14" width="50" alt="" border="0"></span> (mod <i class="emphasis">n</i><sub>2</sub>) implies <span class="inlinemediaobject"><img src="images/fig917_09.jpg" height="15" width="50" alt="" border="0"></span> (mod <i class="emphasis">n</i>). Hence, <span class="inlinemediaobject"><img src="images/fig917_10.jpg" height="14" width="50" alt="" border="0"></span> (mod <i class="emphasis">n</i>), and so <i class="emphasis">w</i> <span class="unicode">&notin;</span> <i class="emphasis">B</i>.</p>
<p class="para">It remains to show that <span class="inlinemediaobject"><img src="images/fig917_11.jpg" height="12" width="35" alt="" border="0"></span>, which we do by first working separately modulo <i class="emphasis">n</i><sub>1</sub> and modulo <i class="emphasis">n</i><sub>2</sub>. Working modulo <i class="emphasis">n</i><sub>1</sub>, we observe that since <span class="inlinemediaobject"><img src="images/fig917_12.jpg" height="12" width="35" alt="" border="0"></span>, we have that gcd(<i class="emphasis">v</i>, <i class="emphasis">n</i>) = 1, and so also gcd(<i class="emphasis">v</i>, <i class="emphasis">n</i><sub>1</sub>) = 1; if <i class="emphasis">v</i> doesn't have any common divisors with <i class="emphasis">n</i>, it certainly doesn't have any common divisors with <i class="emphasis">n</i><sub>1</sub>. Since <i class="emphasis">w</i> <span class="unicode">&equiv;</span> <i class="emphasis">v</i> (mod <i class="emphasis">n</i><sub>1</sub>), we see that gcd(<i class="emphasis">w</i>, <i class="emphasis">n</i><sub>1</sub>) = 1. Working modulo <i class="emphasis">n</i><sub>2</sub>, we observe that <i class="emphasis">w</i> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i><sub>2</sub>) implies gcd(<i class="emphasis">w</i>, <i class="emphasis">n</i><sub>2</sub>) = 1. To combine these results, we use <a href="DDU0200.html#2647" target="_parent" class="chapterjump">Theorem 31.6</a>, which implies that gcd(<i class="emphasis">w</i>, <i class="emphasis">n</i><sub>1</sub><i class="emphasis">n</i><sub>2</sub>) = gcd(<i class="emphasis">w</i>, <i class="emphasis">n</i>) = 1. That is, <span class="inlinemediaobject"><img src="images/fig917_13.jpg" height="12" width="34" alt="" border="0"></span>.</p>
<p class="para">Therefore <span class="inlinemediaobject"><img src="images/fig917_14.jpg" height="12" width="59" alt="" border="0"></span>, and we finish case 2 with the conclusion that <i class="emphasis">B</i> is a proper subgroup of <span class="inlinemediaobject"><img src="images/fig917_15.jpg" height="12" width="13" alt="" border="0"></span>.</p>
<p class="last-para">In either case, we see that the number of witnesses to the compositeness of <i class="emphasis">n</i> is at least (<i class="emphasis">n</i> - 1)/2.</p>
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="End example" border="0"></b></font></td>
</tr>
</table>
<table class="BlankSpace" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td height="16"></td>
</tr>
</table>
</div>
</div>
<div class="example">
<span class="example-title"><span class="example-titlelabel">Theorem 31.39</span></span><a name="2794"></a><a name="ch31ex79"></a>
<div class="formalbody">
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="Start example" border="0"></b></font></td>
</tr>
</table>
<p class="first-para">For any odd integer <i class="emphasis">n</i> <span class="unicode">&gt;</span> 2 and positive integer <i class="emphasis">s</i>, the probability that MILLER-RABIN(<i class="emphasis">n</i>, <i class="emphasis">s</i>) errs is at most 2<sup>-<i class="emphasis">s</i></sup>.</p>
<p class="last-para">
<b class="bold"><i class="emphasis">Proof</i></b> Using <a class="internaljump" href="#ch31ex78">Theorem 31.38</a>, we see that if <i class="emphasis">n</i> is composite, then each execution of the <b class="bold">for</b> loop of lines 1<span class="unicode">-</span>4 has a probability of at least 1/2 of discovering a witness <i class="emphasis">x</i> to the compositeness of <i class="emphasis">n</i>. MILLER-RABIN makes an error only if it is so unlucky as to miss discovering a witness to the compositeness of <i class="emphasis">n</i> on each of the <i class="emphasis">s</i> iterations of the main loop. The probability of such a string of misses is at most 2<sup>-<i class="emphasis">s</i></sup>.</p>
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="End example" border="0"></b></font></td>
</tr>
</table>
<table class="BlankSpace" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td height="16"></td>
</tr>
</table>
</div>
</div>
<p class="para">Thus, choosing <i class="emphasis">s</i> = 50 should suffice for almost any imaginable application. If we are trying to find large primes by applying MILLER-RABIN to <i class="emphasis">randomly chosen</i> <a name="2795"></a><a name="IDX-896"></a>large integers, then it can be argued (although we won't do so here) that choosing a small value of <i class="emphasis">s</i> (say 3) is very unlikely to lead to erroneous results. That is, for a randomly chosen odd composite integer <i class="emphasis">n</i>, the expected number of nonwitnesses to the compositeness of <i class="emphasis">n</i> is likely to be much smaller than (<i class="emphasis">n</i> - 1)/2. If the integer <i class="emphasis">n</i> is not chosen randomly, however, the best that can be proven is that the number of nonwitnesses is at most (<i class="emphasis">n</i> - 1)/4, using an improved version of <a class="internaljump" href="#ch31ex79">Theorem 31.39</a>. Furthermore, there do exist integers <i class="emphasis">n</i> for which the number of nonwitnesses is (<i class="emphasis">n</i> - 1)/4.</p>
<div class="example">
<span class="example-title"><span class="example-titlelabel">Exercises 31.8-1</span></span><a name="2796"></a><a name="ch31ex80"></a>
<div class="formalbody">
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="Start example" border="0"></b></font></td>
</tr>
</table>
<p class="first-para">Prove that if an odd integer <i class="emphasis">n</i> <span class="unicode">&gt;</span> 1 is not a prime or a prime power, then there exists a nontrivial square root of 1 modulo <i class="emphasis">n</i>.</p>
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="End example" border="0"></b></font></td>
</tr>
</table>
<table class="BlankSpace" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td height="16"></td>
</tr>
</table>
</div>
</div>
<div class="example">
<span class="example-title"><span class="example-titlelabel">Exercises 31.8-2: </span><span class="unicode">&#9733;</span></span><a name="2797"></a><a name="ch31ex81"></a>
<div class="formalbody">
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="Start example" border="0"></b></font></td>
</tr>
</table>
<p class="first-para">It is possible to strengthen Euler's theorem slightly to the form</p>
<p class="para">
<i class="emphasis">a</i><sup><i class="emphasis"><span class="unicode">&lambda;</span></i>(<i class="emphasis">n</i>)</sup> <span class="unicode">&equiv;</span> 1 (mod <i class="emphasis">n</i>) for all <span class="inlinemediaobject"><img src="images/fig918_01.jpg" height="19" width="45" alt="" border="0"></span>,</p>
<p class="para">where <span class="inlinemediaobject"><img src="images/fig918_02.jpg" height="14" width="65" alt="" border="0"></span> and <span class="unicode">&lambda;</span>(<i class="emphasis">n</i>) is defined by</p>
<p class="para">
<div class="equation">
<table border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><span class="equation-label">(31.40)&nbsp;</span></td><td valign="top"><span class="equation-image"><img src="images/fig918_03.jpg" height="18" width="196" alt="" border="0"></span></td>
</tr>
</table>
</div>
</p>
<p class="last-para">Prove that <span class="unicode">&lambda;</span>(<i class="emphasis">n</i>) | <i class="emphasis"><span class="unicode">&phi;</span></i>(<i class="emphasis">n</i>). A composite number <i class="emphasis">n</i> is a Carmichael number if <span class="unicode">&lambda;</span>(<i class="emphasis">n</i>) | <i class="emphasis">n</i> - 1. The smallest Carmichael number is 561 = 3 <span class="unicode">&middot;</span> 11 <span class="unicode">&middot;</span> 17; here, <span class="unicode">&lambda;</span>(<i class="emphasis">n</i>) = lcm(2, 10, 16) = 80, which divides 560. Prove that Carmichael numbers must be both "square-free" (not divisible by the square of any prime) and the product of at least three primes. For this reason, they are not very common.</p>
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="End example" border="0"></b></font></td>
</tr>
</table>
<table class="BlankSpace" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td height="16"></td>
</tr>
</table>
</div>
</div>
<div class="example">
<span class="example-title"><span class="example-titlelabel">Exercises 31.8-3</span></span><a name="2798"></a><a name="ch31ex82"></a>
<div class="formalbody">
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="Start example" border="0"></b></font></td>
</tr>
</table>
<p class="first-para">Prove that if <i class="emphasis">x</i> is a nontrivial square root of 1, modulo <i class="emphasis">n</i>, then gcd(<i class="emphasis">x</i> - 1, <i class="emphasis">n</i>) and gcd(<i class="emphasis">x</i> + 1, <i class="emphasis">n</i>) are both nontrivial divisors of <i class="emphasis">n</i>.</p>
<table class="BlueLine" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td bgcolor="000080" class="bluecell"><font size="2" face="Arial" color="010100"><b><img src="_.gif" width="1" height="2" alt="End example" border="0"></b></font></td>
</tr>
</table>
<table class="BlankSpace" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td height="16"></td>
</tr>
</table>
</div>
</div>

</div>

</div>
</div>
</div>
</div>
<br><hr size="1">
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td align="left" width="30%">
<div STYLE="MARGIN-LEFT: 0.15in;">
<a href="DDU0206.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</div></td>
<td align="center" width="40%">
<a href="toc.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td align="right" width="30%">
<div STYLE="MARGIN-RIGHT: 0.15in"><a href="DDU0208.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr>
</table>
</body>
</html>
