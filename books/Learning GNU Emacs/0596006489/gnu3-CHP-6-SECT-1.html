<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>6.1. Defining a Macro</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="gnu3-CHP-6.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="gnu3-CHP-6-SECT-2.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="gnu3-CHP-6-SECT-1"></A>
<H3 class="docSection1Title">6.1. Defining a Macro</H3>

<P class="docText">To start defining a
<A NAME="gnu3-CHP-6-ITERM-2258"></A><A NAME="gnu3-CHP-6-ITERM-2259"></A>macro, press
<span class="docEmphBold">F3</span> or <span class="docEmphBold">C-x (</span>.<sup class="docFootnote"><A class="docLink" HREF="#gnu3-CHP-6-FNOTE-2">[2]</A></sup> The abbreviation
<TT>Def</TT> appears on the mode line, showing that you are
in macro definition mode. In this mode, Emacs records all the
keystrokes that you type, whether they are commands or literal text,
so that you can replay them later. To end the macro, press <span class="docEmphBold">F4</span> or <span class="docEmphBold">C-x )</span>;
you leave macro definition mode, and Emacs stops recording your
keystrokes. Emacs also stops recording your keystrokes automatically
if an error occurs or if you press <span class="docEmphBold">C-g</span>.</P><blockquote><p class="docFootnote"><sup><A NAME="gnu3-CHP-6-FNOTE-2">[2]</A></sup> Mac OS X users may have bound <span class="docEmphBold">F3</span> and <span class="docEmphBold">F4</span>,
used in defining and executing macros, to another key. These users
should press <span class="docEmphBold">Option-F3</span> and <span class="docEmphBold">Option-F4</span> to get the same
functionality.</p></blockquote>

<P class="docText">While you're defining a macro, Emacs acts on
<A NAME="gnu3-CHP-6-ITERM-2260"></A>your keystrokes as well as recording
them: that is, anything you type while in macro definition mode is
treated as a regular command and executed. While
you're defining a macro, you're
doing completely normal editing. That way you can see that the macro
does exactly what you want it to, and you can cancel it (with
<span class="docEmphBold">C-g</span>) if you notice that the macro
isn't really quite what you want.</P>

<P class="docText">To execute your
<A NAME="gnu3-CHP-6-ITERM-2261"></A><A NAME="gnu3-CHP-6-ITERM-2262"></A>macro, press <span class="docEmphBold">F4</span> or <span class="docEmphBold">C-x e</span>.
Emacs then replays your keystrokes exactly. (You can see that
<span class="docEmphBold">F4</span> has two different functions
relating to macros: to end a macro definition and, after
it's defined, to execute the macro.)</P>

<P class="docText">This macro is referred to as the
"last" keyboard macro, with last
here meaning most recent. Only one macro is the last keyboard macro.
A macro ring, much like the kill ring, allows you to access a number
of macros during an Emacs session.</P>

<P class="docText"><A class="docLink" HREF="#gnu3-CHP-6-TABLE-1">Table 6-1</A> shows the steps required to define and
execute a macro. This macro takes a list of names in the ordinary
First Name Last Name order and changes it to the frequently needed
Last Name, First
<A NAME="gnu3-CHP-6-ITERM-2263"></A>Name order.</P>

<A NAME="gnu3-CHP-6-TABLE-1"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 6-1. Steps for creating name transposition macro</h5></CAPTION><COLGROUP><COL><COL></COLGROUP><THEAD><TR><TH class="thead" scope="col">
<P class="docText">Keystrokes</P>
</TH><TH class="thead" scope="col">
<P class="docText">Action</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F3</span> <span class="docEmphasis">or</span> <span class="docEmphBold">C-x (</span></P>
</TD><TD class="docTableCell">
<P class="docText">Start the macro; <TT>Def</TT> appears on the mode line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-a</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the beginning of the current line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-f</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move forward a word.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">,</P>
</TD><TD class="docTableCell">
<P class="docText">Type a comma.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-t</span></P>
</TD><TD class="docTableCell">
<P class="docText">Transpose first and last.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-n</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the next line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F4</span> <span class="docEmphasis">or</span> <span class="docEmphBold">C-x )</span></P>
</TD><TD class="docTableCell">
<P class="docText">End the macro definition.</P>
</TD></TR></TABLE></P><br>

<A NAME="ch06-3-fm2xml"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><COLGROUP><COL></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell">
<P class="docText">Define the macro using the keystrokes given in <A class="docLink" HREF="#gnu3-CHP-6-TABLE-1">Table 6-1</A>.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><IMG BORDER="0" width="425" height="206" SRC="images/0596006489/figs/ge3_ch06scrn01.gif" ALT=""></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">In defining the macro, you transposed the names on the first line,
leaving the cursor on the second line.</P>
</TD></TR></TABLE></P><br>

<P class="docText">Now let's be brave and assume the macro works;
we'll try repeating it five times by prefacing the
command to execute a macro with <span class="docEmphBold">M-5</span>.
Of course, in real life, you'd be better off trying
it once before doing anything so bold.</P>

<A NAME="ch06-4-fm2xml"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><COLGROUP><COL></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell">
<P class="docText">Type <span class="docEmphBold">M-5 F4</span> or <span class="docEmphBold">M-5 C-x e</span></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><IMG BORDER="0" width="425" height="206" SRC="images/0596006489/figs/ge3_ch06scrn02.gif" ALT=""></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">Now we've done the first six lines: one by defining
the macro and five more by executing it.</P>
</TD></TR></TABLE></P><br>

<P class="docText">The macro works well, so we can finish the rest of the buffer with
confidence: type <span class="docEmphBold">M-100</span>, then
<span class="docEmphBold">C-x e</span> or <span class="docEmphBold">F4</span>. Emacs stops automatically when you reach
the end of the buffer, so it doesn't matter if you
repeat the
<A NAME="gnu3-CHP-6-ITERM-2264"></A><A NAME="gnu3-CHP-6-ITERM-2265"></A>macro
more times than necessary.</P>

<P class="docText">Here are a few points to remember:</P>

<UL><LI><P class="docList">Don't forget to press <span class="docEmphBold">F4</span> or <span class="docEmphBold">C-x )</span>
when you've finished the macro. If you try to
execute a macro before it has been defined, Emacs complains and
forgets the macro's definition.</P></LI><LI><P class="docList"><span class="docEmphBold">C-g</span> terminates a macro, causing
Emacs to forget its definition.</P></LI><LI><P class="docList">Virtually any error automatically terminates a macro. If Emacs beeps
at you, you have to start over.</P></LI><LI><P class="docList">Emacs executes the keystrokes <span class="docEmphasis">exactly</span> as you
type them, with no intelligence whatsoever. Avoid making assumptions
like, "Of course I'll be at the
beginning (or end) of the line when I execute the
macro."</P></LI></UL>
<P class="docText">If you invoke a macro and it does the wrong thing, you can use
<span class="docEmphBold">C-_</span> to undo it. Emacs is smart
enough to realize that "undo the last
command" means "undo the entire
macro" rather than "undo the last
command within the macro." However, if you repeat a
macro multiple times using <span class="docEmphBold">M-</span><span class="docEmphasis">n</span>, <span class="docEmphBold">C-_</span> undoes only the last instance of the
macro, not all the instances.</P>


<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="gnu3-CHP-6.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="gnu3-CHP-6-SECT-2.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
