<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>6.3. A More Complicated Macro Example</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="gnu3-CHP-6-SECT-2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="gnu3-CHP-6-SECT-4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="gnu3-CHP-6-SECT-3"></A>
<H3 class="docSection1Title">6.3. A More Complicated Macro Example</H3>

<P class="docText">Sometimes you may want to find all the references to a particular
topic in a file. <A class="docLink" HREF="#gnu3-CHP-6-TABLE-2">Table 6-2</A> lists steps for creating a macro that
takes takes every sentence in the buffer that contains the word
<span class="docEmphasis">Emacs</span> and copies it to another buffer. If you
try this macro, you'll need to type some text about
Emacs into a buffer. You can also get a test file to work with by
opening the Emacs <span class="docEmphasis">NEWS</span> file (using <span class="docEmphBold">C-h n</span>), then writing it to a file (<span class="docEmphBold">C-x C-w</span> <span class="docEmphBold">NEWS</span>). This buffer is in view mode by default;
change to text mode by typing <span class="docEmphBold">M-x text-mode
Enter</span>.</P>

<A NAME="gnu3-CHP-6-TABLE-2"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 6-2. Steps for macro that creates a buffer of Emacs references</h5></CAPTION><COLGROUP><COL><COL></COLGROUP><THEAD><TR><TH class="thead" scope="col">
<P class="docText">Keystrokes</P>
</TH><TH class="thead" scope="col">
<P class="docText">Action</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F3</span> <span class="docEmphasis">or</span> <span class="docEmphBold">C-x (</span></P>
</TD><TD class="docTableCell">
<P class="docText">Start macro definition; <TT>Def</TT> appears on the mode
line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-s emacs</span></P>
</TD><TD class="docTableCell">
<P class="docText">Find the word Emacs.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Stop the search after it is successful; if the search is
unsuccessful, it rings the bell and stops the macro.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-a</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the beginning of the sentence.<sup class="docFootnote"><A class="docLink" HREF="#gnu3-CHP-6-FNOTE-3">[3]</A></sup></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-Space</span></P>
</TD><TD class="docTableCell">
<P class="docText">Set the mark.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-e</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the end of the sentence.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-w</span></P>
</TD><TD class="docTableCell">
<P class="docText">Copy the sentence to the kill ring.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-x b emacsrefs Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to a buffer called <TT>emacsrefs</TT>.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-y</span></P>
</TD><TD class="docTableCell">
<P class="docText">Insert the sentence.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Start the next sentence on a new line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-x b Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move back to the original buffer.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F4</span> <span class="docEmphasis">or</span> <span class="docEmphBold">C-x )</span></P>
</TD><TD class="docTableCell">
<P class="docText">End the macro definition; <TT>Def</TT> is removed from the
mode line.</P>
</TD></TR></TABLE></P><br> <blockquote><p class="docFootnote"><sup><A NAME="gnu3-CHP-6-FNOTE-3">[3]</A></sup> <span class="docEmphBold">M-a</span>'s definition of a
"sentence" is controlled by the
variable <span class="docEmphBold">sentence-end</span>, which is a
fairly complex regular expression. By default, a sentence ends with a
period, question mark, or exclamation mark, optionally followed by a
quotation mark or parenthesis (including brackets or braces), and
followed by two or more spaces or a newline.</p></blockquote> 

<P class="docText">Now, assume that you've already constructed the
macro outlined in <A class="docLink" HREF="#gnu3-CHP-6-TABLE-2">Table 6-2</A> and that you can
invoke it with <span class="docEmphBold">F4</span>. The following
screen shows what happens when you run it five times and then display
the <TT>emacsrefs</TT> buffer.</P>

<A NAME="ch06-5-fm2xml"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><COLGROUP><COL></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell">
<P class="docText">Type: <span class="docEmphBold">M-5 F4</span> or <span class="docEmphBold">M-5 C-x e</span>, followed by
<span class="docEmphBold">C-x b Enter</span></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><IMG BORDER="0" width="425" height="206" SRC="images/0596006489/figs/ge3_ch06scrn03.gif" ALT=""></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">By executing the macro repeatedly, we've created a
buffer that contains references to the Emacs editor.</P>
</TD></TR></TABLE></P><br>

<P class="docText">As in the previous example, you can jump back and forth between an
unlimited number of buffers while defining a macro. Macros
don't need to be confined to one buffer. Macros that
work with several buffers are more difficult to debug; when several
buffers are involved, it becomes harder for you to keep track of
where the cursor and the mark are. It is also easy to make mistaken
assumptions about what buffer you're visiting;
hence, it's a good idea to specify the buffer name
explicitly. However, after you get accustomed to working with macros
and multiple buffers, you'll be amazed at how much
work you can do with almost no effort.</P>

<P class="docText">Windows are sometimes useful in macros, but, again, you have to watch
out. It's better to start a macro with one window on
the screen, have the macro open other windows, and finally close all
but one window (<span class="docEmphBold">C-x 1</span>). If you write
a macro with two windows on the screen and later try to execute it
with four windows on the screen, the results will be unpredictable at
best! In general, moving to a named buffer, <span class="docEmphBold">C-x
b</span> <TT><I>buffername</I></TT>, is preferable to
moving to the "other" window using
<span class="docEmphBold">C-x o</span> (too vague to be generally
useful). The other window could be anything—a
<TT>*Help*</TT> buffer, <TT>*Completion*</TT>
buffer, <TT>*shell*</TT> buffer, and so on. Moving to a
named buffer always gets you to the right place, no matter how (or
whether) the buffer is displayed.</P>


<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="gnu3-CHP-6-SECT-2.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="gnu3-CHP-6-SECT-4.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
