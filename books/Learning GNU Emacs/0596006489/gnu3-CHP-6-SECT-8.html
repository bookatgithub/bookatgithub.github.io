<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>6.8. Building More Complicated Macros</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="gnu3-CHP-6-SECT-7.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="gnu3-CHP-6-SECT-9.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="gnu3-CHP-6-SECT-8"></A>
<H3 class="docSection1Title" >6.8. Building More Complicated Macros</H3>

<P class="docText">So far, we've covered the basics of writing,
executing, and saving keyboard macros. Now let's
discuss a couple of more advanced features Emacs lets you add to your
macros: pausing a macro for keyboard input and inserting a query in a
macro.</P>

<A NAME="gnu3-CHP-6-SECT-8.1"></A>
<H4 class="docSection2Title">6.8.1 Pausing a Macro for Keyboard Input</H4>

<P class="docText">Sometimes it's
<A NAME="gnu3-CHP-6-ITERM-2281"></A><A NAME="gnu3-CHP-6-ITERM-2282"></A><A NAME="gnu3-CHP-6-ITERM-2283"></A>useful to pause a macro briefly
so you can type something. For example, if you write a lot of
letters, you could have a macro that prints out a template and then
pauses for you to fill in variables (such as the date and the
recipient's name). You can perform this task (and
similar tasks) by inserting a recursive edit into a macro. A
recursive edit is just a fancy way to say, "Stop and
let me type a while, then pick up the macro where I left
off."</P>

<P class="docText">When you're defining a macro, type <span class="docEmphBold">C-u C-x q</span> at the point where you want the
recursive edit to occur. Emacs enters a recursive edit. (You can tell
you're in a recursive edit because square brackets
appear on the mode line; you'll see them in the
screenshots later in this section.) Nothing you type during the
recursive edit becomes a part of the macro. You can type whatever you
want to and then press <span class="docEmphBold">C-M-c</span> to exit
the recursive edit. Notice how the square brackets disappear when you
type <span class="docEmphBold">C-M-c</span>. When the square brackets
are no longer on the screen, you have left the recursive edit.
Anything you type at this point becomes part of the macro. You can
put as many pauses in your macros as you want to.</P>

<A NAME="gnu3-CHP-6-SECT-8.1.1"></A>
<H5 class="docSection3Title">6.8.1.1 Example</H5>

<P class="docText">Here's an example of a macro that puts a business
letter template on the screen and uses recursive edits to let you
type your return address, the recipient's name and
address, and the date. Because the brackets on the mode line are a
pretty subtle clue to what you are going to type,
we'll give the user of this macro explicit
instructions about what to type. <A class="docLink" HREF="#gnu3-CHP-6-TABLE-3">Table 6-3</A>
provides these instructions.</P>

<A NAME="gnu3-CHP-6-TABLE-3"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 6-3. Steps for creating a business letter macro</h5></CAPTION><COLGROUP><COL><COL></COLGROUP><THEAD><TR><TH class="thead" scope="col">
<P class="docText">Keystrokes</P>
</TH><TH class="thead" scope="col">
<P class="docText">Action</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F3</span> <span class="docEmphasis">or</span> <span class="docEmphBold">C-x (</span></P>
</TD><TD class="docTableCell">
<P class="docText">Start keyboard macro definition.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-5 Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Put in 5 blank lines.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">Type your address and press C-M-c</span></P>
</TD><TD class="docTableCell">
<P class="docText">Display <TT>Type your address and press C-M-c</TT> on the screen.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-a</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the beginning of the line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-u C-x q</span></P>
</TD><TD class="docTableCell">
<P class="docText">Enter a recursive edit, during which the keystrokes you type are not
recorded as part of the macro.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-M-c</span></P>
</TD><TD class="docTableCell">
<P class="docText">Exit the recursive edit.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-e</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the end of the line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-5 Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move the cursor down 5 lines.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">Type recipient name and address and press
C-M-c</span></P>
</TD><TD class="docTableCell">
<P class="docText">Display <TT>Type recipient name and address and press C-M-c</TT>
 on the screen.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-a</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the beginning of the line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-u C-x q</span></P>
</TD><TD class="docTableCell">
<P class="docText">Enter a recursive edit.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-M-c</span></P>
</TD><TD class="docTableCell">
<P class="docText">Exit the recursive edit.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-e</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the end of the line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-5 Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move the cursor down 5 lines.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">Type date and press C-M-c</span></P>
</TD><TD class="docTableCell">
<P class="docText">Display <TT>Type date and press C-M-c</TT> on the screen.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-a</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the beginning of the line</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-u C-x q</span></P>
</TD><TD class="docTableCell">
<P class="docText">Enter a recursive edit.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-M-c</span></P>
</TD><TD class="docTableCell">
<P class="docText">Exit the recursive edit.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-e</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the end of the line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-5 Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move the cursor down 5 lines.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">Dear Space</span></P>
</TD><TD class="docTableCell">
<P class="docText">Display <span class="docEmphBold">Dear</span> on the screen.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F4</span> <span class="docEmphasis">or</span> <span class="docEmphBold">C-x )</span></P>
</TD><TD class="docTableCell">
<P class="docText">End keyboard macro definition.</P>
</TD></TR></TABLE></P><br>

<P class="docText">The following screens show what the macro defined in <A class="docLink" HREF="#gnu3-CHP-6-TABLE-3">Table 6-3</A> looks like when you run it.</P>

<A NAME="ch06-11-fm2xml"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><COLGROUP><COL></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell">
<P class="docText">Type: <span class="docEmphBold">F4</span></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><IMG BORDER="0"  width="425" height="195" SRC="images/0596006489/figs/ge3_ch06scrn08.gif" ALT=""></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">The macro pauses so that you can type your address.</P>
</TD></TR></TABLE></P><br>

<A NAME="ch06-12-fm2xml"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><COLGROUP><COL></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell">
<P class="docText">Type your address and press: <span class="docEmphBold">C-M-c</span></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><IMG BORDER="0"  width="425" height="238" SRC="images/0596006489/figs/ge3_ch06scrn09.gif" ALT=""></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">The macro pauses so you can type the recipient's
name and address.</P>
</TD></TR></TABLE></P><br>

<A NAME="ch06-13-fm2xml"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><COLGROUP><COL></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell">
<P class="docText">Type the recipient's name and address and press:
<span class="docEmphBold">C-M-c</span></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><IMG BORDER="0"  width="425" height="227" SRC="images/0596006489/figs/ge3_ch06scrn10.gif" ALT=""></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">The macro pauses so you can type the date.</P>
</TD></TR></TABLE></P><br>

<A NAME="ch06-14-fm2xml"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><COLGROUP><COL></COLGROUP><THEAD></THEAD><TR><TD class="docTableCell">
<P class="docText">Type the date and press: <span class="docEmphBold">C-M-c</span></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><IMG BORDER="0"  width="425" height="257" SRC="images/0596006489/figs/ge3_ch06scrn11.gif" ALT=""></P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">The macro finishes by typing the opening for the letter.</P>
</TD></TR></TABLE></P><br>

<P class="docText">Now the macro has finished editing; you can type the
recipient's name and then the body of the letter,
and of course you can go back and edit any of the information
you've already filled in.</P>



<A NAME="gnu3-CHP-6-SECT-8.2"></A>
<H4 class="docSection2Title">6.8.2 Adding a Query to a Macro</H4>

<P class="docText">The more complex the task your
<A NAME="gnu3-CHP-6-ITERM-2285"></A><A NAME="gnu3-CHP-6-ITERM-2286"></A>macro performs, the more difficult it is
to make the macro general enough to work in every case. Although
macros can do a lot of things, they aren't programs:
you can't have <span class="docEmphBold">if</span>
statements, loops, and the other things you associate with a program.
In particular, a macro can't get input from the user
and then take some action on the basis of that input.</P>

<P class="docText">However, one feature lets a macro get input, in a limited way, from
the user. You can create a macro that queries the user while it is
running; it works much like a query-replace. To create this kind of a
macro, type <span class="docEmphBold">C-x q</span> when you reach the
point in the macro definition where you want the macro to query the
user. Nothing happens immediately; go on defining the macro as you
normally would.</P>

<P class="docText">Things get interesting later, when you execute the macro. When it
gets to the point in the macro where you typed <span class="docEmphBold">C-x q</span>, Emacs prints a query in the minibuffer:</P>

<PRE>Proceed with macro? (y, n, RET, C-l, C-r)</PRE><BR>


<P class="docText">The responses listed here are analogous to those in query-replace:</P>

<UL><LI><P class="docList">Pressing <span class="docEmphBold">y</span> means to continue and go
on to the next repetition, if any.</P></LI><LI><P class="docList">Pressing <span class="docEmphBold">n</span> means to stop executing
the macro but go on to the next repetition, if any.</P></LI><LI><P class="docList">Pressing <span class="docEmphBold">Enter</span> means to stop
executing the macro and cancel any repetitions.</P></LI><LI><P class="docList">Pressing <span class="docEmphBold">C-r</span> starts a recursive
edit, which lets you do any editing or moving around you may want to
and then resume the macro when you exit the recursive edit. To exit a
recursive edit, press <span class="docEmphBold">C-M-c</span>. Emacs
again asks if you want to proceed with the macro, and you type
<span class="docEmphBold">y</span> for yes or <span class="docEmphBold">n</span> or <span class="docEmphBold">Enter</span>
for no.</P></LI><LI><P class="docList">Pressing <span class="docEmphBold">C-l</span> puts the line the
cursor is on in the middle of the screen (this is good for getting a
feel for the context). Similar to <span class="docEmphBold">C-r</span>, Emacs again asks if you want to proceed
with the macro, and you have to answer <span class="docEmphBold">y</span>, <span class="docEmphBold">n</span>, or
<span class="docEmphBold">Enter</span>.</P></LI><LI><P class="docList">Pressing <span class="docEmphBold">C-g</span> (although not listed as
an option) cancels the query and the macro; it is similar to pressing
<span class="docEmphBold">Enter</span>.</P></LI></UL>
<A NAME="gnu3-CHP-6-SECT-8.2.1"></A>
<H5 class="docSection3Title">6.8.2.1 Example</H5>

<P class="docText">Let's say that you write a macro that copies
comments from a program to another buffer. The comments in our
program are preceded by a slash, so you start the macro with a search
for a slash. However, not all comments are worth copying. Following
the search with a query lets you decide case by case whether the
search has found a comment you want to copy. <A class="docLink" HREF="#gnu3-CHP-6-TABLE-4">Table 6-4</A> shows a macro to copy comments to another
buffer.</P>

<A NAME="gnu3-CHP-6-TABLE-4"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 6-4. Comment-copying macro with a query</h5></CAPTION><COLGROUP><COL><COL></COLGROUP><THEAD><TR><TH class="thead" scope="col">
<P class="docText">Keystrokes</P>
</TH><TH class="thead" scope="col">
<P class="docText">Action</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F3</span></P>
</TD><TD class="docTableCell">
<P class="docText">Start the macro definition.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-s /</span></P>
</TD><TD class="docTableCell">
<P class="docText">Search for a slash.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">Enter</span></P>
</TD><TD class="docTableCell">
<P class="docText">Stop the search when it is successful.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-x q</span></P>
</TD><TD class="docTableCell">
<P class="docText">Insert a query in the macro; Emacs asks you if you want to proceed at
this point when you run the macro.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-f</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move forward one word.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-b</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the beginning of this word.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-Space</span></P>
</TD><TD class="docTableCell">
<P class="docText">Set the mark.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-e</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to the end of the line.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-f</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move forward one character.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">M-w</span></P>
</TD><TD class="docTableCell">
<P class="docText">Copy the comment to the kill ring.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-x b comments</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move to a buffer called <TT>comments</TT>.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-y</span></P>
</TD><TD class="docTableCell">
<P class="docText">Insert the comment in the buffer.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">C-x b</span></P>
</TD><TD class="docTableCell">
<P class="docText">Move back to the original buffer.</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphBold">F4</span></P>
</TD><TD class="docTableCell">
<P class="docText">End the macro definition.</P>
</TD></TR></TABLE></P><br>




<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="gnu3-CHP-6-SECT-7.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="gnu3-CHP-6-SECT-9.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
