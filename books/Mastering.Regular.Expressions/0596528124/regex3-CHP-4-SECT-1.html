<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 4.1.&nbsp; Start Your Engines!</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4-SECT-2.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a name="regex3-CHP-4-SECT-1"></a>
<H3 id="title-IDAGJ2DF" class="docSection1Title">4.1. Start Your Engines!</H3>
<a name="IDX-CHP-4-1423"></a> 
<a name="IDX-CHP-4-1424"></a> 
<a name="IDX-CHP-4-1425"></a> 

<p class="docText">Let's see how much I can milk this engine analogy.<a name="IDX-CHP-4-1426"></a> 
 The whole point of having an engine is so that you can get from Point A to Point B without doing much work. The engine does the work for you so you can relax and enjoy the sound system. The engine's primary task is to turn the wheels, and how it does that isn't really a concern of yours. Or is it?</P>
<a name="regex3-CHP-4-SECT-1.1"></a>
<H4 id="title-IDAAK2DF" class="docSection2Title">4.1.1. Two Kinds of Engines</h4>
<p class="docText">Well, what if you had an electric car? They've been around for a long time, but they aren't as common as gas cars because they're hard to design well. If you had one, though, you would have to remember not to put gas in it. If you had a gasoline engine, well, watch out for sparks! An electric engine more or less just runs, but a gas engine might need some babysitting. You can get much better performance just by changing little things like your spark plug gaps, air filter, or brand of gas. Do it wrong and the engine's performance deteriorates, or, worse yet, it stalls.</P>
<p class="docText">Each engine might do its work differently, but the end result is that the wheels turn. You still have to steer properly if you want to get anywhere, but that's an entirely different issue.</p>

<a name="regex3-CHP-4-SECT-1.2"></a>
<h4 id="title-IDALK2DF" class="docSection2Title">4.1.2. New Standards</H4>
<p class="docText">Let's stoke the fire by adding another variable: the California Emissions Standards.<sup class="docFootnote"><a class="docLink" href="#regex3-CHP-4-FN-1">[<img src=images/U2020.jpg border=0>]</a></sup> Some engines adhere to California's strict pollution standards, and some engines don't. These aren't really different kinds of engines, just new variations on what's already around. The standard regulates a result of the engine's work, the emissions, but doesn't say anything about how the engine should go about achieving those cleaner results. So, our two classes of engine are divided into four types: electric (adhering and non-adhering) and gasoline (adhering and non-adhering).</P><blockquote><p class="docFootnote"><sup><a name="regex3-CHP-4-FN-1">[<img src=images/U2020.jpg border=0>]</a></sup> California has rather strict standards regulating the amount of pollution a car can produce. Because of this, many cars sold in America come in "California" and "non-California" models.</p></blockquote>
<p class="docText">Come to think of it, I bet that an electric engine can qualify for the standard without much changethe standard just "blesses" the clean results that are already par for the course. The gas engine, on the other hand, needs some major tweaking and a bit of re-tooling before it can qualify. Owners of this kind of engine need to pay particular care to what they feed ituse the wrong kind of gas and you're in big trouble.</p>
<a name="regex3-CHP-4-SECT-1.2.1"></a>
<H5 id="title-IDA1K2DF" class="docSection3Title">4.1.2.1. The impact of standards</H5>
<p class="docText">Better pollution standards are a good thing, but they require that the driver exercise more thought and foresight (well, at least for gas engines). Frankly, however, the standard doesn't impact most people since all the other states still do their own thing and don't follow California's standard.</P>
<p class="docText">So, you realize that these four types of engines can be classified into three groups (the two kinds for gas, and electric in general). You know about the differences, and that in the end they all still turn the wheels. What you don't know is what the heck this has to do with regular expressions! More than you might imagine.</p>


<a name="regex3-CHP-4-SECT-1.3"></a>
<H4 id="title-IDAHL2DF" class="docSection2Title">4.1.3. Regex Engine Types</H4>
<a name="IDX-CHP-4-1427"></a> 

<p class="docText">There are two fundamentally different types of regex engines: one called "DFA" (the electric engine of our story) and one called "NFA" (the gas engine). The details of what NFA and DFA mean follow shortly (&#9758; 156), but for now just consider them names, like Bill and Ted. Or electric and gas.</p>
<p class="docText">Both engine types have been around for a long time, but like its gasoline counterpart, the NFA type seems to be used more often. Tools that use an NFA engine include the .NET languages, PHP, Ruby, Perl, Python, GNU Emacs, <span class="docEmphasis">ed</span>, sed, <span class="docEmphasis">vi</span>, most versions of <span class="docEmphasis">grep</span>, and even a few versions of <span class="docEmphasis">egrep</span> and awk. On the other hand, a DFA engine is found in almost all versions of <span class="docEmphasis">egrep</span> and awk, as well as <span class="docEmphasis">lex</span> and <span class="docEmphasis">flex</span>. Some systems have a multi-engine hybrid system, using the most appropriate engine for the job (or even one that swaps between engines for different parts of the same regex, as needed to get the best combination of features and speed). <a class="docLink" href="#regex3-CHP-4-TABLE-1">Table 4-1</a> lists a few common programs and the regex engine that most versions use. If your favorite program is not in the list, the section "<a class="docLink" href="#regex3-CHP-4-SECT-1.5">Testing the Engine Type</a>" on the next page can help you find out which it is.</p>
<a name="regex3-CHP-4-TABLE-1"></a><p><table cellspacing="0" FRAME="hsides" RULES="all" cellpadding="4" width="100%"><caption><h5 class="docTableTitle">Table 4-1. Some Tools and Their Regex Engines</H5></caption><colgroup span="2"><col><col></colgroup><thead><tr><th class="thead" scope="col" align="left"><p class="docText">Engine type</p></th><th class="thead" scope="col" align="left"><p class="docText">Programs</P></th></tr></thead><tr><td class="docTableCell" align="left"><p class="docText">DFA</p></td><td class="docTableCell" align="left"><p class="docText">awk (most versions), <span class="docEmphasis">egrep</span>(most versions), <span class="docEmphasis">flex</span>, <span class="docEmphasis">lex</span>, MySQL, Procmail</p></td></tr><tr><td class="docTableCell" align="left"><p class="docText">Traditional NFA</p></td><td class="docTableCell" align="left"><p class="docText">GNU Emacs, Java, <span class="docEmphasis">grep</span>(most versions), <span class="docEmphasis">less</span>, <span class="docEmphasis">more</span>, .NET languages, PCRE library, Perl, PHP (all three regex suites), Python, Ruby, sed (most versions), <span class="docEmphasis">vi</span></p></td></tr><TR><td class="docTableCell" align="left"><p class="docText">POSIX NFA</P></td><td class="docTableCell" align="left"><p class="docText"><span class="docEmphasis">mawk</span>, Mortice Kern Systems' utilities, GNU Emacs (when requested)</P></TD></TR><TR><td class="docTableCell" align="left"><p class="docText">Hybrid NFA/DFA</P></td><td class="docTableCell" align="left"><p class="docText">GNU awk, GNU <span class="docEmphasis">grep/egrep</span>, Tcl</P></TD></tr></table></p><BR>
<p class="docText">As <a class="docLink" href="regex3-CHP-3.html#regex3-CHP-3">Chapter 3</a> illustrated, 20 years of development with both DFAs and NFAs resulted in a lot of needless variety. Things were dirty. The POSIX standard came in to clean things up by clearly specifying not only which metacharacters and features an engine should support, as mentioned in the previous chapter, but also <span class="docEmphasis">exactly the results you could expect from them</span>. Superficial details aside, the DFAs (our electric engines) were already well suited to adhere to this new standard, but the kind of results an NFA traditionally provided were different, so changes were needed. As a result, broadly speaking, there are three types of regex engines:</P>
<UL><li><p class="docList">DFA (POSIX or notsimilar either way)</P></LI><li><p class="docList">Traditional NFA (most common: Perl, .NET, PHP, Java, Python, ...)</p></li><li><p class="docList">POSIX NFA</P></li></ul>
<p class="docText">Here, we use "POSIX" to refer to the match <span class="docEmphasis">semantics</span>the expected operation of a regex that the POSIX standard specifies (which we'll get to later in this chapter). Don't confuse this use of "POSIX" with uses surrounding regex <span class="docEmphasis">features</span> introduced<a name="IDX-CHP-4-1428"></a> 
 in that same standard (&#9758; 127). Many programs support the features without supporting the full match semantics.</P>
<p class="docText">Old (and minimally featured) programs like <span class="docEmphasis">egrep</span>, awk, and <span class="docEmphasis">lex</span> were normally implemented with the electric DFA engine, so the new standard primarily just confirmed the status quono big changes. However, there <span class="docEmphasis">were</span> some gas-powered versions of these programs which had to be changed if they wanted to be POSIX-compliant. The gas engines that passed the California Emission Standards tests(POSIX NFA) were fine in that they produced results according to the standard, but the necessary changes only increased how fickle they were to proper tuning. Where before you might get by with slightly misaligned spark plugs, you now have absolutely no tolerance. Gasoline that used to be "good enough" now causes knocks and pings. But, so long as you know how to maintain your baby, the engine runs smoothly and cleanly.</p>

<a name="regex3-CHP-4-SECT-1.4"></a>
<h4 id="title-IDAHR2DF" class="docSection2Title">4.1.4. From the Department of Redundancy Department</h4>
<a name="IDX-CHP-4-1429"></a> 
<a name="IDX-CHP-4-1430"></a> 
<a name="IDX-CHP-4-1431"></a> 
<a name="IDX-CHP-4-1432"></a> 
<a name="IDX-CHP-4-1433"></a> 
<a name="IDX-CHP-4-1434"></a> 

<p class="docText">At this point, I'll ask you to go back and review the story about engines. Every sentence there rings with some truth about regular expressions. A second reading should raise some questions. Particularly, what does it mean that an electric DFA regex engine more or less "just runs?" What affects a gas-powered NFA? How can I tune my regular expressions to run as I want on an NFA? What special concerns does an emissions-controlled POSIX NFA have? What's a "stalled engine" in the regex world?</p>

<a name="regex3-CHP-4-SECT-1.5"></a>
<h4 id="title-IDAMS2DF" class="docSection2Title">4.1.5. Testing the Engine Type</h4>
<p class="docText">Because the type of engine used in a tool influences the type of features it can offer, and how those features appear to work, we can often learn the type of engine a tool has merely by checking to see how it handles a few test expressions. (After all, if you can't tell the difference, the difference doesn't matter.) At this point in the book, I wouldn't expect you to understand why the following test results indicate what they do, but I want to offer these tests now so that if your favorite tool is not listed in <a class="docLink" href="#regex3-CHP-4-TABLE-1">Table 4-1</a>, you can investigate before continuing with this and the subsequent chapters.</p>
<a name="regex3-CHP-4-SECT-1.5.1"></a>
<h5 id="title-IDA0S2DF" class="docSection3Title">4.1.5.1. Traditional NFA or not?</h5>
<p class="docText">The most commonly used engine is a Traditional NFA, and spotting it is easy. First, are lazy quantifiers (&#9758; 141) supported? If so, it's almost certainly a Traditional NFA. As we'll see, lazy quantifiers are not possible with a DFA, nor would they make any sense with a POSIX NFA. However, to make sure, simply apply the regex <img src=images/U2308.jpg border=0><tt>nfa|nfa&#8226;not</tt><img src=images/U230B.jpg border=0> to the string <tt>'nfa&#8226;not'</tt>if only <tt>'nfa'</tt> matches, it's a Traditional NFA. If the entire <tt>'nfa&#8226;not'</tt> matches, it's either a POSIX NFA or a DFA.</p>

<a name="regex3-CHP-4-SECT-1.5.2"></a>
<h5 id="title-IDAMT2DF" class="docSection3Title">4.1.5.2. DFA or POSIX NFA?</h5>
<p class="docText">Differentiating between a POSIX NFA and a DFA is sometimes just as simple. Capturing parentheses and backreferences are not supported by a DFA, so that can be one hint, but there are systems that are a hybrid mix between the two engine types, and so may end up using a DFA if there are no capturing parentheses.</p>
<p class="docText">Here's a simple test that can tell you a lot. Apply <img src=images/U2308.jpg border=0><tt>X(.+)+X</tt><img src=images/U230B.jpg border=0> to a string like '<tt>=XX====================</tt>', as with this <span class="docEmphasis">egrep</span> command:</p>
<pre>
    echo =XX========================================= | egrep 'X(.+)+X'
</pre><br>

<p class="docText">If it takes a long time to finish, it's an NFA (and if not a Traditional NFA as per the test in the previous section, it must be a POSIX NFA). If it finishes quickly, it's either a DFA or an NFA with some advanced optimization. Does it display a warning message about a stack overflow or long match aborted? If so, it's an NFA.</p>



<a href="7041536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4-SECT-2.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>