<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 4.3.&nbsp; Regex-Directed Versus Text-Directed</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4-SECT-2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4-SECT-4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a name="regex3-CHP-4-SECT-3"></a>
<H3 id="title-IDAXQWJN" class="docSection1Title">4.3. Regex-Directed Versus Text-Directed</H3>
<p class="docText">The two basic engine types reflect a fundamental difference in algorithms available for applying a regular expression to a string. I call the gasoline-driven NFA engine "regex-directed," and the electric-driven DFA "text-directed."</P>
<a name="regex3-CHP-4-SECT-3.1"></a>
<H4 id="title-IDA5QWJN" class="docSection2Title">4.3.1. NFA Engine: Regex-Directed</h4>
<a name="IDX-CHP-4-1474"></a> 

<p class="docText">Let's consider one way an engine might match <img src=images/U2308.jpg border=0><tt>to(nite|knight|night)</tt><img src=images/U230B.jpg border=0> against the text '<tt>&#8943;tonight&#8943;</tt>'. Starting with the <img src=images/U2308.jpg border=0><tt>t</tt><img src=images/U230B.jpg border=0>, the regular expression is examined one component at a time, and the "current text" is checked to see whether it is matched by the current component of the regex. If it does, the next component is checked, and so on, until all components have matched, indicating that an overall match has been achieved.</P>
<a name="regex3-CHP-4-SIDEBAR-2"></a><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><TD>
<H2 class="docSidebarTitle">Quiz Answer</h2>
<p class="docText">&#10070; <span class="docEmphasis">Answer to the question on page 153</span>.</p>
<p class="docText"><span class="docEmphStrong">When <img src=images/U2308.jpg border=0><tt>^.*([0-9]+)</tt><img src=images/U230B.jpg border=0> is applied to '<tt>Copyright 2003</tt>.', what is captured by the parentheses?</span></P>
<p class="docText">The desire is to get the last whole number, but it doesn't work. As before, <img src=images/U2308.jpg border=0> <tt>.*</tt><img src=images/U230B.jpg border=0> is forced to relinquish some of what it had matched because the subsequent <img src=images/U2308.jpg border=0><tt>[0-9]+</tt><img src=images/U230B.jpg border=0> requires a match to be successful. In this example, that means unmatching the final period and '<tt>3</tt>', which then allows <img src=images/U2308.jpg border=0><tt>[0-9]</tt><img src=images/U230B.jpg border=0> to match. That's governed by <img src=images/U2308.jpg border=0><tt>+</tt><img src=images/U230B.jpg border=0>, so matching just once fulfills its minimum, and now facing '.' in the string, it finds nothing else to match.</P>
<p class="docText">Unlike before, though, there's then nothing further that <span class="docEmphasis">must</span> match, so <img src=images/U2308.jpg border=0> <tt>.*</tt><img src=images/U230B.jpg border=0> is not forced to give up the <tt>0</tt> or any other digits it might have matched. Were <img src=images/U2308.jpg border=0> <tt>.*</tt><img src=images/U230B.jpg border=0> to do so, the <img src=images/U2308.jpg border=0><tt>[0-9]+</tt><img src=images/U230B.jpg border=0> would certainly be a grateful and greedy recipient, but nope, first come first served. Greedy constructs give up something they've matched only when forced. In the end, <tt>$1</tt> gets only '<tt>3</tt>'.</P>
<p class="docText">If this feels counter-intuitive, realize that <img src=images/U2308.jpg border=0><tt>[0-9]+</tt><img src=images/U230B.jpg border=0> is at most one match away from <img src=images/U2308.jpg border=0><tt>[0-9]<img border="0" alt="" width="7" height="10" SRC="images/regex3_u0408.jpg"></tt><img src=images/U230B.jpg border=0>, which is in the same league as <img src=images/U2308.jpg border=0> <tt>.*</tt><img src=images/U230B.jpg border=0>. Substituting that into <img src=images/U2308.jpg border=0><tt>^.*([0-9]+)</tt><img src=images/U230B.jpg border=0>, we get <img src=images/U2308.jpg border=0><tt>^.*(<img border="0" alt="" width="154" height="13" SRC="images/regex3_u0409.jpg">)</tt><img src=images/U230B.jpg border=0> as our regex, which looks suspiciously like the <img src=images/U2308.jpg border=0><tt>^Subject:&#8226;(.*)<img border="0" alt="" width="154" height="13" SRC="images/regex3_u0409.jpg"></tt><img src=images/U230B.jpg border=0> example from page 152, where the second <img src=images/U2308.jpg border=0> <tt>.*</tt><img src=images/U230B.jpg border=0> was guaranteed to match nothing.</p>
</TD></TR></table></p><br>
<p class="docText">With the <img src=images/U2308.jpg border=0><tt>to(nite|knight|night)</tt><img src=images/U230B.jpg border=0> example, the first component is <img src=images/U2308.jpg border=0><tt>t</tt><img src=images/U230B.jpg border=0>, which repeatedly fails until a '<tt>t</tt>' is reached in the target string. Once that happens, the <img src=images/U2308.jpg border=0><tt>o</tt><img src=images/U230B.jpg border=0> is checked against the next character, and if it matches, control moves to the next component. In this case, the "next component" is <img src=images/U2308.jpg border=0><tt>(nite|knight|night)</tt><img src=images/U230B.jpg border=0> which really means "<img src=images/U2308.jpg border=0><tt>nite</tt><img src=images/U230B.jpg border=0> or <img src=images/U2308.jpg border=0><tt>knight</tt><img src=images/U230B.jpg border=0> or <img src=images/U2308.jpg border=0><tt>night</tt><img src=images/U230B.jpg border=0>." Faced with three possibilities, the engine just tries each in turn. We (humans with advanced neural nets between our ears) can see that if we're matching <tt>tonight</tt>, the third alternative is the one that leads to a match. Despite their brainy origins (&#9758; 85), a regex-directed engine can't come to that conclusion until actually going through the motions to check.</p>
<p class="docText">Attempting the first alternative, <img src=images/U2308.jpg border=0><tt>nite</tt><img src=images/U230B.jpg border=0>, involves the same component-at-a-time treatment as before: "Try to match <img src=images/U2308.jpg border=0><tt>n</tt><img src=images/U230B.jpg border=0>, then <img src=images/U2308.jpg border=0><tt>i</tt><img src=images/U230B.jpg border=0>, then <img src=images/U2308.jpg border=0><tt>t</tt><img src=images/U230B.jpg border=0>, and finally <img src=images/U2308.jpg border=0><tt>e</tt><img src=images/U230B.jpg border=0>. " If this fails, as it eventually does, the engine tries another alternative, and so on until it achieves a match or must report failure. Control moves within the regex from component to component, so I call it "regex-directed."</p>
<a name="regex3-CHP-4-SECT-3.1.1"></a>
<H5 id="title-IDAJVWJN" class="docSection3Title">4.3.1.1. The control benefits of an NFA engine</h5>
<a name="IDX-CHP-4-1475"></a> 

<a name="IDX-CHP-4-1476"></a> 

<p class="docText">In essence, each subexpression of a regex in a regex-directed match is checked independently of the others. Other than backreferences, there's no interrelation among subexpressions, except for the relation implied by virtue of being thrown together to make a larger expression. The layout of the subexpressions and regex control structures (e.g., alternation, parentheses, and quantifiers) controls an engine's overall movement through a match.</p>
<p class="docText">Since the regex directs the NFA engine, the driver (the writer of the regular expression) has considerable opportunity to craft just what he or she wants to happen. (Chapters <a class="docLink" href="regex3-CHP-5.html#regex3-CHP-5">5</a> and <a class="docLink" href="regex3-CHP-6.html#regex3-CHP-6">6</a> show how to put this to use to get a job done correctly and efficiently.) What this really means may seem vague now, but it will all be spelled out soon.</P>


<a name="regex3-CHP-4-SECT-3.2"></a>
<h4 id="title-IDAMWWJN" class="docSection2Title">4.3.2. DFA Engine: Text-Directed</h4>
<p class="docText">Contrast the regex-directed NFA engine with an engine that, while scanning the string, keeps track of all matches "currently in the works." In the <tt>tonight</tt> example, the moment the engine hits <tt>t</tt>, it adds a potential match to its list of those currently in progress:</p>
<p><table cellspacing="0" border="1" RULES="all" cellpadding="4" width="100%"><colgroup span="2"><col><col></colgroup><thead><tr><th class="thead" scope="col" align="center"><p class="docText">in string</p></th><th class="thead" scope="col" align="center"><p class="docText">in regex</p></th></tr></thead><tr><td class="docTableCell" align="center"><p class="docText">after &#8943;<tt>t</tt><sub><img src=images/U22CF.jpg border=0></sub><tt>onight</tt>&#8943;</p></td><td class="docTableCell" align="center"><p class="docText">possible matches: <img src=images/U2308.jpg border=0><tt>t<sub><img src=images/U22CF.jpg border=0></sub>o(nite|knight|night)</tt><img src=images/U230B.jpg border=0></p></td></tr></table></p><BR>
<p class="docText">Each subsequent character scanned updates the list of possible matches. After a few more characters are matched, the situation becomes</p>
<P><table cellspacing="0" border="1" RULES="all" cellpadding="4" width="100%"><colgroup span="2"><col><col></colgroup><thead><tr><th class="thead" scope="col" align="center"><p class="docText">in string</p></th><th class="thead" scope="col" align="center"><p class="docText">in regex</P></th></TR></thead><TR><TD class="docTableCell" align="center"><p class="docText">after &#8943;<tt>toni</tt><sub><img src=images/U22CF.jpg border=0></sub><tt>ght</tt>&#8943;</p></TD><td class="docTableCell" align="center"><p class="docText">possible matches: <img src=images/U2308.jpg border=0><tt>to(ni<sub><img src=images/U22CF.jpg border=0></sub>te|knight|ni<sub><img src=images/U22CF.jpg border=0></sub>ght)</tt><img src=images/U230B.jpg border=0></p></TD></TR></table></p><br>
<p class="docText">with two possible matches in the works (and one alternative, <tt>knight</tt>, ruled out). With the <tt>g</tt> that follows, only the third alternative remains viable. Once the <tt>h</tt> and <tt>t</tt> are scanned as well, the engine realizes it has a complete match and can return success.</P>
<p class="docText">I call this "text-directed" matching because each character scanned from the text controls the engine. As in the example, a partial match might be the start of any number of different, yet possible, matches. Matches that are no longer viable are pruned as subsequent characters are scanned. There are even situations where a "partial match in progress" is also a full match. If the regex were <img src=images/U2308.jpg border=0><tt>to(&#8943;)?</tt><img src=images/U230B.jpg border=0>, for example, the parenthesized expression becomes optional, but it's still greedy, so it's always attempted. All the time that a partial match is in progress inside those parentheses, a full match (of '<tt>to</tt>') is already confirmed and in reserve in case the longer matches don't pan out.</P>
<p class="docText">If the engine reaches a character in the text that invalidates all the matches in the works, it must revert to one of the full matches in reserve. If there are none, it must declare that there are no matches at the current attempt's starting point.</P>

<a name="regex3-CHP-4-SECT-3.3"></a>
<h4 id="title-IDAB1WJN" class="docSection2Title">4.3.3. First Thoughts: NFA and DFA in Comparison</H4>
<a name="IDX-CHP-4-1477"></a> 
<a name="IDX-CHP-4-1478"></a> 
<a name="IDX-CHP-4-1479"></a> 
<a name="IDX-CHP-4-1480"></a> 
<a name="IDX-CHP-4-1481"></a> 
<a name="IDX-CHP-4-1482"></a> 

<p class="docText">If you compare these two engines based only on what I've mentioned so far, you might conclude that the text-directed DFA engine is generally faster. The regex-directed NFA engine might waste time attempting to match different subexpressions against the same text (such as the three alternatives in the example).</P>
<p class="docText">You would be right. During the course of an NFA match, the same character of the target might be checked by many different parts of the regex (or even by the same part, over and over). Even if a subexpression can match, it might have to be applied again (and again and again) as it works in concert with the rest of the regex to find a match. A local subexpression can fail or match, but you just never know about the overall match until you eventually work your way to the end of the regex. (If I could find a way to include "It's not over until the fat lady sings." in this paragraph, I would.) On the other hand, a DFA engine is <span class="docEmphasis">deterministic</span>each character in the target is checked once (at most). When a character matches, you don't know yet if it will be part of the final match (it could be part of a possible match that doesn't pan out), but since the engine keeps track of all possible matches in parallel, it needs to be checked only once, period.</p>
<p class="docText">The two basic technologies behind regular-expression engines have the somewhat imposing names <span class="docEmphasis">Nondeterministic Finite Automaton</span> (NFA) and <span class="docEmphasis">Deterministic Finite Automaton</span> (DFA). With mouthfuls like this, you see why I stick to just "NFA" and "DFA." We won't be seeing these phrases spelled out again.<sup class="docFootnote"><a class="docLink" href="#regex3-CHP-4-FN-5">[<img src=images/U2020.jpg border=0>]</a></sup></p><blockquote><p class="docFootnote"><sup><a name="regex3-CHP-4-FN-5">[<img src=images/U2020.jpg border=0>]</a></sup> I suppose I could explain the underlying theory that goes into these names, if I only knew it! As I hinted, the word <span class="docEmphasis">deterministic</span> is pretty important, but for the most part the theory is not relevant, so long as we understand the practical effects. By the end of this chapter, we will.</p></blockquote>
<a name="regex3-CHP-4-SECT-3.3.1"></a>
<h5 id="title-IDA12WJN" class="docSection3Title">4.3.3.1. Consequences to us as users</H5>
<p class="docText">Because of the regex-directed nature of an NFA, the details of how the engine attempts a match are very important. As I said before, the writer can exercise a fair amount of control simply by changing how the regex is written. With the <tt>tonight</tt> example, perhaps less work would have been wasted had the regex been written differently, such as in one of the following ways:</p>
<ul><LI><p class="docList"><img src=images/U2308.jpg border=0><tt>to<span class="docEmphStrong">(</span>ni(ght|te)<span class="docEmphStrong">|</span>knight<span class="docEmphStrong">)</span></tt><img src=images/U230B.jpg border=0></p></li><li><p class="docList"><img src=images/U2308.jpg border=0><tt>tonite|toknight|tonight</tt><img src=images/U230B.jpg border=0></p></li><li><p class="docList"><img src=images/U2308.jpg border=0><tt>to(k?night|nite)</tt><img src=images/U230B.jpg border=0></p></li></ul>
<p class="docText">With any given text, these all end up matching exactly the same thing, but in doing so direct the engine in different ways. At this point, we don't know enough to judge which of these, if any, are better than the others, but that's coming soon.</p>
<p class="docText">It's the exact opposite with a DFAsince the engine keeps track of all matches simultaneously, none of these differences in representation matter so long as in the end they all represent the same set of possible matches. There could be a hundred different ways to achieve the same result, but since the DFA keeps track of them all simultaneously (almost magicallymore on this later), it doesn't matter which form the regex takes. To a pure DFA, even expressions that appear as different as <img src=images/U2308.jpg border=0><tt>abc</tt><img src=images/U230B.jpg border=0> and <img src=images/U2308.jpg border=0><tt>[aa-a](b|b{1}|b)c</tt><img src=images/U230B.jpg border=0> are utterly indistinguishable.</p>
<p class="docText">Three things come to my mind when describing a DFA engine:</p>
<ul><li><p class="docList">DFA matching is very fast.</p></li><li><p class="docList">DFA matching is very consistent.</P></li><LI><p class="docList">Talking about DFA matching is very boring.<a name="IDX-CHP-4-1483"></a> 
</p></li></UL>
<p class="docText">I'll eventually expand on all these points.</P>
<p class="docText">The regex-directed nature of an NFA makes it interesting to talk about. NFAs provide plenty of room for creative juices to flow. There are great benefits in crafting an expression well, and even greater penalties for doing it poorly. A gasoline engine is not the only engine that can stall and conk out completely. To get to the bottom of this, we need to look at the essence of an NFA engine: <span class="docEmphasis">backtracking</span>.</P>



<a href="7041536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4-SECT-2.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=regex3-CHP-4-SECT-4.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>