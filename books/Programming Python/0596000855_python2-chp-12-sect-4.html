<html><head>
<META http-equiv="Content-Type" content="text/html">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="12.4 The Hello World Selector"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#CCCCCC">
<td><font color="black" size=1>I l<font color="#FF0000">@</font>ve RuBoard</td>
<td valign="top" class="v2" align="right">
	<a href="0596000855_python2-CHP-12-SECT-3.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0596000855_python2-CHP-12-SECT-5.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><A NAME="python2-CHP-12-SECT-4"></A>
<H3 class="docSection1Title">12.4 The Hello World Selector</H3>

<P class="docText"><A NAME="python2-IDXTERM-1218"></A> <A NAME="python2-IDXTERM-1219"></A>It's now time for something a bit
more useful (well, more entertaining, at least). This section
presents a program that displays the basic syntax required by various
programming languages to print the string "Hello World",
the classic language benchmark. To keep this simple, it assumes the
string shows up in the standard output stream, not a GUI or web page.
It also gives just the output command itself, not the complete
programs. The Python version happens to be a complete program, but we
won't hold that against its competitors here.
</P>

<P class="docText">Structurally, the first cut of this example consists of a main page
HTML file, along with a Python-coded CGI script that is invoked by a
form in the main HTML page. Because no state or database data is
stored between user clicks, this is still a fairly simple example. In
fact, the main HTML page implemented by <A class="docLink" HREF="#python2-CHP-12-EX-16">Example 12-16</A>
is really just one big pull-down selection list within a form.
</P>


<H5 class="docExampleTitle"><A NAME="python2-CHP-12-EX-16"></A>Example 12-16. PP2E\Internet\Cgi-Web\Basics\languages.html </H5>
<PRE>&lt;html&gt;&lt;body&gt;
&lt;title&gt;Languages&lt;/title&gt;
&lt;h1&gt;Hello World selector&lt;/h1&gt;

&lt;P&gt;This demo shows how to display a "hello world" message in various
programming languages' syntax.  To keep this simple, only the output command
is shown (it takes more code to make a complete program in some of these 
languages), and only text-based solutions are given (no GUI or HTML 
construction logic is included). This page is a simple HTML file; the one 
you see after pressing the button below is generated by a Python CGI script 
which runs on the server. Pointers: 

&lt;UL&gt;
&lt;LI&gt;To see this page's HTML, use the 'View Source' command in your browser.
&lt;LI&gt;To view the Python CGI script on the server, 
    &lt;A HREF="languages-src.cgi"&gt;click here&lt;/A&gt; or
    &lt;A HREF="getfile.cgi?filename=languages.cgi"&gt;here&lt;/A&gt;. 
&lt;LI&gt;To see an alternative version that generates this page dynamically, 
    &lt;A HREF="languages2.cgi"&gt;click here&lt;/A&gt;. 
&lt;LI&gt;For more syntax comparisons, visit 
    &lt;A HREF="http://www.ionet.net/~timtroyr/funhouse/beer.html"&gt;this site&lt;/A&gt;.
&lt;/UL&gt;&lt;/P&gt;

&lt;hr&gt;
<B>&lt;form method=POST action="languages.cgi"&gt;</B>
    &lt;P&gt;&lt;B&gt;Select a programming language:&lt;/B&gt;
<B>    &lt;P&gt;&lt;select name=language&gt;</B>
        &lt;option&gt;All
        &lt;option&gt;Python
        &lt;option&gt;Perl
        &lt;option&gt;Tcl
        &lt;option&gt;Scheme
        &lt;option&gt;SmallTalk
        &lt;option&gt;Java
        &lt;option&gt;C
        &lt;option&gt;C++
        &lt;option&gt;Basic
        &lt;option&gt;Fortran
        &lt;option&gt;Pascal
        &lt;option&gt;Other
    &lt;/select&gt;
    &lt;P&gt;&lt;input type=Submit&gt;
&lt;/form&gt;

&lt;/body&gt;&lt;/html&gt;</PRE>


<P class="docText">For the moment, let's ignore some of the hyperlinks near the
middle of this file; they introduce bigger concepts like file
transfers and maintainability that we will explore in the next two
sections. When visited with a browser, this HTML file is downloaded
to the client and rendered into the new browser page shown in <A class="docLink" HREF="#python2-CHP-12-FIG-19">Figure 12-19</A>.
</P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="python2-CHP-12-FIG-19"></A>Figure 12-19. The "Hello World" main page</H5>
<IMG BORDER="0" WIDTH="381" HEIGHT="324" src="FILES/ppy2_1219.gif" ALT="figs/ppy2_1219.gif"></CENTER>

<P class="docText">That widget above the Submit button is a pull-down selection list
that lets you choose one of the <TT>&lt;option&gt;</TT> tag
values in the HTML file. As usual, selecting one of these language
names and pressing the Submit button at the bottom (or pressing your
Enter key) sends the selected language name to an instance of the
server-side CGI script program named in the form's
<TT>action</TT> option. <A class="docLink" HREF="#python2-CHP-12-EX-17">Example 12-17</A>
contains the Python script that runs on the server upon submission.
</P>


<H5 class="docExampleTitle"><A NAME="python2-CHP-12-EX-17"></A>Example 12-17. PP2E\Internet\Cgi-Web\Basics\languages.cgi </H5>
<PRE>#!/usr/bin/python
########################################################
# show hello world syntax for input language name;
# note that it uses r'...' raw strings so that '\n'
# in the table are left intact, and cgi.escape(  ) on 
# the string so that things like '&lt;&lt;' don't confuse 
# browsers--they are translated to valid html code;
# any language name can arrive at this script: e.g.,
# can type "http://starship.python.net/~lutz/Basics
# /languages.cgi?language=Cobol" in any web browser.
# caveats: the languages list appears in both the cgi
# and html files--could import from a single file if
# selection list generated by another cgi script too;
########################################################

debugme  = 0                                     # 1=test from cmd line
inputkey = 'language'                            # input parameter name 

hellos = {
    'Python':    r" print 'Hello World'               ",
    'Perl':      r' print "Hello World\n";            ',
    'Tcl':       r' puts "Hello World"                ',
    'Scheme':    r' (display "Hello World") (newline) ',
    'SmallTalk': r" 'Hello World' print.              ",
    'Java':      r' System.out.println("Hello World"); ',
    'C':         r' printf("Hello World\n");          ',
    'C++':       r' cout &lt;&lt; "Hello World" &lt;&lt; endl;    ',
    'Basic':     r' 10 PRINT "Hello World"            ',
    'Fortran':   r" print *, 'Hello World'             ",
    'Pascal':    r" WriteLn('Hello World');            "
}

class dummy:                                     # mocked-up input obj  
    def __init__(self, str): self.value = str

import cgi, sys
if debugme:
    form = {inputkey: dummy(sys.argv[1])}        # name on cmd line
else:
    form = cgi.FieldStorage(  )                    # parse real inputs

print "Content-type: text/html\n"                # adds blank line
print "&lt;TITLE&gt;Languages&lt;/TITLE&gt;"
print "&lt;H1&gt;Syntax&lt;/H1&gt;&lt;HR&gt;" 

def showHello(form):                             # html for one language
    choice = form[inputkey].value 
    print "&lt;H3&gt;%s&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;" % choice
    try:
        print cgi.escape(hellos[choice])
    except KeyError:
        print "Sorry--I don't know that language"
    print "&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;"
    
if not form.has_key(inputkey) or form[inputkey].value == 'All':
    for lang in hellos.keys(  ):
        mock = {inputkey: dummy(lang)}
        showHello(mock)
else:
    showHello(form)
print '&lt;HR&gt;' </PRE>


<P class="docText">And as usual, this script prints HTML code to the standard output
stream to produce a response page in the client's browser.
There's not much new to speak of in this script, but it employs
a few techniques that merit special focus:
</P>

<A NAME="IXT-12-337567"></A><A NAME="IXT-12-337568"></A><A NAME="IXT-12-337569"></A><A NAME="IXT-12-337570"></A><A NAME="IXT-12-337571"></A><A NAME="IXT-12-337572"></A><A NAME="IXT-12-337573"></A><A NAME="IXT-12-337574"></A><DL class="docList">
<DT><I><span class="docPubcolor">Raw strings</span></I></DT>
<DD>
<P class="docList"><A NAME="IXT-12-337567"></A>
<A NAME="IXT-12-337568"></A>Notice the use of <span class="docEmphasis">raw
strings</span> (string constants preceded by an "r"
character) in the language syntax dictionary. Recall that raw strings
retain <TT>\</TT> backslash characters in the string
literally, rather than interpreting them as string escape-code
introductions. Without them, the <TT>\n</TT> newline
character sequences in some of the language's code snippets
would be interpreted by Python as line-feeds, rather than being
printed in the HTML reply as <TT>\n</TT>.
</P>
</DD><DT><I><span class="docPubcolor">Escaping text embedded in HTML and URLs</span></I></DT>
<DD>
<P class="docList"><A NAME="IXT-12-337569"></A> <A NAME="IXT-12-337570"></A>
<A NAME="IXT-12-337571"></A>This script
takes care to format the text of each language's code snippet
with the <TT>cgi.escape</TT> utility function. This
standard Python utility automatically translates characters that are
special in HTML into HTML escape code sequences, such that they are
not treated as HTML operators by browsers. Formally,
<TT>cgi.escape</TT> translates characters to escape code
sequences, according to the standard HTML convention:
<TT>&lt;</TT>, <TT>&gt;</TT>, and
<TT>&amp;</TT> become <TT>&amp;lt;</TT>,
<TT>&amp;gt;</TT>, and <TT>&amp;amp;</TT>. If you
pass a second true argument, the double-quote character
(<TT>"</TT>) is also translated to
<TT>&amp;quot;</TT>.
</P>

<P class="docList">For example, the <TT>&lt;&lt;</TT> left-shift operator in
the C++ entry is translated to
<TT>&amp;lt;&amp;lt;</TT> -- a pair of HTML escape
codes. Because printing each code snippet effectively embeds it in
the HTML response stream, we must escape any special HTML characters
it contains. HTML parsers (including Python's standard
<TT>htmllib</TT> module) translate escape codes back to the
original characters when a page is rendered.
</P>

<P class="docList">More generally, because CGI is based upon the notion of passing
formatted stringsacross the Net, escaping
special characters is a ubiquitous operation. CGI scripts almost
always need to escape text generated as part of the reply to be safe.
For instance, if we send back arbitrary text input from a user or
read from a data source on the server, we usually can't be sure
if it will contain HTML characters or not, so we must escape it just
in case.
</P>

<P class="docList">In later examples, we'll also find that characters inserted
into URL address strings generated by our scripts may need to be
escaped as well. A literal <TT>&amp;</TT> in a URL is
special, for example, and must be escaped if it appears embedded in
text we insert into a URL. However, URL syntax reserves different
special characters than HTML code, and so different escaping
conventions and tools must be used. As we'll see later in this
chapter, <TT>cgi.escape</TT> implements escape translations
in HTML code, but <TT>urllib.quote</TT> (and its relatives)
escapes characters in URL strings.
</P>
</DD><DT><I><span class="docPubcolor">Mocking up form inputs</span></I></DT>
<DD>
<P class="docList"><A NAME="IXT-12-337572"></A> <A NAME="IXT-12-337573"></A>Here again, form inputs are
"mocked up" (simulated), both for debugging and for
responding to a request for all languages in the table. If the
script's global <TT>debugme</TT> variable is set to a
true value, for instance, the script creates a dictionary that is
plug-and-play compatible with the result of a
<TT>cgi.FieldStorage</TT> call -- its
"languages" key references an instance of the
<TT>dummy</TT> mock-up class. This class in turn creates an
object that has the same interface as the contents of a
<TT>cgi.FieldStorage</TT> result -- it makes an object
with a <TT>value</TT> attribute set to a passed-in
string.<A NAME="IXT-12-337574"></A>
</P>

<P class="docList">The net effect is that we can test this script by running it from the
system command line: the generated dictionary fools the script into
thinking it was invoked by a browser over the Net. Similarly, if the
requested language name is "All," the script iterates
over all entries in the languages table, making a mocked-up form
dictionary for each (as though the user had requested each language
in turn). This lets us reuse the existing
<TT>showHello</TT> logic to display each language's
code in a single page. As always in Python, object interfaces and
protocols are what we usually code for, not specific datatypes. The
<TT>showHello</TT> function will happily process any object
that responds to the syntax
<TT>form['language'].value</TT>.<sup class="docFootnote"><A class="docLink" HREF="#">[8]</A></sup>
</P> <blockquote><p class="docFootnote"><sup><A NAME="">[8]</A></sup> If you are
reading closely, you might notice that this is the second time
we've used mock-ups in this chapter (see the earlier
<I>test4.cgi</I> example). If you find this technique
generally useful, it would probably make sense to put the
<TT>dummy</TT> class, along with a function for populating
a form dictionary on demand, into a module so it can be reused. In
fact, we will do that in the next section. Even for two-line classes
like this, typing the same code the third time around will do much to
convince you of the power of code reuse.</p></blockquote> 
</DD>
</DL>

<P class="docText">Now let's get back to interacting with this program. If we
select a particular language, our CGI script generates an HTML reply
of the following sort (along with the required content-type header
and blank line):
</P>

<PRE>&lt;TITLE&gt;Languages&lt;/TITLE&gt;
&lt;H1&gt;Syntax&lt;/H1&gt;&lt;HR&gt;
&lt;H3&gt;Scheme&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 (display "Hello World") (newline) 
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;HR&gt;</PRE>

<P class="docText">Program code is marked with a <TT>&lt;PRE&gt;</TT> tag to
specify preformatted text (the browser won't reformat it like a
normal text paragraph). This reply code shows what we get when we
pick "Scheme." <A class="docLink" HREF="#python2-CHP-12-FIG-20">Figure 12-20</A> shows the
page served up by the script after selecting "Python" in
the pull-down selection list.
</P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="python2-CHP-12-FIG-20"></A>Figure 12-20. Response page created by languages.cgi</H5>
<IMG BORDER="0" WIDTH="231" HEIGHT="200" src="FILES/ppy2_1220.gif" ALT="figs/ppy2_1220.gif"></CENTER>

<P class="docText">Our script also accepts a language name of "All," and
interprets it as a request to display the syntax for every language
it knows about. For example, here is the HTML that is generated if we
set global variable <TT>debugme</TT> to 1 and run from the
command line with a single argument, "All." This output
is the same as what's printed to the client's browser in
response to an "All" request:<sup class="docFootnote"><A class="docLink" HREF="#">[9]</A></sup>
</P>
<blockquote><p class="docFootnote"><sup><A NAME="">[9]</A></sup> Interestingly, we also get the "All" reply if
<TT>debugme</TT> is set to
when we run the script from the command line. The
<TT>cgi.FieldStorage</TT> call returns an empty dictionary
if called outside the CGI environment rather than throwing an
exception, so the test for a missing key kicks in. It's likely
safer to not rely on this behavior, however. </p></blockquote>

<PRE>C:\...\PP2E\Internet\Cgi-Web\Basics&gt;<B>python languages.cgi All</B>
Content-type: text/html

&lt;TITLE&gt;Languages&lt;/TITLE&gt;
&lt;H1&gt;Syntax&lt;/H1&gt;&lt;HR&gt;
&lt;H3&gt;Perl&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 print "Hello World\n";            
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;SmallTalk&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 'Hello World' print.              
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;Basic&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 10 PRINT "Hello World"            
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;Scheme&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 (display "Hello World") (newline) 
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;Python&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 print 'Hello World'               
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;C++&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 cout &amp;lt;&amp;lt; "Hello World" &amp;lt;&amp;lt; endl;    
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;Pascal&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 WriteLn('Hello World');            
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;Java&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 System.out.println("Hello World"); 
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;C&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 printf("Hello World\n");          
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;Tcl&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 puts "Hello World"                
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;H3&gt;Fortran&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
 print *, 'Hello World'             
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;HR&gt;</PRE>

<P class="docText">Each language is represented here with the same code
pattern -- the <TT>showHello</TT> function is called for
each table entry, along with a mocked-up form object. Notice the way
that C++ code is escaped for embedding inside the HTML stream; this
is the <TT>cgi.escape</TT> call's handiwork. When
viewed with a browser, the "All" response page is
rendered as shown in <A class="docLink" HREF="#python2-CHP-12-FIG-21">Figure 12-21</A>.<A NAME="IXTR3-318"></A> <A NAME="IXTR3-319"></A>
</P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="python2-CHP-12-FIG-21"></A>Figure 12-21. Response page for "all languages" choice</H5>
<IMG BORDER="0" WIDTH="274" HEIGHT="331" src="FILES/ppy2_1221.gif" ALT="figs/ppy2_1221.gif"></CENTER>

<A NAME="python2-CHP-12-SECT-4.1"></A>
<H4 class="docSection2Title">12.4.1 Checking for Missing and Invalid Inputs</H4>

<P class="docText"><A NAME="IXT-12-337575"></A>
<A NAME="IXT-12-337576"></A>
<A NAME="IXT-12-337577"></A>So far, we've been
triggering the CGI script by selecting a language name from the
pull-down list in the main HTML page. In this context, we can be
fairly sure that the script will receive valid inputs. Notice,
though, that there is nothing to prevent a user from passing the
requested language name at the end of the CGI script's URL as
an explicit parameter, instead of using the HTML page form. For
instance, a URL of the form:
</P>

<PRE>http://starship.python.net/~lutz/Basics/languages.cgi?language=Python</PRE>

<P class="docText">yields the same "Python" response page shown in <A class="docLink" HREF="#python2-CHP-12-FIG-20">Figure 12-20</A>.<sup class="docFootnote"><A class="docLink" HREF="#">[10]</A></sup> However, because it's always possible for a user to
bypass the HTML file and use an explicit URL, it's also
possible that a user could invoke our script with an unknown language
name that is not in the HTML file's pull-down list (and so not
in our script's table). In fact, the script might be triggered
with no language input at all, if someone explicitly types its URL
with no parameter at the end.
</P>
<blockquote><p class="docFootnote"><sup><A NAME="">[10]</A></sup> See the
<TT>urllib</TT> module examples in the prior and following
chapters for a way to send this URL from a Python script.
<TT>urllib</TT> lets programs fetch web pages and invoke
remote CGI scripts by building and submitting URL strings like this
one, with any required parameters filled in at the end of the string.
You could use this module, for instance, to automatically send
information to order Python books at an online bookstore from within
a Python script, without ever starting a web browser.</p></blockquote>

<P class="docText">To be robust, the script checks for both cases explicitly, as all CGI
scripts generally should. For instance, here is the HTML generated in
response to a request for the fictitious language
"GuiDO":
</P>

<PRE>&lt;TITLE&gt;Languages&lt;/TITLE&gt;
&lt;H1&gt;Syntax&lt;/H1&gt;&lt;HR&gt;
&lt;H3&gt;GuiDO&lt;/H3&gt;&lt;P&gt;&lt;PRE&gt;
Sorry--I don't know that language
&lt;/PRE&gt;&lt;/P&gt;&lt;BR&gt;
&lt;HR&gt;</PRE>

<P class="docText">If the script doesn't receive any language name input, it
simply defaults to the "All" case. If we didn't
detect these cases, chances are that our script would silently die on
a Python exception and leave the user with a mostly useless
half-complete page or with a default error page (we didn't
assign <TT>stderr</TT> to <TT>stdout</TT> here,
so no Python error message would be displayed). In pictures, <A class="docLink" HREF="#python2-CHP-12-FIG-22">Figure 12-22</A> shows the page generated if the script is
invoked with an explicit URL like this:
</P>

<PRE>http://starship.python.net/~lutz/Basics/languages.cgi?language=COBOL</PRE>

<P class="docText">To test this error case, the pull-down list includes an
"Unknown" name, which produces a similar error page
reply. Adding code to the script's table for the COBOL
"Hello World" program is left as an exercise for the
reader.
</P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="python2-CHP-12-FIG-22"></A>Figure 12-22. Response page for unknown language</H5>
<IMG BORDER="0" WIDTH="296" HEIGHT="200" src="FILES/ppy2_1222.gif" ALT="figs/ppy2_1222.gif"></CENTER>



<a href="0596000855_"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul>
</td>
</tr>
</table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#CCCCCC">
<td><font color="black" size=1>I l<font color="#FF0000">@</font>ve RuBoard</td>
<td valign="top" class="v2" align="right">
          <a href="0596000855_python2-CHP-12-SECT-3.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0596000855_python2-CHP-12-SECT-5.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
