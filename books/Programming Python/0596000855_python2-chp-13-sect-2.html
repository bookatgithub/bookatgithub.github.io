<html><head>
<META http-equiv="Content-Type" content="text/html">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="13.2 The PyMailCgi Web Site"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#CCCCCC">
<td><font color="black" size=1>I l<font color="#FF0000">@</font>ve RuBoard</td>
<td valign="top" class="v2" align="right">
	<a href="0596000855_python2-CHP-13-SECT-1.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0596000855_python2-CHP-13-SECT-3.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><A NAME="python2-CHP-13-SECT-2"></A>
<H3 class="docSection1Title">13.2 The PyMailCgi Web Site</H3>

<P class="docText"><A NAME="python2-IDXTERM-1296"></A>Near the end of <A class="docLink" HREF="0596000855_python2-CHP-11.html#python2-CHP-11">Chapter 11</A>, we built a program called PyMailGui that
implemented a complete Python+Tk email client GUI (if you
didn't read that section, you may want to take a quick look at
it now). Here, we're going to do something of the same, but on
the Web: the system presented in this section, PyMailCgi, is a
collection of CGI scripts that implement a simple web-based interface
for sending and reading email in any browser.
</P>

<P class="docText">Our goal in studying this system is partly to learn a few more CGI
tricks, partly to learn a bit about designing larger Python systems
in general, and partly to underscore the trade-offs between systems
implemented for the Web (PyMailCgi) and systems written to run
locally (PyMailGui). This chapter hints at some of these trade-offs
along the way, and returns to explore them in more depth after the
presentation of this system.<A NAME="IXT-13-337603"></A>
</P>

<A NAME="python2-CHP-13-SECT-2.1"></A>
<H4 class="docSection2Title">13.2.1 Implementation Overview</H4>

<P class="docText"><A NAME="python2-IDXTERM-1298"></A> <A NAME="python2-IDXTERM-1299"></A>
<A NAME="python2-IDXTERM-1300"></A>At the top
level, PyMailCgi allows users to view incoming email with the POP
interface and to send new mail by SMTP. Users also have the option of
replying to, forwarding, or deleting an incoming email while viewing
it. As implemented, anyone can send email from the PyMailCgi site,
but to view your email, you generally have to install PyMailCgi at
your own site with your own mail server information (due to security
concerns described later).
</P>

<P class="docText">Viewing and sending email sounds simple enough, but the interaction
involved involves a number of distinct web pages, each requiring a
CGI script or HTML file of its own. In fact, PyMailCgi is a fairly
linear system -- in the most complex user interaction scenario,
there are six states (and hence six web pages) from start to finish.
Because each page is usually generated by a distinct file in the CGI
world, that also implies six source files.
</P>

<P class="docText">To help keep track of how all of PyMailCgi's files fit into the
overall system, I wrote the file in <A class="docLink" HREF="#python2-CHP-13-EX-1">Example 13-1</A>
before starting any real programming. It informally sketches the
user's flow through the system and the files invoked along the
way. You can certainly use more formal notations to describe the flow
of control and information through states such as web pages (e.g.,
dataflow diagrams), but for this simple example this file gets the
job done.
</P>


<H5 class="docExampleTitle"><A NAME="python2-CHP-13-EX-1"></A>Example 13-1. PP2E\Internet\Cgi-Web\PyMailCgi\pageflow.txt </H5>
<PRE>file or script                          creates
--------------                          -------

[pymailcgi.html]                        Root window
 =&gt; [onRootViewLink.cgi]                Pop password window
     =&gt; [onViewPswdSubmit.cgi]          List window (loads all pop mail)
         =&gt; [onViewListLink.cgi]        View Window + pick=del|reply|fwd (fetch)
             =&gt; [onViewSubmit.cgi]      Edit window, or delete+confirm (del)
                 =&gt; [onSendSubmit.cgi]  Confirmation (sends smtp mail)
                     =&gt; back to root

 =&gt; [onRootSendLink.cgi]                Edit Window
     =&gt; [onSendSubmit.cgi]              Confirmation (sends smtp mail)
         =&gt; back to root</PRE>


<P class="docText">This file simply lists all the source files in the system, using
<TT>=&gt;</TT> and indentation to denote the scripts they
trigger.
</P>

<P class="docText">For instance, links on the <I>pymailcgi.html</I> root
page invoke <I>onRootViewLink.cgi </I>and
<I>onRootSendLink.cgi</I>, both executable scripts. The
script <I>onRootViewLink.cgi</I> generates a password
page, whose Submit button in turn triggers
<I>onViewPswdSubmit.cgi</I>, and so on. Notice that
both the view and send actions can wind up triggering
<I>onSendSubmit.cgi</I> to send a new mail; view
operations get there after the user chooses to reply to or forward an
incoming mail.
</P>

<P class="docText">In a system like this, CGI scripts make little sense in isolation, so
it's a good idea to keep the overall page flow in mind; refer
to this file if you get lost. For additional context, <A class="docLink" HREF="#python2-CHP-13-FIG-1">Figure 13-1</A> shows the overall contents of this site,
viewed on Windows with the PyEdit "Open" function.
</P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="python2-CHP-13-FIG-1"></A>Figure 13-1. PyMailCgi contents</H5>
<IMG BORDER="0" WIDTH="357" HEIGHT="216" src="FILES/ppy2_1301.gif" ALT="figs/ppy2_1301.gif"></CENTER>

<P class="docText">The <I>temp</I> directory was used only during
development. To install this site, all the files you see here are
uploaded to a <I>PyMailCgi</I> subdirectory of my
<I>public_html</I> web directory. Besides the page-flow
HTML and CGI script files invoked by user interaction, PyMailCgi uses
a handful of utility modules as well:
</P>

<UL>
<LI><P class="docList"><I>commonhtml.py</I> is a library of HTML
tools.<A NAME="IXT-13-337604"></A>
</P></LI>
<LI><P class="docList"><I>externs.py</I> isolates access to modules imported
from other systems.
</P></LI>
<LI><P class="docList"><I>loadmail.py</I> encapsulates mailbox
fetches.<A NAME="IXT-13-337605"></A>
</P></LI>
<LI><P class="docList"><I>secret.py</I> implements configurable password
encryption.<A NAME="IXT-13-337606"></A>
<A NAME="IXT-13-337607"></A>
<A NAME="IXT-13-337608"></A>
</P></LI>
</UL>
<P class="docText">PyMailCgi also reuses parts of the <I>pymail.py</I> and
<I>mailconfig.py</I> modules we wrote in <A class="docLink" HREF="0596000855_python2-CHP-11.html#python2-CHP-11">Chapter 11</A>; on my web server, these are installed in a
special directory that is not necessarily the same as their location
in the examples distribution (they show up in another server
directory, not shown in <A class="docLink" HREF="#python2-CHP-13-FIG-1">Figure 13-1</A>). As usual,
PyMailCgi also uses a variety of standard Python library modules:
<TT>smtplib</TT>, <TT>poplib</TT>,
<TT>rfc822</TT>, <TT>cgi</TT>,
<TT>urllib</TT>, <TT>time</TT>,
<TT>rotor</TT>, and the like.<A NAME="IXTR3-340"></A> <A NAME="IXTR3-341"></A>
</P>

<P><A NAME="python2-CHP-13-SIDEBAR-1"></A><TABLE CELLSPACING="0" WIDTH="90%" BORDER="1"><TR><TD>
<H2 class="docSidebarTitle">Carry-on Software</H2>

<P class="docText">PyMailCgi works as planned and illustrates more CGI and email
concepts, but I want to point out a few caveats up front. The
application was initially written during a two-hour layover in
Chicago's O'Hare airport (though debugging took a few
hours more). I wrote it to meet a specific need -- to be able to
read and send email from any web browser while traveling around the
world teaching Python classes. I didn't design it to be
aesthetically pleasing to others and didn't spend much time
focusing on its efficiency.
</P>

<P class="docText">I also kept this example intentionally simple for this book. For
example, PyMailCgi doesn't provide all the features of the
PyMailGui program in <A class="docLink" HREF="0596000855_python2-CHP-11.html#python2-CHP-11">Chapter 11</A>, and reloads email
more than it probably should. In other words, you should consider
this system a work in progress; it's not yet software worth
selling. On the other hand, it does what it was intended to do, and
can be customized by tweaking its Python source code -- something
that can't be said of all software sold.
</P>
</TD></TR></TABLE></P>


<A NAME="python2-CHP-13-SECT-2.2"></A>
<H4 class="docSection2Title">13.2.2 Presentation Overview</H4>

<P class="docText">PyMailCgi is a challenge to present in a book like this, because most
of the "action" is encapsulated in shared utility modules
(especially one called <I>commonhtml.py </I>); the CGI
scripts that implement user interaction don't do much by
themselves. This architecture was chosen deliberately, to make
scripts simple and implement a common look-and-feel. But it means you
must jump between files to understand how the system works.
</P>

<P class="docText">To make this example easier to digest, we're going to explore
its code in two chunks: page scripts first, and then the utility
modules. First, we'll study screen shots of the major web pages
served up by the system and the HTML files and top-level Python CGI
scripts used to generate them. We begin by following a send mail
interaction, and then trace how existing email is processed. Most
implementation details will be presented in these sections, but be
sure to flip ahead to the utility modules listed later to understand
what the scripts are really doing.
</P>

<P class="docText">I should also point out that this is a fairly complex system, and I
won't describe it in exhaustive detail; be sure to read the
source code along the way for details not made explicit in the
narrative. All of the system's source code appears in this
section (and also at <A class="docLink" target="_blank" HREF="http://examples.oreilly.com/python2">http://examples.oreilly.com/python2</A>), and we will study the key
concepts in this system here. But as usual with case studies in this
book, I assume that you can read Python code by now and will consult
the example's source code for more details. Because
Python's syntax is so close to executable pseudocode, systems
are sometimes better described in Python than in English.
</P>



<ul></ul>
</td>
</tr>
</table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#CCCCCC">
<td><font color="black" size=1>I l<font color="#FF0000">@</font>ve RuBoard</td>
<td valign="top" class="v2" align="right">
          <a href="0596000855_python2-CHP-13-SECT-1.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0596000855_python2-CHP-13-SECT-3.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
