<HTML><HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="C.5 Type Objects and Constructors"-->
<LINK REL="stylesheet" href="FILES/sbolM.css">
</HEAD>
<BODY link="#354278" vlink="#000066" alink="#000080" topmargin="0">
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#CCCCCC">
<td><font color="black" size=1>I l<font color="#FF0000">@</font>ve RuBoard</td>
<td valign="top" class="v2" align="right"><a href="pythonwin32_snode212.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a> <a href="pythonwin32_snode214.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></td></table>
<FONT>
<h3>C.5
Type Objects and Constructors</h3>


<p>
<a NAME="idx2245"></a>
<a naME="idx2246"></A>Many databases need to have the input in a
particular format in order to bind to an operation's input
parameters. For example, if an input is destined for a
<Tt claSS="monofont">DATE</TT> column, it must be bound to the database in a
particular string format. Similar problems exist for "Row
ID" columns or large binary items (e.g.,
<tt class="monofont">BLOB</tt>s or <tt class="monofont">RAW</tt> columns). This
presents problems for Python since the parameters to the
<tt cLASS="monofont">executeXXX()</TT> method are untyped. When the database
module sees a Python string object, it doesn't know if it
should be bound as a simple <tT ClASs="monofont">CHAR</Tt> column, as a raw
<TT CLass="monofont">BINARY</tT> item, or as a <TT Class="monofont">DATE</TT>.</P>



<P>To overcome this problem, a module must provide the constructors
defined here to create objects that can hold special values. When
passed to the cursor methods, the module can then detect the proper
type of the input parameter and bind it accordingly.</p>



<p>A <tt CLASs="monofont">cursor</tt> object's description attribute
returns information about each of the result columns of a query. The
<tt class="monofont">type_code</tt> must compare equal to one of
<tt class="monofont">type</tt> objects defined here. <TT CLASs="monofont">Type</TT>
objects may be equal to more than one type code (e.g.,
<tT ClAsS="monofont">DATETIME</TT> could be equal to the type codes for
date, time, and timestamp columns; see the implementation hints later
in this appendix for details).</P>



<p>The module exports the following constructors and singletons:</p>



<dl>
<DT>
<FOnt coLOR="#990000"><Font cOLOR="#990000"><span class="monofont">Date(</span></font>

     
  <tt clASS="monofont"><I>year,month,day</I></Tt><FOnT CoLoR="#990000"><SPAn claSS="monofont">) </SPan></foNT>

     
  </FOnt></dt>
<DD>
<P>This function constructs an object holding a <Tt class="monofont">date</tt>
value.</p>
</dd>
<dt>
<font coloR="#990000"><FONT CoLOr="#990000"><SPaN cLASS="monofont">Time(</span></FONT>

     
  <tt clASS="monofont"><I>hour,minute,second</i></tt><fONT Color="#990000"><span class="monofont">) </span></font>

     
  </FONT></DT>
<dD>
<P>This function constructs an object holding a <tT ClAsS="monofont">time</TT>
value.</P>
</dd>
<dt>
<FONT coloR="#990000"><FONt colOR="#990000"><SPan class="monofont">Timestamp(</span></font>

     
  <tt clasS="monofont"><I>year,month,day,hour,minute,second</I></TT><FoNT cOLoR="#990000"><sPAN Class="monofont">) </SPAN></font>

     
  </FONT></dt>
<dd>
<P>This function constructs an object holding a
<TT Class="monofont">timestamp</tt> value.</p>
</dd>
<dt>
<font color="#990000"><fONT COLoR="#990000"><SpAN cLaSS="monofont">DateFromTicks(</SPan></foNT>

     
  <TT clasS="monofont"><I>ticks</I></Tt><fonT COLor="#990000"><span class="monofont">) </span></font>

     
  </foNT></DT>
<DD>
<p>This function constructs an object holding a <TT cLAsS="monofont">date</tT>
value from the given <TT Class="monofont"><I>ticks</I></TT> value (number
of seconds since the epoch; see the documentation of the standard
Python <tt clASS="monofont">time</Tt> module for details).</p>
</dd>
<DT>
<FOnt color="#990000"><font color="#990000"><span cLASS="monofont">TimeFromTicks(</SPaN></FoNT>

     
  <tT cLASS="monofont"><i>ticks</i></tt><FONT coloR="#990000"><SPAn claSS="monofont">) </SPan></font>

     
  </font></dt>
<dd>
<p>This function constructs an object holding a <tt clasS="monofont">time</TT>
value from the given <TT ClASs="monofont"><I>ticks</I></tT> value (number
of seconds since the epoch; see the documentation of the standard
Python <tT CLAss="monofont">time</tt> module for details).</P>
</DD>
<Dt>
<fonT COLor="#990000"><foNT COlor="#990000"><span class="monofont">TimestampFromTicks(</span></font>

     
  <tT CLASS="monofont"><i>ticks</I></Tt><FOnT cOLOR="#990000"><span CLASs="monofont">) </spaN></FONt>

     
  </fonT></DT>
<Dd>
<p>This function constructs an object holding a
<tt class="monofont">timestamp</tt> value from the given
<tt class="monofont"><i>ticks</i></tT> value (number of seconds since the
epoch; see the documentation of the standard Python
<TT CLAsS="monofont">time</Tt> module for details).</P>
</Dd>
<Dt>
<FONT coloR="#990000"><FONt colOR="#990000"><SPan clASS="monofont">Binary(</Span></font>

     
  <tt class="monofont"><i>string</i></tt><fonT COLOR="#990000"><sPAn CLaSs="monofont">) </SPAN></font>

     
  </FONT></dt>
<dd>
<P>This function constructs an object capable of holding a binary
(<TT Class="monofont">long</TT>) string value.</P>
</Dd>
<dt>
<font color="#990000"><font color="#990000"><SPAN CLaSS="monofont">STRING</sPAn></FoNT>
</FOnt></dt>
<DD>
<P>This <Tt claSS="monofont">type</TT> object describes columns in a database
that are string-based (e.g., <tt clASS="monofont">CHAR</Tt>).</p>
</dd>
<dt>
<font color="#990000"><font coLOR="#990000"><SPAn CLaSS="monofont">BINARY</sPaN></FONt>
</fonT></DT>
<Dd>
<p>This <tt CLASs="monofont">type</tt> object describes
(<tT CLAss="monofont">long</tt>) binary columns in a database (e.g.,
<tt class="monofont">LONG</tt>, <tt class="monofont">RAW</tT>,
<TT CLAsS="monofont">BLOB</Tt>s).</P>
</Dd>
<Dt>
<FONT coloR="#990000"><FONt colOR="#990000"><SPan clASS="monofont">NUMBER</Span></font>
 </font></dt>
<dd>
<p>This <tt claSS="monofont">type</TT> object describes numeric columns in a
database.</P>
</Dd>
<DT>
<fONt CoLOR="#990000"><Font cOLOR="#990000"><span CLASs="monofont">DATETIME</spaN></FONt>
 </font></dt>
<dd>
<p>This <tt class="monofont">type</tt> object describes date/time columns in a
database.</p>
</dD>
<DT>
<FONt COlOR="#990000"><fOnT COLor="#990000"><spAN CLass="monofont">ROWID</sPAN></Font>
 </fONT></Dt>
<dd>
<p>This <tt class="monofont">type</tt> object describes the "Row
ID" column in a database.</p>
</dd>
</dl>


<p>SQL <tt CLASS="monofont">NULL</Tt> values are represented by the Python
<TT cLAsS="monofont">None</tT> singleton on input and output.</P>



<P>Using Unix ticks for database interfacing can cause troubles because
of the limited date range they cover.</P>




<h4>C.5.1
Implementation Hints</h4>


<p>The preferred object types for the date/time objects are those
defined in the <tT CLAss="monofont">mxDateTime</tt> package. It provides all
necessary constructors and methods both at Python and C level.</P>



<P>The preferred object type for <TT clasS="monofont">binary</TT> objects are
the buffer types available in standard Python starting with Version
1.5.2. Please see the Python documentation for details. For
information about the C interface have a look at
<I>Include/bufferobject.h</i> and
<i>Objects/bufferobject.c</i> in the Python source
distribution.</p>



<p>Here is a sample implementation of the Unix ticks based constructors
for date/time delegating work to the generic constructors:</p>



<pre class="monofont">import time
def DateFromTicks(ticks):
    return apply(Date,time.localtime(ticks)[:3])
def TimeFromTicks(ticks):
    return apply(Time,time.localtime(ticks)[3:6])
def TimestampFromTicks(ticks):
    return apply(Timestamp,time.localtime(ticks)[:6])</pre>


<p>This Python class allows implementing the above
<tt cLASS="monofont">type</TT> objects even though the description type code
field yields multiple values for on <tT ClASs="monofont">type</Tt> object:</P>



<PRE clasS="monofont">class DBAPITypeObject:
    def __init__(self,*values):
    self.values = values
    def __cmp__(self,other):
    if other in self.values:
        return 0
    if other &lt; self.values:
        return 1
    else:
        return -1</PRE>


<p>The resulting <tt cLASS="monofont">type</tt> object compares equal to all
values passed to the constructor.</p>



<p>Here is a snippet of Python code that implements the exception
hierarchy defined previously:</P>



<PRE class="monofont">import exceptions

class Error(exceptions.StandardError):
    pass

class Warning(exceptions.StandardError):
    pass

class InterfaceError(Error):
    pass

class DatabaseError(Error):
    pass

class InternalError(DatabaseError):
    pass

class OperationalError(DatabaseError):
    pass

class ProgrammingError(DatabaseError):
    pass

class IntegrityError(DatabaseError):
    pass

class DataError(DatabaseError):
    pass

class NotSupportedError(DatabaseError):
    pass</pre>


<p>In C you can use the
<tt class="monofont">PyErr_NewException(</tt><tt cLASS="monofont"><I>fullname</I></tT>,
<Tt CLaSs="monofont"><I>base</I></TT>,
<tt clASS="monofont"><I>NULL</i></tt><tT CLAss="monofont">)</tt> API to create the
exception objects.<A NAMe="idx2247"></a> <a name="idx2248"></a></p>


</font>
 
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#CCCCCC">
<td><font color="black" size=1>I l<font color="#FF0000">@</font>ve RuBoard</td>
<td valign="top" class="v2" align="right"><a href="pythonwin32_snode212.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a> <a href="pythonwin32_snode214.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a></td></table>
</BODY></HTML>