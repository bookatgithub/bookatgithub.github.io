<html><head>
<META http-equiv="Content-Type" content="text/html">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="11.4 The Python Database API (DBAPI) 2.0"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0596001886_pythonian-chp-11-sect-3.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0596001886_pythonian-chp-12.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><A NAME="pythonian-CHP-11-SECT-4"></A>
<H3 class="docSection1Title">11.4 The Python Database API (DBAPI) 2.0</H3>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6191"></A>As I mentioned earlier,
the Python standard library does not come with an RDBMS interface,
but there are many free third-party modules that let your Python
programs access specific databases. Such modules mostly follow the
Python Database API 2.0 standard, also known as the DBAPI.</P>

<P class="docText">At the time of this writing, Python's DBAPI Special
Interest Group (SIG) was busy preparing a new version of the DBAPI
(possibly to be known as 3.0 when it is ready). Programs written
against DBAPI 2.0 should work with minimal or no changes with the
future DBAPI 3.0, although 3.0 will no doubt offer further
enhancements that future programs will be able to take advantage
of.<A NAME="pythonian-CHP-11-ITERM-6192"></A></P>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6193"></A>
<A NAME="pythonian-CHP-11-ITERM-6194"></A>If your Python program runs only
on Windows, you may prefer to access databases by using
Microsoft's <TT>ADO</TT> package through
<TT>COM</TT>. For more information on using Python on
Windows, see the book <span class="docEmphasis">Python Programming on Win32</span>, by Mark Hammond and Andy Robinson
(O'Reilly). Since ADO and COM are platform-specific,
and this book focuses on cross-platform use of Python, I do not cover
ADO nor COM further in this book.</P>

<P class="docText">After importing a DBAPI-compliant module, you call the
module's <TT>connect</TT> function with
suitable parameters. <TT>connect</TT> returns an instance
of class <TT>Connection</TT>, which represents a connection
to the database. This instance supplies <TT>commit</TT> and
<TT>rollback</TT> methods to let you deal with
transactions, a <TT>close</TT> method to call as soon as
you're done with the database, and a
<TT>cursor</TT> method that returns an instance of class
<TT>Cursor</TT>. This instance supplies the methods and
attributes that you'll use for all database
operations. A DBAPI-compliant module also supplies exception classes,
<TT>descriptive</TT> attributes, factory functions, and
type-description attributes.</P>

<A NAME="pythonian-CHP-11-SECT-4.1"></A>
<H4 class="docSection2Title">11.4.1 Exception Classes</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6195"></A>A
DBAPI-compliant module supplies exception classes
<TT>Warning</TT>, <TT>Error</TT>, and several
subclasses of <TT>Error</TT>. <TT>Warning</TT>
indicates such anomalies as data truncation during insertion.
<TT>Error</TT>'s subclasses indicate
various kinds of errors that your program can encounter when dealing
with the database and the DBAPI-compliant module that interfaces to
it. Generally, your code uses a statement of the form:</P>

<PRE>try: 
    ...
except <TT><I>module</I></TT>.Error, <TT><I>err</I></TT>: 
    ...</PRE>

<P class="docText">in order to trap all database-related errors that you need to handle
without terminating.</P>


<A NAME="pythonian-CHP-11-SECT-4.2"></A>
<H4 class="docSection2Title">11.4.2 Thread Safety</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6196"></A>When a DBAPI-compliant module has an
attribute <TT>threadsafety</TT> that is greater than
<TT>0</TT>, the module is asserting some specific level of
thread safety for database interfacing. Rather than relying on this,
it's safer and more portable to ensure that a single
thread has exclusive access to any given external resource, such as a
database, as outlined in <A class="docLink" HREF="0596001886_pythonian-chp-14.html#pythonian-CHP-14">Chapter 14</A>.</P>


<A NAME="pythonian-CHP-11-SECT-4.3"></A>
<H4 class="docSection2Title">11.4.3 Parameter Style</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6197"></A>A DBAPI-compliant module has an
attribute <TT>paramstyle</TT> that identifies the style of
markers to use as placeholders for parameters. You insert such
markers in SQL statement strings that you pass to methods of
<TT>Cursor</TT> instances, such as method
<TT>execute</TT>, in order to use runtime-determined
parameter values. Say, for example, that you need to fetch the rows
of database table <TT><I>ATABLE</I></TT> where field
<TT><I>AFIELD</I></TT> equals the current value of Python
variable <TT><I>x</I></TT>. Assuming the cursor instance
is named <TT><I>c</I></TT>, you could perform this task by
using Python's string formatting operator
<TT>%</TT> as follows:</P>

<PRE><TT><I>c</I></TT>.execute('SELECT * FROM ATABLE WHERE AFIELD=%r' % <TT><I>x</I></TT>)</PRE>

<P class="docText">However, this is not the recommended approach. This approach
generates a different statement string for each value of
<TT><I>x</I></TT>, requiring such statements to be parsed
and prepared anew each time. With parameter substitution, you pass to
<TT>execute</TT> a single statement string, with a
placeholder instead of the parameter value. This lets
<TT>execute</TT> perform parsing and preparation just once,
giving potentially better performance. For example, if a
module's <TT>paramstyle</TT> attribute is
'<TT>qmark</TT>', you can express the above query as:</P>

<PRE><TT><I>c</I></TT>.execute('SELECT * FROM ATABLE WHERE AFIELD=?', [<TT><I>x</I></TT>])</PRE>

<P class="docText">The read-only attribute <TT>paramstyle</TT> is meant to
inform your program about the way to use parameter substitution with
that module. The possible values of <TT>paramstyle</TT>
are:</P>

<DL class="docList">
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">format</span></span></span></DT>
<DD>
<P class="docList">The marker is <TT>%s</TT>, as in string formatting. A query
looks like:</P>

<PRE><TT><I>c</I></TT>.execute('SELECT * FROM ATABLE WHERE AFIELD=%s', [<TT><I>x</I></TT>])</PRE>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">named</span></span></span></DT>
<DD>
<P class="docList">The marker is :<TT><I>name</I></TT> and
parameters are named. A query look like:</P>


<PRE><TT><I>c</I></TT>.execute('SELECT * FROM ATABLE WHERE AFIELD=:x', {'x':<TT><I>x</I></TT>})</PRE>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">numeric</span></span></span></DT>
<DD>
<P class="docList">The marker is :<TT><I>n</I></TT>,
giving the parameter's number. A query looks like:</P>


<PRE><TT><I>c</I></TT>.execute('SELECT * FROM ATABLE WHERE AFIELD=:1', [<TT><I>x</I></TT>])</PRE>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">pyformat</span></span></span></DT>
<DD>
<P class="docList">The marker is
<TT>%(</TT><TT><I>name</I></TT><TT>)s</TT>
and parameters are named. A query looks like:</P>


<PRE><TT><I>c</I></TT>.execute('SELECT * FROM ATABLE WHERE AFIELD=%(x)s', {'x':<TT><I>x</I></TT>})</PRE>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">qmark</span></span></span></DT>
<DD>
<P class="docList">The marker is <TT>?</TT>. A query looks like:</P>


<PRE><TT><I>c</I></TT>.execute('SELECT * FROM ATABLE WHERE AFIELD=?', [<TT><I>x</I></TT>])</PRE>
</DD>
</DL>

<P class="docText">When <TT>paramstyle</TT> does not imply named parameters,
the second argument of method <TT>execute</TT> is a
sequence. When parameters are named, the second argument of method
<TT>execute</TT> is a dictionary.</P>


<A NAME="pythonian-CHP-11-SECT-4.4"></A>
<H4 class="docSection2Title">11.4.4 Factory Functions</H4>

<P class="docText">Parameters passed to the database via placeholders must typically be
of the right type. This means Python numbers (integers or
floating-point values), strings (plain or Unicode), and
<TT>None</TT> to represent SQL <TT>NULL</TT>.
Python has no specific types to represent dates, times, and binary
large objects (BLOBs). A DBAPI-compliant module supplies factory
functions to build such objects. The types used for this purpose by
most DBAPI-compliant modules are those supplied by module
<TT>mxDateTime</TT>, covered in <A class="docLink" HREF="0596001886_pythonian-chp-12.html#pythonian-CHP-12">Chapter 12</A>, and strings or buffer types for BLOBs. The
factory functions are as follows.<A NAME="pythonian-CHP-11-ITERM-6198"></A></P>

<A NAME="ch11-77043"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>Binary</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>Binary(<TT><I>string</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an object representing the given
<TT><I>string</I></TT> of bytes as a BLOB.</P>

<A NAME="ch11-77044"></A><A NAME="pythonian-CHP-11-ITERM-6199"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>Date</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>Date(<TT><I>year</I></TT>,<TT><I>month</I></TT>,<TT><I>day</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an object representing the specified date.</P>

<A NAME="ch11-77045"></A><A NAME="pythonian-CHP-11-ITERM-6200"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>DateFromTicks</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>DateFromTicks(<TT><I>s</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an object representing the date that is
<TT><I>s</I></TT> seconds after the epoch of module
<TT>time</TT>, covered in <A class="docLink" HREF="0596001886_pythonian-chp-12.html#pythonian-CHP-12">Chapter 12</A>. For
example, <TT>DateFromTicks(time.time( ))</TT> is
today's date.</P>

<A NAME="ch11-77046"></A><A NAME="pythonian-CHP-11-ITERM-6201"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>Time</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>Time(<TT><I>hour</I></TT>,<TT><I>minute</I></TT>,<TT><I>second</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an object representing the specified time.</P>

<A NAME="ch11-77047"></A><A NAME="pythonian-CHP-11-ITERM-6202"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>TimeFromTicks</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>TimeFromTicks(<TT><I>s</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an object representing the time that is
<TT><I>s</I></TT> seconds after the epoch of module
<TT>time</TT>, covered in <A class="docLink" HREF="0596001886_pythonian-chp-12.html#pythonian-CHP-12">Chapter 12</A>. For
example, <TT>TimeFromTicks(time.time( ))</TT> is the
current time.</P>

<A NAME="ch11-77048"></A><A NAME="pythonian-CHP-11-ITERM-6203"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>Timestamp</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>Timestamp(<TT><I>year</I></TT>,<TT><I>month</I></TT>,<TT><I>day</I></TT>,<TT><I>hour</I></TT>,<TT><I>minute</I></TT>,<TT><I>second</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an object representing the specified date and time.</P>

<A NAME="ch11-77049"></A><A NAME="pythonian-CHP-11-ITERM-6204"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>TimestampFromTicks</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>TimestampFromTicks(<TT><I>s</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an object representing the date and time that is
<TT><I>s</I></TT> seconds after the epoch of module
<TT>time</TT>, covered in <A class="docLink" HREF="0596001886_pythonian-chp-12.html#pythonian-CHP-12">Chapter 12</A>. For
example, <TT>TimestampFromTicks(time.time( ))</TT> is the
current date and time.</P>


<A NAME="pythonian-CHP-11-SECT-4.5"></A>
<H4 class="docSection2Title">11.4.5 Type Description Attributes</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6205"></A>
<A NAME="pythonian-CHP-11-ITERM-6206"></A>A <TT>Cursor</TT>
instance's attribute <TT>description</TT>
describes the types and other characteristics of each column of a
query. Each column's type (the second item of the
tuple describing the column) equals one of the following attributes
of the DBAPI-compliant module:</P>

<DL class="docList">
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">BINARY</span></span></span></DT>
<DD>
<P class="docList">Describes columns containing BLOBs</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">DATETIME</span></span></span></DT>
<DD>
<P class="docList">Describes columns containing dates, times, or both</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">NUMBER</span></span></span></DT>
<DD>
<P class="docList">Describes columns containing numbers of any kind</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">ROWID</span></span></span></DT>
<DD>
<P class="docList">Describes columns containing a row-identification number</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">STRING</span></span></span></DT>
<DD>
<P class="docList">Describes columns containing text of any kind</P>
</DD>
</DL>

<P class="docText">A cursor's description, and in particular each
column's type, is mostly useful for introspection
about the database your program is working with. Such introspection
can help you write general modules that are able to work with
databases that have different schemas, schemas that may not be fully
known at the time you are writing your code.</P>


<A NAME="pythonian-CHP-11-SECT-4.6"></A>
<H4 class="docSection2Title">11.4.6 The connect Function</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6207"></A>
<A NAME="pythonian-CHP-11-ITERM-6208"></A>A DBAPI-compliant
module's <TT>connect</TT> function accepts
arguments that vary depending on the kind of database and the
specific module involved. The DBAPI standard recommends, but does not
mandate, that <TT>connect</TT> accept named arguments. In
particular, <TT>connect</TT> should at least accept
optional arguments with the following names:</P>

<DL class="docList">
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">database</span></span></span></DT>
<DD>
<P class="docList">Name of the specific database to connect</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">dsn</span></span></span></DT>
<DD>
<P class="docList">Data-source name to use for the connection</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">host</span></span></span></DT>
<DD>
<P class="docList">Hostname on which the database is running</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">password</span></span></span></DT>
<DD>
<P class="docList">Password to use for the connection</P>
</DD>
<DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">user</span></span></span></DT>
<DD>
<P class="docList">Username for the connection</P>
</DD>
</DL>


<A NAME="pythonian-CHP-11-SECT-4.7"></A>
<H4 class="docSection2Title">11.4.7 Connection Objects</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6209"></A>A
DBAPI-compliant module's <TT>connect</TT>
function returns an object <TT><I>x</I></TT> that is an
instance of class <TT>Connection</TT>.
<TT><I>x</I></TT> supplies the following methods.</P>

<A NAME="ch11-77053"></A><A NAME="pythonian-CHP-11-ITERM-6210"></A><A NAME="pythonian-CHP-11-ITERM-6211"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>close</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>x</I></TT>.close(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Terminates the database connection and releases all related
resources. Call <TT>close</TT> as soon as
you're done with the database, since keeping
database connections uselessly open can be a serious resource drain
on the system.</P>

<A NAME="ch11-77054"></A><A NAME="pythonian-CHP-11-ITERM-6212"></A><A NAME="pythonian-CHP-11-ITERM-6213"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>commit</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>x</I></TT>
.commit(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Commits the current transaction in the database. If the database does
not support transactions,
<TT><I>x</I></TT><TT>.commit( )</TT> is an
innocuous no-op.</P>

<A NAME="ch11-77055"></A><A NAME="pythonian-CHP-11-ITERM-6214"></A><A NAME="pythonian-CHP-11-ITERM-6215"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>cursor</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>x</I></TT>.close(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns a new instance of class <TT>Cursor</TT>, covered
later in this section.</P>

<A NAME="ch11-77056"></A><A NAME="pythonian-CHP-11-ITERM-6216"></A><A NAME="pythonian-CHP-11-ITERM-6217"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>rollback</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>x</I></TT>.rollback(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6216"></A> <A NAME="pythonian-CHP-11-ITERM-6217"></A>Rolls back the current transaction in
the database. If the database does not support transactions,
<TT><I>x</I></TT><TT>.rollback( )</TT> raises an
exception. The DBAPI recommends, but does not mandate, that for
databases that do not support transactions class
<TT>Connection</TT> supplies no <TT>rollback</TT>
method, so that <TT><I>x</I></TT><TT>.rollback(
)</TT> raises <TT>AttributeError</TT>. You can test
whether transaction support is present with
<TT>hasattr(</TT><TT><I>x</I></TT><TT>,'rollback')</TT>.</P>


<A NAME="pythonian-CHP-11-SECT-4.8"></A>
<H4 class="docSection2Title">11.4.8 Cursor Objects</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6218"></A>
<A NAME="pythonian-CHP-11-ITERM-6219"></A>A
<TT>Connection</TT> instance provides a
<TT>cursor</TT> method that returns an object
<TT><I>c</I></TT> that is an instance of class
<TT>Cursor</TT>. A SQL cursor represents the set of results
of a query and lets you work with the records in that set, in
sequence, one at a time. A cursor as modeled by the DBAPI is a richer
concept, since it also represents the only way in which your program
executes SQL queries in the first place. On the other hand, a DBAPI
cursor allows you only to advance in the sequence of results (some
relational databases, but not all, also provide richer cursors that
are able to go backward as well as forward), and does not support the
SQL clause <TT>WHERE</TT> <TT>CURRENT</TT>
<TT>OF</TT> <TT>CURSOR</TT>. These limitations of
DBAPI cursors enable DBAPI-compliant modules to provide cursors even
on RDBMSes that provide no real SQL cursors at all. An instance of
class <TT>Cursor</TT> <TT><I>c</I></TT> supplies
many attributes and methods; the most frequently used ones are
documented here.</P>

<A NAME="ch11-77058"></A><A NAME="pythonian-CHP-11-ITERM-6220"></A><A NAME="pythonian-CHP-11-ITERM-6221"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>close</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>c</I></TT>.close(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Closes the cursor and releases all related resources.</P>

<A NAME="ch11-77059"></A><A NAME="pythonian-CHP-11-ITERM-6222"></A><A NAME="pythonian-CHP-11-ITERM-6223"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>description
</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left"></td>
<td align="right"></td>
</tr>
</table>
<P class="docText">A read-only attribute that is a sequence of seven-item tuples, one
per column in the last query executed:</P>
<PRE><TT><I>name</I></TT>, <TT><I>typecode</I></TT>, <TT><I>displaysize</I></TT>, <TT><I>internalsize</I></TT>, <TT><I>precision</I></TT>, <TT><I>scale</I></TT>, <TT><I>nullable</I></TT></PRE><P class="docText"><TT><I>c</I></TT><TT>.description</TT> is
<TT>None</TT> if the last operation on
<TT><I>c</I></TT> was not a query or returned no usable
description of the columns involved. A cursor's
description is mostly useful for introspection about the database
your program is working with. Such introspection can help you write
general modules that are able to work with databases that have
different schemas, including schemas that may not be fully known at
the time you are writing your code.</P>

<A NAME="ch11-77060"></A><A NAME="pythonian-CHP-11-ITERM-6224"></A><A NAME="pythonian-CHP-11-ITERM-6225"></A><A NAME="pythonian-CHP-11-ITERM-6226"></A><A NAME="pythonian-CHP-11-ITERM-6227"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>execute


</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>c</I></TT>.execute(<TT><I>statement</I></TT>,<TT><I>parameters</I></TT>=None)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Executes a SQL <TT><I>statement</I></TT> on the database
with the given <TT><I>parameters</I></TT>.
<TT><I>parameters</I></TT> is a sequence when the
module's <TT>paramstyle</TT> is
'<TT>format</TT>', '<TT>numeric</TT>', or
'<TT>qmark</TT>', and a dictionary when
'<TT>named</TT>' or '<TT>pyformat</TT>'.</P>

<A NAME="ch11-77061"></A><A NAME="pythonian-CHP-11-ITERM-6228"></A><A NAME="pythonian-CHP-11-ITERM-6229"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>executemany</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>c</I></TT>.executemany(<TT><I>statement</I></TT>,*<TT><I>parameters</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6228"></A> <A NAME="pythonian-CHP-11-ITERM-6229"></A>Executes a SQL
<TT><I>statement</I></TT> on the database, once for each
item of the given <TT><I>parameters</I></TT>.
<TT><I>parameters</I></TT> is a sequence of sequences when
the module's <TT>paramstyle</TT> is
'<TT>format</TT>', '<TT>numeric</TT>', or
'<TT>qmark</TT>', and a sequence of dictionaries when
'<TT>named</TT>' or '<TT>pyformat</TT>'. For
example, the statement:</P>
<PRE>c.executemany('UPDATE atable SET x=? WHERE y=?',
                     (12,23),(23,34))</PRE><P class="docText">that uses a module whose <TT>paramstyle</TT> is
'<TT>qmark</TT>' is equivalent to, but probably faster
than, the two statements:</P>
<PRE>c.execute('UPDATE atable SET x=12 WHERE y=23')
c.execute('UPDATE atable SET x=23 WHERE y=34')</PRE>

<A NAME="ch11-77062"></A><A NAME="pythonian-CHP-11-ITERM-6230"></A><A NAME="pythonian-CHP-11-ITERM-6231"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>fetchall</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>c</I></TT>.fetchall(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6230"></A> <A NAME="pythonian-CHP-11-ITERM-6231"></A>Returns all remaining result rows from
the last query as a sequence of tuples. Raises an exception if the
last operation was not a <TT>SELECT</TT> query.</P>

<A NAME="ch11-77063"></A><A NAME="pythonian-CHP-11-ITERM-6232"></A><A NAME="pythonian-CHP-11-ITERM-6233"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>fetchmany</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>c</I></TT>.fetchmany(<TT><I>n</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6232"></A> <A NAME="pythonian-CHP-11-ITERM-6233"></A>Returns up to
<TT><I>n</I></TT> remaining result rows from the last
query as a sequence of tuples. Raises an exception if the last
operation was not a <TT>SELECT</TT> query.</P>

<A NAME="ch11-77064"></A><A NAME="pythonian-CHP-11-ITERM-6234"></A><A NAME="pythonian-CHP-11-ITERM-6235"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>fetchone</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>c</I></TT>.fetchone(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns the next result row from the last query as a tuple. Raises an
exception if the last operation was not a <TT>SELECT</TT>
query.</P>

<A NAME="ch11-77065"></A><A NAME="pythonian-CHP-11-ITERM-6236"></A><A NAME="pythonian-CHP-11-ITERM-6237"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>rowcount</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left"></td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6236"></A> <A NAME="pythonian-CHP-11-ITERM-6237"></A>A read-only attribute that specifies
the number of rows fetched or affected by the last operation, or
<TT>-1</TT> if the module is unable to determine this
value.</P>


<A NAME="pythonian-CHP-11-SECT-4.9"></A>
<H4 class="docSection2Title">11.4.9 DBAPI-Compliant Modules</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6238"></A>
<A NAME="pythonian-CHP-11-ITERM-6239"></A>Whatever
relational database you want to use, there's at
least one (and often more than one) DBAPI-compliant module that you
can download from the Internet. All modules listed in the following
sections, except <TT>mxODBC</TT>, have liberal licenses
that are mostly similar to Python's license (the SAP
DB, however, is licensed under GPL) and that let you use them freely
in either open source or closed source programs.
<TT>mxODBC</TT> can be used freely for noncommercial
purposes, but you must purchase a license for any commercial use.
There are so many relational databases that it's
impossible to list them all, but here are some of the most popular
ones:<A NAME="pythonian-CHP-11-ITERM-6240"></A></P>

<A NAME="pythonian-CHP-11-ITERM-6241"></A><A NAME="pythonian-CHP-11-ITERM-6242"></A><A NAME="pythonian-CHP-11-ITERM-6243"></A><A NAME="pythonian-CHP-11-ITERM-6244"></A><A NAME="pythonian-CHP-11-ITERM-6245"></A><A NAME="pythonian-CHP-11-ITERM-6246"></A><A NAME="pythonian-CHP-11-ITERM-6247"></A><A NAME="pythonian-CHP-11-ITERM-6248"></A><A NAME="pythonian-CHP-11-ITERM-6249"></A><A NAME="pythonian-CHP-11-ITERM-6250"></A><A NAME="pythonian-CHP-11-ITERM-6251"></A><A NAME="pythonian-CHP-11-ITERM-6252"></A><A NAME="pythonian-CHP-11-ITERM-6253"></A><A NAME="pythonian-CHP-11-ITERM-6254"></A><A NAME="pythonian-CHP-11-ITERM-6255"></A><A NAME="pythonian-CHP-11-ITERM-6256"></A><A NAME="pythonian-CHP-11-ITERM-6257"></A><A NAME="pythonian-CHP-11-ITERM-6258"></A><DL class="docList">
<DT><I><span class="docPubcolor">ODBC</span></I></DT>
<DD>
<P class="docList"><A NAME="pythonian-CHP-11-ITERM-6241"></A> <A NAME="pythonian-CHP-11-ITERM-6242"></A> <A NAME="pythonian-CHP-11-ITERM-6243"></A> <A NAME="pythonian-CHP-11-ITERM-6244"></A> <A NAME="pythonian-CHP-11-ITERM-6245"></A> <A NAME="pythonian-CHP-11-ITERM-6246"></A>Open DataBase Connectivity (ODBC) is a
popular standard that lets you connect to many different relational
databases, including ones not otherwise supported by DBAPI-compliant
modules, such as Microsoft Jet (also known as the Access database).
The Windows distribution of Python contains an
<TT>odbc</TT> module, but the module is unsupported and
complies to an older version of the DBAPI, not to the current version
2.0. On either Unix or Windows, use <TT>mxODBC</TT>,
available at <A class="docLink" target="_blank" HREF="http://www.lemburg.com/files/Python/mxODBC.html">http://www.lemburg.com/files/Python/mxODBC.html</A>.
<TT>mxODBC</TT>'s
<TT>paramstyle</TT> is '<TT>qmark</TT>'. Its
<TT>connect</TT> function accepts three optional arguments,
named <TT><I>dsn</I></TT>,
<TT><I>user</I></TT>, and
<TT><I>password</I></TT>.</P>
</DD>
<DT><I><span class="docPubcolor">Oracle</span></I></DT>
<DD>
<P class="docList"><A NAME="pythonian-CHP-11-ITERM-6247"></A>
<A NAME="pythonian-CHP-11-ITERM-6248"></A>Oracle is a
widespread, commercial RDBMS. To interface to Oracle, I recommend
module <TT>DCOracle2</TT>, available at <A class="docLink" target="_blank" HREF="http://www.zope.org/Members/matt/dco2">http://www.zope.org/Members/matt/dco2</A>.
<TT>DCOracle2</TT>'s
<TT>paramstyle</TT> is '<TT>numeric</TT>'. Its
<TT>connect</TT> function accepts a single optional,
unnamed argument string with the syntax:</P>


<PRE>'user/password@service'</PRE>
</DD>
<DT><I><span class="docPubcolor">Microsoft SQL Server</span></I></DT>
<DD>
<P class="docList"><A NAME="pythonian-CHP-11-ITERM-6249"></A>
<A NAME="pythonian-CHP-11-ITERM-6250"></A>To interface
to Microsoft SQL Server, I recommend module
<TT>mssqldb</TT>, available at <A class="docLink" target="_blank" HREF="http://www.object-craft.com.au/projects/mssql/default.htm">http://www.object-craft.com.au/projects/mssql/</A>.
<TT>mssqldb</TT>'s
<TT>paramstyle</TT> is '<TT>qmark</TT>'. Its
<TT>connect</TT> function accepts three arguments, named
<TT><I>dsn</I></TT>, <TT><I>user</I></TT>, and
<TT><I>passwd</I></TT>, as well as an optional
<TT><I>database</I></TT> argument.</P>
</DD>
<DT><I><span class="docPubcolor">DB2</span></I></DT>
<DD>
<P class="docList"><A NAME="pythonian-CHP-11-ITERM-6251"></A>
<A NAME="pythonian-CHP-11-ITERM-6252"></A>For IBM DB/2, try
module <TT>DB2</TT>, available at ftp://people.linuxkorea.co.kr/pub/DB2/.
<TT>DB2</TT>'s
<TT>paramstyle</TT> is '<TT>format</TT>'. Its
<TT>connect</TT> function accepts three optional arguments,
named <TT><I>dsn</I></TT>, <TT><I>uid</I></TT>,
and <TT><I>pwd</I></TT>.</P>
</DD>
<DT><I><span class="docPubcolor">MySQL</span></I></DT>
<DD>
<P class="docList"><A NAME="pythonian-CHP-11-ITERM-6253"></A>
<A NAME="pythonian-CHP-11-ITERM-6254"></A>MySQL is a
widespread, open source RDBMS. To interface to MySQL, try
<TT>MySQLdb</TT>, available at <A class="docLink" target="_blank" HREF="http://sourceforge.net/projects/mysql-python">http://sourceforge.net/projects/mysql-python</A>.
<TT>MySQLdb</TT>'s
<TT>paramstyle</TT> is '<TT>format</TT>'. Its
<TT>connect</TT> function accepts four optional arguments,
named <TT><I>db</I></TT>, <TT><I>host</I></TT>,
<TT><I>user</I></TT>, and
<TT><I>passwd</I></TT>.</P>
</DD>
<DT><I><span class="docPubcolor">PostgreSQL</span></I></DT>
<DD>
<P class="docList"><A NAME="pythonian-CHP-11-ITERM-6255"></A>
<A NAME="pythonian-CHP-11-ITERM-6256"></A>PostgreSQL is
an excellent open source RDBMS. To interface to PostgreSQL, I
recommend <TT>psycopg</TT>, available at <A class="docLink" target="_blank" HREF="http://initd.org/Software/psycopg">http://initd.org/Software/psycopg</A>.
<TT>psycopg</TT>'s
<TT>paramstyle</TT> is '<TT>pyformat</TT>'. Its
<TT>connect</TT> function accepts a single mandatory
argument, named <TT><I>dsn</I></TT>, with the syntax:</P>


<PRE>'host=host dbname=dbname user=username password=password'</PRE>
</DD>
<DT><I><span class="docPubcolor">SAP DB</span></I></DT>
<DD>
<P class="docList"><A NAME="pythonian-CHP-11-ITERM-6257"></A>
<A NAME="pythonian-CHP-11-ITERM-6258"></A>SAP DB, once
known as Adabas, is a powerful RDBMS that used to be closed source,
but is now open source. SAP DB comes with
<TT>sapdbapi</TT>, available at <A class="docLink" target="_blank" HREF="http://www.sapdb.org/sapdbapi.html">http://www.sapdb.org/sapdbapi.html</A>, as well
as other useful Python modules.
<TT>sapdbapi</TT>'s
<TT>paramstyle</TT> is '<TT>pyformat</TT>'. Its
<TT>connect</TT> function accepts three mandatory
arguments, named <TT><I>user</I></TT>,
<TT><I>password</I></TT>, and
<TT><I>database</I></TT>, and an optional argument named
<TT><I>host</I></TT>.</P>
</DD>
</DL>


<A NAME="pythonian-CHP-11-SECT-4.10"></A>
<H4 class="docSection2Title">11.4.10 Gadfly</H4>

<P class="docText"><A NAME="pythonian-CHP-11-ITERM-6259"></A>
<A NAME="pythonian-CHP-11-ITERM-6260"></A>
<A NAME="pythonian-CHP-11-ITERM-6261"></A>Gadfly,
available at <A class="docLink" target="_blank" HREF="http://gadfly.sf.net/default.htm">http://gadfly.sf.net</A>, is not an interface to
some other RDBMS, but rather a complete RDBMS engine written in
Python. Gadfly supports a large subset of standard SQL. For example,
Gadfly lacks <TT>NULL</TT>, but it does support
<TT>VIEW</TT>, which is a crucial SQL feature that engines
such as MySQL still lack at the time of this writing. Gadfly can run
as a daemon server, to which clients connect with TCP/IP.
Alternatively, you can run the Gadfly engine directly in your
application's process, if you don't
need other processes to be able to access the same database
concurrently.</P>

<P class="docText">The <TT>gadfly</TT> module has several discrepancies from
the DBAPI 2.0 covered in this chapter because Gadfly implements a
variant of the older DBAPI 1.0. The concepts are quite close, but
several details differ. The main differences are:</P>

<UL>
<LI><P class="docList"><TT>gadfly</TT> does not supply custom exception classes,
so Gadfly operations that fail raise normal Python exceptions, such
as <TT>IOError</TT>, <TT>NameError</TT>, etc.</P></LI>
<LI><P class="docList"><TT>gadfly</TT> does not supply a
<TT>paramstyle</TT> attribute. However, the module behaves
as if it supplied a <TT>paramstyle</TT> of
'<TT>qmark</TT>'.</P></LI>
<LI><P class="docList"><TT>gadfly</TT> does not supply a function named
<TT>connect</TT>; use the <TT>gadfly.gadfly</TT>
or <TT>gadfly.client.gfclient</TT> functions instead.</P></LI>
<LI><P class="docList"><TT>gadfly</TT> does not supply factory functions for data
types.</P></LI>
<LI><P class="docList">Gadfly cursors do not supply the <TT>executemany</TT>
method. Instead, in the specific case in which the SQL statement is
an <TT>INSERT</TT>, the <TT>execute</TT> method
optionally accepts as its second argument a list of tuples and
inserts all the data.</P></LI>
<LI><P class="docList">Gadfly cursors do not supply the <TT>rowcount</TT> method.</P></LI>
</UL>
<P class="docText">The <TT>gadfly</TT> module supplies the following functions.</P>

<A NAME="ch11-77068"></A><A NAME="pythonian-CHP-11-ITERM-6262"></A><A NAME="pythonian-CHP-11-ITERM-6263"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>gadfly</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>gadfly.gadfly(<TT><I>dbname</I></TT>,<TT><I>dirpath</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns a connection object for the database named
<TT><I>dbname</I></TT>, which must have been previously
created in the directory indicated by string
<TT><I>dirpath</I></TT>. The database engine runs in the
same process as your application.</P>

<A NAME="ch11-77069"></A><A NAME="pythonian-CHP-11-ITERM-6264"></A><A NAME="pythonian-CHP-11-ITERM-6265"></A><A NAME="pythonian-CHP-11-ITERM-6266"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>gfclient</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>gadfly.client.gfclient(<TT><I>policyname</I></TT>, <TT><I>port</I></TT>, <TT><I>password</I></TT>, <TT><I>host</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns a connection object for the database served by a
<TT>gfserve</TT> process on the given
<TT><I>host</I></TT> and <TT><I>port</I></TT>.
<TT><I>policyname</I></TT> identifies the level of access
required, and is often '<TT>admin</TT>' to specify
unlimited access.<A NAME="pythonian-CHP-11-ITERM-6266"></A></P>




<ul></ul>
</td>
</tr>
</table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0596001886_pythonian-chp-11-sect-3.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0596001886_pythonian-chp-12.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
