<html><head>
<META http-equiv="Content-Type" content="text/html">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="18.2 Email Protocols"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0596001886_pythonian-chp-18-sect-1.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0596001886_pythonian-chp-18-sect-3.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><A NAME="pythonian-CHP-18-SECT-2"></A>
<H3 class="docSection1Title">18.2 Email Protocols</H3>

<P class="docText"><A NAME="pythonian-CHP-18-ITERM-8097"></A> <A NAME="pythonian-CHP-18-ITERM-8098"></A>Most email today is sent via servers
that implement the Simple Mail Transport Protocol (SMTP) and received
via servers that implement the Post Office Protocol Version 3 (POP3).
These protocols are supported by the Python standard library modules
<TT>smtplib</TT> and <TT>poplib</TT>,
respectively. Some servers, instead of or in addition to POP3,
implement the richer and more advanced Internet Message Access
Protocol Version 4 (IMAP4), supported by the Python standard library
module <TT>imaplib</TT>, which I do not cover in this
book.<A NAME="pythonian-CHP-18-ITERM-8099"></A> <A NAME="pythonian-CHP-18-ITERM-8100"></A> <A NAME="pythonian-CHP-18-ITERM-8101"></A>
<A NAME="pythonian-CHP-18-ITERM-8102"></A></P>

<A NAME="pythonian-CHP-18-SECT-2.1"></A>
<H4 class="docSection2Title">18.2.1 The poplib Module</H4>

<P class="docText"><A NAME="pythonian-CHP-18-ITERM-8103"></A> <A NAME="pythonian-CHP-18-ITERM-8104"></A> <A NAME="pythonian-CHP-18-ITERM-8105"></A> <A NAME="pythonian-CHP-18-ITERM-8106"></A>
<A NAME="pythonian-CHP-18-ITERM-8107"></A>The
<TT>poplib</TT> module supplies a class
<TT>POP3</TT> to access a POP
mailbox.<A NAME="pythonian-CHP-18-ITERM-8108"></A> <A NAME="pythonian-CHP-18-ITERM-8109"></A></P>

<A NAME="ch18-41-fm2xml"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>POP3</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>class POP3(<TT><I>host</I></TT>,<TT><I>port</I></TT>=110)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an instance <TT><I>p</I></TT> of class
<TT>POP3</TT> connected to the given
<TT><I>host</I></TT> and <TT><I>port</I></TT>.</P>

<P class="docText">Instance <TT><I>p</I></TT> supplies many methods, of which
the most frequently used are the following.</P>

<A NAME="ch18-42-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8110"></A><A NAME="pythonian-CHP-18-ITERM-8111"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>dele</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.dele(<TT><I>msgnum</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-18-ITERM-8110"></A>
<A NAME="pythonian-CHP-18-ITERM-8111"></A>Marks
message <TT><I>msgnum</I></TT> for deletion. The server
performs deletions when this connection terminates by a call to
method <TT><I>quit</I></TT>. Returns the response string.</P>

<A NAME="ch18-43-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8112"></A><A NAME="pythonian-CHP-18-ITERM-8113"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>list</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.list(<TT><I>msgnum</I></TT>=None)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns a pair
<TT>(</TT><TT><I>response</I></TT>,<TT><I>messages</I></TT><TT>)</TT>
where <TT><I>response</I></TT> is the response string and
<TT><I>messages</I></TT> is a list of strings, each of two
words '<TT><I>msgnum</I></TT>
<TT><I>bytes</I></TT>', giving the
message number and the length in bytes of each message in the
mailbox. When <TT><I>msgnum</I></TT> is not
<TT>None</TT>, list <TT><I>messages</I></TT> has
only one item, a string with two words:
<TT><I>msgnum</I></TT> as requested, and the length
<TT><I>bytes</I></TT>.</P>

<A NAME="ch18-44-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8114"></A><A NAME="pythonian-CHP-18-ITERM-8115"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>pass_</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.pass_(<TT><I>password</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Sends the password. Must be called after method
<TT>user</TT>. The trailing underscore in the
function's name is necessary because
<TT>pass</TT> is a Python keyword. Returns the response
string.</P>

<A NAME="ch18-45-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8116"></A><A NAME="pythonian-CHP-18-ITERM-8117"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>quit</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.quit(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Ends the session and performs the deletions that were requested by
calls to method <TT>dele</TT>. Returns the response string.</P>

<A NAME="ch18-46-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8118"></A><A NAME="pythonian-CHP-18-ITERM-8119"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>retr</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.retr(<TT><I>msgnum</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns a three-item tuple
<TT>(</TT><TT><I>response</I></TT>,<TT><I>lines</I></TT>,<TT><I>bytes</I></TT><TT>)</TT>,
where <TT><I>response</I></TT> is the response string,
<TT><I>lines</I></TT> is a list of all lines in message
<TT><I>msgnum</I></TT>, and
<TT><I>bytes</I></TT> is the total number of bytes in the
message.</P>

<A NAME="ch18-47-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8120"></A><A NAME="pythonian-CHP-18-ITERM-8121"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>set_debuglevel</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.set_debuglevel(<TT><I>debug_level</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Sets the debug level to integer
<TT><I>debug_level</I></TT>: <TT>0</TT>, the
default, for no debugging; <TT>1</TT> to get a modest
amount of debugging output; <TT>2</TT> or more to get a
complete output trace of all control information exchanged with the
server.</P>

<A NAME="ch18-48-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8122"></A><A NAME="pythonian-CHP-18-ITERM-8123"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>stat</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.stat(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns a pair
<TT>(</TT><TT><I>num_messages</I></TT>,<TT><I>bytes</I></TT><TT>)</TT>,
where <TT><I>num_messages</I></TT> is the number of
messages in the mailbox, and <TT><I>bytes</I></TT> is the
total number of bytes.</P>

<A NAME="ch18-49-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8124"></A><A NAME="pythonian-CHP-18-ITERM-8125"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>top</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.top(<TT><I>msgnum</I></TT>,<TT><I>maxlines</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Like <TT>retr</TT>, but returns no more than
<TT><I>maxlines</I></TT> lines of text from the message
after the headers. Can be useful to view the start of long messages.</P>

<A NAME="ch18-50-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8126"></A><A NAME="pythonian-CHP-18-ITERM-8127"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>user</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>p</I></TT>.user(<TT><I>username</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Sends the username. Must be followed by a call to method
<TT>pass_</TT>.</P>


<A NAME="pythonian-CHP-18-SECT-2.2"></A>
<H4 class="docSection2Title">18.2.2 The smtplib Module</H4>

<P class="docText"><A NAME="pythonian-CHP-18-ITERM-8128"></A> <A NAME="pythonian-CHP-18-ITERM-8129"></A> <A NAME="pythonian-CHP-18-ITERM-8130"></A>The <TT>smtplib</TT> module
supplies a class <TT>SMTP</TT> to send mail to any SMTP
server.<A NAME="pythonian-CHP-18-ITERM-8131"></A></P>

<A NAME="ch18-52-fm2xml"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>SMTP</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>class SMTP([<TT><I>host</I></TT>,<TT><I>port</I></TT>=25])</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns an instance <TT><I>s</I></TT> of class
<TT>SMTP</TT>. When <TT><I>host</I></TT> (and
optionally <TT><I>port</I></TT>) is given, implicitly
calls
<TT><I>s</I></TT><TT>.connect(</TT><TT><I>host</I></TT>,<TT><I>port</I></TT><TT>)</TT>.</P>

<P class="docText">Instance <TT><I>s</I></TT> supplies many methods, of which
the most frequently used are the following.</P>

<A NAME="ch18-53-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8132"></A><A NAME="pythonian-CHP-18-ITERM-8133"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>connect</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>s</I></TT>.connect(<TT><I>host</I></TT>=127.0.0.1,<TT><I>port</I></TT>=25)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Connects to an SMTP server on the given
<TT><I>host</I></TT> (by default, the local host) and
<TT><I>port</I></TT> (port 25 is the default port for the
SMTP service).</P>

<A NAME="ch18-54-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8134"></A><A NAME="pythonian-CHP-18-ITERM-8135"></A><A NAME="pythonian-CHP-18-ITERM-8136"></A><A NAME="pythonian-CHP-18-ITERM-8137"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>login</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>s</I></TT>.login(<TT><I>user</I></TT>,<TT><I>password</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Logs in to the server with the given <TT><I>user</I></TT>
and <TT><I>password</I></TT>. Needed only if the SMTP
server requires
authentication.<A NAME="pythonian-CHP-18-ITERM-8136"></A>
<A NAME="pythonian-CHP-18-ITERM-8137"></A></P>

<A NAME="ch18-55-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8138"></A><A NAME="pythonian-CHP-18-ITERM-8139"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>quit</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>s</I></TT>.quit(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Terminates the SMTP session.</P>

<A NAME="ch18-56-fm2xml"></A><A NAME="pythonian-CHP-18-ITERM-8140"></A><A NAME="pythonian-CHP-18-ITERM-8141"></A><A NAME="pythonian-CHP-18-ITERM-8142"></A><A NAME="pythonian-CHP-18-ITERM-8143"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>sendmail</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>s</I></TT>.sendmail(<TT><I>from_addr</I></TT>,<TT><I>to_addrs</I></TT>,<TT><I>msg_string</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Sends mail message <TT><I>msg_string</I></TT> from the
sender whose email address is in string
<TT><I>from_addr</I></TT> to each of the recipients whose
email addresses are the items of list
<TT><I>to_addrs</I></TT>.
<TT><I>msg_string</I></TT> must be a complete RFC-822
message in a single multiline string: the headers, an empty line for
separation, followed by the body.
<TT><I>from_addr</I></TT> and
<TT><I>to_addrs</I></TT> are used only to direct the mail
transport, not to add or change headers within
<TT><I>msg_string</I></TT>. To prepare RFC-822-compliant
messages, use package <TT>email</TT>, covered in <A class="docLink" HREF="0596001886_pythonian-chp-21.html#pythonian-CHP-21">Chapter 21</A>.<A NAME="pythonian-CHP-18-ITERM-8142"></A> <A NAME="pythonian-CHP-18-ITERM-8143"></A></P>



<ul></ul>
</td>
</tr>
</table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0596001886_pythonian-chp-18-sect-1.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0596001886_pythonian-chp-18-sect-3.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
