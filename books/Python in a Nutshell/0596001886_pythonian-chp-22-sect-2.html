<html><head>
<META http-equiv="Content-Type" content="text/html">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="22.2 The htmllib Module"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0596001886_pythonian-chp-22-sect-1.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0596001886_pythonian-chp-22-sect-3.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
<td valign="top"><A NAME="pythonian-CHP-22-SECT-2"></A>
<H3 class="docSection1Title">22.2 The htmllib Module</H3>

<P class="docText"><A NAME="pythonian-CHP-22-ITERM-8899"></A>
<A NAME="pythonian-CHP-22-ITERM-8900"></A>
<A NAME="pythonian-CHP-22-ITERM-8901"></A>The <TT>htmllib</TT> module
supplies a class named <TT>HTMLParser</TT> that subclasses
<TT>SGMLParser</TT> and defines
<TT>start_</TT><TT><I>tag</I></TT>,
<TT>do_</TT><TT><I>tag</I></TT>, and
<TT>end_</TT><TT><I>tag</I></TT> methods for
tags defined in HTML 2.0. <TT>HTMLParser</TT> implements
and overrides methods in terms of calls to methods of a formatter
object, covered later in this chapter. You can subclass
<TT>HTMLParser</TT> to add or override methods. In addition
to the <TT>start_</TT><TT><I>tag</I></TT>,
<TT>do_</TT><TT><I>tag</I></TT>, and
<TT>end_</TT><TT><I>tag</I></TT> methods, an
instance <TT><I>h</I></TT> of
<TT>HTMLParser</TT> supplies the following attributes and
methods.<A NAME="pythonian-CHP-22-ITERM-8902"></A>
<A NAME="pythonian-CHP-22-ITERM-8903"></A> <A NAME="pythonian-CHP-22-ITERM-8904"></A>
<A NAME="pythonian-CHP-22-ITERM-8905"></A> <A NAME="pythonian-CHP-22-ITERM-8906"></A>
<A NAME="pythonian-CHP-22-ITERM-8907"></A></P>

<A NAME="ch22-20-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8908"></A><A NAME="pythonian-CHP-22-ITERM-8909"></A><A NAME="pythonian-CHP-22-ITERM-8910"></A><A NAME="pythonian-CHP-22-ITERM-8911"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>anchor_bgn</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>h</I></TT>.anchor_bgn(<TT><I>href</I></TT>,<TT><I>name</I></TT>,<TT><I>type</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-22-ITERM-8908"></A> <A NAME="pythonian-CHP-22-ITERM-8909"></A>
<A NAME="pythonian-CHP-22-ITERM-8910"></A> <A NAME="pythonian-CHP-22-ITERM-8911"></A>Called for each
<TT>&lt;a&gt;</TT> tag. <TT><I>href</I></TT>,
<TT><I>name</I></TT>, and <TT><I>type</I></TT>
are the string values of the tag's attributes with
the same names. <TT>HTMLParser</TT>'s
implementation of <TT>anchor_bgn</TT> maintains a list of
outgoing hyperlinks (i.e., <TT><I>href</I></TT> arguments
of method <TT><I>s</I></TT><TT>.anchor_bgn</TT>)
in an instance attribute named
<TT><I>s</I></TT><TT>.anchorlist</TT>.</P>

<A NAME="ch22-21-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8912"></A><A NAME="pythonian-CHP-22-ITERM-8913"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>anchor_end</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>h</I></TT>.anchor_end(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Called for each <TT>&lt;/a&gt;</TT> end tag.
<TT>HTMLParser</TT>'s implementation of
<TT>anchor_end</TT> emits to the formatter a footnote
reference that is an index within
<TT><I>s</I></TT><TT>.anchorlist</TT>. In other
words, by default, <TT>HTMLParser</TT> asks the formatter
to format an
<TT>&lt;a&gt;</TT>/<TT>&lt;/a&gt;</TT> tag pair
as the text inside the tag, followed by a footnote reference number
that points to the URL in the <TT>&lt;a&gt;</TT> tag. Of
course, it's up to the formatter to deal with this
formatting request.</P>

<A NAME="ch22-22-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8914"></A><A NAME="pythonian-CHP-22-ITERM-8915"></A><A NAME="pythonian-CHP-22-ITERM-8916"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>anchorlist</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left"></td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-22-ITERM-8914"></A> <A NAME="pythonian-CHP-22-ITERM-8915"></A>The
<TT><I>h</I></TT><TT>.anchor_list</TT> attribute
contains the list of outgoing hyperlink URLs built by
<TT><I>h</I></TT><TT>.anchor_bgn</TT>.<A NAME="pythonian-CHP-22-ITERM-8916"></A></P>

<A NAME="ch22-23-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8917"></A><A NAME="pythonian-CHP-22-ITERM-8918"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>formatter</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left"></td>
<td align="right"></td>
</tr>
</table>
<P class="docText">The <TT><I>h</I></TT><TT>.formatter</TT>
attribute is the formatter object <TT><I>f</I></TT>
associated with <TT><I>h</I></TT>, which you pass as the
only argument when you instantiate
<TT>HTMLParser(</TT><TT><I>f</I></TT><TT>)</TT>.<A NAME="pythonian-CHP-22-ITERM-8917"></A>
<A NAME="pythonian-CHP-22-ITERM-8918"></A></P>

<A NAME="ch22-24-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8919"></A><A NAME="pythonian-CHP-22-ITERM-8920"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>handle_image</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>h</I></TT>.handle_image(<TT><I>source</I></TT>,<TT><I>alt</I></TT>,<TT><I>ismap</I></TT>='',<TT><I>align</I></TT>='',<TT><I>width</I></TT>='',<TT><I>height</I></TT>='')</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Called for each <TT>&lt;img&gt;</TT> tag. Each argument is
the string value of the tag's attribute of the same
name. <TT>HTMLParser</TT>'s implementation
of <TT>handle_image</TT> calls
<TT><I>h</I></TT><TT>.handle_data(</TT><TT><I>alt</I></TT><TT>)</TT>.</P>

<A NAME="ch22-25-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8921"></A><A NAME="pythonian-CHP-22-ITERM-8922"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>nofill</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>h</I></TT>.nofill</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText"><A NAME="pythonian-CHP-22-ITERM-8921"></A> <A NAME="pythonian-CHP-22-ITERM-8922"></A>The
<TT><I>h</I></TT><TT>.nofill</TT> attribute is
false when the parser is collapsing whitespace, the normal case. It
is true when the parser must preserve whitespace, typically within a
<TT>&lt;pre&gt;</TT> tag.</P>

<A NAME="ch22-26-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8923"></A><A NAME="pythonian-CHP-22-ITERM-8924"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>save_bgn</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>h</I></TT>.save_bgn(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Diverts data to an internal buffer instead of passing it to the
formatter, until the next call to
<TT><I>h</I></TT><TT>.save_end( )</TT>.
<TT><I>h</I></TT> has only one buffer, so you cannot nest
<TT>save_bgn</TT> calls.</P>

<A NAME="ch22-27-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8925"></A><A NAME="pythonian-CHP-22-ITERM-8926"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>save_end</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre><TT><I>h</I></TT>.save_end(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">Returns a string with all data in the internal buffer, and directs
data back to the formatter from now on. If
<TT>save_bgn</TT> state was not on, raises
<TT>TypeError</TT>.</P>

<A NAME="pythonian-CHP-22-SECT-2.1"></A>
<H4 class="docSection2Title">22.2.1 The formatter Module</H4>

<P class="docText"><A NAME="pythonian-CHP-22-ITERM-8927"></A> <A NAME="pythonian-CHP-22-ITERM-8928"></A>The <TT>formatter</TT> module
defines formatter and writer classes. You instantiate a formatter by
passing to the class a writer instance, and then you pass the
formatter instance to class <TT>HTMLParser</TT> of module
<TT>htmllib</TT>. You can define your own formatters and
writers by subclassing
<TT>formatter</TT>'s classes and
overriding methods appropriately, but I do not cover this advanced
and rarely used possibility in this book. An application with special
output requirements would typically define an appropriate writer,
subclassing <TT>AbstractWriter</TT> and overriding all
methods, and use class <TT>AbstractFormatter</TT> without
needing to subclass it. Module <TT>formatter</TT> supplies
the following classes.</P>

<A NAME="ch22-29-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8929"></A><A NAME="pythonian-CHP-22-ITERM-8930"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>AbstractFormatter</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>class AbstractFormatter(<TT><I>writer</I></TT>)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">The standard formatter implementation, suitable for most tasks.</P>

<A NAME="ch22-30-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8931"></A><A NAME="pythonian-CHP-22-ITERM-8932"></A><A NAME="pythonian-CHP-22-ITERM-8933"></A><A NAME="pythonian-CHP-22-ITERM-8934"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>AbstractWriter</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>class AbstractWriter(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">A writer implementation that prints each of its method names when
called, suitable for debugging purposes
only.<A NAME="pythonian-CHP-22-ITERM-8933"></A>
<A NAME="pythonian-CHP-22-ITERM-8934"></A></P>

<A NAME="ch22-31-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8935"></A><A NAME="pythonian-CHP-22-ITERM-8936"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>DumbWriter</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>class DumbWriter(<TT><I>file</I></TT>=sys.stdout,<TT><I>maxcol</I></TT>=72)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">A writer implementation that emits text to file object
<TT><I>file</I></TT>, with word wrapping to ensure that no
text line is longer than <TT><I>maxcol</I></TT>
characters.</P>

<A NAME="ch22-32-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8937"></A><A NAME="pythonian-CHP-22-ITERM-8938"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>NullFormatter</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>class NullFormatter(<TT><I>writer</I></TT>=None)</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">A formatter implementation whose methods are do-nothing stubs. When
<TT><I>writer</I></TT> is <TT>None</TT>,
instantiates <TT>NullWriter</TT>. Suitable when you
subclass <TT>HMTLParser</TT> to analyze an HTML document
but don't want any output to happen.</P>

<A NAME="ch22-33-fm2xml"></A><A NAME="pythonian-CHP-22-ITERM-8939"></A><A NAME="pythonian-CHP-22-ITERM-8940"></A><table width="515" border="0" cellpadding="5">
<tr>
<td align="left"><b><i>NullWriter</i></b></td>
<td align="right"></td>
</tr>
</table>
<hr width="515" size="3" noshade="true" align="left" color="black">
<table width="515" border="0" cellpadding="5">
<tr>
<td align="left">
<pre>class NullWriter(  )</pre>
</td>
<td align="right"></td>
</tr>
</table>
<P class="docText">A writer implementation whose methods are do-nothing stubs.</P>


<A NAME="pythonian-CHP-22-SECT-2.2"></A>
<H4 class="docSection2Title">22.2.2 The htmlentitydefs Module</H4>

<P class="docText"><A NAME="pythonian-CHP-22-ITERM-8941"></A> <A NAME="pythonian-CHP-22-ITERM-8942"></A>The <TT>htmlentitydefs</TT>
module supplies just one attribute, a dictionary named
<TT>entitydefs</TT> that maps each entity defined in HTML
2.0 to the corresponding string in the ISO-8859-1 (also known as
Latin-1) encoding. Module <TT>htmllib</TT> uses module
<TT>htmlentitydefs</TT>
internally.<A NAME="pythonian-CHP-22-ITERM-8943"></A>
<A NAME="pythonian-CHP-22-ITERM-8944"></A></P>


<A NAME="pythonian-CHP-22-SECT-2.3"></A>
<H4 class="docSection2Title">22.2.3 Parsing HTML with htmllib</H4>

<P class="docText"><A NAME="pythonian-CHP-22-ITERM-8945"></A>The
following example uses <TT>htmllib</TT> to perform the same
task as in the previous example for <TT>sgmllib</TT>,
fetching a page from the Web with <TT>urllib</TT>, parsing
it, and outputting the hyperlinks:</P>

<PRE>import htmllib, formatter, urllib, urlparse

p = htmllib.HTMLParser(formatter.NullFormatter(  ))
f = urllib.urlopen('http://www.python.org/index.html')
BUFSIZE = 8192
while True:
    data = f.read(BUFSIZE)
    if not data: break
    p.feed(data)
p.close(  )

seen = {}
for url in p.anchorlist:
    if url in seen: continue
    seen[url] = True
    pieces = urlparse.urlparse(url)
    if pieces[0] == 'http':
        print urlparse.urlunparse(pieces)</PRE>

<P class="docText">The example exploits the <TT>anchorlist</TT> attribute of
class <TT>htmllib.HTMLParser</TT>, and therefore does not
need to perform any subclassing.
<TT>htmllib.HTMLParser</TT> builds the
<TT>anchorlist</TT> attribute as it parses the HTML page,
so the code need only loop on the list and work with the
list's items, each a relevant URL.</P>



<a href="0596001886_"><img src="FILES/pixel.gif" width="1" height="1" border="0"></a><ul></ul>
</td>
</tr>
</table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0596001886_pythonian-chp-22-sect-1.html"><img src="FILES/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0596001886_pythonian-chp-22-sect-3.html"><img src="FILES/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
