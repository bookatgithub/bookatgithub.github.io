<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Recipe&nbsp;14.4.&nbsp;Checking for a Web Page's Existence</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="toc.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=pythoncook2-chp-14-sect-3.html><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href=pythoncook2-chp-14-sect-5.html><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><td valign="top"><a name="pythoncook2-CHP-14-SECT-4"></a>
<h3 class="docSection1Title">Recipe 14.4. Checking for a Web Page's Existence</h3>

<p class="docText"><span class="docEmphasis">Credit: James Thiele, Rogier Steehouder</span></p>

<a name="pythoncook2-CHP-14-SECT-4.1"></a>
<h4 class="docSection2Title">Problem</h4>

<p class="docText">You want to check whether an HTTP URL corresponds to an existing web
page.</P>


<a name="pythoncook2-CHP-14-SECT-4.2"></a>
<h4 class="docSection2Title">Solution</H4>

<p class="docText">Using <tt>httplib</tt> allows you to easily check for a
page's existence without actually downloading the
page itself, just its headers. Here's a module
implementing a function to perform this task:</p>

<pre>"""
httpExists.py
A quick and dirty way to check whether a web file is there.
Usage:
&gt;&gt;&gt; import httpExists
&gt;&gt;&gt; httpExists.httpExists('http://www.python.org/')
True
&gt;&gt;&gt; httpExists.httpExists('http://www.python.org/PenguinOnTheTelly')
Status 404 Not Found : http://www.python.org/PenguinOnTheTelly
False
"""
import httplib, urlparse
def httpExists(url):
    host, path = urlparse.urlsplit(url)[1:3]
    if ':' in host:
        # port specified, try to use it
        host, port = host.split(':', 1)
        try:
            port = int(port)
        except ValueError:
            print 'invalid port number %r' % (port,)
            return False
    else:
        # no port specified, use default port
        port = None
    try:
        connection = httplib.HTTPConnection(host, port=port)
        connection.request("HEAD", path)
        resp = connection.getresponse( )
        if resp.status == 200:       # normal 'found' status
            found = True
        elif resp.status == 302:     # recurse on temporary redirect
            found = httpExists(urlparse.urljoin(url,
                               resp.getheader('location', '')))
        else:                        # everything else -&gt; not found
            print "Status %d %s : %s" % (resp.status, resp.reason, url)
            found = False
    except Exception, e:
        print e._ _class_ _, e, url
        found = False
    return found
def _test( ):
    import doctest, httpExists
    return doctest.testmod(httpExists)
if _ _name_ _ == "_ _main_ _":
    _test( )</pre><BR>



<a name="pythoncook2-CHP-14-SECT-4.3"></a>
<h4 class="docSection2Title">Discussion</H4>

<p class="docText">While this recipe is very simple and runs quite fast (thanks to the
ability to use the HTTP command <tt>HEAD</tt> to get just
the headers, not the body, of the page), it may be too simplistic for
your specific needs: the HTTP result codes you might need to deal
with may go beyond the simple 200 success code, and 302 temporary
redirect, to include permanent redirects, temporary inaccessibility,
permission problems, and so on.</P>

<p class="docText">In my case, I needed to check the correctness of a huge number of
mutual links among pages of a site generated by a complex web
application on an intranet, so I knew I had the privilege of relying
on a simple check for "200 or
bust." At any rate, you can use this simple recipe
as a starting point to which to add any refinements you determine you
actually need.</p>


<a name="pythoncook2-CHP-14-SECT-4.4"></a>
<H4 class="docSection2Title">See Also</H4>

<p class="docText">Documentation on the <tt>urlparse</tt> and
<tt>httplib</tt> standard library modules in the
<span class="docEmphasis">Library Reference</span> and <span class="docEmphasis">Python in a
Nutshell</span>.</p>



<a href="5991535.html"><img src="images/pixel.gif" alt="" width="1" height="1" border="0"></a><ul></ul></td></TR></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="toc.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=pythoncook2-chp-14-sect-3.html><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href=pythoncook2-chp-14-sect-5.html><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr></table>
</body></html>