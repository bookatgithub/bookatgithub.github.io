<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Recipe&nbsp;3.5.&nbsp;Calculating the Number of Weekdays Between Two Dates</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="toc.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=pythoncook2-chp-3-sect-4.html><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href=pythoncook2-chp-3-sect-6.html><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><td valign="top"><a name="pythoncook2-CHP-3-SECT-5"></a>
<h3 class="docSection1Title">Recipe 3.5. Calculating the Number of Weekdays Between Two Dates</h3>

<p class="docText"><span class="docEmphasis">Credit: Anna Martelli Ravenscroft</span></p>

<a name="pythoncook2-CHP-3-SECT-5.1"></a>
<h4 class="docSection2Title">Problem</h4>

<p class="docText"><a name="pythoncook2-CHP-3-ITERM-1752"></a>You want to calculate the number of
weekdays (working days), as opposed to calendar days, that fall
between two dates.</P>


<a name="pythoncook2-CHP-3-SECT-5.2"></a>
<h4 class="docSection2Title">Solution</H4>

<p class="docText">Since weekends and other "days off"
vary by country, by region, even sometimes within a single company,
there is no built-in way to perform this task. However, using
<tt>dateutil</tt> along with <tt>datetime</tt>
objects, it's reasonably simple to code a solution:</p>

<pre>from dateutil import rrule 
import datetime
def workdays(start, end, holidays=0, days_off=None):
    if days_off is None:
        days_off = 5, 6         # default to: saturdays and sundays
    workdays = [x for x in range(7) if x not in days_off]
    days = rrule.rrule(rrule.DAILY, dtstart=start, until=end,
                       byweekday=workdays)
    return days.count( ) - holidays
if _ _name_ _ == '_ _main_ _':
# test when run as main script
    testdates = [ (datetime.date(2004, 9, 1), datetime.date(2004, 11, 14), 2),
                  (datetime.date(2003, 2, 28), datetime.date(2003, 3, 3), 1), ]
    def test(testdates, days_off=None):
        for s, e, h in testdates:
            print 'total workdays from %s to %s is %s with %s holidays' % (
                        s, e, workdays(s, e, h, days_off), h)
    test(testdates)
    test(testdates, days_off=[6])</pre><BR>



<a name="pythoncook2-CHP-3-SECT-5.3"></a>
<h4 class="docSection2Title">Discussion</H4>

<p class="docText">This project was my very first one in Python: I needed to know the
number of actual days in training of our trainees, given a start date
and end date (inclusive). This problem was a bit trickier back in
Python 2.2; today, the <tt>datetime</tt> module and the
<tt>dateutil</tt> third-party package make the problem much
simpler to solve.<a name="pythoncook2-CHP-3-ITERM-1753"></a> <a name="pythoncook2-CHP-3-ITERM-1754"></a></P>

<p class="docText">Function <i>workdays</I> starts by assigning a reasonable
default value to variable <I>days_off</i> (unless an
explicit value was passed for it as an argument), which is a sequence
of the weekday numbers of our normal days off. In my company, weekly
days off varied among individuals but were usually fewer than the
workdays, so it was easier to track and modify the days off rather
than the workdays. I made this an argument to the function so that I
can easily pass a different value for <i>days_off</i> if
and when I have different needs. Then, the function uses a list
comprehension to create a list of actual weekly workdays, which are
all weekdays not in <i>days_off</I>. Now the function is
ready to do its calculations.</p>

<p class="docText">The workhorse in this recipe is an instance, named
<i>days</I>, of <tt>dateutil's</tt>
<tt>rrule</tt> (recurrence rule) class. Class
<tt>rrule</tt> may be instantiated with various parameters
to produce a rule object. In this example, I pass a frequency
(<tt>rrule.DAILY</tt>), a beginning date and an ending
dateboth of which must be <tt>datetime.date</tt>
objectsand which weekdays to include
(<i>workdays</I>). Then, I simply call method
<tt>days.count</tt> to count the number of occurrences
generated by the rule. (See <a class="docLink" href="pythoncook2-CHP-3-SECT-3.html#pythoncook2-CHP-3-SECT-3">Recipe 3.3</a> for other uses for the
<tt>count</tt> method of <tt>rrule</tt>.)</p>

<p class="docText">You can easily set your own definition of
<span class="docEmphasis">weekend</span>: just pass as <I>days_off</I>
whichever values you need. In this recipe, the default value is set
to the standard U.S. weekend of Saturday and Sunday. However, if your
company normally works a four-day week, say, Tuesday through Friday,
you would pass <tt>days_off=(5, 6, 0)</tt>. Just be sure to
pass the <i>days_off</i> value as an iterable, such as a
<tt>list</tt> or <tt>tuple</tt>, even if, as in
the second test, you only have a single day in that container.</p>

<p class="docText">A simple but useful enhancement might be to automatically check
whether your start and end dates are weekends (for weekend-shift
workers), and use an <tt>if/else</tt> to handle the weekend
shifts, with appropriate changes to <i>days_off</i>.
Further enhancements would be to add the ability to enter sick days,
or to perform a call to an automatic holiday lookup function, rather
than passing the number of holidays directly, as I do in this recipe.
See <a class="docLink" href="pythoncook2-CHP-3-SECT-6.html#pythoncook2-CHP-3-SECT-6">Recipe 3.6</a> for a
simple implementation of a holidays list for this purpose.</p>


<a name="pythoncook2-CHP-3-SECT-5.4"></a>
<h4 class="docSection2Title">See Also</h4>

<p class="docText">Refer to the <tt>dateutil</tt> documentation, which is
available at <a class="docLink" target="_blank" href="https://moin.conectiva.com.br/DateUtil?action=highlight&amp;value=DateUtil">https://moin.conectiva.com.br/DateUtil?action=highlight&amp;value=DateUtil</a>,
<tt>datetime</tt> documentation in the <span class="docEmphasis">Library
Reference</span>; <a class="docLink" href="pythoncook2-CHP-3-SECT-3.html#pythoncook2-CHP-3-SECT-3">Recipe 3.3</a> for another use of
<tt>rrule.count</tt>; <a class="docLink" href="pythoncook2-CHP-3-SECT-6.html#pythoncook2-CHP-3-SECT-6">Recipe 3.6</a> for automatic holiday
lookup.</p>



<a href="5991535.html"><img src="images/pixel.gif" alt="" width="1" height="1" border="0"></a><ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;"><a href="toc.html"><img src="images/teamlib.gif" width="62" height="15" border="0" align="absmiddle"  alt="Team LiB"></a></div></td>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=pythoncook2-chp-3-sect-4.html><img src="images/previous.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
<a href=pythoncook2-chp-3-sect-6.html><img src="images/next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</div></td></tr></table>
</body></html>