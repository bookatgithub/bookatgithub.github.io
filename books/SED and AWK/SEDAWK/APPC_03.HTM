<HTML
><HEAD
>
<TITLE>[Appendix C] C.3 Documentation for masterindex</TITLE>
<META
NAME="DC.title"
CONTENT="sed &amp; awk"><META
NAME="DC.creator"
CONTENT="Dale Dougherty &amp; Arnold Robbins"><META
NAME="DC.publisher"
CONTENT="O'Reilly &amp; Associates, Inc."><META
NAME="DC.date"
CONTENT="1998-08-03T21:07:11Z"><META
NAME="DC.type"
CONTENT="Text.Monograph"><META
NAME="DC.format"
CONTENT="text/html"
SCHEME="MIME"><META
NAME="DC.source"
CONTENT="1-56592-225-5"
SCHEME="ISBN"><META
NAME="DC.language"
CONTENT="en-US"><META
NAME="generator"
CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINK
REV="made"
HREF="mailto:online-books@oreilly.com"
TITLE="Online Books Comments"><LINK
REL="up"
HREF="appc_01.htm"
TITLE="C. Supplement for Chapter 12"><LINK
REL="prev"
HREF="appc_02.htm"
TITLE="C.2 Listing of masterindex Shell Script"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="htmlnav"
><H1
><IMG
SRC="gifs/smbanner.gif"
ALT="sed &amp; awk"
USEMAP="#srchmap"
BORDER="0"></H1
><MAP
NAME="srchmap"
><AREA
SHAPE="RECT"
COORDS="0,0,466,65"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="467,0,514,18"
HREF="../search/ssrch.htm"
ALT="Search this book"></MAP
><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="appc_02.htm"
TITLE="C.2 Listing of masterindex Shell Script"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: C.2 Listing of masterindex Shell Script"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><B
><FONT
FACE="ARIEL,HELVETICA,HELV,SANSERIF"
SIZE="-1"
>Appendix C<BR>Supplement for Chapter 12</FONT
></B
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>&nbsp;</TD
></TR
></TABLE
>&nbsp;<HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="sect1"
><A
CLASS="title"
NAME="SEDAWK-APP-C-SECT-3"
>C.3 Documentation for masterindex</A
></H2
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="AUTOID-13388"
></A
>This documentation, and the notes that follow, are by Dale Dougherty.</P
><DIV
CLASS="refentry"
><DIV
CLASS="refnamediv"
><H3
CLASS="refname"
><A
CLASS="refname"
NAME="AUTOID-13391"
>C.3.1 masterindex</A
></H3
><P
CLASS="refpurpose"
>indexing program for single and multivolume indexing.</P
></DIV
><BLOCKQUOTE
><DIV
CLASS="refsynopsisdiv"
><H4
>Synopsis</H4
><P
CLASS="synopsis"
><CODE
>masterindex [-master [volume]]  [-page] [-screen] [filename..]</CODE
></P
></DIV
><DIV
CLASS="refsect1"
><H4
CLASS="refsect1"
><A
CLASS="title"
NAME="AUTOID-13397"
>Description</A
></H4
><P
CLASS="para"
><KBD
CLASS="command"
>masterindex</KBD
> generates a formatted index based 
on structured index entries output by <KBD
CLASS="command"
>troff</KBD
>.
Unless you redirect output, it comes to the screen. </P
></DIV
><DIV
CLASS="refsect1"
><H4
CLASS="refsect1"
><A
CLASS="title"
NAME="AUTOID-13402"
>Options</A
></H4
><P
CLASS="para"
><I
CLASS="option"
>-m</I
> or <I
CLASS="option"
>-master</I
>
indicates that you are
compiling a multivolume index.  The index entries for each volume
should be in a single file and the filenames should be listed in
sequence.  If the first file is not the first volume, then specify the
volume number as a separate argument.  The volume number is converted
to a roman numeral and prepended to all the page numbers of entries
in that file.</P
><P
CLASS="para"
><I
CLASS="option"
>-p</I
> or <I
CLASS="option"
>-page</I
> produces a listing of
index entries for each page number.  It can be used to proof the
entries against hardcopy.</P
><P
CLASS="para"
><I
CLASS="option"
>-s</I
> or <I
CLASS="option"
>-screen</I
> specifies that the
unformatted index will be viewed on the &quot;screen&quot;.  The default is to
prepare output that contains <KBD
CLASS="command"
>troff</KBD
> macros for
formatting.</P
></DIV
><DIV
CLASS="refsect1"
><H4
CLASS="refsect1"
><A
CLASS="title"
NAME="AUTOID-13414"
>Files</A
></H4
><TABLE
CLASS="simplelist"
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/bin/masterindex</I
></TD
></TR
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/bin/page.idx</I
></TD
></TR
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/bin/pagenums.idx</I
></TD
></TR
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/bin/combine.idx</I
></TD
></TR
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/bin/format.idx</I
></TD
></TR
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/bin/rotate.idx</I
></TD
></TR
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/bin/romanum</I
></TD
></TR
><TR
><TD
CLASS="member"
><I
CLASS="filename"
>/work/macros/current/indexmacs</I
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="refsect1"
><H4
CLASS="refsect1"
><A
CLASS="title"
NAME="AUTOID-13433"
>See Also</A
></H4
><P
CLASS="para"
>Note that these programs require &quot;nawk&quot; (new awk): <KBD
CLASS="command"
>nawk (1),</KBD
> and <KBD
CLASS="command"
>sed (1V)</KBD
>.</P
></DIV
><DIV
CLASS="refsect1"
><H4
CLASS="refsect1"
><A
CLASS="title"
NAME="AUTOID-13438"
>Bugs</A
></H4
><P
CLASS="para"
>The new index program is modular, invoking a series of smaller programs. 
This should allow me to connect different modules to implement
new features as well as isolate and fix problems more easily.
Index entries should not contain any
<KBD
CLASS="command"
>troff</KBD
> font changes.  The program does not handle them.
Roman numerals greater than eight will not be sorted
properly, thus imposing a limit of an eight-book index.  (The sort
program will sort the roman numerals 1-10 in the following order: I,
II, III, IV, IX, V, VI, VII, VIII, X.)</P
></DIV
></BLOCKQUOTE
></DIV
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="SEDAWK-APP-C-SECT-3.1"
>C.3.2 Background Details</A
></H3
><P
CLASS="para"
>Tim O'Reilly recommends <CITE
CLASS="citetitle"
>The Joy of Cooking</CITE
>
(JofC) index as an ideal index.  I examined the JofC
index quite thoroughly and set out to write a new indexing program
that duplicated its features.  I did not wholly duplicate the
JofC format, but this could be done fairly easily if
desired.  Please look at the JofC index yourself to
examine its features.</P
><P
CLASS="para"
>I also tried to do a few other things to improve on the previous index
program and provide more support for the person coding
the index.</P
></DIV
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="SEDAWK-APP-C-SECT-3.2"
>C.3.3 Coding Index Entries</A
></H3
><P
CLASS="para"
>This section describes the coding of index entries in the document
file.  We use the .XX macro for placing index entries in a file.  The
simplest case is:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;entry&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>If the entry consists of primary and secondary sort keys, then we can
code it as:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;primary, secondary&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>A comma delimits the two keys.  We also have a .XN macro for
generating &quot;See&quot; references without a page number.  It is specified
as:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XN &quot;entry (See anotherEntry)&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>While these coding forms continue to work as they have,
<KBD
CLASS="command"
>masterindex</KBD
> provides greater flexibility by
allowing three levels of keys: primary, secondary, and tertiary.  You'd
specify the entry like so:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;primary: secondary; tertiary&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>Note that the comma is not used as a delimiter.  A colon delimits the
primary and secondary entry; the semicolon delimits the secondary and
tertiary entry.  This means that commas can be a part of a key using
this syntax.  Don't worry, though, you can continue to use a comma to
delimit the primary and secondary keys.  (Be aware that the first
comma in a line is converted to a colon, if no colon delimiter is
found.)  I'd recommend that new books be coded using the above syntax,
even if you are only specifying a primary and secondary key.</P
><P
CLASS="para"
>Another feature is automatic rotation of primary and secondary keys if
a tilde (~) is used as the delimiter.  So the following entry:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;cat~command&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>is equivalent to the following two entries:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;cat command&quot;
.XX &quot;command: cat&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>You can think of the secondary key as a classification (command,
attribute, function, etc.) of the primary entry.  Be careful not to
reverse the two, as &quot;command cat&quot; does not make much sense.  To use a
tilde in an entry, enter &quot;~~&quot;.</P
><P
CLASS="para"
>I added a new macro, .XB, that is the same as .XX except that the page
number for this index entry will be output in bold to indicate that it
is the most significant page number in a range.  Here is an example:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XB &quot;cat command&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>When <KBD
CLASS="command"
>troff</KBD
> processes the index entries, it outputs
the page number followed by an asterisk.  This is how it appears when
output is seen in screen format.  When coded for
<KBD
CLASS="command"
>troff</KBD
> formatting, the page number is surrounded by
the bold font change escape sequences.  (By the way, in the
JofC index, I noticed that they allowed having the same page
number in roman and in bold.)  Also, this page number will not be
combined in a range of consecutive numbers.</P
><P
CLASS="para"
>One other feature of the JofC index is that the very first
secondary key appears on the same line with the primary key.  The old
index program placed any secondary key on the next line.  The one
advantage of doing it the JofC way is that entries containing
only one secondary key will be output on the same line and look much
better.  Thus, you'd have &quot;line justification, definition of&quot; rather
than having &quot;definition of&quot; indented on the next line.  The next
secondary key would be indented.  Note that if the primary key exists
as a separate entry (it has page numbers associated with it), the page
references for the primary key will be output on the same line and the
first secondary entry will be output on the next line.</P
><P
CLASS="para"
>To reiterate, while the syntax of the three-level entries is
different, this index entry is perfectly valid:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;line justification, definition of&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>It also produces the same result as:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;line justification: definition of&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>(The colon disappears in the output.)  Similarly, you could write an
entry, such as</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;justification, lines, defined&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>or</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;justification: lines, defined&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>where the comma between &quot;lines&quot; and &quot;defined&quot; does not serve as a
delimiter but is part of the secondary key.</P
><P
CLASS="para"
>The previous example could be written as an entry with three levels:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>.XX &quot;justification: lines; defined&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>where the semicolon delimits the tertiary key.  The semicolon is
output with the key, and multiple tertiary keys may follow immediately
after the secondary key.</P
><P
CLASS="para"
>The main thing, though, is that page numbers are collected for
all primary, secondary, and tertiary keys.  Thus, you could have
output such as:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>  justification  4-9
    lines 4,6; defined, 5</PRE
></BLOCKQUOTE
></DIV
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="SEDAWK-APP-C-SECT-3.3"
>C.3.4 Output Format</A
></H3
><P
CLASS="para"
>One thing I wanted to do that our previous program did not do is
generate an index without the <KBD
CLASS="command"
>troff</KBD
> codes.
<KBD
CLASS="command"
>masterindex</KBD
> has three output modes:
<KBD
CLASS="command"
>troff</KBD
>, <KBD
CLASS="command"
>screen</KBD
>, and
<KBD
CLASS="command"
>page</KBD
>.</P
><P
CLASS="para"
>The default output is intended for processing by
<KBD
CLASS="command"
>troff</KBD
> (via <KBD
CLASS="command"
>fmt</KBD
>).  It contains
macros that are defined in
<EM
CLASS="emphasis"
>/work/macros/current/indexmacs</EM
>.  These macros
should produce the same index format as before, which was largely done
directly through <KBD
CLASS="command"
>troff</KBD
> requests.  Here are a few
lines off the top:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>masterindex ch01</B
></CODE
>
.so /work/macros/current/indexmacs
.Se &quot;&quot; &quot;Index&quot;
.XC
.XF A &quot;A&quot;
.XF 1 &quot;applications, structure of  2;  program  1&quot;
.XF 1 &quot;attribute, WIN_CONSUME_KBD_EVENTS  13&quot;
.XF 2 &quot;WIN_CONSUME_PICK_EVENTS  13&quot;
.XF 2 &quot;WIN_NOTIFY_EVENT_PROC  13&quot;
.XF 2 &quot;XV_ERROR_PROC  14&quot;
.XF 2 &quot;XV_INIT_ARGC_PTR_ARGV  5,6&quot;</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>The top two lines should be obvious.  The .XC macro produces
multicolumn output.  (It will print out two columns for smaller
books.  It's not smart enough to take arguments specifying the width
of columns, but that should be done.)  The .XF macro has three
possible values for its first argument.  An &quot;A&quot; indicates that the
second argument is a letter of the alphabet that should be output as a
divider.  A &quot;1&quot; indicates that the second argument contains a primary
entry.  A &quot;2&quot; indicates that the entry begins with a secondary entry,
which is indented.</P
><P
CLASS="para"
>When invoked with the <I
CLASS="option"
>-s</I
> argument, the program
prepares the index for viewing on the screen (or printing as an ASCII
file).  Again, here are a few lines:</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>masterindex -s ch01</B
></CODE
>
		A
applications, structure of  2;  program  1
attribute, WIN_CONSUME_KBD_EVENTS  13
  WIN_CONSUME_PICK_EVENTS  13
  WIN_NOTIFY_EVENT_PROC  13
  XV_ERROR_PROC  14
  XV_INIT_ARGC_PTR_ARGV  5,6
  XV_INIT_ARGS  6
  XV_USAGE_PROC  6</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>Obviously, this is useful for quickly proofing the index.  The third
type of format is also used for proofing the index.  Invoked using
<I
CLASS="option"
>-p</I
>, it provides a page-by-page listing of the index
entries.</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>masterindex -p ch01</B
></CODE
>
Page 1
        structure of XView applications
        applications, structure of; program
        XView applications
        XView applications, structure of
        XView interface
        compiling XView programs
        XView, compiling programs
Page 2
        XView libraries</PRE
></BLOCKQUOTE
></P
></DIV
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="SEDAWK-APP-C-SECT-3.4"
>C.3.5 Compiling a Master Index</A
></H3
><P
CLASS="para"
>A multivolume master index is invoked by specifying the
<I
CLASS="option"
>-m</I
> option.  Each set of index entries for a
particular volume must be placed in a separate file.</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>masterindex -m -s book1 book2 book3</B
></CODE
>
xv_init() procedure  II: 4; III: 5
XV_INIT_ARGC_PTR_ARGV attribute  II: 5,6
XV_INIT_ARGS attribute  I: 6</PRE
></BLOCKQUOTE
></P
><P
CLASS="para"
>Files must be specified in consecutive order.  If the first file is
not Volume 1, you can specify the number as an argument.</P
><P
CLASS="para"
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>masterindex -m 4 -s book4 book5 </B
></CODE
></PRE
></BLOCKQUOTE
></P
></DIV
><A
CLASS="indexterm"
NAME="AUTOID-13534"
></A
></DIV
><DIV
CLASS="htmlnav"
><P
></P
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="appc_02.htm"
TITLE="C.2 Listing of masterindex Shell Script"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: C.2 Listing of masterindex Shell Script"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="book"
HREF="index.htm"
TITLE="sed &amp; awk"
><IMG
SRC="../gifs/txthome.gif"
ALT="sed &amp; awk"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>&nbsp;</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
>C.2 Listing of masterindex Shell Script</TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="index"
HREF="index/idx_0.htm"
TITLE="Book Index"
><IMG
SRC="../gifs/index.gif"
ALT="Book Index"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>&nbsp;</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><IMG
SRC="../gifs/smnavbar.gif"
USEMAP="#map"
BORDER="0"
ALT="The UNIX CD Bookshelf Navigation"><MAP
NAME="map"
><AREA
SHAPE="RECT"
COORDS="0,0,73,21"
HREF="../index.htm"
ALT="The UNIX CD Bookshelf"><AREA
SHAPE="RECT"
COORDS="74,0,163,21"
HREF="../upt/index.htm"
ALT="UNIX Power Tools"><AREA
SHAPE="RECT"
COORDS="164,0,257,21"
HREF="../unixnut/index.htm"
ALT="UNIX in a Nutshell"><AREA
SHAPE="RECT"
COORDS="258,0,321,21"
HREF="../vi/index.htm"
ALT="Learning the vi Editor"><AREA
SHAPE="RECT"
COORDS="322,0,378,21"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="379,0,438,21"
HREF="../ksh/index.htm"
ALT="Learning the Korn Shell"><AREA
SHAPE="RECT"
COORDS="439,0,514,21"
HREF="../lrnunix/index.htm"
ALT="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
