<HTML
><HEAD
>
<TITLE>[Chapter 4] 4.2 A Global Perspective on Addressing</TITLE>
<META
NAME="DC.title"
CONTENT="sed &amp; awk"><META
NAME="DC.creator"
CONTENT="Dale Dougherty &amp; Arnold Robbins"><META
NAME="DC.publisher"
CONTENT="O'Reilly &amp; Associates, Inc."><META
NAME="DC.date"
CONTENT="1998-08-03T20:52:53Z"><META
NAME="DC.type"
CONTENT="Text.Monograph"><META
NAME="DC.format"
CONTENT="text/html"
SCHEME="MIME"><META
NAME="DC.source"
CONTENT="1-56592-225-5"
SCHEME="ISBN"><META
NAME="DC.language"
CONTENT="en-US"><META
NAME="generator"
CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINK
REV="made"
HREF="mailto:online-books@oreilly.com"
TITLE="Online Books Comments"><LINK
REL="up"
HREF="ch04_01.htm"
TITLE="4. Writing sed Scripts"><LINK
REL="prev"
HREF="ch04_01.htm"
TITLE="4.1 Applying Commands in a Script"><LINK
REL="next"
HREF="ch04_03.htm"
TITLE="4.3 Testing and Saving Output"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="htmlnav"
><H1
><IMG
SRC="gifs/smbanner.gif"
ALT="sed &amp; awk"
USEMAP="#srchmap"
BORDER="0"></H1
><MAP
NAME="srchmap"
><AREA
SHAPE="RECT"
COORDS="0,0,466,65"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="467,0,514,18"
HREF="../search/ssrch.htm"
ALT="Search this book"></MAP
><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch04_01.htm"
TITLE="4.1 Applying Commands in a Script"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 4.1 Applying Commands in a Script"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><B
><FONT
FACE="ARIEL,HELVETICA,HELV,SANSERIF"
SIZE="-1"
>Chapter 4<BR>Writing sed Scripts</FONT
></B
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch04_03.htm"
TITLE="4.3 Testing and Saving Output"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 4.3 Testing and Saving Output"
BORDER="0"></A
></TD
></TR
></TABLE
>&nbsp;<HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="sect1"
><A
CLASS="title"
NAME="SEDAWK-CH-4-SECT-2"
>4.2 A Global Perspective on Addressing</A
></H2
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="CH04.GLOBAL1"
></A
><A
CLASS="indexterm"
NAME="CH04.GLOBAL2"
></A
>One of the first things you'll notice about sed commands is that sed
will apply them to every input line.  Sed is implicitly global, unlike
<KBD
CLASS="command"
>ed</KBD
>, <KBD
CLASS="command"
>ex</KBD
>, or
<KBD
CLASS="command"
>vi</KBD
>.  The following substitute command will change
every &quot;CA&quot; into &quot;California.&quot;</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>s/CA/California/g</PRE
></BLOCKQUOTE
><P
CLASS="para"
>If the same command were entered from the <KBD
CLASS="command"
>ex</KBD
>
command prompt in <KBD
CLASS="command"
>vi</KBD
>, it would make the replacement
for all occurrences on the current line only.  In sed, it is as though
each line has a turn at becoming the current line and so the command
is applied to every line.  Line addresses are used to supply context<A
CLASS="indexterm"
NAME="AUTOID-2672"
></A
><A
CLASS="indexterm"
NAME="AUTOID-2674"
></A
>
for, or <EM
CLASS="emphasis"
>restrict</EM
>, an operation.  (In short: Nothing gets 
done in <KBD
CLASS="command"
>vi</KBD
> unless you tell it which
lines to work on, while sed will work on every line unless you tell it
not to.)  For instance, by supplying the address &quot;Sebastopol&quot; to the
previous substitute command, we can limit the replacement of &quot;CA&quot; by
&quot;California&quot; to just lines containing &quot;Sebastopol.&quot;</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>/Sebastopol/s/CA/California/g</PRE
></BLOCKQUOTE
><P
CLASS="para"
>An input line consisting of &quot;Sebastopol, CA&quot; would match the address
and the substitute command would be applied, changing it to
&quot;Sebastopol, California.&quot; A line consisting of &quot;San Francisco, CA&quot;
would not be matched and the substitution would not be applied.</P
><P
CLASS="para"
>A sed command can specify zero, one, or two addresses.  An address can
be a regular expression describing a pattern, a line number, or a
line addressing symbol.</P
><UL
CLASS="itemizedlist"
><LI
CLASS="listitem"
><P
CLASS="para"
>If no address is specified, then the command is applied to each line. </P
></LI
><LI
CLASS="listitem"
><P
CLASS="para"
>If there is only one address, the command is applied 
to any line matching the address. </P
></LI
><LI
CLASS="listitem"
><P
CLASS="para"
>If two comma-separated addresses are specified, the command is 
performed on the first line matching the first address
and all succeeding lines up 
to and including a line matching the second address. </P
></LI
><LI
CLASS="listitem"
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="AUTOID-2690"
></A
><A
CLASS="indexterm"
NAME="AUTOID-2692"
></A
>If an address is followed by an exclamation mark (<B
CLASS="emphasis.bold"
>!</B
>), the command
is applied to all lines that do <EM
CLASS="emphasis"
>not</EM
> match the address.</P
></LI
></UL
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="AUTOID-2697"
></A
>To illustrate how addressing works, let's look at examples using the
delete command, <KBD
CLASS="command"
>d</KBD
>.  A script consisting of simply
the <KBD
CLASS="command"
>d</KBD
> command and no address produces no output
since it deletes <EM
CLASS="emphasis"
>all</EM
> lines:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>When a line number is supplied as an address, the command affects only
that line.  For instance, the following example deletes only the first
line:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>1d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>The line number refers to an internal line count maintained by sed.
This counter is not reset for multiple input files.  Thus, no matter
how many files were specified as input, there is only one line 1 in
the input stream.</P
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="AUTOID-2707"
></A
><A
CLASS="indexterm"
NAME="AUTOID-2710"
></A
>Similarly, the input stream has only one last line.  It
can be specified using the addressing symbol <B
CLASS="emphasis.bold"
>$</B
>.  The following
example deletes the last line of input:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>The $ symbol should not be confused with the $ used
in regular expressions, which means the end of the line.</P
><P
CLASS="para"
>When a regular expression is supplied as an address, the command 
affects only the lines matching that pattern.
The regular expression must be enclosed by slashes (/). 
The following delete command</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>/^$/d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>deletes only blank lines.  All other lines are passed through
untouched.</P
><P
CLASS="para"
>If you supply two addresses, then you specify a range of lines over
which the command is executed.  The following example shows hows to
delete all lines blocked by a pair of macros, in this case, .TS
and .TE, that mark <KBD
CLASS="command"
>tbl</KBD
> input.</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>/^\.TS/,/^\.TE/d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>It deletes all lines beginning with the line matched by the first
pattern and up to and including the line matched by the second
pattern.  Lines outside this range are not affected.  The following
command deletes from line 50 to the last line in the file:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>50,$d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>You can mix a line address and a pattern address:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>1,/^$/d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>This example deletes from the first line up to the first blank line,
which, for instance, will delete a mailer header from an Internet mail
message that you have saved in a file.</P
><P
CLASS="para"
>You can think of the first address as enabling the action and the
second address as disabling it.  Sed has no way of looking ahead to
determine if the second match will be made.  The action will be
applied to lines once the first match is made.  The command will be
applied to <EM
CLASS="emphasis"
>all</EM
> subsequent lines until the second
match is made.  In the previous example, if the file did not contain a
blank line, then all lines would be deleted.</P
><P
CLASS="para"
>An exclamation mark (!) following an address reverses the sense of the
match.  For instance, the following script deletes all lines
<EM
CLASS="emphasis"
>except</EM
> those inside <KBD
CLASS="command"
>tbl</KBD
> input:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>/^\.TS/,/^\.TE/!d</PRE
></BLOCKQUOTE
><P
CLASS="para"
>This script, in effect, extracts <KBD
CLASS="command"
>tbl</KBD
> input from a source file.</P
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="SEDAWK-CH-4-SECT-2.1"
>4.2.1 Grouping Commands</A
></H3
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="AUTOID-2738"
></A
><A
CLASS="indexterm"
NAME="AUTOID-2741"
></A
><A
CLASS="indexterm"
NAME="AUTOID-2744"
></A
><A
CLASS="indexterm"
NAME="AUTOID-2746"
></A
>Braces ({}) are used in sed to nest one
address inside another or to apply multiple commands at the same
address.  You can nest addresses if you want to specify a range of
lines and then, within that range, specify another address.  For
example, to delete blank lines only inside blocks of
<KBD
CLASS="command"
>tbl</KBD
> input, use the following command:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>/^\.TS/,/^\.TE/{
      /^$/d
}</PRE
></BLOCKQUOTE
><P
CLASS="para"
>The opening curly brace must end a line and the closing curly brace
must be on a line by itself.  Be sure there are no spaces after
the braces.</P
><P
CLASS="para"
>You can apply multiple commands to the same range of lines
by enclosing the editing commands within braces, as shown below.</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>/^\.TS/,/^\.TE/{
	/^$/d
  	s/^\.ps 10/.ps 8/
  	s/^\.vs 12/.vs 10/
}</PRE
></BLOCKQUOTE
><P
CLASS="para"
>This example not only deletes blank lines in <KBD
CLASS="command"
>tbl</KBD
>
input but it also uses the substitute command, <KBD
CLASS="command"
>s</KBD
>,
to change several <KBD
CLASS="command"
>troff</KBD
> requests.  These commands
are applied only to lines within the .TS/.TE block.</P
></DIV
><A
CLASS="indexterm"
NAME="AUTOID-2758"
></A
><A
CLASS="indexterm"
NAME="AUTOID-2759"
></A
></DIV
><DIV
CLASS="htmlnav"
><P
></P
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch04_01.htm"
TITLE="4.1 Applying Commands in a Script"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 4.1 Applying Commands in a Script"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="book"
HREF="index.htm"
TITLE="sed &amp; awk"
><IMG
SRC="../gifs/txthome.gif"
ALT="sed &amp; awk"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch04_03.htm"
TITLE="4.3 Testing and Saving Output"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 4.3 Testing and Saving Output"
BORDER="0"></A
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
>4.1 Applying Commands in a Script</TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="index"
HREF="index/idx_0.htm"
TITLE="Book Index"
><IMG
SRC="../gifs/index.gif"
ALT="Book Index"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>4.3 Testing and Saving Output</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><IMG
SRC="../gifs/smnavbar.gif"
USEMAP="#map"
BORDER="0"
ALT="The UNIX CD Bookshelf Navigation"><MAP
NAME="map"
><AREA
SHAPE="RECT"
COORDS="0,0,73,21"
HREF="../index.htm"
ALT="The UNIX CD Bookshelf"><AREA
SHAPE="RECT"
COORDS="74,0,163,21"
HREF="../upt/index.htm"
ALT="UNIX Power Tools"><AREA
SHAPE="RECT"
COORDS="164,0,257,21"
HREF="../unixnut/index.htm"
ALT="UNIX in a Nutshell"><AREA
SHAPE="RECT"
COORDS="258,0,321,21"
HREF="../vi/index.htm"
ALT="Learning the vi Editor"><AREA
SHAPE="RECT"
COORDS="322,0,378,21"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="379,0,438,21"
HREF="../ksh/index.htm"
ALT="Learning the Korn Shell"><AREA
SHAPE="RECT"
COORDS="439,0,514,21"
HREF="../lrnunix/index.htm"
ALT="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
