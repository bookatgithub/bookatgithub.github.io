<HTML
><HEAD
>
<TITLE>[Chapter 5] 5.6 List</TITLE>
<META
NAME="DC.title"
CONTENT="sed &amp; awk"><META
NAME="DC.creator"
CONTENT="Dale Dougherty &amp; Arnold Robbins"><META
NAME="DC.publisher"
CONTENT="O'Reilly &amp; Associates, Inc."><META
NAME="DC.date"
CONTENT="1998-08-03T20:54:07Z"><META
NAME="DC.type"
CONTENT="Text.Monograph"><META
NAME="DC.format"
CONTENT="text/html"
SCHEME="MIME"><META
NAME="DC.source"
CONTENT="1-56592-225-5"
SCHEME="ISBN"><META
NAME="DC.language"
CONTENT="en-US"><META
NAME="generator"
CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINK
REV="made"
HREF="mailto:online-books@oreilly.com"
TITLE="Online Books Comments"><LINK
REL="up"
HREF="ch05_01.htm"
TITLE="5. Basic sed Commands"><LINK
REL="prev"
HREF="ch05_05.htm"
TITLE="5.5 Append, Insert, and Change"><LINK
REL="next"
HREF="ch05_07.htm"
TITLE="5.7 Transform"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="htmlnav"
><H1
><IMG
SRC="gifs/smbanner.gif"
ALT="sed &amp; awk"
USEMAP="#srchmap"
BORDER="0"></H1
><MAP
NAME="srchmap"
><AREA
SHAPE="RECT"
COORDS="0,0,466,65"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="467,0,514,18"
HREF="../search/ssrch.htm"
ALT="Search this book"></MAP
><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch05_05.htm"
TITLE="5.5 Append, Insert, and Change"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 5.5 Append, Insert, and Change"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><B
><FONT
FACE="ARIEL,HELVETICA,HELV,SANSERIF"
SIZE="-1"
>Chapter 5<BR>Basic sed Commands</FONT
></B
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch05_07.htm"
TITLE="5.7 Transform"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 5.7 Transform"
BORDER="0"></A
></TD
></TR
></TABLE
>&nbsp;<HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="sect1"
><A
CLASS="title"
NAME="SEDAWK-CH-5-SECT-6"
>5.6 List</A
></H2
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="CH05.LIST"
></A
><A
CLASS="indexterm"
NAME="AUTOID-3638"
></A
><A
CLASS="indexterm"
NAME="AUTOID-3641"
></A
><A
CLASS="indexterm"
NAME="AUTOID-3645"
></A
>The list command (<KBD
CLASS="command"
>l</KBD
>) displays the contents of the
pattern space, showing non-printing characters as two-digit ASCII
codes.  It is similar in function to the list (:l) command in
<KBD
CLASS="command"
>vi</KBD
>.  You can use this command to detect &quot;invisible&quot;
characters in the input.[6]</P
><BLOCKQUOTE
CLASS="footnote"
><P
CLASS="para"
>[6]  
GNU sed displays certain characters, such as carriage return, using
the ANSI C escape sequences, instead of straight octal.  Presumably,
this is easier to comprehend for those who are familiar with C (or
awk, as we'll see later in the book).  </P
></BLOCKQUOTE
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>cat test/spchar</B
></CODE
>
Here is a string of special characters: ^A  ^B
^M ^G</PRE
></BLOCKQUOTE
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>sed -n -e &quot;l&quot; test/spchar</B
></CODE
>
Here is a string of special characters: \01 \02 
\15 \07</PRE
></BLOCKQUOTE
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
># test with GNU sed too</B
></CODE
>
$ <CODE
CLASS="userinput"
><B
>gsed -n -e &quot;l&quot; test/spchar</B
></CODE
>
Here is a string of special characters: \01  \02
\r \a</PRE
></BLOCKQUOTE
><P
CLASS="para"
>Because the list command causes immediate output, we suppress the
default output or we would get duplicate copies of the lines.</P
><P
CLASS="para"
>You cannot match a character by ASCII value (nor can you match octal
values) in sed.[7]
Instead, you have to find a key combination in <KBD
CLASS="command"
>vi</KBD
>
to produce it.  Use CTRL-V to quote the character.
For instance, you can match an ESC character
(^[).  Look at the following script:<A
CLASS="indexterm"
NAME="AUTOID-3663"
></A
><A
CLASS="indexterm"
NAME="AUTOID-3665"
></A
></P
><BLOCKQUOTE
CLASS="footnote"
><P
CLASS="para"
>[7] You can do this in awk, however.</P
></BLOCKQUOTE
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
># list line and replace ^[ with &quot;Escape&quot;
l
s/^[/Escape/</PRE
></BLOCKQUOTE
><P
CLASS="para"
>Here's a one-line test file:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>The Great ^[ is a movie starring Steve McQueen.</PRE
></BLOCKQUOTE
><P
CLASS="para"
>Running the script produces the following output:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>The Great \33 is a movie starring Steve McQueen.
The Great Escape is a movie starring Steve McQueen.</PRE
></BLOCKQUOTE
><P
CLASS="para"
>GNU sed produces this:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>The Great \1b is a movie starring Steve McQueen.
The Great Escape is a movie starring Steve McQueen.</PRE
></BLOCKQUOTE
><P
CLASS="para"
>The ^[ character was made in <KBD
CLASS="command"
>vi</KBD
> by entering
CTRL-V, then pressing the ESC key.</P
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="SEDAWK-CH-5-SECT-6.1"
>5.6.1 Stripping Out Non-Printable Characters from nroff Files</A
></H3
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="CH05.NROFF1"
></A
><A
CLASS="indexterm"
NAME="CH05.NROFF2"
></A
><A
CLASS="indexterm"
NAME="CH05.NROFF3"
></A
>The UNIX formatter <KBD
CLASS="command"
>nroff</KBD
> produces output for line
printers and CRT displays.  To achieve such special effects as
bolding, it outputs the character followed by a backspace and then
outputs the same character again.  A sample of it viewed with a text
editor might look like:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>N^HN^HN^HNA^HA^HA^HAM^HM^HM^HME^HE^HE^HE</PRE
></BLOCKQUOTE
><P
CLASS="para"
>which bolds the word &quot;NAME.&quot;  There are three overstrikes for each
character output.  Similarly, underlining is achieved by outputting an
underscore, a backspace and then the character to be underlined.  The
following example is the word &quot;file&quot; surrounded by a sequence for
underscoring it.</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>_^Hf_^Hi_^Hl_^He</PRE
></BLOCKQUOTE
><P
CLASS="para"
>It might be necessary at times to strip these printing
&quot;special-effects&quot;; perhaps if you are given this type of output as a
source file.  The following line removes the sequences for emboldening
and underscoring:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>s/.^H//g</PRE
></BLOCKQUOTE
><P
CLASS="para"
>It removes any character preceding the backspace along with the
backspace itself.  In the case of underlining, &quot;.&quot; matches the
underscore; for emboldening, it matches the overstrike character.
Because it is applied repeatedly, multiple occurrences of the
overstrike character are removed, leaving a single character for each
sequence.  Note that <KBD
CLASS="command"
>^H</KBD
> is entered in
<KBD
CLASS="command"
>vi</KBD
> by pressing CTRL-V followed by
CTRL-H.</P
><P
CLASS="para"
>A sample application is &quot;de-formatting&quot; an nroff-produced
<KBD
CLASS="command"
>man</KBD
> page found on an older System V
UNIX system.[8]
If you should want to
access the formatted pages with a text editor, you'd want to get a
clean version.  (In many ways, this is a similar problem to one we
solved in converting a word processing file in the previous chapter.)
A formatted <KBD
CLASS="command"
>man</KBD
> page captured in a file looks like
this:</P
><BLOCKQUOTE
CLASS="footnote"
><P
CLASS="para"
>[8] For a while, many System V UNIX
vendors only provided preformatted
manpages.  This allowed the <KBD
CLASS="command"
>man</KBD
> command to show
information quickly, instead of having to format it, but the lack of
<KBD
CLASS="command"
>troff</KBD
> source to the manpages made it difficult to
fix documentation errors.  Fortunately, most vendors of modern UNIX
systems supply source for their manuals.  </P
></BLOCKQUOTE
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>^[9     who(1)                                             who(1)
^[9 N^HN^HN^HNA^HA^HA^HAM^HM^HM^HME^HE^HE^HE
      who - who is on the system?
  S^HS^HS^HSY^HY^HY^HYN^HN^HN^HNO^HO^HO^HOP^HP^HP^HPS^HS^HS^HSI^HI
      who [-a] [-b] [-d] [-H] [-l] [-p] [-q] [-r] [-s] [-t] [-T]
      [-u] [_^Hf_^Hi_^Hl_^He]
          who am i
          who am I
  D^HD^HD^HDE^HE^HE^HES^HS^HS^HSC^HC^HC^HCR^HR^HR^HRI^HI^HI^HIP^HP
      who can list the user's name, terminal line, login time,
      elapsed time since activity occurred on the line, and the
...</PRE
></BLOCKQUOTE
><P
CLASS="para"
>In addition to stripping out the bolding and underlining
sequences, there are strange escape sequences that produce form feeds
or various other printer functions.  You can see the sequence
&quot;^[9&quot; at the top of the formatted manpage.  This escape
sequence can simply be removed:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>s/^[9//g</PRE
></BLOCKQUOTE
><P
CLASS="para"
>Once again, the ESC character is entered in
<KBD
CLASS="command"
>vi</KBD
> by typing CTRL-V followed by
pressing the ESC key.  The number 9 is literal.
There are also what look to be leading spaces that supply the left
margin and indentation.  On further examination, it turns out that
leading spaces precede the heading such as &quot;NAME&quot; but a single tab
precedes each line of text.  Also, there are tabs that unexpectedly
appear in the text, which have to do with how <KBD
CLASS="command"
>nroff</KBD
>
optimizes for display on a CRT screen.</P
><P
CLASS="para"
>To eliminate the left margin and the unwanted tabs, we add two
commands to our previous two:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
># sedman -- deformat nroff-formatted manpage
s/.^H//g
s/^[9//g
s/^[<IMG
SRC="../chars/squ.gif"
ALT=" "><IMG
SRC="../chars/bull.gif"
ALT="&#183;">]*//g
s/<IMG
SRC="../chars/bull.gif"
ALT="&#183;">/ /g</PRE
></BLOCKQUOTE
><P
CLASS="para"
>The third command looks for any number of tabs or spaces at the
beginning of a line.  (A tab is represented by &quot;<IMG
SRC="../chars/bull.gif"
ALT="&#183;">&quot; and a space by
&quot;<IMG
SRC="../chars/squ.gif"
ALT=" ">&quot;.) The last command looks for a tab and replaces it
with a single space.  Running this script on our sample
<KBD
CLASS="command"
>man</KBD
> page output produces a file that looks like
this:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>who(1)                                                     who(1)
NAME
who - who is on the system?
SYNOPSIS
who [-a] [-b] [-d] [-H] [-l] [-p] [-q] [-r] [-s] [-t] [-T]
[-u] [file]
who am i
who am I
DESCRIPTION
who can list the user's name, terminal line, login time,
elapsed time since activity occurred on the line, and the
...</PRE
></BLOCKQUOTE
><P
CLASS="para"
>This script does not eliminate the unnecessary blank lines
caused by paging.  We will look at how to do that in the next
chapter, as it requires a multiline operation.  </P
><A
CLASS="indexterm"
NAME="AUTOID-3714"
></A
><A
CLASS="indexterm"
NAME="AUTOID-3715"
></A
><A
CLASS="indexterm"
NAME="AUTOID-3716"
></A
></DIV
><A
CLASS="indexterm"
NAME="AUTOID-3717"
></A
></DIV
><DIV
CLASS="htmlnav"
><P
></P
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch05_05.htm"
TITLE="5.5 Append, Insert, and Change"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 5.5 Append, Insert, and Change"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="book"
HREF="index.htm"
TITLE="sed &amp; awk"
><IMG
SRC="../gifs/txthome.gif"
ALT="sed &amp; awk"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch05_07.htm"
TITLE="5.7 Transform"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 5.7 Transform"
BORDER="0"></A
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
>5.5 Append, Insert, and Change</TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="index"
HREF="index/idx_0.htm"
TITLE="Book Index"
><IMG
SRC="../gifs/index.gif"
ALT="Book Index"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>5.7 Transform</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><IMG
SRC="../gifs/smnavbar.gif"
USEMAP="#map"
BORDER="0"
ALT="The UNIX CD Bookshelf Navigation"><MAP
NAME="map"
><AREA
SHAPE="RECT"
COORDS="0,0,73,21"
HREF="../index.htm"
ALT="The UNIX CD Bookshelf"><AREA
SHAPE="RECT"
COORDS="74,0,163,21"
HREF="../upt/index.htm"
ALT="UNIX Power Tools"><AREA
SHAPE="RECT"
COORDS="164,0,257,21"
HREF="../unixnut/index.htm"
ALT="UNIX in a Nutshell"><AREA
SHAPE="RECT"
COORDS="258,0,321,21"
HREF="../vi/index.htm"
ALT="Learning the vi Editor"><AREA
SHAPE="RECT"
COORDS="322,0,378,21"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="379,0,438,21"
HREF="../ksh/index.htm"
ALT="Learning the Korn Shell"><AREA
SHAPE="RECT"
COORDS="439,0,514,21"
HREF="../lrnunix/index.htm"
ALT="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
