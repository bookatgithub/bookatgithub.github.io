<HTML
><HEAD
>
<TITLE>[Chapter 7] 7.11 Information Retrieval</TITLE>
<META
NAME="DC.title"
CONTENT="sed &amp; awk"><META
NAME="DC.creator"
CONTENT="Dale Dougherty &amp; Arnold Robbins"><META
NAME="DC.publisher"
CONTENT="O'Reilly &amp; Associates, Inc."><META
NAME="DC.date"
CONTENT="1998-08-03T20:58:15Z"><META
NAME="DC.type"
CONTENT="Text.Monograph"><META
NAME="DC.format"
CONTENT="text/html"
SCHEME="MIME"><META
NAME="DC.source"
CONTENT="1-56592-225-5"
SCHEME="ISBN"><META
NAME="DC.language"
CONTENT="en-US"><META
NAME="generator"
CONTENT="Jade 1.1/O'Reilly DocBook 3.0 to HTML 4.0"><LINK
REV="made"
HREF="mailto:online-books@oreilly.com"
TITLE="Online Books Comments"><LINK
REL="up"
HREF="ch07_01.htm"
TITLE="7. Writing Scripts for awk"><LINK
REL="prev"
HREF="ch07_10.htm"
TITLE="7.10 Passing Parameters Into a Script"><LINK
REL="next"
HREF="ch08_01.htm"
TITLE="8. Conditionals, Loops, and Arrays"></HEAD
><BODY
BGCOLOR="#FFFFFF"
TEXT="#000000"
><DIV
CLASS="htmlnav"
><H1
><IMG
SRC="gifs/smbanner.gif"
ALT="sed &amp; awk"
USEMAP="#srchmap"
BORDER="0"></H1
><MAP
NAME="srchmap"
><AREA
SHAPE="RECT"
COORDS="0,0,466,65"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="467,0,514,18"
HREF="../search/ssrch.htm"
ALT="Search this book"></MAP
><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch07_10.htm"
TITLE="7.10 Passing Parameters Into a Script"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 7.10 Passing Parameters Into a Script"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><B
><FONT
FACE="ARIEL,HELVETICA,HELV,SANSERIF"
SIZE="-1"
>Chapter 7<BR>Writing Scripts for awk</FONT
></B
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="CHAPTER"
HREF="ch08_01.htm"
TITLE="8. Conditionals, Loops, and Arrays"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 8. Conditionals, Loops, and Arrays"
BORDER="0"></A
></TD
></TR
></TABLE
>&nbsp;<HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="sect1"
><A
CLASS="title"
NAME="SEDAWK-CH-7-SECT-11"
>7.11 Information Retrieval</A
></H2
><P
CLASS="para"
><A
CLASS="indexterm"
NAME="CH07.FILE3"
></A
><A
CLASS="indexterm"
NAME="CH07.FILE4"
></A
>An awk program can be used to retrieve information from
a database, the database basically being any kind of 
text file.  The more structured the text file,
the easier it is to work with, although the structure might be
no more than a line consisting of individual words.</P
><P
CLASS="para"
>The list of acronyms below is a simple database.</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>cat acronyms</B
></CODE
>
BASIC	Beginner's All-Purpose Symbolic Instruction Code
CICS	Customer Information Control System
COBOL	Common Business Oriented Language
DBMS	Data Base Management System
GIGO	Garbage In, Garbage Out
GIRL 	Generalized Information Retrieval Language</PRE
></BLOCKQUOTE
><P
CLASS="para"
>A tab is used as the field separator.
We're going to look at a program
that takes an acronym as input and displays
the appropriate line from the database as output.
(In the next chapter, we're going to 
look at two other programs that use
the acronym database.
One program reads the list of acronyms
and then finds occurrences of these acronyms in another file. 
The other program locates the first occurrence of
these acronyms in a text file and inserts the description
of the acronym.) </P
><P
CLASS="para"
>The shell script that we develop is named <KBD
CLASS="command"
>acro</KBD
>.
It takes the first 
argument from the command line (the name of the acronym) 
and passes it to the awk script.
The <KBD
CLASS="command"
>acro</KBD
> script follows: </P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>cat acro</B
></CODE
>
#! /bin/sh
# assign shell's $1 to awk search variable
awk '$1 == search' search=$1 acronyms</PRE
></BLOCKQUOTE
><P
CLASS="para"
>The first argument specified on the shell command line ($1) is assigned to
the variable named <B
CLASS="emphasis.bold"
>search</B
>; this variable is
passed as a parameter into the awk program. 
Parameters passed to an awk program 
are specified <EM
CLASS="emphasis"
>after</EM
> the script section. 
(This gets somewhat confusing, because <B
CLASS="emphasis.bold"
>$1</B
> inside the awk
program represents the first field of each input line, 
while <B
CLASS="emphasis.bold"
>$1</B
> in the shell represents the first argument supplied
on the command line.)</P
><P
CLASS="para"
>The example below demonstrates how this program can be used
to find a particular acronym on our list.</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>acro CICS</B
></CODE
>
CICS Customer Information Control System</PRE
></BLOCKQUOTE
><P
CLASS="para"
>Notice that we tested the parameter as a string (<B
CLASS="emphasis.bold"
>$1 == search</B
>).
We could also have written this as a regular expression match
(<B
CLASS="emphasis.bold"
>$1 ~ search</B
>).</P
><DIV
CLASS="sect2"
><H3
CLASS="sect2"
><A
CLASS="title"
NAME="SEDAWK-CH-7-SECT-11.1"
>7.11.1 Finding a Glitch</A
></H3
><P
CLASS="para"
>A net posting was once forwarded to one of us because it contained
a problem that could be solved using awk.
Here's the original posting by Emmett Hogan:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>I have been trying to rewrite a sed/tr/fgrep script that we use quite
a bit here in Perl, but have thus far been unsuccessful...hence this
posting.  Having never written anything in perl, and not wishing to
wait for the Nutshell Perl Book, I figured I'd tap the knowledge of this
group.

Basically, we have several files which have the format:

item	info line 1
	info line 2
	  .
	  .
	  .
	info line n

Where each info line refers to the item and is indented by either
spaces or tabs.  Each item &quot;block&quot; is separated by a blank line.

What I need to do, is to be able to type:

info glitch filename

Where info is the name of the perl script, glitch is what I want to
find out about, and filename is the name of the file with the
information in it.  The catch is that I need it to print the entire
&quot;block&quot; if it finds glitch anywhere in the file, i.e.:

machine		Sun 3/75
		8 meg memory
		Prone to memory glitches
		more info
		more info

would get printed if you looked for &quot;glitch&quot; along with any other
&quot;blocks&quot; which contained the word glitch.

Currently we are using the following script:

#!/bin/csh -f
#
sed '/^ /\!s/^/@/' $2 | tr '\012@' '@\012' | fgrep -i $1 | tr '@' '\012'

Which is in a word....SLOW.

I am sure Perl can do it faster, better, etc...but I cannot figure it out.

Any, and all, help is greatly appreciated.

Thanks in advance,
Emmett

-------------------------------------------------------------------
Emmett Hogan              Computer Science Lab, SRI International</PRE
></BLOCKQUOTE
><P
CLASS="para"
>The problem yielded a solution based on awk.  You may want to try to
tackle the problem yourself before reading any further.  The solution
relies on awk's multiline record capability and requires that you be
able to pass the search string as a command-line parameter.</P
><P
CLASS="para"
>Here's the <KBD
CLASS="command"
>info</KBD
> script using awk:</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>awk 'BEGIN { FS = &quot;\n&quot;; RS = &quot;&quot; }
$0 ~ search { print $0 }' search=$1 $2</PRE
></BLOCKQUOTE
><P
CLASS="para"
>Given a test file with multiple entries, <KBD
CLASS="command"
>info</KBD
> was tested
to see if it could find the word &quot;glitch.&quot;</P
><BLOCKQUOTE
CLASS="screen"
><PRE
CLASS="screen"
>$ <CODE
CLASS="userinput"
><B
>info glitch glitch.test</B
></CODE
>
machine		Sun 3/75
		8 meg memory
		Prone to memory glitches
		more info
		more info</PRE
></BLOCKQUOTE
><P
CLASS="para"
>In the next chapter, we look at conditional and looping
constructs, and arrays.</P
></DIV
><A
CLASS="indexterm"
NAME="AUTOID-6277"
></A
><A
CLASS="indexterm"
NAME="AUTOID-6278"
></A
></DIV
><DIV
CLASS="htmlnav"
><P
></P
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><TABLE
WIDTH="515"
BORDER="0"
CELLSPACING="0"
CELLPADDING="0"
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="SECT1"
HREF="ch07_10.htm"
TITLE="7.10 Passing Parameters Into a Script"
><IMG
SRC="../gifs/txtpreva.gif"
ALT="Previous: 7.10 Passing Parameters Into a Script"
BORDER="0"></A
></TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="book"
HREF="index.htm"
TITLE="sed &amp; awk"
><IMG
SRC="../gifs/txthome.gif"
ALT="sed &amp; awk"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
><A
CLASS="CHAPTER"
HREF="ch08_01.htm"
TITLE="8. Conditionals, Loops, and Arrays"
><IMG
SRC="../gifs/txtnexta.gif"
ALT="Next: 8. Conditionals, Loops, and Arrays"
BORDER="0"></A
></TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="TOP"
WIDTH="172"
>7.10 Passing Parameters Into a Script</TD
><TD
ALIGN="CENTER"
VALIGN="TOP"
WIDTH="171"
><A
CLASS="index"
HREF="index/idx_0.htm"
TITLE="Book Index"
><IMG
SRC="../gifs/index.gif"
ALT="Book Index"
BORDER="0"></A
></TD
><TD
ALIGN="RIGHT"
VALIGN="TOP"
WIDTH="172"
>8. Conditionals, Loops, and Arrays</TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="515"
TITLE="footer"><IMG
SRC="../gifs/smnavbar.gif"
USEMAP="#map"
BORDER="0"
ALT="The UNIX CD Bookshelf Navigation"><MAP
NAME="map"
><AREA
SHAPE="RECT"
COORDS="0,0,73,21"
HREF="../index.htm"
ALT="The UNIX CD Bookshelf"><AREA
SHAPE="RECT"
COORDS="74,0,163,21"
HREF="../upt/index.htm"
ALT="UNIX Power Tools"><AREA
SHAPE="RECT"
COORDS="164,0,257,21"
HREF="../unixnut/index.htm"
ALT="UNIX in a Nutshell"><AREA
SHAPE="RECT"
COORDS="258,0,321,21"
HREF="../vi/index.htm"
ALT="Learning the vi Editor"><AREA
SHAPE="RECT"
COORDS="322,0,378,21"
HREF="index.htm"
ALT="sed &amp; awk"><AREA
SHAPE="RECT"
COORDS="379,0,438,21"
HREF="../ksh/index.htm"
ALT="Learning the Korn Shell"><AREA
SHAPE="RECT"
COORDS="439,0,514,21"
HREF="../lrnunix/index.htm"
ALT="Learning the UNIX Operating System"></MAP
></DIV
></BODY
></HTML
>
