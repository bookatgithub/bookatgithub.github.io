<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>D.4 FreeBSD</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="squid-APP-D-SECT-3.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="squid-APP-D-SECT-5.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="squid-APP-D-SECT-4"></A>
<H3 class="docSection1Title">D.4 FreeBSD</H3>

<P class="docText">FreeBSD is another
<A NAME="squid-APP-D-ITERM-2422"></A><A NAME="squid-APP-D-ITERM-2423"></A><A NAME="squid-APP-D-ITERM-2424"></A>popular
Squid platform, and my personal favorite. <A class="docLink" HREF="#squid-APP-D-TABLE-2">Table D-2</A> and <A class="docLink" HREF="#squid-APP-D-FIG-2">Figure D-2</A> summarize the
results for FreeBSD. Again, <span class="docEmphasis">coss</span> exhibits the
highest throughput, followed by <span class="docEmphasis">diskd</span>. The
<span class="docEmphasis">aufs</span> storage scheme doesn't
currently run on FreeBSD. These results come from FreeBSD Version
4.8-STABLE (released April 3, 2003). I built a kernel with the
following noteworthy options:</P>

<PRE>options         MSGMNB=16384
options         MSGMNI=41
options         MSGSEG=2049
options         MSGSSZ=64
options         MSGTQL=512
options         SHMSEG=16
options         SHMMNI=32
options         SHMMAX=2097152
options         SHMALL=4096
options         MAXFILES=8192
options         NMBCLUSTERS=32768
options         VFS_AIO</PRE>

<A NAME="squid-APP-D-TABLE-2"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table D-2. FreeBSD benchmarking results</h5></CAPTION><COLGROUP span="6"><THEAD><TR><TH class="docTableHeader">
<P class="docText">Storage scheme</P>
</TH><TH class="docTableHeader">
<P class="docText">Filesystem</P>
</TH><TH class="docTableHeader">
<P class="docText">Mount options</P>
</TH><TH class="docTableHeader">
<P class="docText">Throughput</P>
</TH><TH class="docTableHeader">
<P class="docText">Response time</P>
</TH><TH class="docTableHeader">
<P class="docText">Hit ratio</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">coss</span></P>
</TD><TD class="docTableCell">&nbsp;</TD><TD class="docTableCell">&nbsp;</TD><TD class="docTableCell">
<P class="docText">330.7</P>
</TD><TD class="docTableCell">
<P class="docText">1.58</P>
</TD><TD class="docTableCell">
<P class="docText">54.5</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">diskd(1)</span></P>
</TD><TD class="docTableCell">
<P class="docText">UFS</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>async</TT>, <TT>noatime</TT>,
<TT>softupdate</TT></P>
</TD><TD class="docTableCell">
<P class="docText">129.0</P>
</TD><TD class="docTableCell">
<P class="docText">1.58</P>
</TD><TD class="docTableCell">
<P class="docText">54.1</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">diskd(2)</span></P>
</TD><TD class="docTableCell">
<P class="docText">UFS</P>
</TD><TD class="docTableCell">&nbsp;</TD><TD class="docTableCell">
<P class="docText">77.4</P>
</TD><TD class="docTableCell">
<P class="docText">1.47</P>
</TD><TD class="docTableCell">
<P class="docText">56.2</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">ufs(1)</span></P>
</TD><TD class="docTableCell">
<P class="docText">UFS</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>async</TT>, <TT>noatime</TT>,
<TT>softupdate</TT></P>
</TD><TD class="docTableCell">
<P class="docText">38.0</P>
</TD><TD class="docTableCell">
<P class="docText">1.49</P>
</TD><TD class="docTableCell">
<P class="docText">56.8</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">ufs(2)</span></P>
</TD><TD class="docTableCell">
<P class="docText">UFS</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>noatime</TT></P>
</TD><TD class="docTableCell">
<P class="docText">31.1</P>
</TD><TD class="docTableCell">
<P class="docText">1.54</P>
</TD><TD class="docTableCell">
<P class="docText">55.0</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">ufs(3)</span></P>
</TD><TD class="docTableCell">
<P class="docText">UFS</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>async</TT></P>
</TD><TD class="docTableCell">
<P class="docText">30.2</P>
</TD><TD class="docTableCell">
<P class="docText">1.51</P>
</TD><TD class="docTableCell">
<P class="docText">55.9</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">ufs(4)</span></P>
</TD><TD class="docTableCell">
<P class="docText">UFS</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>softupdate</TT></P>
</TD><TD class="docTableCell">
<P class="docText">29.9</P>
</TD><TD class="docTableCell">
<P class="docText">1.51</P>
</TD><TD class="docTableCell">
<P class="docText">55.7</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText"><span class="docEmphasis">ufs(5)</span></P>
</TD><TD class="docTableCell">
<P class="docText">UFS</P>
</TD><TD class="docTableCell">&nbsp;</TD><TD class="docTableCell">
<P class="docText">24.4</P>
</TD><TD class="docTableCell">
<P class="docText">1.50</P>
</TD><TD class="docTableCell">
<P class="docText">56.4</P>
</TD></TR></COLGROUP></TABLE></P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="squid-APP-D-FIG-2"></A>Figure D-2. FreeBSD filesystem benchmarking traces</H5>
<IMG BORDER="0" WIDTH="484" HEIGHT="345" SRC="images/0596001622/figs/SQ_ad02.gif" ALT="figs/SQ_ad02.gif"></CENTER>

<P class="docText">Enabling the <TT>async</TT>, <TT>noatime</TT>,
and <TT>softupdate<sup class="docFootnote"><A class="docLink" HREF="#squid-APP-D-FNOTE-3">[3]</A></sup></TT> options boosts the standard
<span class="docEmphasis">ufs</span> performance from 24 to 38 transactions per
second. However, using one of the other storage schemes increases the
sustainable throughput even more.</P><blockquote><p class="docFootnote"><sup><A NAME="squid-APP-D-FNOTE-3">[3]</A></sup> On FreeBSD, softupdates
aren't a <I>mount</I> option, but must
be set with the <I>tunefs</I> command.</p></blockquote>

<P class="docText">FreeBSD's <span class="docEmphasis">diskd</span> performance
(129/sec) isn't quite as good as on Linux (169/sec),
perhaps because the underlying filesystem
(<span class="docEmphasis">ext2fs</span>) is better.</P>

<P class="docText">Note that the trace for <span class="docEmphasis">coss</span> is relatively flat.
Its performance doesn't change much over time.
Furthermore, both FreeBSD and Linux report similar throughput
numbers: 326/sec and 331/sec. This leads me to believe that the disk
system isn't a bottleneck in these tests. In fact,
the test with no disk cache (see <A class="docLink" HREF="squid-APP-D-SECT-8.html#squid-APP-D-SECT-8">Section D.8</A>) achieves essentially the
same throughput (332/sec).</P>


<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="squid-APP-D-SECT-3.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="squid-APP-D-SECT-5.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
