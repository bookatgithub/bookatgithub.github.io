<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>13.2 access.log</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="squid-CHP-13-SECT-1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="squid-CHP-13-SECT-3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="squid-CHP-13-SECT-2"></A>
<H3 class="docSection1Title">13.2 access.log</H3>

<P class="docText">Squid saves key information <A NAME="squid-CHP-13-ITERM-1842"></A><A NAME="squid-CHP-13-ITERM-1843"></A>about
HTTP transactions in <I>access.log</I>. This file is
line-based, such that each line corresponds to one client request.
Squid records the client IP address (or hostname), requested URI,
response size, and other information.</P>

<P class="docText">Squid records all HTTP accesses in <I>access.log</I>,
except for those that disconnect before sending any data. Squid also
records all ICP (but not HTCP) transactions unless you disable them
with the <span class="docEmphasis">log_icp_queries</span> directive. 
<A class="docLink" HREF="#squid-CHP-13-SECT-2.4">Section 13.2.4</A> describes the
other <I>squid.conf</I> directives that affect the
access log.</P>

<P class="docText">The default <I>access.log</I> format contains 10
fields. Here are some <A NAME="squid-CHP-13-ITERM-1844"></A><A NAME="squid-CHP-13-ITERM-1845"></A>examples,
with long lines split and indented:</P>

<PRE>1066037222.011  126389 9.121.105.207 TCP_MISS/503 1055
        GET http://home.gigigaga.com/n8342133/Miho.DAT.019 -
        DIRECT/203.187.1.180 -
1066037222.011   19120 12.83.179.11 TCP_MISS/200 359
        GET http://ads.x10.com/720x300/Z2FtZ3JlZXRpbmcxLmRhd/7/AMG -
        DIRECT/63.211.210.20 text/html
1066037222.011   34173 166.181.33.71 TCP_MISS/200 559
        GET http://coursesites.blackboard.com:8081/service/collab/../1010706448190/ -
        DIRECT/216.200.107.101 application/octet-stream
1066037222.011   19287 41.51.105.27 TCP_REFRESH_MISS/200 500
        GET http://fn.yam.com/include/tsemark/show.js -
        DIRECT/210.59.224.59 application/x-javascript
1066037222.011   19395 41.51.105.27 TCP_MISS/304 274
        GET http://fnasp.yam.com/image/coin3.gif -
        DIRECT/211.72.254.133 -
1066037222.011   19074 30.208.85.76 TCP_CLIENT_REFRESH_MISS/304 197
        GET http://ads.icq.com/content/B0/0/..bC6GygEYNeHGjBUin5Azfe68m5hD1jLk$/aol -
        DIRECT/64.12.184.121 -
1066037222.011   19048 12.83.179.11 TCP_MISS/200 261
        GET http://ads.adsag.com/js.ng/...ne&amp;cat=friendship&amp;subcat=girltalk -
        DIRECT/209.225.54.119 application/x-javascript
1066037222.118     106 41.51.105.27 TCP_HIT/200 536
        GET http://rcm-images.amazon.com/images/G/01/rcm/privacy.gif -
        NONE/- image/gif
1066037222.352   19475 27.34.49.248 TCP_MISS/200 12387
        GET http://espanol.geocities.com/lebastias/divulgacion/budismo-tarot.html -
        DIRECT/209.1.225.139 text/html
1066037222.352     132 144.157.100.17 TCP_MISS/504 1293
        GET http://ar.atwola.com/image/93101912/aol -
        NONE/- -</PRE>

<P class="docText">Here are the definitions for all fields:</P>

<A NAME="squid-CHP-13-ITERM-1846"></A><A NAME="squid-CHP-13-ITERM-1847"></A><A NAME="squid-CHP-13-ITERM-1848"></A><A NAME="squid-CHP-13-ITERM-1849"></A><A NAME="squid-CHP-13-ITERM-1850"></A><A NAME="squid-CHP-13-ITERM-1851"></A><A NAME="squid-CHP-13-ITERM-1852"></A><A NAME="squid-CHP-13-ITERM-1853"></A><A NAME="squid-CHP-13-ITERM-1854"></A><A NAME="squid-CHP-13-ITERM-1855"></A><A NAME="squid-CHP-13-ITERM-1856"></A><A NAME="squid-CHP-13-ITERM-1857"></A><DL class="docList"><br><p><DT><I><span class="docPubcolor">1: timestamp</span></I></DT></p>
<DD>
<P class="docList">The completion time of the request, expressed as the
<A NAME="squid-CHP-13-ITERM-1846"></A>number of
seconds since the Unix epoch (Thu Jan 1 00:00:00 UTC 1970), with
millisecond resolution. Squid uses this format, instead of something
more human-friendly, to simplify the work of various log file
processing programs.</P>

<P class="docList">You can use a simple Perl command to convert the Unix timestamps into
local time. For example:</P>

<PRE>perl -pe 's/^\d+\.\d+/localtime($&amp;)/e;' access.log</PRE>
</DD>
<br><p><DT><I><span class="docPubcolor">2: response time</span></I></DT></p>
<DD>
<P class="docList">For HTTP transactions, this field <A NAME="squid-CHP-13-ITERM-1847"></A>indicates how much time it
took to process the request. The timer starts when Squid receives the
HTTP request and stops when the response has been fully delivered.
The response time is given in milliseconds.</P>

<P class="docList">The response time is usually 0 for ICP queries. This is because Squid
answers ICP queries very quickly. Furthermore, Squid
doesn't update the process clock between receiving
an ICP query and sending the reply.</P>

<P class="docList">While time values are reported with millisecond resolution, the
precision of those entries is probably about 10 milliseconds. Timing
becomes even less precise when Squid is heavily loaded.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">3: client address</span></I></DT></p>
<DD>
<P class="docList">This field contains <A NAME="squid-CHP-13-ITERM-1848"></A>the
client's IP address, or hostname if you enable
<span class="docEmphasis">log_fqdn</span>. For security or privacy reasons, you
may want to mask a part of client's address out
using the <I>client_netmask</I> directive. However,
that also makes it impossible to group requests coming from the same
client.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">4: result/status codes</span></I></DT></p>
<DD>
<P class="docList">This field consists of two tokens <A NAME="squid-CHP-13-ITERM-1849"></A>separated by a slash.
The first token, result code, classifies the protocol and the result
of a transaction (e.g., <TT>TCP_HIT</TT> or
<TT>UDP_DENIED</TT>). These are Squid-specific codes,
defined in <A class="docLink" HREF="#squid-CHP-13-SECT-2.1">Section 13.2.1</A>. The codes that begin with
<TT>TCP_</TT> refer to HTTP requests, while
<TT>UDP_</TT> refers to ICP queries.</P>

<P class="docList">The second token is the HTTP response status code (e.g, 200, 304,
404, etc.). The status code normally comes from the origin server. In
some cases, however, Squid may be responsible for selecting the
status code. These codes, defined by the HTTP RFC, are summarized
later in <A class="docLink" HREF="#squid-CHP-13-TABLE-1">Table 13-1</A>.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">5: transfer size</span></I></DT></p>
<DD>
<P class="docList">This field indicates the <A NAME="squid-CHP-13-ITERM-1850"></A>number of bytes transferred to the
client. Strictly speaking, it is the number of bytes that Squid told
the TCP/IP stack to send to the client. Thus, it
doesn't include overheads from TCP/IP headers. Also
note that the transfer size is normally larger than the
response's <TT>Content-Length</TT>. This
value includes the HTTP response headers, while
<TT>Content-Length</TT> does not.</P>

<P class="docList">These properties make the transfer size field useful for approximate
bandwidth usage analysis but not for exact HTTP entity size
calculations. If you need to know a response's
<TT>Content-Length</TT>, you can find it in the
<I>store.log</I> file.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">6: request method</span></I></DT></p>
<DD>
<P class="docList">This field contains the <A NAME="squid-CHP-13-ITERM-1851"></A>request method. Because Squid clients
may use ICP or HTTP, the request method is either HTTP- or
ICP-specific. The most common HTTP request method is
<TT>GET</TT>. ICP queries are always logged with
<TT>ICP_QUERY</TT>. See <A class="docLink" HREF="squid-CHP-6-SECT-1.html#squid-CHP-6-SECT-1.2.8">Section 6.1.2.8</A> for a
list of HTTP methods Squid knows about.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">7: URI</span></I></DT></p>
<DD>
<P class="docList">This field contains the URI from <A NAME="squid-CHP-13-ITERM-1852"></A>the
client's request. The vast majority of logged URIs
are actually URLs (i.e., they have hostnames).</P>

<P class="docList">Squid uses a special format for certain failures. These are cases
when Squid can't parse the HTTP request or otherwise
determine the URI. Instead of a URI/URL, you'll see
a string such as
"error:invalid-request." For
example:</P>

<PRE>1066036250.603 310 192.0.34.70 NONE/400 1203 GET error:invalid-request - NONE/- -</PRE>

<P class="docList">Also in this field look out for whitespace characters in the URI.
Depending on your <span class="docEmphasis">uri_whitespace</span> setting, Squid
may print the URI in the log file with whitespace characters. When
this happens, the tools that read <I>access.log</I>
files may become confused by the extra fields.</P>

<P class="docList">When logging, Squid strips all URI characters after the first
question mark unless the <span class="docEmphasis">strip_query_terms</span>
directive is disabled.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">8: client identity</span></I></DT></p>
<DD>
<P class="docList">Squid can determine a <A NAME="squid-CHP-13-ITERM-1853"></A>user's identity in
two different ways. One is with the RFC 1413 ident protocol; the
other is from HTTP authentication headers.</P>

<P class="docList">Squid attempts ident lookups based on the
<span class="docEmphasis">ident_lookup_access</span> rules, if any (see <A class="docLink" HREF="squid-CHP-6-SECT-2.html#squid-CHP-6-SECT-2">Section 6.2</A>). Alternatively, if you use proxy
authentication (or regular server authentication in surrogate mode),
Squid places the given username in this field. If both methods
provide Squid with a username, and you're using the
native <I>access.log</I> format, the HTTP
authentication name is logged, and the RFC 1413 name is ignored. The
common log file format has separate fields for both names.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">9: peering code/peerhost</span></I></DT></p>
<DD>
<P class="docList">The peering information consists <A NAME="squid-CHP-13-ITERM-1854"></A>of two tokens,
separated by a slash. It is relevant only for requests that are cache
misses. The first token indicates how the next hop was chosen. The
second token is the address of that next hop. The peering codes are
listed in <A class="docLink" HREF="#squid-CHP-13-SECT-2.3">Section 13.2.3</A>.</P>

<P class="docList">When Squid sends a request to a neighbor cache, the peerhost address
is the neighbor's hostname. If the request is sent
directly to the origin server, however, Squid writes the origin
server's IP address or its hostname if
<span class="docEmphasis">log_ip_on_direct</span> is disabled. The value
<TT>NONE/-</TT> indicates that Squid
didn't forward this request to any other servers.</P>

</DD>
<br><p><DT><I><span class="docPubcolor">10: content type</span></I></DT></p>
<DD>
<P class="docList">The final field of the <A NAME="squid-CHP-13-ITERM-1855"></A>default, native
<I>access.log</I> is the content type of the HTTP
response. Squid obtains the content type value from the
response's <TT>Content-Type</TT> header.
If that header is missing, Squid uses a hyphen
(<TT>-</TT>).</P>

<P class="docList">If you enable the <span class="docEmphasis">log_mime_headers</span> directive,
Squid appends two additional fields to each line:</P>
</DD>
<br><p><DT><I><span class="docPubcolor">11: HTTP request headers</span></I></DT></p>
<DD>
<P class="docList">Squid encodes the HTTP request headers <A NAME="squid-CHP-13-ITERM-1856"></A>and prints
them between a pair of square brackets. The brackets are necessary
because Squid doesn't encode space characters. The
encoding scheme is a little strange. Carriage return (ASCII 13) and
newline (ASCII 10) are printed as <TT>\r</TT> and
<TT>\n</TT>, respectively. Other non-printable characters
are encoded with the RFC 1738 style, such that Tab (ASCII 9) becomes
<TT>%09</TT>.</P>
</DD>
<br><p><DT><I><span class="docPubcolor">12: HTTP response headers</span></I></DT></p>
<DD>
<P class="docList">Squid encodes the HTTP response <A NAME="squid-CHP-13-ITERM-1857"></A>headers and prints
them between a pair of square brackets. Note that these are the
headers sent to the client, which may be different from headers
received from the origin server.</P>
</DD>
</DL>

<P class="docText">Squid writes to <I>access.log</I> only after the entire
response has been sent to the client. This allows Squid to include
both request and response information in the log file. However,
transactions that take minutes, or even hours, to complete
aren't visible in <I>access.log</I> at
the time of the request. When these types of transactions present a
performance or policy concern, the <I>access.log</I>
may be unable help you. Instead, use the cache manager to view a list
of pending transactions (see <A class="docLink" HREF="squid-CHP-14-SECT-2.html#squid-CHP-14-SECT-2.1.37">Section 14.2.1.37</A>).</P>

<A NAME="squid-CHP-13-SECT-2.1"></A>
<H4 class="docSection2Title">13.2.1 access.log Result Codes</H4>

<P class="docText">The following labels may
<A NAME="squid-CHP-13-ITERM-1858"></A><A NAME="squid-CHP-13-ITERM-1859"></A>appear in the fourth field of the
<I>access.log</I> file in response to HTTP requests:</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a likely fresh copy of the requested resource and sent it
immediately to the client.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_MISS</span></span></span></DT></p>
<DD>
<P class="docList">Squid didn't have a cached copy of the requested
resource.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_REFRESH_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a likely stale copy of the requested resource and sent a
validation request to the origin server. The origin server sent a 304
(Not Modified) response, indicating that Squid's
copy is still fresh.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_REF_FAIL_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a likely stale copy of the requested resource and sent a
validation request to the origin server. However, the origin server
failed to respond or sent a response that Squid
didn't understand. In any case, Squid sent the
cached (and likely stale) copy to the client.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_REFRESH_MISS</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a likely stale copy of the requested resource and sent a
validation request to the origin server. The server responded with
new content, indicating the cached response was indeed stale.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_CLIENT_REFRESH_MISS</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a copy of the requested resource, but the
client's request included a
<TT>Cache-Control</TT>: <TT>no-cache</TT>
directive. Squid forwarded the client's request to
the origin server, forcing a cache validation.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_IMS_HIT</span></span></span></DT></p>
<DD>
<P class="docList">The client sent a validation request, and Squid found a more recent,
and likely fresh, copy of the requested resource. Squid sent the
newer content to the client, without contacting the origin server.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_SWAPFAIL_MISS</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a valid copy of the requested resource but failed to load
it from disk. Squid then sent the request to the origin server as
though it were a cache miss.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_NEGATIVE_HIT</span></span></span></DT></p>
<DD>
<P class="docList">When a request to an origin server results in an HTTP error, Squid
may cache the response anyway. Repeated requests for these resources,
within a short amount of time, result in negative hits. The
<span class="docEmphasis">negative_ttl</span> directive controls the amount of
time these errors may be cached. Also note that errors are cached
only in memory and never written to disk. The following HTTP status
codes may be negatively cached, subject to additional constraints:
204, 305, 400, 403, 404, 405, 414, 500, 501, 502, 503, 504.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_MEM_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a valid copy of the requested resource in the memory
cache and sent it immediately to the client. Note that this
doesn't accurately represent all responses served
from memory. For example, responses that are cached in memory, but
require validation, are logged with
<TT>TCP_REFRESH_HIT</TT>,
<TT>TCP_REFRESH_MISS</TT>, etc.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_DENIED</span></span></span></DT></p>
<DD>
<P class="docList">The client's request was denied, due to either the
<span class="docEmphasis">http_access</span> or
<span class="docEmphasis">http_reply_access</span> rules. Note that requests
denied by <span class="docEmphasis">http_access</span> have
<TT>NONE/-</TT> in the ninth field, whereas those denied by
<span class="docEmphasis">http_reply_access</span> have a valid entry.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_OFFLINE_HIT</span></span></span></DT></p>
<DD>
<P class="docList">When <I>offline_mode</I> is enabled, Squid returns
cache hits for almost any cached response, without considering its
freshness.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">TCP_REDIRECT</span></span></span></DT></p>
<DD>
<P class="docList">A redirector program told Squid to generate an HTTP redirect to a new
URI (see <A class="docLink" HREF="squid-CHP-11-SECT-1.html#squid-CHP-11-SECT-1">Section 11.1</A>). Normally, Squid
doesn't log these redirects. To do so, you must
manually define the <TT>LOG_TCP_REDIRECTS</TT> preprocessor
directive before compiling Squid.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">NONE</span></span></span></DT></p>
<DD>
<P class="docList">Unclassified result used for certain errors, such as invalid
hostnames.</P>
</DD>
</DL>

<P class="docText">The following labels may appear in the fourth field of the
<I>access.log</I> file in response to ICP queries:</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">UDP_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid found a likely fresh copy of the requested resource in the
cache.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">UDP_MISS</span></span></span></DT></p>
<DD>
<P class="docList">Squid didn't find a likely fresh copy of the
requested resource in the cache. If the same object is requested via
HTTP, it would probably be a cache miss. Compare with
<TT>UDP_MISS_NOFETCH</TT>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">UDP_MISS_NOFETCH</span></span></span></DT></p>
<DD>
<P class="docList">Like <TT>UDP_MISS</TT>, except that this also indicates
Squid's reluctance to handle the corresponding HTTP
request. If you use the <I>-Y</I> command-line option,
Squid returns this, instead of <TT>UDP_MISS</TT>, while
rebuilding its in-memory indexes at startup.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">UDP_DENIED</span></span></span></DT></p>
<DD>
<P class="docList">The ICP query is denied due to the <span class="docEmphasis">icp_access</span>
rules. If more than 95% of the ICP replies to a client are
<TT>UDP_DENIED</TT>, and the client database is enabled
(see <A class="docLink" HREF="appa-77572.html#appa-77572">Appendix A</A>), Squid stops sending any ICP
replies to the client for an hour. When this happens
you'll also see a warning in
<I>cache.log</I>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">UDP_INVALID</span></span></span></DT></p>
<DD>
<P class="docList">Squid received an invalid query (e.g., truncated message, invalid
protocol version, whitespace in the URI, etc.). Squid sent an
<TT>ICP_INVALID</TT> reply back to the client.</P>
</DD>
</DL>


<A NAME="squid-CHP-13-SECT-2.2"></A>
<H4 class="docSection2Title">13.2.2 HTTP Response Status Codes</H4>

<P class="docText"><A class="docLink" HREF="#squid-CHP-13-TABLE-1">Table 13-1</A> lists the numerical HTTP response
<A NAME="squid-CHP-13-ITERM-1860"></A><A NAME="squid-CHP-13-ITERM-1861"></A>codes and reason
phrases. Note that Squid and other HTTP agents care only about the
numeric value. The reason phrase is purely informational and
doesn't affect the meaning of the response. For each
status code, I also provide a reference to the particular section in
RFC 2616 that describes it. Note that status codes 0 and 600 are
nonstandard values used by Squid, and aren't
mentioned in the RFC.</P>

<A NAME="squid-CHP-13-TABLE-1"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 13-1. HTTP response status codes</h5></CAPTION><COLGROUP span="3"><THEAD><TR><TH class="docTableHeader">
<P class="docText">Code</P>
</TH><TH class="docTableHeader">
<P class="docText">Reason phrase</P>
</TH><TH class="docTableHeader">
<P class="docText">RFC 2616 section</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText">0</P>
</TD><TD class="docTableCell">
<P class="docText">No Response Received (Squid-specific)</P>
</TD><TD class="docTableCell">
<P class="docText">N/A</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">1xx</P>
</TD><TD class="docTableCell">
<P class="docText">Informational</P>
</TD><TD class="docTableCell">
<P class="docText">10.1</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">100</P>
</TD><TD class="docTableCell">
<P class="docText">Continue</P>
</TD><TD class="docTableCell">
<P class="docText">10.1.1</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">101</P>
</TD><TD class="docTableCell">
<P class="docText">Switching Protocols</P>
</TD><TD class="docTableCell">
<P class="docText">10.1.2</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">2xx</P>
</TD><TD class="docTableCell">
<P class="docText">Successful</P>
</TD><TD class="docTableCell">
<P class="docText">10.2</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">200</P>
</TD><TD class="docTableCell">
<P class="docText">OK</P>
</TD><TD class="docTableCell">
<P class="docText">10.2.1</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">201</P>
</TD><TD class="docTableCell">
<P class="docText">Created</P>
</TD><TD class="docTableCell">
<P class="docText">10.2.2</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">202</P>
</TD><TD class="docTableCell">
<P class="docText">Accepted</P>
</TD><TD class="docTableCell">
<P class="docText">10.2.3</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">203</P>
</TD><TD class="docTableCell">
<P class="docText">Non-Authoritative Information</P>
</TD><TD class="docTableCell">
<P class="docText">10.2.4</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">204</P>
</TD><TD class="docTableCell">
<P class="docText">No Content</P>
</TD><TD class="docTableCell">
<P class="docText">10.2.5</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">205</P>
</TD><TD class="docTableCell">
<P class="docText">Reset Content</P>
</TD><TD class="docTableCell">
<P class="docText">10.2.6</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">206</P>
</TD><TD class="docTableCell">
<P class="docText">Partial Content</P>
</TD><TD class="docTableCell">
<P class="docText">10.2.7</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">3xx</P>
</TD><TD class="docTableCell">
<P class="docText">Redirection</P>
</TD><TD class="docTableCell">
<P class="docText">10.3</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">300</P>
</TD><TD class="docTableCell">
<P class="docText">Multiple Choices</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.1</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">301</P>
</TD><TD class="docTableCell">
<P class="docText">Moved Permanently</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.2</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">302</P>
</TD><TD class="docTableCell">
<P class="docText">Found</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.3</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">303</P>
</TD><TD class="docTableCell">
<P class="docText">See Other</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.4</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">304</P>
</TD><TD class="docTableCell">
<P class="docText">Not Modified</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.5</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">305</P>
</TD><TD class="docTableCell">
<P class="docText">Use Proxy</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.6</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">306</P>
</TD><TD class="docTableCell">
<P class="docText">(Unused)</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.7</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">307</P>
</TD><TD class="docTableCell">
<P class="docText">Temporary Redirect</P>
</TD><TD class="docTableCell">
<P class="docText">10.3.8</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">4xx</P>
</TD><TD class="docTableCell">
<P class="docText">Client Error</P>
</TD><TD class="docTableCell">
<P class="docText">10.4</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">400</P>
</TD><TD class="docTableCell">
<P class="docText">Bad Request</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.1</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">401</P>
</TD><TD class="docTableCell">
<P class="docText">Unauthorized</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.2</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">402</P>
</TD><TD class="docTableCell">
<P class="docText">Payment Required</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.3</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">403</P>
</TD><TD class="docTableCell">
<P class="docText">Forbidden</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.4</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">404</P>
</TD><TD class="docTableCell">
<P class="docText">Not Found</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.5</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">405</P>
</TD><TD class="docTableCell">
<P class="docText">Method Not Allowed</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.6</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">406</P>
</TD><TD class="docTableCell">
<P class="docText">Not Acceptable</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.7</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">407</P>
</TD><TD class="docTableCell">
<P class="docText">Proxy Authentication Required</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.8</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">408</P>
</TD><TD class="docTableCell">
<P class="docText">Request Timeout</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.9</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">409</P>
</TD><TD class="docTableCell">
<P class="docText">Conflict</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.10</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">410</P>
</TD><TD class="docTableCell">
<P class="docText">Gone</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.11</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">411</P>
</TD><TD class="docTableCell">
<P class="docText">Length Required</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.12</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">412</P>
</TD><TD class="docTableCell">
<P class="docText">Precondition Failed</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.13</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">413</P>
</TD><TD class="docTableCell">
<P class="docText">Request Entity Too Large</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.14</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">414</P>
</TD><TD class="docTableCell">
<P class="docText">Request-URI Too Long</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.15</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">415</P>
</TD><TD class="docTableCell">
<P class="docText">Unsupported Media Type</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.16</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">416</P>
</TD><TD class="docTableCell">
<P class="docText">Requested Range Not Satisfiable</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.17</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">417</P>
</TD><TD class="docTableCell">
<P class="docText">Expectation Failed</P>
</TD><TD class="docTableCell">
<P class="docText">10.4.18</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">5xx</P>
</TD><TD class="docTableCell">
<P class="docText">Server Error</P>
</TD><TD class="docTableCell">
<P class="docText">10.5</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">500</P>
</TD><TD class="docTableCell">
<P class="docText">Internal Server Error</P>
</TD><TD class="docTableCell">
<P class="docText">10.5.1</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">501</P>
</TD><TD class="docTableCell">
<P class="docText">Not Implemented</P>
</TD><TD class="docTableCell">
<P class="docText">10.5.2</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">502</P>
</TD><TD class="docTableCell">
<P class="docText">Bad Gateway</P>
</TD><TD class="docTableCell">
<P class="docText">10.5.3</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">503</P>
</TD><TD class="docTableCell">
<P class="docText">Service Unavailable</P>
</TD><TD class="docTableCell">
<P class="docText">10.5.4</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">504</P>
</TD><TD class="docTableCell">
<P class="docText">Gateway Timeout</P>
</TD><TD class="docTableCell">
<P class="docText">10.5.5</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">505</P>
</TD><TD class="docTableCell">
<P class="docText">HTTP Version Not Supported</P>
</TD><TD class="docTableCell">
<P class="docText">10.5.6</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">6xx</P>
</TD><TD class="docTableCell">
<P class="docText">Proxy Error</P>
</TD><TD class="docTableCell">
<P class="docText">N/A</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">600</P>
</TD><TD class="docTableCell">
<P class="docText">Unparseable Response Headers (Squid-specific)</P>
</TD><TD class="docTableCell">
<P class="docText">N/A</P>
</TD></TR></COLGROUP></TABLE></P>

<P class="docText">You'll see status code 0 in the
<I>access.log</I> if Squid doesn't
receive any response from the origin server. You'll
see status code 600 if Squid received a response but
couldn't find any HTTP headers. In a small fraction
of cases, certain origin servers send only the response body and omit
any headers.</P>


<A NAME="squid-CHP-13-SECT-2.3"></A>
<H4 class="docSection2Title">13.2.3 access.log Peering Codes</H4>

<P class="docText">The following codes may appear in
<A NAME="squid-CHP-13-ITERM-1862"></A><A NAME="squid-CHP-13-ITERM-1863"></A>the ninth field of the
<I>access.log</I>. Refer to <A class="docLink" HREF="squid-CHP-10-SECT-10.html#squid-CHP-10-SECT-10">Section 10.10</A> for a description of how Squid selects the
next-hop for cache misses.</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">NONE</span></span></span></DT></p>
<DD>
<P class="docList">This indicates that Squid didn't communicate with
any other servers (neighbors, origin) for this request.
You'll see it in association with various types of
cache hits, denied requests, cache manager requests, errors, and all
ICP queries.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">DIRECT</span></span></span></DT></p>
<DD>
<P class="docList">Squid forwarded the request directly to the origin server. The second
half of the field shows the origin server's IP
address, or hostname if you've disabled
<I>log_ip_on_direct</I>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">SIBLING_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid sent the request to this sibling cache after the sibling
returned an ICP or HTCP hit.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">PARENT_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid sent the request to this parent cache after the parent returned
an ICP or HTCP hit.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">DEFAULT_PARENT</span></span></span></DT></p>
<DD>
<P class="docList">Squid selected this parent because it was marked as
<TT>default</TT> on the <span class="docEmphasis">cache_peer</span>
line in <I>squid.conf</I>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">FIRST_UP_PARENT</span></span></span></DT></p>
<DD>
<P class="docList">Squid forwarded the request to this parent because it is the first
parent in the list known to be alive.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">FIRST_PARENT_MISS</span></span></span></DT></p>
<DD>
<P class="docList">Squid forwarded the request to the parent cache that was first to
respond with an ICP/HTCP miss message. In other words, for this
particular ICP/HTCP query, at this particular time, the selected
parent had the best round-trip time. Note that measured RTTs may be
artificially adjusted by the <TT>weight</TT> option to the
<span class="docEmphasis">cache_peer</span> directive.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CLOSEST_PARENT_MISS</span></span></span></DT></p>
<DD>
<P class="docList">Squid selected this parent because it reports the lowest RTT to the
origin server. This occurs only if both caches have
<span class="docEmphasis">netdb</span> enabled (see <A class="docLink" HREF="squid-CHP-10-SECT-5.html#squid-CHP-10-SECT-5">Section 10.5</A>), and the origin server (or other servers on
its subnet) returns ICMP pings.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CLOSEST_PARENT</span></span></span></DT></p>
<DD>
<P class="docList">This is similar to <TT>CLOSEST_PARENT_MISS</TT>, except
that the RTT measurements don't come from the
ICP/HTCP reply messages. Instead, they come from older measurements
saved by Squid, such as the netdb exchange feature.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CLOSEST_DIRECT</span></span></span></DT></p>
<DD>
<P class="docList">Squid forwarded the request to the origin server based on
<span class="docEmphasis">netdb</span> measurements. This happens if any of these
conditions occur:</P>

<UL><LI><P class="docList">The RTT between Squid and the origin server is less than the
configured <span class="docEmphasis">minimum_direct_rtt</span> value.</P></LI><LI><P class="docList">The measured number of router hops between Squid and the origin
server is less than the configured
<span class="docEmphasis">minimum_direct_hops</span> value.</P></LI><LI><P class="docList">The RTT values returned in ICP/HTCP replies indicate that Squid is
closer to the origin server than any of its neighbors.</P></LI></UL>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">ROUNDROBIN_PARENT</span></span></span></DT></p>
<DD>
<P class="docList">Squid forwarded the request to this parent because the
<TT>round-robin</TT> option was set, and it had the lowest
usage counter.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CD_PARENT_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid forwarded the request to this parent based on the Cache Digest
algorithm (see <A class="docLink" HREF="squid-CHP-10-SECT-7.html#squid-CHP-10-SECT-7">Section 10.7</A>).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CD_SIBLING_HIT</span></span></span></DT></p>
<DD>
<P class="docList">Squid forwarded the request to this sibling based on the Cache Digest
algorithm.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CARP</span></span></span></DT></p>
<DD>
<P class="docList">Squid selected this parent based on the Cache Array Routing Protocol
algorithm (see <A class="docLink" HREF="squid-CHP-10-SECT-9.html#squid-CHP-10-SECT-9">Section 10.9</A>).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">ANY_PARENT</span></span></span></DT></p>
<DD>
<P class="docList">Squid selected this parent as a last resort because none of the other
methods resulted in a viable next-hop.</P>
</DD>
</DL>

<P class="docText">Note that most of these codes may be preceded by TIMEOUT_ to indicate
that a timeout occurred while waiting for ICP/HTCP replies. For
example:</P>

<PRE>1066038165.382    345 193.233.46.21 TCP_MISS/200 2836
        GET http://www.caida.org/home/images/home.jpg
        TIMEOUT_CLOSEST_DIRECT/213.219.122.19 image/jpeg</PRE>

<P class="docText">You can adjust the timeout with the
<span class="docEmphasis">icp_query_timeout</span> directive.</P>


<A NAME="squid-CHP-13-SECT-2.4"></A>
<H4 class="docSection2Title">13.2.4 Configuration Directives That Affect access.log</H4>

<P class="docText">Following are the configuration <A NAME="squid-CHP-13-ITERM-1864"></A><A NAME="squid-CHP-13-ITERM-1865"></A>file directives that affect the
<I>access.log</I> in one way or another.</P>

<A NAME="squid-CHP-13-SECT-2.4.1"></A>
<H5 class="docSection3Title">13.2.4.1 log_icp_queries</H5>

<P class="docText">This directive, enabled by default,
<A NAME="squid-CHP-13-ITERM-1866"></A>causes Squid to log all ICP queries. If
you're running a busy parent cache, this may make
your <I>access.log</I> files huge. To save space,
disable this directive:</P>

<PRE>log_icp_queries off</PRE>

<P class="docText">If you disable ICP query logging, I suggest that you monitor the
number of queries, either through the cache manager or with SNMP.</P>



<A NAME="squid-CHP-13-SECT-2.4.2"></A>
<H5 class="docSection3Title">13.2.4.2 emulate_httpd_log</H5>

<P class="docText">The <I>access.log</I> file has two formats: common
<A NAME="squid-CHP-13-ITERM-1867"></A>and native. The common format is the same
as most HTTP servers (e.g., Apache) use. It contains less information
than Squid's native format. However, you might want
to use the common log-file format if you use Squid as a surrogate
(see <A class="docLink" HREF="squid-CHP-15.html#squid-CHP-15">Chapter 15</A>). The common format may also be
useful if you have log-file analysis tools that know how to parse it.
Use this directive to enable the common format:</P>

<PRE>emulate_httpd_log on</PRE>

<P class="docText">See the site <A class="docLink" target="_blank" HREF="http://www.w3.org/Daemon/User/Config/Logging.html#common-logfile-format">http://www.w3.org/Daemon/User/Config/Logging.html#common-logfile-format</A>,
for a description of this format.</P>



<A NAME="squid-CHP-13-SECT-2.4.3"></A>
<H5 class="docSection3Title">13.2.4.3 log_mime_hdrs</H5>

<P class="docText">Use the <span class="docEmphasis">log_mime_hdrs</span> directive
<A NAME="squid-CHP-13-ITERM-1868"></A>to make Squid log the HTTP request and
response headers:</P>

<PRE>log_mime_headers on</PRE>

<P class="docText">When enabled, Squid appends the request and response headers to
<I>access.log</I>. This adds two fields to each line.
Each field is surrounded by square brackets to make parsing easier.
Certain characters are encoded to keep the log file readable. <A class="docLink" HREF="#squid-CHP-13-TABLE-2">Table 13-2</A> shows the encoding scheme.</P>

<A NAME="squid-CHP-13-TABLE-2"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 13-2. Character encoding rules for HTTP headers in access.log</h5></CAPTION><COLGROUP span="2"><THEAD><TR><TH class="docTableHeader">
<P class="docText">Character</P>
</TH><TH class="docTableHeader">
<P class="docText">Encoding</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText">Newline</P>
</TD><TD class="docTableCell">
<PRE>\n</PRE>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">Carriage return</P>
</TD><TD class="docTableCell">
<PRE>\r</PRE>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">Backslash</P>
</TD><TD class="docTableCell">
<PRE>\\</PRE>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">[</P>
</TD><TD class="docTableCell">
<PRE>%5b</PRE>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">]</P>
</TD><TD class="docTableCell">
<PRE>%5d</PRE>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">%</P>
</TD><TD class="docTableCell">
<PRE>%25</PRE>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">ASCII 0-31</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>%xx</TT> (hexadecimal value)</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">ASCII 127-255</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>%xx</TT> (hexadecimal value)</P>
</TD></TR></COLGROUP></TABLE></P>



<A NAME="squid-CHP-13-SECT-2.4.4"></A>
<H5 class="docSection3Title">13.2.4.4 log_fqdn</H5>

<P class="docText">By default, Squid puts client IP addresses
<A NAME="squid-CHP-13-ITERM-1869"></A>in the <I>access.log</I>.
You can record hostnames, when available, by enabling this directive:</P>

<PRE>log_fqdn on</PRE>

<P class="docText">This causes Squid to make reverse DNS lookups for the
client's address when it receives a request. If an
answer is available by the time the request is complete, Squid places
it in the third field.</P>



<A NAME="squid-CHP-13-SECT-2.4.5"></A>
<H5 class="docSection3Title">13.2.4.5 ident_lookup_access</H5>

<P class="docText">This access rule list determines
<A NAME="squid-CHP-13-ITERM-1870"></A>whether or not Squid makes an RFC 1413
ident query for the client's TCP connection. By
default, Squid doesn't issue ident queries. To
enable this feature, simply add one or more rules:</P>

<PRE>acl All src 0/0
ident_lookup_access allow All</PRE>

<P class="docText">If an answer is available by the time the request is complete, Squid
places it in the eighth field. If you are also using HTTP
authentication, that username is written instead of the ident answer.</P>



<A NAME="squid-CHP-13-SECT-2.4.6"></A>
<H5 class="docSection3Title">13.2.4.6 log_ip_on_direct</H5>

<P class="docText">When Squid forwards a cache miss to
<A NAME="squid-CHP-13-ITERM-1871"></A>an origin server, it records the origin
server's IP address in the ninth field. You can
disable this directive so that Squid writes the hostname instead:</P>

<PRE>log_ip_on_direct off</PRE>

<P class="docText">In this case, the hostname comes from the URI. If the URI contains an
IP address, Squid doesn't convert it to a hostname.</P>



<A NAME="squid-CHP-13-SECT-2.4.7"></A>
<H5 class="docSection3Title">13.2.4.7 client_netmask</H5>

<P class="docText">This directive exists to provide<A NAME="squid-CHP-13-ITERM-1872"></A>
some level of privacy for your users. Rather than logging the entire
client IP address, you can mask off some bits. For example:</P>

<PRE>client_netmask 255.255.255.0</PRE>

<P class="docText">With this setting, all client IP addresses in
<I>access.log</I> have 0 as the last octet:</P>

<PRE>1066036246.918     35 163.11.255.0 TCP_IMS_HIT/304 266 GET http://...
1066036246.932     16 163.11.255.0 TCP_IMS_HIT/304 266 GET http://...
1066036247.616    313 140.132.252.0 TCP_MISS/200 1079 GET http://...
1066036248.598  44459 140.132.252.0 TCP_MISS/500 1531 GET http://...
1066036249.230     17 170.210.173.0 TCP_IMS_HIT/304 265 GET http://...
1066036249.752   2135 140.132.252.0 TCP_MISS/200 50230 GET http://...
1066036250.467      4 170.210.173.0 TCP_IMS_HIT/304 265 GET http://...
1066036250.762    102 163.11.255.0 TCP_IMS_HIT/304 265 GET http://...
1066036250.832     20 163.11.255.0 TCP_IMS_HIT/304 266 GET http://...
1066036251.026     74 203.91.150.0 TCP_CLIENT_REFRESH_MISS/304 267 GET http://...</PRE>



<A NAME="squid-CHP-13-SECT-2.4.8"></A>
<H5 class="docSection3Title">13.2.4.8 strip_query_terms</H5>

<P class="docText">This directive is another privacy
<A NAME="squid-CHP-13-ITERM-1873"></A>feature. It removes query terms from URIs
before logging them. If your log files somehow fall into the wrong
hands, they won't be able to find any usernames and
passwords. When this directive is enabled, all characters after a
question mark (<TT>?</TT>) are removed. For example, a URI
like this:</P>

<PRE>http://auto.search.msn.com/response.asp?MT=www.kimo.com.yw&amp;srch=3
&amp;prov=&amp;utf8</PRE>

<P class="docText">is logged like this:</P>

<PRE>http://auto.search.msn.com/response.asp?</PRE>



<A NAME="squid-CHP-13-SECT-2.4.9"></A>
<H5 class="docSection3Title">13.2.4.9 uri_whitespace</H5>

<P class="docText">Earlier, I mentioned the problem <A NAME="squid-CHP-13-ITERM-1874"></A>with whitespace appearing in some URIs.
The RFCs state that URIs must not contain whitespace, but in reality
it happens all too often. The <span class="docEmphasis">uri_whitespace</span>
directive dictates how Squid should handle such cases. The allowed
settings are: <TT>strip</TT> (default),
<TT>deny</TT>, <TT>allow</TT>,
<TT>encode</TT>, and <TT>chop</TT>. Of these,
<TT>strip</TT>, <TT>encode</TT>, and
<TT>chop</TT> ensure that the URI field
doesn't contain any whitespace (thus adding more
fields to <I>access.log</I>).</P>

<P class="docText">The <TT>allow</TT> setting allows the request to pass
through Squid unmodified. It is likely to cause trouble for
redirectors and log file parsers. The <TT>deny</TT>
setting, on the other hand, causes Squid to deny the request. The
user receives an error message, but the request is still written to
<I>access.log</I> with the whitespace characters.</P>

<P class="docText">If you set it to <TT>encode</TT>, Squid changes the
whitespace characters to their RFC 1738 equivalents. This is probably
what the user-agent should have done in the first place. The
<TT>chop</TT> setting causes Squid to cut off the URI at
the first whitespace character.</P>

<P class="docText">The default setting is <TT>strip</TT>, which makes Squid
remove the whitespace characters from the URI. It ensures that your
log-file parsers and redirectors will be happy, but it might break
certain things, such as improperly encoded search engine queries.</P>



<A NAME="squid-CHP-13-SECT-2.4.10"></A>
<H5 class="docSection3Title">13.2.4.10 buffered_logs</H5>

<P class="docText">By default, Squid disables <A NAME="squid-CHP-13-ITERM-1875"></A>buffering for the
<I>cache.log</I> file, which allows you to run
<I>tail -f</I> and watch log file entries appear in real
time. If you think this will cause an unnecessary overhead, you can
disable buffering:</P>

<PRE>buffered_logs off</PRE>

<P class="docText">However, it probably doesn't matter unless you are
running Squid with full debugging. Note that this option <A NAME="squid-CHP-13-ITERM-1876"></A><A NAME="squid-CHP-13-ITERM-1877"></A>affects only
<I>cache.log</I>. The others always use unbuffered
writes.</P>



<A NAME="squid-CHP-13-SECT-2.5"></A>
<H4 class="docSection2Title">13.2.5 access.log Analysis Tools</H4>

<P class="docText">The <I>access.log</I> file contains a wealth of
information, much more than you can see by just browsing through it.
In order to get the big picture view, you'll need to
use a third-party log-file analysis package. You can find a long list
of them linked from the Squid web page, or by going directly to
<A class="docLink" target="_blank" HREF="http://www.squid-cache.org/Scripts/">http://www.squid-cache.org/Scripts/</A>.</P>

<P class="docText">One of the most popular tools
<A NAME="squid-CHP-13-ITERM-1878"></A><A NAME="squid-CHP-13-ITERM-1879"></A>is
Calamarisa Perl script that parses the log file and generates
either text or HTML-based reports. It provides a breakdown of traffic
by request method, client IP address, origin server domain name,
content types, filename extensions, reply size, and more. Calamaris
also reports on ICP query traffic and even understands log files from
other caching products. Check it out by visiting <A class="docLink" target="_blank" HREF="http://calamaris.cord.de/">http://calamaris.cord.de/</A>.</P>

<P class="docText">Squeezer, and its derivative,
<A NAME="squid-CHP-13-ITERM-1880"></A><A NAME="squid-CHP-13-ITERM-1881"></A>Squeezer2,
are Squid-specific analysis tools. They provide many statistics that
can help you understand Squid's performance,
especially when you have neighbors. Both generate HTML pages as
output. Visit the <span class="docEmphasis">Logfile Analysis</span> page on the
<A class="docLink" target="_blank" HREF="squid-cache.org">squid-cache.org</A> site for links to
these programs.</P>

<P class="docText">Webalyzer is another good utility. It
<A NAME="squid-CHP-13-ITERM-1882"></A><A NAME="squid-CHP-13-ITERM-1883"></A>is
designed to be fast and produces HTML pages with tables and bar
charts. It was originally designed for origin server access logs.
Although it can parse Squid's logs, it
doesn't report on such things as hit ratios and
response times. It also uses some terms differently than I do. For
example, Webalyzer calls any request a
"hit," which isn't
the same as a cache hit. It also makes a distinction between
"pages" <A NAME="squid-CHP-13-ITERM-1884"></A><A NAME="squid-CHP-13-ITERM-1885"></A>and
"files." For more information,
visit the Webalyzer home page at <A class="docLink" target="_blank" HREF="http://www.mrunix.net/webalyzer/">http://www.mrunix.net/webalyzer/</A>.</P>



<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="squid-CHP-13-SECT-1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="squid-CHP-13-SECT-3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
