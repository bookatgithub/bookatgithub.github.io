<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>14.2 The Cache Manager</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body >
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="squid-CHP-14-SECT-1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="squid-CHP-14-SECT-3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="squid-CHP-14-SECT-2"></A>
<H3 class="docSection1Title" id="225793-825">14.2 The Cache Manager</H3>

<P class="docText">The Cache Manager is an
<A NAME="squid-CHP-14-ITERM-1947"></A><A NAME="squid-CHP-14-ITERM-1948"></A>interface to Squid for receiving
information about various components. It is accessed via normal HTTP
requests with a special protocol name:
<TT>cache_object</TT>. A full cache manager URL looks like
<A class="docLink" target="_blank" HREF="cache_object://cache.host.name/info">cache_object://cache.host.name/info</A>. Squid
provides two easy ways to access the cache manager information: the
command-line <I>squidclient</I> program<sup class="docFootnote"><A class="docLink" HREF="#squid-CHP-14-FNOTE-1">[1]</A></sup> or the
<I>cachemgr.cgi</I> CGI program.</P><blockquote><p class="docFootnote"><sup><A NAME="squid-CHP-14-FNOTE-1">[1]</A></sup> In older versions of Squid, it was called just
<I>client</I>.</p></blockquote>

<P class="docText">The <I>squidclient</I> utility is a
<A NAME="squid-CHP-14-ITERM-1949"></A><A NAME="squid-CHP-14-ITERM-1950"></A>simple HTTP client, with a few special
features for use with Squid. For example, you can use a shortcut to
request the cache manager pages. Rather than typing a long URL like
this:</P>

<PRE>% squidclient cache_object://cache.host.name/info</PRE>

<P class="docText">you can use this shorter version:</P>

<PRE>% squidclient mgr:info</PRE>

<P class="docText"><I>squidclient</I> is a convenient way to quickly see
some of the cache manager pages. It's also useful
when you need to save the cache manager output to disk for later
analysis. However, some pages, such as the memory utilization table,
are difficult to read in a terminal window. They are really designed
to be formatted as an HTML page and viewed with your web browser. In
that case, you may want to use <I>cachemgr.cgi</I>.</P>

<P class="docText">To use <I>cachemgr.cgi</I>, you must have an HTTP server
that can execute the program. You can use an existing server or
install one alongside Squid if you prefer. Keep in mind that the
cache manager has only weak security (cleartext passwords). If the
HTTP server is on a different host, you need to add its IP address to
a cache manager access list (see <A class="docLink" HREF="#squid-CHP-14-SECT-2.2">Section 14.2.2</A>). You may also want to add
access controls to the HTTP server so that others
can't access <I>cachemgr.cgi</I>.</P>

<P class="docText">If you use Apache, I recommend making a special
<I>cgi-bin</I> directory so you can protect
<I>cachemgr.cgi</I> with access controls. For example,
create a new directory, and copy the binary to it:</P>

<PRE># mkdir /usr/local/apache/squid-cgi
# cp /usr/local/squid/libexec/cachemgr.cgi /usr/local/apache/squid-cgi
# chmod 755 /usr/local/apache/squid-cgi/cachemgr.cgi</PRE>

<P class="docText">Now, add a <span class="docEmphasis">ScriptAlias</span> line to
Apache's <I>httpd.conf</I>:</P>

<PRE>ScriptAlias /squid-cgi/ "/usr/local/apache/squid-cgi/"</PRE>

<P class="docText">Finally, create an <I>.htaccess</I> file in the
<I>squid-cgi</I> directory that contains access
controls. To allow requests from only one IP address, use something
like this:</P>

<PRE>Allow from 192.168.4.2
Deny from all</PRE>

<P class="docText">Once <I>cachemgr.cgi</I> is installed, simply enter the
appropriate URL into your web browser. For example:</P>

<PRE>http://www.server.name/squid-cgi/cachemgr.cgi</PRE>

<P class="docText">If the CGI program is working, you should see a page with four
fields. See <A class="docLink" HREF="#squid-CHP-14-FIG-1">Figure 14-1</A> for an example. The
<span class="docEmphasis">Cache Host</span> field contains the name of the host
on which Squid is running—<A class="docLink" target="_blank" HREF="localhost">localhost</A> by default. You can set it with the
<I>—enable-cachemgr-hostname</I> option when running
<I>./configure</I>. Similarly, <span class="docEmphasis">Cache
Port</span> contains the TCP port number to which Squid listens
for requests. It's 3128 by default and can be
changed with the <I>—enable-cachemgr-port</I> option.
The <span class="docEmphasis">Manager name</span> and
<span class="docEmphasis">Password</span> fields are for access to protected
pages, which I'll talk about shortly.</P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="squid-CHP-14-FIG-1"></A>Figure 14-1. The cachemgr.cgi login screen</H5>
<IMG BORDER="0" WIDTH="481" HEIGHT="238" SRC="images/0596001622/figs/SQ_1401.gif" ALT="figs/SQ_1401.gif"></CENTER>

<P class="docText">After clicking on the <span class="docEmphasis">Continue</span>... button, you
should see a list of all cache manager pages currently available. The
following section describes the various pages, some of which are
available only when you enable certain features at compile time.</P>

<A NAME="squid-CHP-14-SECT-2.1"></A>
<H4 class="docSection2Title">14.2.1 Cache Manager Pages</H4>

<P class="docText">This section describes the <A NAME="squid-CHP-14-ITERM-1951"></A><A NAME="squid-CHP-14-ITERM-1952"></A>cache manager pages, in the same order in
which they appear in the menu. Each section title has both the page
name (for use with <I>squidclient</I>), followed by its
description. Descriptions that contain an asterisk indicate pages
that are disabled by default, unless you configure a password for
them. <A class="docLink" HREF="#squid-CHP-14-TABLE-1">Table 14-1</A> shows the table of contents and
the section number for each page.</P>

<A NAME="squid-CHP-14-TABLE-1"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 14-1. Cache manager pages</h5></CAPTION><COLGROUP span="2"><THEAD><TR><TH class="docTableHeader">
<P class="docText">Short name</P>
</TH><TH class="docTableHeader">
<P class="docText">Description</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText">leaks</P>
</TD><TD class="docTableCell">
<P class="docText">Memory Leak Tracking</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">mem</P>
</TD><TD class="docTableCell">
<P class="docText">Memory Utilization</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">cbdata</P>
</TD><TD class="docTableCell">
<P class="docText">Callback Data Registry Contents</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">events</P>
</TD><TD class="docTableCell">
<P class="docText">Event Queue</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">squidaio_counts</P>
</TD><TD class="docTableCell">
<P class="docText">Async IO Function Counters</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">diskd</P>
</TD><TD class="docTableCell">
<P class="docText">DISKD Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">config</P>
</TD><TD class="docTableCell">
<P class="docText">Current Squid Configuration*</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">comm_incoming</P>
</TD><TD class="docTableCell">
<P class="docText">comm_incoming( ) Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">ipcache</P>
</TD><TD class="docTableCell">
<P class="docText">IP Cache Stats and Contents</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">fqdncache</P>
</TD><TD class="docTableCell">
<P class="docText">FQDN Cache Stats and Contents</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">idns</P>
</TD><TD class="docTableCell">
<P class="docText">Internal DNS Statistics</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">dns</P>
</TD><TD class="docTableCell">
<P class="docText">Dnsserver Statistics</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">redirector</P>
</TD><TD class="docTableCell">
<P class="docText">URL Redirector Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">basicauthenticator</P>
</TD><TD class="docTableCell">
<P class="docText">Basic User Authenticator Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">digestauthenticator</P>
</TD><TD class="docTableCell">
<P class="docText">Digest User Authenticator Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">ntlmauthenticator</P>
</TD><TD class="docTableCell">
<P class="docText">NTLM User Authenticator Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">external_acl</P>
</TD><TD class="docTableCell">
<P class="docText">External ACL Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">http_headers</P>
</TD><TD class="docTableCell">
<P class="docText">HTTP Header Statistics</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">via_headers</P>
</TD><TD class="docTableCell">
<P class="docText">Via Request Headers</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">forw_headers</P>
</TD><TD class="docTableCell">
<P class="docText">X-Forwarded-For Request Headers</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">menu</P>
</TD><TD class="docTableCell">
<P class="docText">This Cache Manager Menu</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">shutdown</P>
</TD><TD class="docTableCell">
<P class="docText">Shut Down the Squid Process*</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">offline_toggle</P>
</TD><TD class="docTableCell">
<P class="docText">Toggle offline_mode Setting*</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">info</P>
</TD><TD class="docTableCell">
<P class="docText">General Runtime Information</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">filedescriptors</P>
</TD><TD class="docTableCell">
<P class="docText">Process File Descriptor Allocation</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">objects</P>
</TD><TD class="docTableCell">
<P class="docText">All Cache Objects</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">vm_objects</P>
</TD><TD class="docTableCell">
<P class="docText">In-Memory and In-Transit Objects</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">openfd_objects</P>
</TD><TD class="docTableCell">
<P class="docText">Objects with Swapout Files Open</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">io</P>
</TD><TD class="docTableCell">
<P class="docText">Server-Side Network read( ) Size Histograms</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">counters</P>
</TD><TD class="docTableCell">
<P class="docText">Traffic and Resource Counters</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">peer_select</P>
</TD><TD class="docTableCell">
<P class="docText">Peer Selection Algorithms</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">digest_stats</P>
</TD><TD class="docTableCell">
<P class="docText">Cache Digest and ICP Blob</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">5min</P>
</TD><TD class="docTableCell">
<P class="docText">5 Minute Average of Counters</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">60min</P>
</TD><TD class="docTableCell">
<P class="docText">60 Minute Average of Counters</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">utilization</P>
</TD><TD class="docTableCell">
<P class="docText">Cache Utilization</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">histograms</P>
</TD><TD class="docTableCell">
<P class="docText">Full Histogram Counts</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">active_requests</P>
</TD><TD class="docTableCell">
<P class="docText">Client-Side Active Requests</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">store_digest</P>
</TD><TD class="docTableCell">
<P class="docText">Store Digest</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">storedir</P>
</TD><TD class="docTableCell">
<P class="docText">Store Directory Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">store_check_cachable_stats</P>
</TD><TD class="docTableCell">
<P class="docText">storeCheckCachable( ) Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">store_io</P>
</TD><TD class="docTableCell">
<P class="docText">Store IO Interface Stats</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">pconn</P>
</TD><TD class="docTableCell">
<P class="docText">Persistent Connection Utilization Histograms</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">refresh</P>
</TD><TD class="docTableCell">
<P class="docText">Refresh Algorithm Statistics</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">delay</P>
</TD><TD class="docTableCell">
<P class="docText">Delay Pool Levels</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">forward</P>
</TD><TD class="docTableCell">
<P class="docText">Request Forwarding Statistics</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">client_list</P>
</TD><TD class="docTableCell">
<P class="docText">Cache Client List</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">netdb</P>
</TD><TD class="docTableCell">
<P class="docText">Network Measurement Database</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">asndb</P>
</TD><TD class="docTableCell">
<P class="docText">AS Number Database</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">carp</P>
</TD><TD class="docTableCell">
<P class="docText">CARP Information</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">server_list</P>
</TD><TD class="docTableCell">
<P class="docText">Peer Cache Statistics</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">non_peers</P>
</TD><TD class="docTableCell">
<P class="docText">List of Unknown Sites Sending ICP Messages</P>
</TD></TR></COLGROUP></TABLE></P>

<A NAME="squid-CHP-14-SECT-2.1.1"></A>
<H5 class="docSection3Title">14.2.1.1 leaks: Memory Leak Tracking</H5>

<P class="docText">This page is available <A NAME="squid-CHP-14-ITERM-1953"></A><A NAME="squid-CHP-14-ITERM-1954"></A>only with the
<I>./configure</I>
<I>—enable-leakfinder</I> option and is intended for
developers trying to track down memory leaks. The page shows each
memory pointer being tracked and where and when it was most recently
referenced. See the Squid Programmer's Guide
(<A class="docLink" target="_blank" HREF="http://www.squid-cache.org/Doc/Prog-Guide/">http://www.squid-cache.org/Doc/Prog-Guide/</A>)
for more information about Squid's leak-finder
feature.</P>



<A NAME="squid-CHP-14-SECT-2.1.2"></A>
<H5 class="docSection3Title">14.2.1.2 mem: Memory Utilization</H5>

<P class="docText">The memory utilization page <A NAME="squid-CHP-14-ITERM-1955"></A><A NAME="squid-CHP-14-ITERM-1956"></A>shows a large
table of numbers. Each row corresponds to a different pool of memory.
The pools have names like <TT>acl_list</TT> and
<TT>MemObject</TT>. Much of this information is of interest
to developers only. However, a few columns are worth mentioning here.</P>

<P><table border="0" bgcolor="black" cellspacing="0" cellpadding="1" width="90%" align="center"><tr><td><table bgcolor="white" width="100%" border="0" cellspacing="0" cellpadding="6"><tr><td width="60" valign="top"><img src="images/tip_yellow.gif" width="50" height="54"></td><td valign="top">
<P class="docText">It is important to keep in mind that this table
doesn't represent all the memory allocated by Squid.
Some memory allocations aren't tracked and
don't appear in the table. Thus, the
<span class="docEmphasis">Total</span> row may be much less than
Squid's actual memory usage.</P>
</td></tr></table></td></tr></table></P><br>

<P class="docText">The <TT>impact</TT> column shows each
pool's contribution to the total amount of memory
allocated. Usually, the <TT>StoreEntry</TT>,
<TT>MD5</TT>
<TT>digest</TT>, and
<TT>LRU</TT>
<TT>policy</TT>
<TT>node</TT> pools take up most of the memory.</P>

<P class="docText">If you are a developer, you can use this page to look for memory
leaks. The column labeled <TT>high</TT>
<TT>(hrs)</TT> shows the amount of time elapsed since the
pool reached its maximum size. A small value in this column may
indicate that memory for that pool isn't being freed
correctly.</P>

<P class="docText">You can also use this page to find out if certain features, such as
<span class="docEmphasis">netdb</span>, the <span class="docEmphasis">ipcache</span>, and
<span class="docEmphasis">client_db</span> consume too much memory. For example,
the <TT>ClientInfo</TT> pool is associated with the
<span class="docEmphasis">client_db</span> feature. The memory utilization page
shows you how much memory you can save if you disable
<span class="docEmphasis">client_db</span> in <I>squid.conf</I>.</P>



<A NAME="squid-CHP-14-SECT-2.1.3"></A>
<H5 class="docSection3Title">14.2.1.3 cbdata: Callback Data Registry Contents</H5>

<P class="docText">The Callback Data Registry is <A NAME="squid-CHP-14-ITERM-1957"></A><A NAME="squid-CHP-14-ITERM-1958"></A>an internal
Squid programming feature for managing memory pointers. Currently,
this cache manager page doesn't provide much useful
information, apart from the number of active
<span class="docEmphasis">cbdata</span> pointers being tracked. In earlier Squid
versions, the <span class="docEmphasis">cbdata</span> feature was implemented
differently and this page provided some information to developers
debugging their code.</P>



<A NAME="squid-CHP-14-SECT-2.1.4"></A>
<H5 class="docSection3Title">14.2.1.4 events: Event Queue</H5>

<P class="docText">Squid maintains an event queue for a<A NAME="squid-CHP-14-ITERM-1959"></A><A NAME="squid-CHP-14-ITERM-1960"></A>
number of tasks that must occur separately from user requests.
Perhaps the most important of these is the periodic task that
maintains the disk cache size. Every second or so, this task runs and
looks for cache files to remove. On this page, you can see all tasks
currently scheduled for execution. Most likely,
you'll not find this very interesting unless you are
hacking the source code.</P>



<A NAME="squid-CHP-14-SECT-2.1.5"></A>
<H5 class="docSection3Title">14.2.1.5 squidaio_counts: Async IO Function Counters</H5>

<P class="docText">This page is available only with <A NAME="squid-CHP-14-ITERM-1961"></A><A NAME="squid-CHP-14-ITERM-1962"></A>the
<I>./configure</I>
<I>—enable-storeio=aufs</I> option. It shows counters
for the number of open, close, read, write, stat, and unlink requests
received. For example:</P>

<PRE>ASYNC IO Counters:
Operation       # Requests
open             15318822
close            15318813
cancel           15318813
write                   0
read             19237139
stat                    0
unlink            2484325
check_callback  311678364
queue                   0</PRE>

<P class="docText">The <TT>cancel</TT> counter is normally equal to the
<TT>close</TT> counter. This is because the close function
always calls the cancel function to ensure that any pending I/O
operations are ignored.</P>

<P class="docText">The <TT>write</TT> counter is zero because this version of
Squid performs writes synchronously, even for
<span class="docEmphasis">aufs</span>.</P>

<P class="docText">The <TT>check_callback</TT> counter shows how many times
the main Squid process has checked the done queue for completed
operations.</P>

<P class="docText">The <TT>queue</TT> value indicates the current length of
the request queue. Normally, the queue length should be less than the
number of threads x 5. If you repeatedly observe a queue
length larger than this, you may be pushing Squid too hard. Adding
more threads may help, but only to a certain point.</P>



<A NAME="squid-CHP-14-SECT-2.1.6"></A>
<H5 class="docSection3Title">14.2.1.6 diskd: DISKD Stats</H5>

<P class="docText">This page is available only <A NAME="squid-CHP-14-ITERM-1963"></A><A NAME="squid-CHP-14-ITERM-1964"></A>with the
<I>./configure</I>
<I>—enable-storeio=diskd</I> option. It provides
various statistics relating to the <span class="docEmphasis">diskd</span> storage
scheme.</P>

<P class="docText">The <TT>sent_count</TT> and <TT>recv_count</TT>
lines are counters for the number of I/O requests sent between Squid
and the group of <span class="docEmphasis">diskd</span> processes. The two
numbers should be very close to each other and could possibly be
equal. The difference indicates how many requests are currently
outstanding.</P>

<P class="docText">The <TT>max_away</TT> value indicates the largest number of
outstanding requests. Similarly, the <TT>max_shmuse</TT>
counter indicates the maximum number of shared memory blocks in use
at once. These two values are reset (to zero) each time you request
this page. Thus, if you wait longer between requests for this page,
these maximum counters are likely to be larger.</P>

<P class="docText">The <TT>open_fail_queue_len</TT> counter indicates the
number of times that the <span class="docEmphasis">diskd</span> code decided to
return failure in response to a request to open a file because the
message queue exceeded its configured limit. In other words, this is
the number of times a <span class="docEmphasis">diskd</span> queue reached the Q1
limit. Similarly, <TT>block_queue_len</TT> shows how many
times the Q2 limit has been reached. See the descriptions of Q1 and
Q2 in <A class="docLink" HREF="squid-CHP-8-SECT-5.html#squid-CHP-8-SECT-5.1">Section 8.5.1</A>.</P>

<P class="docText">The <span class="docEmphasis">diskd</span> page also shows how many requests
Squid sent to the <span class="docEmphasis">diskd</span> processes for each of
the six I/O operations: open, create, close, unlink, read, and write.
It also shows how many times each operation succeeded or failed.
Note, these counters are incremented only for requests sent. The
<TT>open_fail_queue_len</TT> check occurs earlier, and in
that case, Squid doesn't send a request to a
<span class="docEmphasis">diskd</span> process.</P>



<A NAME="squid-CHP-14-SECT-2.1.7"></A>
<H5 class="docSection3Title">14.2.1.7 config: Current Squid Configuration*</H5>

<P class="docText">This option dumps Squid's current
<A NAME="squid-CHP-14-ITERM-1965"></A><A NAME="squid-CHP-14-ITERM-1966"></A>configuration
in the <I>squid.conf</I> format. Thus, if you ever
accidentally remove the configuration file, you can recover it from
the running Squid process. By saving the output to a file, you can
also compare (e.g., with the <TT>diff</TT> command) the
running configuration to the saved configuration. Note, however, that
comments and blank lines aren't preserved.</P>

<P class="docText">This option reveals potentially sensitive information, so
it's available only with a password. You must add a
cache manager password for the <span class="docEmphasis">config</span> option
with the <span class="docEmphasis">cachemgr_passwd</span> directive. See 
<A class="docLink" HREF="#squid-CHP-14-SECT-2.2">Section 14.2.2</A> for specifics.
Additionally, these cache manager passwords aren't
displayed in this output.</P>



<A NAME="squid-CHP-14-SECT-2.1.8"></A>
<H5 class="docSection3Title">14.2.1.8 comm_incoming: comm_incoming( ) Stats</H5>

<P class="docText">This page provides low-level <A NAME="squid-CHP-14-ITERM-1967"></A><A NAME="squid-CHP-14-ITERM-1968"></A>network
I/O information to developers and Squid wizards. The loop that checks
for activity on file descriptors is called <I>comm_poll(
)</I>. Over the years, this function has become increasingly
complicated in order to improve Squid's performance.
One of those performance improvements relates to how often Squid
checks certain network sockets relative to the others.</P>

<P class="docText">For example, the incoming HTTP socket is where Squid accepts new
client connections. This socket tends to be busier than a normal data
socket because each new connection comes through the incoming socket.
To provide good performance, Squid makes an extra effort to check the
incoming socket more frequently than the others.</P>

<P class="docText">At the top of the <I>comm_incoming</I> page,
you'll see three incoming interval numbers: one each
for ICP, DNS, and HTTP. The interval is the number of normal I/O
events that Squid handles before checking the incoming socket again.
For example, if <TT>incoming_dns_interval</TT> is set to
140, Squid checks the incoming DNS socket after 140 I/Os on normal
connections. Unless your Squid is very busy, you'll
probably see 256 for all incoming intervals.</P>

<P class="docText">The page also contains three histograms that show how many events
occur for each incoming function call. Normally, the majority of the
histogram counts occur in the low values. In other words, functions
such as <I>comm_select_http_incoming( )</I> usually
handle between one and four events.</P>



<A NAME="squid-CHP-14-SECT-2.1.9"></A>
<H5 class="docSection3Title">14.2.1.9 ipcache: IP Cache Stats and Contents</H5>

<P class="docText">The IP cache contains <A NAME="squid-CHP-14-ITERM-1969"></A><A NAME="squid-CHP-14-ITERM-1970"></A>cached
results of hostname-to-address lookups. This cache manager page
displays quite a lot of information. At the top of this page
you'll see a handful of statistics like these:</P>

<PRE>IPcache Entries: 10034
IPcache Requests: 1066445
IPcache Hits: 817880
IPcache Negative Hits: 6846
IPcache Misses: 200497</PRE>

<P class="docText">In this example, you can see that the IP cache contains slightly more
than 10,000 entries (hostnames). Since Squid was started, there have
been 1,066,445 name-to-address requests, 817,880 of which were cache
hits. This is a cache hit ratio of 77%. An IP cache negative hit
occurs when Squid receives a subsequent request for a hostname that
it recently failed to resolve. Rather than retry the DNS lookup
immediately, Squid assumes it will fail again and returns an error
message to the user.</P>

<P class="docText">Following these brief statistics, you'll see a long
list of the IP cache contents. For each hostname in the cache, Squid
prints six fields:</P>

<UL><LI><P class="docList">The hostname itself</P></LI><LI><P class="docList">Flags: <TT>N</TT> for negatively cached entries and
<TT>H</TT> if the addresses came from the local
<I>hosts</I> file, rather than the DNS</P></LI><LI><P class="docList">The number of seconds since the hostname was last requested or used</P></LI><LI><P class="docList">The number of seconds until the cached entry expires</P></LI><LI><P class="docList">The number of IP addresses known for the host, and, in parentheses,
the number of BAD addresses</P></LI><LI><P class="docList">A list of IP addresses and whether each is OK or BAD</P></LI></UL>
<P class="docText">Here is a short sample (formatted to fit the page):</P>

<PRE> Hostname                        Flg lstref    TTL  N
 ads.x10.com                              9    110  1( 0)   63.211.210.20-OK
 us.rd.yahoo.com                        640   -340  4( 0) 216.136.232.150-OK
                                                          216.136.232.147-OK
                                                          216.136.232.149-OK
                                                          216.136.232.148-OK
 www.movielodge.com                    7143  -2161  1( 0)   66.250.223.36-OK
 shell.windows.com                    10865  -7447  2( 1)   207.46.226.48-BAD
                                                           207.46.248.237-OK
 www.surf3.net                       126810 -40415  1( 0)   212.74.112.95-OK</PRE>

<P class="docText">The list is sorted by the time since last reference. Recently
referenced names are at the top of the list, and unused (about to be
removed) names are at the bottom.</P>

<P class="docText">IP addresses are marked OK by default. An address is marked BAD when
Squid receives an error or timeout during a TCP connection attempt.
Subsequent IP cache requests don't return BAD
addresses. If all the host's addresses become BAD,
Squid resets them all back to OK.</P>



<A NAME="squid-CHP-14-SECT-2.1.10"></A>
<H5 class="docSection3Title">14.2.1.10 fqdncache: FQDN Cache Stats and Contents</H5>

<P class="docText">The FQDN cache is <A NAME="squid-CHP-14-ITERM-1971"></A><A NAME="squid-CHP-14-ITERM-1972"></A>similar to
the IP cache, except that it stores address-to-hostname lookups.
Another difference is that the FQDN cache doesn't
mark hostnames as OK or BAD.</P>

<P class="docText">Your FQDN cache may be empty, unless you enable the
<span class="docEmphasis">log_fqdn</span> directive, use domain-based ACLs (such
as <span class="docEmphasis">srcdomain</span>, <span class="docEmphasis">dstdomain</span>,
<span class="docEmphasis">srcdom_regex</span>, and
<span class="docEmphasis">dstdom_regex</span>), or use a redirector.</P>



<A NAME="squid-CHP-14-SECT-2.1.11"></A>
<H5 class="docSection3Title">14.2.1.11 idns: Internal DNS Statistics</H5>

<P class="docText">Squid contains an internal DNS <A NAME="squid-CHP-14-ITERM-1973"></A><A NAME="squid-CHP-14-ITERM-1974"></A>client
implementation, which is enabled by default. Disabling internal DNS
with the <I>—disable-internal-dns</I> option also
disables this page. Here is some sample output:</P>

<PRE>Internal DNS Statistics:

The Queue:
                       DELAY SINCE
  ID   SIZE SENDS FIRST SEND LAST SEND
------ ---- ----- ---------- ---------
001876   44     1      0.010     0.010
001875   44     1      0.010     0.010

Nameservers:
IP ADDRESS      # QUERIES # REPLIES
--------------- --------- ---------
192.168.19.124       4889      4844
192.168.19.190         91        51
192.168.10.2           73        39

Rcode Matrix:
RCODE ATTEMPT1 ATTEMPT2 ATTEMPT3
    0     6149        4        2
    1        0        0        0
    2       38       34       32
    3        0        0        0
    4        0        0        0
    5        0        0        0</PRE>

<P class="docText">The Internal DNS page contains three tables. First,
you'll see the queue of unanswered queries.
Unfortunately, you can't see the contents of the
query (the hostname or IP address). Instead, Squid prints the ID,
size, number of transmissions, and elapsed times for each query. You
should see relatively few queries in the queue. If you see a lot
relative to your total traffic rate, make sure your DNS servers are
functioning properly.</P>

<P class="docText">The second table (<TT>Nameservers</TT>) shows how many
queries have been sent to, and replies received from, each DNS
server. Squid always queries the first server in the list first.
Second (and third, etc.) servers are queried only when the previous
server times out for a given query. If you see zero replies from the
first address, make sure a server is actually running at that
address.</P>

<P class="docText">Finally, you'll see a table of DNS response codes
versus number of attempts. The cell for response code
<TT>0</TT> and <TT>ATTEMPT1</TT> should have the
highest count. Response code <TT>0</TT> indicates success,
while others are different types of errors (see RFC 1035 for their
descriptions). You may see some smaller numbers for response code
<TT>0</TT> in the columns for <TT>ATTEMPT2</TT>
and <TT>ATTEMPT3</TT>. This shows the cases when
retransmitting a query, after initially receiving an error, resulted
in a successful reply. Note that Squid retries only response code 2
(server failure) errors.</P>



<A NAME="squid-CHP-14-SECT-2.1.12"></A>
<H5 class="docSection3Title">14.2.1.12 dns: Dnsserver Statistics</H5>

<P class="docText">This cache manager page is available only when you use the
<I>—disable-internal-dns</I> option. In this case,
Squid uses a number of external <I>dnsserver</I>
processes to perform DNS lookups. The <I>dnsserver</I>
program is one of a number of helper processes Squid can use. The
other types of helpers are redirectors, authenticators, and external
ACLs. All Squid's helpers have cache manager pages
that display the same statistics. For example:</P>

<PRE>Dnsserver Statistics:
number running: 5 of 5
requests sent: 3001
replies received: 3001
queue length: 0
avg service time: 23.10 msec

      #      FD     PID  # Requests     Flags      Time  Offset Request
      1       6   20110         128     AB        0.293       0 www.nlanr.net
      2       7   20111          45     A         0.000       0 (none)
      3       8   20112           4     A         0.000       0 (none)
      4       9   20113           0     A         0.000       0 (none)
      5      10   20114           0     A         0.000       0 (none)</PRE>

<P class="docText">The <TT>number</TT> <TT>running</TT> line shows
how many helper processes are running and how many should be running.
The <span class="docEmphasis">dns_children</span> directive specifies how many
<I>dnsserver</I> processes to use. The two numbers should
match, but they may not if a helper process dies unexpectedly or if
some processes could not be started. Recall that when you reconfigure
a running Squid instance, all the helpers are killed and restarted.
See the discussion in <A class="docLink" HREF="appa-77637.html#appa-77637">Appendix A</A>.</P>

<P class="docText">The <TT>requests sent</TT> and <TT>replies
received</TT> values display the number of requests sent to (and
responses received from) the helpers since Squid started. The
difference between these two, if any, should correspond to the number
of outstanding requests.</P>

<P class="docText">The <TT>queue length</TT> line shows how many requests are
queued, waiting for one of the helpers to become free. The queue
length should usually be zero. If not, you should add more helpers to
reduce delays for your users.</P>

<P class="docText">The <TT>avg service time</TT> line shows the running
average service time for all helpers. Your particular value may
depend on numerous factors, such as your network bandwidth and
processing power.</P>

<P class="docText">The next section displays a table of statistics for the running
<I>dnsserver</I> processes. The <TT>FD</TT>
column shows the file descriptor for the socket between Squid and
each <I>dnsserver</I> process. Similarly, the
<TT>PID</TT> column shows each helper's
process ID number.</P>

<P class="docText">The <TT># Requests</TT> column shows how many requests have
been sent to each helper. These numbers are zeroed each time you
reconfigure Squid, so they many not add up to the total number of
requests sent, as shown earlier. Note that Squid always chooses the
first idle helper in the list, so the first process should receive
the largest number of requests. The last few processes may not
receive any requests at all.</P>

<P class="docText">The <TT>Flags</TT> column shows a few flags describing the
state of the helper process. You should normally see
<TT>A</TT> (for Alive) in each column. Occasionally, when
the helper process is handling a request, you'll see
<TT>B</TT> (for Busy).</P>

<P class="docText">The <TT>Time</TT> column displays the amount of time
elapsed (in seconds) for the current, or last, request.
<TT>Offset</TT> shows how many bytes of the response
message Squid has read on the socket. This is almost always zero.
Finally, the <TT>Request</TT> column shows the request that
was sent to the helper process. In this case, it is either a hostname
or an IP address.</P>



<A NAME="squid-CHP-14-SECT-2.1.13"></A>
<H5 class="docSection3Title">14.2.1.13 redirector: URL Redirector Stats</H5>

<P class="docText">The Redirector Stats page <A NAME="squid-CHP-14-ITERM-1975"></A><A NAME="squid-CHP-14-ITERM-1976"></A>is
available only if you are using a redirector (see <A class="docLink" HREF="squid-CHP-11.html#squid-CHP-11">Chapter 11</A>). The format of this page is identical to
<span class="docEmphasis">Dnsserver Statistics</span>, described earlier.</P>



<A NAME="squid-CHP-14-SECT-2.1.14"></A>
<H5 class="docSection3Title">14.2.1.14 basicauthenticator: Basic User Authenticator Stats</H5>

<P class="docText">This page is available only w<A NAME="squid-CHP-14-ITERM-1977"></A><A NAME="squid-CHP-14-ITERM-1978"></A>ith
the <I>./configure</I>
<I>—enable-auth=basic</I> option and when you define
a Basic authenticator with the <span class="docEmphasis">auth_param basic
program</span> directive. The format of this page is identical to
<span class="docEmphasis">Dnsserver Statistics</span>, described earlier.</P>



<A NAME="squid-CHP-14-SECT-2.1.15"></A>
<H5 class="docSection3Title">14.2.1.15 digestauthenticator: Digest User Authenticator Stats</H5>

<P class="docText">This page is available only <A NAME="squid-CHP-14-ITERM-1979"></A><A NAME="squid-CHP-14-ITERM-1980"></A>with
the <I>./configure</I>
<I>—enable-auth=digest</I> option and when you define
a Digest authenticator with the <span class="docEmphasis">auth_param digest
program</span> directive. The format of this page is identical to
<span class="docEmphasis">Dnsserver Statistics</span>, described earlier.</P>



<A NAME="squid-CHP-14-SECT-2.1.16"></A>
<H5 class="docSection3Title">14.2.1.16 ntlmauthenticator: NTLM User Authenticator Stats</H5>

<P class="docText">This page is available only <A NAME="squid-CHP-14-ITERM-1981"></A><A NAME="squid-CHP-14-ITERM-1982"></A>with
the <I>./configure</I>
<I>—enable-auth=ntlm</I> option and when you define a
NTLM authenticator with then <span class="docEmphasis">auth_param ntlm
program</span> directive. The format of this page is similar to
<span class="docEmphasis">Dnsserver Statistics</span>, described earlier, with a
few additions.</P>

<P class="docText">The table of helper processes includes an extra column: <TT>#
Deferred Requests</TT>. NTLM requires
"stateful" helpers because the
helper processes themselves generate the challenges. Squid receives a
challenge from a helper, sends that challenge to a user, and receives
a response. Squid must send the user's challenge
response back to the same helper for validation. For this protocol to
work, Squid must defer some messages to be sent to a helper until the
helper is ready to accept them.</P>

<P class="docText">These helpers also have two new flags: <TT>R</TT> (reserved
or deferred) and <TT>P</TT> (placeholder). The
<TT>R</TT> flag is set when the helper has at least one
deferred request waiting. The <TT>P</TT> flag is set when
Squid is waiting for the NTLM helper to generate a new challenge
token.</P>



<A NAME="squid-CHP-14-SECT-2.1.17"></A>
<H5 class="docSection3Title">14.2.1.17 external_acl: External ACL Stats</H5>

<P class="docText">This page displays helper statistics
<A NAME="squid-CHP-14-ITERM-1983"></A><A NAME="squid-CHP-14-ITERM-1984"></A>for
your external ACLs. If you don't have any
<span class="docEmphasis">external_acl_type</span> lines in
<I>squid.conf</I>, this page will be empty. Otherwise,
Squid displays the statistics for each external ACL. The format is
the same as for the <span class="docEmphasis">Dnsserver Statistics</span>.</P>



<A NAME="squid-CHP-14-SECT-2.1.18"></A>
<H5 class="docSection3Title">14.2.1.18 http_headers: HTTP Header Statistics</H5>

<P class="docText">This page displays a <A NAME="squid-CHP-14-ITERM-1985"></A><A NAME="squid-CHP-14-ITERM-1986"></A>number
of tables containing statistics about HTTP headers. It contains up to
four sections: HTCP reply stats (if HTCP is enabled), HTTP request
stats, HTTP reply stats, and a final section called HTTP Fields
Stats. The HTCP reply statistics refer to HTCP replies received by
your cache. The HTTP request section refers to HTTP requests either
sent or received by your cache. Similarly, the HTTP reply section
refers to replies either sent or received by Squid.</P>

<P class="docText">The first three sections have the same format. Each section contains
three tables: Field type distribution, Cache-control directives
distribution, and Number of fields per header distribution.</P>

<P class="docText">The Field type distribution table shows the number of times that each
header value occurs and the percentage of cases in which it occurs.
For example, in <A class="docLink" HREF="#squid-CHP-14-TABLE-2">Table 14-2</A> you can see that the
<TT>Accept</TT> header occurs in 98% of HTTP requests.</P>

<A NAME="squid-CHP-14-TABLE-2"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 14-2. Sample Field type distribution values for HTTP requests</h5></CAPTION><COLGROUP span="4"><THEAD><TR><TH class="docTableHeader">
<P class="docText">ID</P>
</TH><TH class="docTableHeader">
<P class="docText">Name</P>
</TH><TH class="docTableHeader">
<P class="docText">Count</P>
</TH><TH class="docTableHeader">
<P class="docText">#/header</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText">0</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>Accept</TT></P>
</TD><TD class="docTableCell">
<P class="docText">1416268</P>
</TD><TD class="docTableCell">
<P class="docText">0.98</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">1</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>Accept-Charset</TT></P>
</TD><TD class="docTableCell">
<P class="docText">322077</P>
</TD><TD class="docTableCell">
<P class="docText">0.22</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">2</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>Accept-Encoding</TT></P>
</TD><TD class="docTableCell">
<P class="docText">709715</P>
</TD><TD class="docTableCell">
<P class="docText">0.49</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">3</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>Accept-Language</TT></P>
</TD><TD class="docTableCell">
<P class="docText">1334736</P>
</TD><TD class="docTableCell">
<P class="docText">0.92</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">...</P>
</TD><TD class="docTableCell">
<P class="docText">...</P>
</TD><TD class="docTableCell">
<P class="docText">...</P>
</TD><TD class="docTableCell">
<P class="docText">...</P>
</TD></TR></COLGROUP></TABLE></P>

<P class="docText">Unfortunately, these (and the following) statistics are tricky
because they don't correspond one-to-one for client
requests. For example, Squid may report 1,416,268
<TT>Accept</TT> headers in requests but only 800,542 client
requests. This happens because Squid creates more than one HTTP
header data structure for each request. In the case of HTTP replies,
it seems that Squid may create up to four separate header structures,
depending on the circumstances.</P>

<P class="docText">The <TT>Cache-Control</TT> directives distribution is
similar, but applies only to the values of the
<TT>Cache-Control</TT> header. <A class="docLink" HREF="#squid-CHP-14-TABLE-3">Table 14-3</A>
shows some of the possible field values.</P>

<A NAME="squid-CHP-14-TABLE-3"></A><P><TABLE CELLSPACING="0" BORDER="1" RULES="all" CELLPADDING="4" WIDTH="100%"><CAPTION><h5 class="docTableTitle">Table 14-3. Sample Cache-Control directives distribution values for HTTP requests</h5></CAPTION><COLGROUP span="4"><THEAD><TR><TH class="docTableHeader">
<P class="docText">ID</P>
</TH><TH class="docTableHeader">
<P class="docText">Name</P>
</TH><TH class="docTableHeader">
<P class="docText">Count</P>
</TH><TH class="docTableHeader">
<P class="docText">#/cc_field</P>
</TH></TR></THEAD><TR><TD class="docTableCell">
<P class="docText">0</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>public</TT></P>
</TD><TD class="docTableCell">
<P class="docText">6866</P>
</TD><TD class="docTableCell">
<P class="docText">0.02</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">1</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>private</TT></P>
</TD><TD class="docTableCell">
<P class="docText">69783</P>
</TD><TD class="docTableCell">
<P class="docText">0.24</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">2</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>no-cache</TT></P>
</TD><TD class="docTableCell">
<P class="docText">78252</P>
</TD><TD class="docTableCell">
<P class="docText">0.27</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">3</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>no-store</TT></P>
</TD><TD class="docTableCell">
<P class="docText">9878</P>
</TD><TD class="docTableCell">
<P class="docText">0.03</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">4</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>no-transform</TT></P>
</TD><TD class="docTableCell">
<P class="docText">168</P>
</TD><TD class="docTableCell">
<P class="docText">0.00</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">5</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>must-revalidate</TT></P>
</TD><TD class="docTableCell">
<P class="docText">10983</P>
</TD><TD class="docTableCell">
<P class="docText">0.04</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">6</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>proxy-revalidate</TT></P>
</TD><TD class="docTableCell">
<P class="docText">2480</P>
</TD><TD class="docTableCell">
<P class="docText">0.01</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">7</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>max-age</TT></P>
</TD><TD class="docTableCell">
<P class="docText">165034</P>
</TD><TD class="docTableCell">
<P class="docText">0.56</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">8</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>s-maxage</TT></P>
</TD><TD class="docTableCell">
<P class="docText">4995</P>
</TD><TD class="docTableCell">
<P class="docText">0.02</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">9</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>max-stale</TT></P>
</TD><TD class="docTableCell">
<P class="docText">0</P>
</TD><TD class="docTableCell">
<P class="docText">0.00</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">10</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>only-if-cached</TT></P>
</TD><TD class="docTableCell">
<P class="docText">0</P>
</TD><TD class="docTableCell">
<P class="docText">0.00</P>
</TD></TR><TR><TD class="docTableCell">
<P class="docText">11</P>
</TD><TD class="docTableCell">
<P class="docText"><TT>Other</TT></P>
</TD><TD class="docTableCell">
<P class="docText">9149</P>
</TD><TD class="docTableCell">
<P class="docText">0.03</P>
</TD></TR></COLGROUP></TABLE></P>

<P class="docText">The <TT>Number</TT> <TT>of</TT>
<TT>fields</TT> <TT>per</TT>
<TT>header</TT> <TT>distribution</TT> table shows
how many headers occur in each request or reply. Usually, you should
see something like a normal distribution with a peak around 10-13
headers per request or response.</P>

<P class="docText">Finally, this page ends with a table labeled <TT>Http</TT>
<TT>Fields</TT> <TT>Stats</TT>
<TT>(replies</TT> <TT>and</TT>
<TT>requests)</TT>. For each header, this table shows three
values: <TT>#alive</TT>, <TT>%err</TT>, and
<TT>%repeat</TT>.</P>

<P class="docText">The <TT>#alive</TT> column shows how many instances of this
header are currently stored in memory. HTTP headers are kept in
memory for both active requests/responses and for completed objects
stored in the memory cache.</P>

<P class="docText">The <TT>%err</TT> column shows the percentage of times
Squid encountered an error while parsing this header. Common errors
include incorrect date formats for <TT>Date</TT>,
<TT>Expires</TT>, <TT>Last-Modified</TT>, and
similar headers. The value <TT>-1</TT> indicates no errors.</P>

<P class="docText">The <TT>%repeat</TT> column indicates the number of times
that a particular header is repeated in a single request or response.
These aren't errors because HTTP allows headers to
be repeated.</P>



<A NAME="squid-CHP-14-SECT-2.1.19"></A>
<H5 class="docSection3Title">14.2.1.19 via_headers: Via Request Headers</H5>

<P class="docText">This page is available only <A NAME="squid-CHP-14-ITERM-1987"></A><A NAME="squid-CHP-14-ITERM-1988"></A>with the
<I>./configure</I>
<I>—enable-forw-via-db</I> option. The information in
this page is intended to help cache administrators understand where
client requests come from. When enabled, Squid counts the number of
times each unique <TT>Via</TT> header occurs in client
requests.</P>

<P class="docText">The <TT>Via</TT> header contains a list of downstream
proxies that have forwarded the request so far. When a proxy forwards
a request, it should append its hostname and other identifying
information to the <TT>Via</TT> header. With the
information in this database, you can, in theory, reconstruct the
hierarchy of proxies forwarding requests through yours.</P>

<P class="docText">Squid prints the <TT>Via</TT> database entries in a random
order. The output may look something like this:</P>

<PRE>   4 1.0 proxy.firekitten.org:3128 (squid/2.5.STABLE1)
   1 1.0 xnsproxy.dyndns.org:3128 (squid/2.5.PRE3-20020125)
1751 1.0 nt04.rmtcc.cc.oh.us:3128 (Squid/2.4.STABLE6),
         1.0 tasksmart.rmtcc.cc.oh.us:3128 (Squid/2.4.STABLE7)
 137 1.0 reg3.bdg.telco.co.id:8080 (Squid/2.2.STABLE5),
         1.0 c1.telco.co.id:8080 (Squid/2.4.STABLE6),
         1.0 cache2.telco.co.id:8080 (Squid/2.4.STABLE1)
  53 1.0 IS_GW_312:3128 (Squid/2.4.STABLE6)
  60 1.0 proxy.kiltron.net:3128 (Squid/2.4.STABLE7)
 815 1.1 DORM</PRE>

<P class="docText">In this example, Squid received 1751 requests that previously passed
through two other proxies (<A class="docLink" target="_blank" HREF="nt04">nt04</A>
and <A class="docLink" target="_blank" HREF="tasksmart">tasksmart</A>). Note that only
proxies add a <TT>Via</TT> header. Requests from
user-agents usually don't have the header and,
therefore, aren't counted in this database.</P>

<P class="docText">As you can see, the <TT>Via</TT> headers reveal some
semiprivate information, such as hostnames, port numbers, and
software versions. Please take care to respect the privacy of your
users if you enable this feature.</P>

<P class="docText">The <TT>Via</TT> database is stored entirely in memory and
is lost if Squid restarts. The database is cleared whenever you
rotate the log files (see <A class="docLink" HREF="squid-CHP-13-SECT-7.html#squid-CHP-13-SECT-7">Section 13.7</A>).</P>



<A NAME="squid-CHP-14-SECT-2.1.20"></A>
<H5 class="docSection3Title">14.2.1.20 forw_headers: X-Forwarded-For Request Headers</H5>

<P class="docText">This page is available only with <A NAME="squid-CHP-14-ITERM-1989"></A><A NAME="squid-CHP-14-ITERM-1990"></A>the
<I>./configure</I>
<I>—enable-forw-via-db</I> option. It is similar to
the <span class="docEmphasis">via_headers</span> page, except that it displays
the accumulation of <TT>X-Forwarded-For</TT> headers.</P>

<P class="docText"><TT>X-Forwarded-For</TT> is a nonstandard HTTP header that
originated with the Squid project. Its value is a list of client IP
addresses. In other words, when Squid receives and forwards a
request, it appends the client's IP address to this
header. It is similar to <TT>Via</TT> because the header
grows each time a proxy passes the request on towards the origin
server.</P>

<P class="docText">The <span class="docEmphasis">forw_headers</span> output is similar to
<span class="docEmphasis">via_headers</span>. Each line begins with an integer,
followed by a header value. The integer indicates how many times that
particular <TT>X-Forwarded-For</TT> value was received. For
example:</P>

<PRE>  1 10.37.1.56, 10.1.83.8
  3 10.3.33.77, 10.1.83.8
569 116.120.203.54
 21 10.65.18.200, 10.1.83.120
 31 116.120.204.6
  5 10.1.92.7, 10.1.83.120
  1 10.3.65.122, 10.3.1.201, 10.1.83.8
  2 10.73.73.51, 10.1.83.120
  1 10.1.68.141, 10.1.83.8
  3 10.1.92.7, 10.1.83.122</PRE>

<P class="docText">As with <span class="docEmphasis">via_headers</span>, this database is also
stored in memory and is lost if Squid exits. The database is cleared
each time you rotate Squid's log files.</P>



<A NAME="squid-CHP-14-SECT-2.1.21"></A>
<H5 class="docSection3Title">14.2.1.21 menu: This Cache Manager Menu</H5>

<P class="docText">This page simply displays a listing <A NAME="squid-CHP-14-ITERM-1991"></A><A NAME="squid-CHP-14-ITERM-1992"></A>of the other
cache manager pages. You can use it if you forget the name of a page
or if you want to know if certain optional pages are available. When
using <I>cachemgr.cgi</I>, each item in the menu is a
clickable link.</P>



<A NAME="squid-CHP-14-SECT-2.1.22"></A>
<H5 class="docSection3Title">14.2.1.22 shutdown: Shut Down the Squid Process*</H5>

<P class="docText">This is one of the few cache manager <A NAME="squid-CHP-14-ITERM-1993"></A><A NAME="squid-CHP-14-ITERM-1994"></A>functions
that doesn't simply display some information.
Rather, this "page" allows you to
shut down Squid remotely. To allow shutdown via the cache manager,
you must assign it a password with the
<span class="docEmphasis">cachemgr_passwd</span> (see <A class="docLink" HREF="#squid-CHP-14-SECT-2.2">Section 14.2.2</A>) directive in
<I>squid.conf</I>. Without a password, the shutdown
operation is disabled (but you can still use <I>squid -k
shutdown</I>).</P>

<P class="docText">Because the cache manager has very weak security—passwords are
sent in cleartext—I don't recommend enabling
this operation.</P>



<A NAME="squid-CHP-14-SECT-2.1.23"></A>
<H5 class="docSection3Title">14.2.1.23 offline_toggle: Toggle offline_mode Setting*</H5>

<P class="docText">This is another function that allows you
<A NAME="squid-CHP-14-ITERM-1995"></A><A NAME="squid-CHP-14-ITERM-1996"></A>to
control Squid, rather than simply receive information. It also
requires a password (see <A class="docLink" HREF="#squid-CHP-14-SECT-2.2">Section 14.2.2</A>) in order to become active.</P>

<P class="docText">Each time you request this page, Squid toggles the
<span class="docEmphasis">offline_mode</span> setting. Squid reports the new
setting on your screen and in <I>cache.log</I>.</P>



<A NAME="squid-CHP-14-SECT-2.1.24"></A>
<H5 class="docSection3Title">14.2.1.24 info: General Runtime Information</H5>

<P class="docText">This page provides a lot of <A NAME="squid-CHP-14-ITERM-1997"></A><A NAME="squid-CHP-14-ITERM-1998"></A>basic
information about the way that Squid is operating. It is a good
starting point for using the cache manager and for tracking down
performance problems.</P>

<P class="docText">At the top, you'll see the release version (e.g.,
Version 2.5.STABLE4) and two timestamps: the starting and current
times. For example:</P>

<PRE>Squid Object Cache: Version 2.5.STABLE4
Start Time:     Mon, 22 Sep 2003 03:10:37 GMT
Current Time:   Mon, 13 Oct 2003 10:25:16 GMT</PRE>

<P class="docText">Following that, you'll see seven different sections.
The first section, <TT>Connection</TT>
<TT>information</TT>, displays a few statistics about the
number and rate of connections, and the number of cache clients:</P>

<PRE>Connection information for squid:
        Number of clients accessing cache:      386
        Number of HTTP requests received:       12997469
        Number of ICP messages received:        16302149
        Number of ICP messages sent:    16310714
        Number of queued ICP replies:   0
        Request failure ratio:   0.00
        Average HTTP requests per minute since start:   423.7
        Average ICP messages per minute since start:    1063.2
        Select loop called: 400027445 times, 4.601 ms avg</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Number of clients accessing cache</span></span></span></DT></p>
<DD>
<P class="docList">Here, "client" actually means IP
address. Squid assumes that each client has a unique IP address.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Number of HTTP requests received</span></span></span></DT></p>
<DD>
<P class="docList">The total number of HTTP requests since Squid was started.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Number of ICP messages received</span></span></span></DT></p>
<DD>
<P class="docList">The total number of ICP messages received since Squid was started.
Note, received messages includes both queries and responses. These
values don't include HTCP messages, however.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Number of ICP messages sent</span></span></span></DT></p>
<DD>
<P class="docList">The total number of ICP messages sent since Squid was started. Note,
received messages includes both queries and responses.
Doesn't include HTCP messages. Most likely, your
sent and received counts will be about the same.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Number of queued ICP replies</span></span></span></DT></p>
<DD>
<P class="docList">ICP messages are sent over UDP. The <I>sendto( )</I>
system call rarely fails, but if it does, Squid queues the ICP
message for retransmission. This counter shows how many times an ICP
message was queued for retransmission. Most likely,
you'll see <TT>0</TT> here.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Request failure ratio</span></span></span></DT></p>
<DD>
<P class="docList">The failure ratio is a moving average ratio between the number of
failed and successful requests. In this context, a failed request is
caused by either a DNS error, TCP connection error, or network read
error. When this ratio exceeds 1.0—meaning Squid returns more
errors than successful responses— Squid goes into hit-only
mode. In this mode, Squid returns <TT>ICP_MISS_NOFETCH</TT>
instead of <TT>ICP_MISS</TT>. Thus, your neighbor caches
that use ICP won't forward cache misses to you until
the problem goes away.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Average HTTP requests per minute since start</span></span></span></DT></p>
<DD>
<P class="docList">This value is simply the number of HTTP requests divided by the
amount of time Squid has been running. This average
doesn't reflect short-term variations in load. To
get a better instantaneous load measurement, use the
<span class="docEmphasis">5min</span> or <span class="docEmphasis">60min</span> page.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Average ICP messages per minute since start</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP queries received by Squid divided by the amount of
time that it has been running.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Select loop called</span></span></span></DT></p>
<DD>
<P class="docList">This number is probably meaningful only to Squid developers. It
represents the number of times the <I>select( )</I> (or
<I>poll( )</I>) function has been called and the
average time between calls. During normal operation, the time between
calls should be in the 1-100 millisecond range.</P>
</DD>
</DL>

<P class="docText">The <TT>Cache</TT> <TT>information</TT> section
displays hit ratio and cache size statistics:</P>

<PRE>Cache information for squid:
        Request Hit Ratios:     5min: 22.6%, 60min: 25.8%
        Byte Hit Ratios:        5min: 24.6%, 60min: 38.7%
        Request Memory Hit Ratios:      5min: 0.7%, 60min: 1.4%
        Request Disk Hit Ratios:        5min: 6.0%, 60min: 12.4%
        Storage Swap size:      41457489 KB
        Storage Mem size:       10180 KB
        Mean Object Size:       14.43 KB
        Requests given to unlinkd:      0</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Request Hit Ratios</span></span></span></DT></p>
<DD>
<P class="docList">Here, and on subsequent lines, you'll see two hit
ratio numbers: one for the last five minutes, and one for the last
hour. These values are simply the percentage of HTTP requests that
result in a cache hit. Here, hits include cases in which Squid
validates a cached response and receives a 304 (Not Modified) reply.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Byte Hit Ratios</span></span></span></DT></p>
<DD>
<P class="docList">Squid calculates byte hit ratio by comparing the number of bytes
received from origin servers (or neighbors) to the number of bytes
sent to clients. When received bytes are less than sent bytes, the
byte hit ratio is positive. However, it is possible to see a negative
byte hit ratio. This might occur, for example, if you have a lot of
clients that abort their request before receiving the entire
response.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Request Memory Hit Ratios</span></span></span></DT></p>
<DD>
<P class="docList">These values represent the percentage of all cache hits that were
served from memory. Or, more accurately, the percentage of all hits
(not requests!) logged as <TT>TCP_MEM_HIT</TT>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Request Disk Hit Ratios</span></span></span></DT></p>
<DD>
<P class="docList">Similarly, these values represent the percentage of
"plain" cache hits served from
disk. In particular, these values are the percentage of all hits
logged as <TT>TCP_HIT</TT>. You'll see
that the memory and disk hit percentages don't add
up to 100%. This is because the other cases (such as
<TT>TCP_IMS_HIT</TT>, etc.) aren't
included in either disk or memory hits.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Storage Swap size</span></span></span></DT></p>
<DD>
<P class="docList">The amount of data currently cached on disk. It is always expressed
in kilobytes. To compensate for space wasted in partial blocks at the
end of files, Squid rounds up file sizes to the nearest filesystem
block size.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Storage Mem size</span></span></span></DT></p>
<DD>
<P class="docList">The amount of data currently cached in memory. It is always expressed
in kilobytes and is always a multiple of Squid's
memory page size: 4 KB.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Mean Object Size</span></span></span></DT></p>
<DD>
<P class="docList">Simply the storage swap size divided by the number of cached objects.
You should set the configuration directive
<span class="docEmphasis">store_avg_object_size</span> close to the actual value
reported here. Squid uses the configured value for a number of
internal estimates.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Requests given to unlinkd</span></span></span></DT></p>
<DD>
<P class="docList">The <I>unlinkd</I> process handles file deletion external
to Squid (depending on your configuration). This value simply shows
how many files Squid has asked <I>unlinkd</I> to remove.
It is zero when <I>unlinkd</I> isn't
used.</P>
</DD>
</DL>

<P class="docText">The <TT>Median</TT> <TT>Service</TT>
<TT>Times</TT> section displays the median of various
service time (or response time) distributions.
You'll see a value for the last five minutes and for
the last hour. All values are in seconds. Squid uses the median,
rather than the mean, because these distributions often have heavy
tails that can significantly skew the mean value. The output looks
like this:</P>

<PRE>Median Service Times (seconds)  5 min    60 min:
        HTTP Requests (All):   0.19742  0.15048
        Cache Misses:          0.22004  0.17711
        Cache Hits:            0.05951  0.04047
        Near Hits:             0.37825  0.14252
        Not-Modified Replies:  0.01309  0.01387
        DNS Lookups:           0.05078  0.03223
        ICP Queries:           0.00000  0.07487</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">HTTP Requests (All)</span></span></span></DT></p>
<DD>
<P class="docList">These are the median response times for all HTTP requests taken
together. For an HTTP request, the timer starts as soon as Squid
receives the request and ends when Squid writes the last byte of the
response. Thus, this time also includes DNS lookups (if any), and ICP
queries to upstream neighbors (if you have them) for cache misses.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Cache Misses</span></span></span></DT></p>
<DD>
<P class="docList">This line shows the response time for cache misses only. Unless your
cache hit ratio is close to 50%, the cache miss response time is
close to (but a little larger than) the overall response time.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Cache Hits</span></span></span></DT></p>
<DD>
<P class="docList">The cache hit response time includes only requests logged as
<TT>TCP_HIT</TT>, <TT>TCP_MEM_HIT</TT>, and
<TT>TCP_OFFLINE_HIT</TT>. These are unvalidated cache hits
served directly from Squid, without any communication to the origin
server. Thus, your cache hit response time should be significantly
less than the miss time. You should keep track of this value over
time; if it climbs too high, your disk filesystem may be a
performance bottleneck.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Near Hits</span></span></span></DT></p>
<DD>
<P class="docList">A near hit is a validated cache hit. It corresponds to
<TT>TCP_REFRESH_HIT</TT> in
<I>access.log</I>. For these, Squid contacts the origin
server (or parent cache), which adds some latency to the response
time. The server's response is a small 304 (Not
Modified) message. Thus, the near hit response time is typically in
between cache hits and cache misses.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Not-Modified Replies</span></span></span></DT></p>
<DD>
<P class="docList">This line shows the response times for requests logged as
<TT>TCP_IMS_HIT</TT>. This occurs when the client sends a
conditional (a.k.a. validation) request, and Squid serves a response
without contacting the origin server. The name
"not-modified" is somewhat
misleading for this category because the status code received by the
client isn't necessarily 304. For example, the
client may send an If-modified-since request, and Squid has a fresh,
cached response with a more recent modification time. Squid knows
that its response is fresh and that the client's
copy is stale. In this case, the client receives a 200 (OK) reply
with the new object data.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">DNS Lookups</span></span></span></DT></p>
<DD>
<P class="docList">The DNS service time shows how long it takes, on average, to query
the DNS. This includes both name-to-address and address-to-name
lookups. It doesn't include IP- and FQDN-cache hits,
however. DNS queries can be a significant source of latency. If you
experience performance problems with Squid, be sure to check this
value. If you see a high median service time (i.e., around five
seconds), make sure your primary DNS server (usually listed in
<I>/etc/resolv.conf</I>) is up and running.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">ICP Queries</span></span></span></DT></p>
<DD>
<P class="docList">The ICP query time represents the elapsed time between an ICP query
and response that causes Squid to select the corresponding neighbor
as the next hop. Thus, it includes only requests logged as
<TT>PARENT_HIT</TT>, <TT>SIBLING_HIT</TT>,
<TT>FIRST_PARENT_MISS</TT>, and
<TT>CLOSEST_PARENT_MISS</TT>. This value may not be a good
estimate of the overall ICP response time because ICP query/response
transactions that don't result in Squid selecting a
neighbor are ignored. Due to a bug in Squid Versions 2.5.STABLE1 and
earlier, ICP response time statistics aren't
collected, and these values always appear as <TT>0</TT>.</P>
</DD>
</DL>

<P class="docText">The <TT>Resource</TT> <TT>usage</TT> section
includes a few statistics relating to CPU and memory usage:</P>

<PRE>Resource usage for squid:
        UP Time:        1840478.681 seconds
        CPU Time:       70571.874 seconds
        CPU Usage:      3.83%
        CPU Usage, 5 minute avg:        1.33%
        CPU Usage, 60 minute avg:       4.41%
        Process Data Segment Size via sbrk( ): 342739 KB
        Maximum Resident Size: 345612 KB
        Page faults with physical i/o: 65375</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">UP Time</span></span></span></DT></p>
<DD>
<P class="docList">This line simply shows the amount of time this Squid process has been
running. It is expressed in seconds.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CPU Time</span></span></span></DT></p>
<DD>
<P class="docList">The amount of CPU time used by Squid, also in seconds. This value
comes from the <I>getrusage( )</I> system call, which
might not be available on all operating systems.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">CPU Usage</span></span></span></DT></p>
<DD>
<P class="docList">This section has three CPU Usage lines. The first is the CPU Time
value divided by the UP Time value. It is a long-term average CPU
usage measurement. The next two lines show the CPU usage for the last
five minutes and the last hour.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Process Data Segment Size via sbrk( )</span></span></span></DT></p>
<DD>
<P class="docList">This line offers an estimate of Squid's process
size. <I>sbrk( )</I> is a low-level system call used by
the memory allocation library (<I>malloc( )</I>). The
<I>sbrk( )</I> technique provides only an estimate,
which usually differs from values reported by programs such as
<I>ps</I> and <I>top</I>. When the
<I>sbrk( )</I> value is greater than the
<TT>Maximum Resident Size</TT> (discussed next), the Squid
process is probably page faulting, and performance may be degrading.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Maximum Resident Size</span></span></span></DT></p>
<DD>
<P class="docList">This is another estimate of memory usage and process size. The
maximum resident set size (RSS) value comes from the
<I>getrusage( )</I> system call. Although the
definition of RSS may vary between operating systems, you can think
of it as the maximum amount of physical memory used by the process at
any one time. Squid's process size may be larger
than the RSS, in which case some parts of the process are actually
swapped to disk.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Page faults with physical i/o</span></span></span></DT></p>
<DD>
<P class="docList">This value also comes from <I>getrusage( )</I>. A
<I>page fault</I> occurs when the operating system
must read a page of the process's memory from disk.
This usually happens when the Squid process becomes too large to fit
entirely in memory, or when the system has other programs competing
for memory. Squid's performance suffers
significantly when page faults occur. You probably
won't notice any problems as long as the page-faults
rate is an order of magnitude lower than the HTTP request rate.</P>
</DD>
</DL>

<P class="docText">You'll see a section called <TT>Memory usage
for squid via mstats( )</TT> if your system has the
<I>mstats( )</I> function. In particular,
you'll have this function if the GNU
<TT>malloc</TT> library
(<I>libgnumalloc.a</I>) is installed. Squid reports two
statistics from <I>mstats( )</I>:</P>

<PRE>Memory usage for squid via mstats( ):
        Total space in arena:  415116 KB
        Total free:            129649 KB 31%</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Total space in arena</span></span></span></DT></p>
<DD>
<P class="docList">This represents the total amount of memory allocated to the process.
It may be similar to the value reported by <I>sbrk(
)</I>. Note that this value only increases over time.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Total free</span></span></span></DT></p>
<DD>
<P class="docList">This represents the amount of memory allocated to the process but not
currently in use by Squid. For example, if Squid frees up some
memory, it goes into this category. Squid can later reuse that
memory, perhaps for a different data structure, without increasing
the process size. This value fluctuates up and down over time.</P>
</DD>
</DL>

<P class="docText">The <TT>Memory</TT> <TT>accounted</TT>
<TT>for</TT> section contains a few tidbits about
Squid's internal memory management techniques:</P>

<PRE>Memory accounted for:
        Total accounted:       228155 KB
        memPoolAlloc calls: 2282058666
        memPoolFree calls: 2273301305</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Total accounted</span></span></span></DT></p>
<DD>
<P class="docList">Squid keeps track of some, but not nearly all, of the memory
allocated to it. This value represents the total size of all data
structures accounted for. Unfortunately, it is typically only about
two-thirds of the actual memory usage. Squid uses a significant
amount of memory in ways that make it difficult to track properly.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">memPoolAlloc calls</span></span></span></DT></p>
<DD>
<P class="docList"><I>memPoolAlloc( )</I> is the function through which
Squid allocates many fixed-size data structures. This line shows how
many times that function has been called.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">memPoolFree calls</span></span></span></DT></p>
<DD>
<P class="docList"><I>memPoolFree( )</I> is the companion function through
which Squid frees memory allocated with <I>memPoolAlloc(
)</I>. In a steady-state condition, the two values should
increase at the same rate and their difference should be roughly
constant over time. If not, the code may contain a bug that frees
pooled memory back to the <TT>malloc</TT> library.</P>
</DD>
</DL>

<P class="docText">The <TT>File</TT> <TT>descriptor</TT>
<TT>usage</TT> section shows how many file descriptors are
available to Squid and how many are in use:</P>

<PRE>File descriptor usage for squid:
        Maximum number of file descriptors:   7372
        Largest file desc currently in use:    151
        Number of file desc currently in use:  105
        Files queued for open:                   0
        Available number of file descriptors: 7267
        Reserved number of file descriptors:   100
        Store Disk files open:                   0</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Maximum number of file descriptors</span></span></span></DT></p>
<DD>
<P class="docList">This is the limit on open file descriptors for the
<I>squid</I> process. This should be the same value
reported by <I>./configure</I> when you compiled Squid.
If you don't see at least 1024 here, you should
probably go back and recompile Squid after reading <A class="docLink" HREF="squid-CHP-3-SECT-3.html#squid-CHP-3-SECT-3.1">Section 3.3.1</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Largest file desc currently in use</span></span></span></DT></p>
<DD>
<P class="docList">This is the highest file descriptor currently open. Its value
isn't particularly important but should be within
15-20% of the next line (number currently in use). This value is more
useful for developers because it corresponds to the first argument of
the <I>select( )</I> system call.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Number of file desc currently in use</span></span></span></DT></p>
<DD>
<P class="docList">The number of currently open descriptors is an important performance
metric. In general, Squid's performance decreases as
the number of open descriptors increases. The kernel must work harder
to scan the larger set of descriptors for activity. Meanwhile, each
file descriptor waits longer (on average) to be serviced.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Files queued for open</span></span></span></DT></p>
<DD>
<P class="docList">This value will always be zero, unless you are using the
<span class="docEmphasis">aufs</span> storage scheme (see <A class="docLink" HREF="squid-CHP-8-SECT-4.html#squid-CHP-8-SECT-4">Section 8.4</A>). It shows how many file-open requests have
been dispatched to the thread processes but have not yet returned.
<span class="docEmphasis">aufs</span> is the only storage scheme in which disk
file descriptors are opened asynchronously.<sup class="docFootnote"><A class="docLink" HREF="#squid-CHP-14-FNOTE-2">[2]</A></sup></P>
<blockquote><p class="docFootnote"><sup><A NAME="squid-CHP-14-FNOTE-2">[2]</A></sup> <span class="docEmphasis">diskd</span> also opens files asynchronously, but
those file descriptors belong to the <I>diskd</I>
processes, not the <I>squid</I> process.</p></blockquote>

</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Available number of file descriptors</span></span></span></DT></p>
<DD>
<P class="docList">The number of available descriptors is the maximum, minus the number
currently open and the number queued for open. It represents the
amount of breathing room Squid has to handle more load. When the
available number gets close to the reserved number (next line), Squid
stops accepting new connections so that existing transactions
continue receiving service.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Reserved number of file descriptors</span></span></span></DT></p>
<DD>
<P class="docList">The number of reserved file descriptors starts out at the lesser of
100 or 25% of the maximum. Squid refuses new client connections if
the number of available (free) descriptors reaches this limit. It is
increased if Squid encounters an error while trying to create a new
TCP socket. In this case, you'll see a message in
<I>cache.log</I>:</P>

<PRE>Reserved FD adjusted from 100 to 150 due to failures</PRE>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Store Disk files open</span></span></span></DT></p>
<DD>
<P class="docList">This counter shows the number of disk files currently open for
reading or writing. It is always zero if you are using the
<span class="docEmphasis">diskd</span> storage scheme because disk files are
opened by the <I>diskd</I> processes, rather than Squid
itself. If you use the <span class="docEmphasis">max_open_disk_fds</span>
directive in <I>squid.conf</I>, Squid stops opening
more cache files for reading or writing when it reaches that limit.
If your filesystem is a bottleneck, this is a simple way to sacrifice
a few cache hits for stable performance.</P>
</DD>
</DL>

<P class="docText">The <TT>Internal Data Structures</TT> section gives a quick
overview of how many objects are in the cache and how many are on
disk or in memory. You can find more detail about
Squid's data structure allocations in the
<span class="docEmphasis">mem</span> page (see <A class="docLink" HREF="#squid-CHP-14-SECT-2.1.2">Section 14.2.1.2</A>). This section has a few
stats:</P>

<PRE>Internal Data Structures:
       2873586 StoreEntries
          1336 StoreEntries with MemObjects
          1302 Hot Object Cache Items
       2873375 on-disk objects</PRE>

<A NAME="squid-CHP-14-ITERM-1999"></A><A NAME="squid-CHP-14-ITERM-2000"></A><DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">StoreEntries</span></span></span></DT></p>
<DD>
<P class="docList">This represents the number of objects cached by Squid. Each object in
the cache uses one <TT>StoreEntry</TT> structure.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">StoreEntries with MemObjects</span></span></span></DT></p>
<DD>
<P class="docList"><TT>MemObject</TT> is the data structure used for objects
currently being requested and for objects stored in the memory cache.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Hot Object Cache Items</span></span></span></DT></p>
<DD>
<P class="docList">The <TT>Hot</TT> <TT>Object</TT>
<TT>Cache</TT> is another name for the memory cache (see
<A class="docLink" HREF="squid-APP-B.html#squid-APP-B">Appendix B</A>). These objects are stored entirely in
memory (as well as on disk). This number should always be less than
the number of entries with <TT>MemObjects</TT>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">on-disk objects</span></span></span></DT></p>
<DD>
<P class="docList">This counter shows how many objects are currently stored on disk. The
counter is incremented when the entire object has been successfully
written. Thus, this number isn't necessarily equal
to <A NAME="squid-CHP-14-ITERM-1999"></A><A NAME="squid-CHP-14-ITERM-2000"></A>the number of
<TT>StoreEntries</TT> minus the number of
<TT>Hot</TT> <TT>Objects</TT>.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.25"></A>
<H5 class="docSection3Title">14.2.1.25 filedescriptors: Process File Descriptor Allocation</H5>

<P class="docText">This page displays a table of all
<A NAME="squid-CHP-14-ITERM-2001"></A><A NAME="squid-CHP-14-ITERM-2002"></A>file
descriptors currently opened by Squid. It looks like this:</P>

<PRE>File Type   Tout Nread  * Nwrite * Remote Address    Description
---- ------ ---- -------- -------- ----------------- ------------------------------
   3 File      0       0        0                    /usr/local/squid/logs/cache.log
   6 File      0       0  2083739                    /usr/local/squid/logs/access.log
  12 Pipe      0       0        0                    unlinkd -&gt; squid
  13 File      0       0  2485913                    /usr/local/squid/logs/store.log
  15 Pipe      0       0        0                    squid -&gt; unlinkd
  16 Socket   24  220853*    1924  65.200.216.110.80 http://downloads.mp3.com/
  18 Pipe      0       0        0                    squid -&gt; diskd
  19 Socket  179     476*    1747  202.59.16.30.4171 http://ads.vesperexchange.com/
  21 Pipe      0       0        0                    squid -&gt; diskd
  22 Socket   20  158783*     998  210.222.20.8.80   http://home.hanmir.com/a
  24 Pipe      0       0        0                    squid -&gt; diskd
  25 Socket    1       0        0* 210.222.20.8.80   http://home.hanmir.com/b
  26 Socket    0 9048307* 1578290  .0                DNS Socket
  27 Pipe      0       0        0                    squid -&gt; diskd
  28 Socket    0       0        0* 66.28.234.77.80   http://updates.hotbar.com/
  29 Socket    0       0*       0  .0                HTTP Socket
  30 Pipe      0       0        0                    squid -&gt; diskd
  31 Socket    0      93     1126  127.0.0.1.3434    ncsa_auth #1
  32 Socket    0       3       31  127.0.0.1.3438    ncsa_auth #3
  33 Socket    0       0        0  127.0.0.1.3440    ncsa_auth #4
  34 Socket  164    8835* 1070222* 212.47.19.52.2201 http://www.eyyubyaqubov.com/
  35 Socket  177    6137*  249899* 212.47.19.25.3044 http://files10.rarlab.com/
  36 Socket    0       0        0  127.0.0.1.3442    ncsa_auth #5
  37 Socket    7  158783*     774  210.222.20.8.80   http://home.hanmir.com/c
  38 Socket  166    1000*  148415* 202.17.13.8.5787  http://home.hanmir.com/d</PRE>

<P class="docText">The table has seven columns:</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">File</span></span></span></DT></p>
<DD>
<P class="docList">This is simply the file descriptor number. The list always starts
with 3 because descriptors 0, 1, and 2 are reserved for
<span class="docEmphasis">stdin</span>, <span class="docEmphasis">stdout</span>, and
<span class="docEmphasis">stderr</span>. Any other gaps in the list represent
closed descriptors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Type</span></span></span></DT></p>
<DD>
<P class="docList">The type field contains one of the following values:
<span class="docEmphasis">File</span>, <span class="docEmphasis">Pipe</span>, or
<span class="docEmphasis">Socket</span>. The <span class="docEmphasis">File</span> type is
used both for files storing cached responses and for log files, such
as <I>cache.log</I> and
<I>access.log</I>. The <A class="docLink" HREF="mailto:Pipe">Pipe</A> type
represents kernel pipes used for interprocess communication. The
<span class="docEmphasis">Socket</span> type is also occasionally used for
interprocess communication, but it's mostly used for
HTTP (and FTP) connections to clients and servers.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Tout</span></span></span></DT></p>
<DD>
<P class="docList">This is the general-purpose timeout value for the descriptor. It is
expressed in minutes. <span class="docEmphasis">Files</span> and
<span class="docEmphasis">Pipes</span> usually don't have a
timeout, so this value is zero. For <span class="docEmphasis">Sockets</span>,
however, if this number of minutes go by without any activity on the
descriptor, Squid calls a timeout function.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Nread</span></span></span></DT></p>
<DD>
<P class="docList">This is where Squid reports the number of bytes read from the
descriptor. An asterisk (*) after the number means Squid has a
function (a read handler) registered to read additional data, if
there is some available.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Nwrite</span></span></span></DT></p>
<DD>
<P class="docList">This column shows the number of bytes written to the descriptor.
Again, the asterisk (*) indicates that a write handler is present for
the descriptor. You can usually tell if a given socket is connected
to a client or to a server by comparing the number of bytes read and
written. Because requests are normally smaller than responses, a
server connection has a higher <TT>Nread</TT> count than
<TT>Nwrite</TT>. The opposite is true for client
connections.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Remote Address</span></span></span></DT></p>
<DD>
<P class="docList">For <span class="docEmphasis">Sockets</span>, this field shows the remote TCP
address of the connection. The format is similar to what you would
find in <I>netstat -n</I> output: an IP address followed
by the TCP port number.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Description</span></span></span></DT></p>
<DD>
<P class="docList">The description field indicates the descriptor's
use. For <span class="docEmphasis">Files</span>, you'll see a
pathname; for <span class="docEmphasis">Pipes</span>, a description to what the
pipe is connected; and for <span class="docEmphasis">Sockets</span>, a URI, or at
least the first part of it. A description such as
<TT>web.icq.com</TT> <TT>idle</TT>
<TT>connection</TT> indicates an idle persistent
connection to an origin server. Similarly,
<TT>Waiting</TT>
<TT>for</TT>
<TT>next</TT>
<TT>request</TT> is an idle client-side
persistent connection.</P>
</DD>
</DL>

<P class="docText">By default, the File Descriptor page isn't
password-protected. However, you may want to give it a password
because it contains some sensitive and, perhaps, personally
identifiable information.</P>



<A NAME="squid-CHP-14-SECT-2.1.26"></A>
<H5 class="docSection3Title">14.2.1.26 objects: All Cache Objects</H5>

<P class="docText">Requesting this page results in a <A NAME="squid-CHP-14-ITERM-2003"></A><A NAME="squid-CHP-14-ITERM-2004"></A>list of all
objects in the cache. Be careful with this page because it can be
extremely long. Furthermore, it contains low-level information that
is probably useful only to developers.</P>

<P class="docText">For each cached object, Squid prints a sequence of lines, most of
which look like this:</P>

<PRE>KEY FF1F6736BCC167A4C3F93275A126C5F5
        STORE_OK      NOT_IN_MEMORY SWAPOUT_DONE PING_NONE
        CACHABLE,DISPATCHED,VALIDATED
        LV:1020824321 LU:1020824671 LM:1020821288 EX:-1
        0 locks, 0 clients, 1 refs
        Swap Dir 0, File 0X010AEE</PRE>

<P class="docText">The first line shows the cache key—a 128-bit MD5 checksum of
the URI. The same MD5 checksum appears in
<I>store.log</I> and in the metadata at the beginning
of each response cached on disk.</P>

<P class="docText">The second line shows four state variables of the
<TT>StoreEntry</TT> data structure:
<span class="docEmphasis">store_status</span>, <span class="docEmphasis">mem_status</span>,
<span class="docEmphasis">swap_status</span>, and
<span class="docEmphasis">ping_status</span>. Refer to the Squid source code if
you'd like more information about them.</P>

<P class="docText">The third line is a list of the <TT>StoreEntry</TT> flags
that are set. Search the source code for
<span class="docEmphasis">e-&gt;flags</span> for more information.</P>

<P class="docText">The fourth line shows the values of four timestamps: last-validation,
last-use, last-modification, and expiration. The last-modification
and expiration timestamps are taken from the origin
server's HTTP response. The others are maintained by
Squid.</P>

<P class="docText">The fifth line shows a few counters: locks, clients, and references.
An entry with locks can't be removed. The
<TT>clients</TT> counter shows how many clients are
currently receiving data for this object. The <TT>refs</TT>
counter shows how many times the object has been requested.</P>

<P class="docText">The sixth line shows the object's index to the
on-disk storage. Each object has a 7-bit swap directory index and a
25-bit file number. Each storage scheme has a function to map these
numbers into pathnames.</P>



<A NAME="squid-CHP-14-SECT-2.1.27"></A>
<H5 class="docSection3Title">14.2.1.27 vm_objects: In-Memory and In-Transit Objects</H5>

<P class="docText">This page is similar to All Cache Objects,
<A NAME="squid-CHP-14-ITERM-2005"></A><A NAME="squid-CHP-14-ITERM-2006"></A>except
that it displays only objects that have a
<TT>MemObject</TT> data structure. In other words, objects
that are currently being requested or are stored in the memory cache.
These objects are displayed like this:</P>

<PRE>KEY 5107D49BA7F9C6BA9559E006D6DDC4B2
        GET http://www.rpgplanet.com/ac2hq/cartography/dynamic/LinvakMassif.jpg
        STORE_PENDING NOT_IN_MEMORY SWAPOUT_WRITING PING_DONE
        CACHABLE,DISPATCHED,VALIDATED
        LV:1043286120 LU:1043286122 LM:1036015230 EX:-1
        4 locks, 1 clients, 1 refs
        Swap Dir 1, File 00X31BD9
        inmem_lo: 184784
        inmem_hi: 229840
        swapout: 229376 bytes queued
        swapout: 229509 bytes written
        Client #0, 1533a1018
                copy_offset: 217552
                seen_offset: 217552
                copy_size: 4096
                flags:</PRE>

<P class="docText">As you can see, many of the lines are the same. However, the
in-memory objects have a few additional lines. Directly following the
cache key (MD5 checksum), Squid prints the request method and URI.</P>

<P class="docText">The <TT>inmem_lo</TT> and <TT>inmem_hi</TT> lines
are byte offsets of the HTTP reply. They indicate the section of
object data currently in memory. In most cases, the difference
between these two should be less than the value of the
<span class="docEmphasis">maximum_object_size_in_memory</span> directive.</P>

<P class="docText">The <TT>swapout</TT>: <TT>bytes</TT>
<TT>queued</TT> line shows the offset for how many bytes
have been given to the storage layer for writing. For objects in the
<TT>SWAPOUT_DONE</TT> state, this value is the same as the
object size. If the state is <TT>SWAPOUT_WRITING</TT>,
Squid also shows the <TT>bytes written</TT> line, which
indicates how many bytes have been successfully stored on disk.</P>

<P class="docText">If one or more clients are currently receiving the response,
you'll see a section for each of them
(<TT>Client #0</TT> in this example). For each client,
Squid reports another pair of offset values. The first,
<TT>copy_offset</TT>, is the starting point for the last
time the client-side asked for data from the storage system. The
second, <TT>seen_offset</TT>, is the point at which the
response data has been sent to the client. Note that
<TT>copy_offset</TT> is always greater than or equal to
<TT>seen_offset</TT>. The <TT>copy_size</TT>
indicates the maximum amount of data the client can receive from the
storage system.</P>



<A NAME="squid-CHP-14-SECT-2.1.28"></A>
<H5 class="docSection3Title">14.2.1.28 openfd_objects: Objects with Swapout Files Open</H5>

<P class="docText">The format of this page is the <A NAME="squid-CHP-14-ITERM-2007"></A><A NAME="squid-CHP-14-ITERM-2008"></A>same
as for In-Memory and In-Transit Objects. The objects reported on this
page should all be in the <TT>SWAPOUT_WRITING</TT> state.
The page is primarily useful to developers when trying to track down
file-descriptor leaks.</P>



<A NAME="squid-CHP-14-SECT-2.1.29"></A>
<H5 class="docSection3Title">14.2.1.29 io: Server-Side Network read( ) Size Histograms</H5>

<P class="docText">This page displays a histogram <A NAME="squid-CHP-14-ITERM-2009"></A><A NAME="squid-CHP-14-ITERM-2010"></A>for each of the
following four server-side protocols: HTTP, FTP, Gopher, and WAIS.
The histograms show how many bytes each <I>read( )</I>
call received. The information is primarily useful to developers for
tuning buffer sizes and other aspects of the source code.</P>

<P class="docText">The bins of the histogram are logarithmic to accommodate the large
scale of read sizes. Here is an example:</P>

<PRE>HTTP I/O
number of reads: 9016088
Read Histogram:
    1-    1:      3082  0%
    2-    2:       583  0%
    3-    4:       905  0%
    5-    8:      2666  0%
    9-   16:     16690  0%
   17-   32:     88046  1%
   33-   64:     19712  0%
   65-  128:    116655  1%
  129-  256:    749259  8%
  257-  512:    633075  7%
  513- 1024:    903145 10%
 1025- 2048:   3664862 41%
 2049- 4096:   1643747 18%
 4097- 8192:    789796  9%
 8193-16384:     99476  1%
16385-32768:     30059  0%</PRE>

<P class="docText">In this case, you can see that the bin for 1025-2048 bytes is the
most popular. When reading from an HTTP server, Squid got between
1025 and 2048 bytes per read 41% of the time.</P>



<A NAME="squid-CHP-14-SECT-2.1.30"></A>
<H5 class="docSection3Title">14.2.1.30 counters: Traffic and Resource Counters</H5>

<P class="docText">Squid maintains a data<A NAME="squid-CHP-14-ITERM-2011"></A><A NAME="squid-CHP-14-ITERM-2012"></A> structure
of counters. Actually, it is an array of counters. Squid shifts the
array every 60 seconds and calculates 1-, 5-, and 60-minute averages
from this array. This page is simply a dump of the current counter
values in a format more suitable for computer processing than for
reading by humans. The counters are as follows:</P>

<A NAME="squid-CHP-14-ITERM-2013"></A><A NAME="squid-CHP-14-ITERM-2014"></A><DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">sample_time</span></span></span></DT></p>
<DD>
<P class="docList">The sample time is actually the time of the last shift, rather than
the current time. The sample time is always within 60 seconds of the
current time.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.requests</span></span></span></DT></p>
<DD>
<P class="docList">The number of HTTP requests received from clients.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.hits</span></span></span></DT></p>
<DD>
<P class="docList">The number of cache hits in response to client requests. A hit is any
transaction logged with one of the <TT>TCP_HIT</TT> codes
in <I>access.log</I>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.errors</span></span></span></DT></p>
<DD>
<P class="docList">The number of client transactions that resulted in an error.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.kbytes_in</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic (in kilobytes) received from clients in their
requests. This is measured at the HTTP layer and
doesn't include TCP, IP, and other packet headers.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.kbytes_out</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic (in kilobytes) sent to clients in responses.
Also measured at the HTTP layer.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.hit_kbytes_out</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic sent to clients in responses that are cache
hits. Keep in mind that some cache hits are 304 (Not Modified)
responses.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.all.requests</span></span></span></DT></p>
<DD>
<P class="docList">The number of requests forwarded to origin servers (or neighbor
caches) for all server-side protocols (HTTP, FTP, Gopher, etc.).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.all.errors</span></span></span></DT></p>
<DD>
<P class="docList">The number of server-side requests (all protocols) that resulted in
some kind of error.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.all.kbytes_in</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic (in kilobytes) read from the server-side for
all protocols.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.all.kbytes_out</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic written to origin servers and/or neighbor
caches for server-side requests.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.http.requests</span></span></span></DT></p>
<DD>
<P class="docList">The number of server-side requests to HTTP servers, including
neighbor caches.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.http.errors</span></span></span></DT></p>
<DD>
<P class="docList">The number of server-side HTTP requests that resulted in an error.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.http.kbytes_in</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic read from HTTP origin servers and neighbor
caches.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.http.kbytes_out</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic written to HTTP origin servers and neighbor
caches.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.ftp.requests</span></span></span></DT></p>
<DD>
<P class="docList">The number of requests sent to FTP servers.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.ftp.errors</span></span></span></DT></p>
<DD>
<P class="docList">The number of requests sent to FTP servers that resulted in an error.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.ftp.kbytes_in</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic read from FTP servers, including control
channel traffic.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.ftp.kbytes_out</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic written to FTP servers, including control
channel traffic.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.other.requests</span></span></span></DT></p>
<DD>
<P class="docList">The number of "other" server-side
requests. Currently, the other protocols are Gopher, WAIS, and SSL.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.other.errors</span></span></span></DT></p>
<DD>
<P class="docList">The number of Gopher, WAIS, and SSL requests that resulted in an
error.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.other.kbytes_in</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic read from Gopher, WAIS, and SSL servers.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">server.other.kbytes_out</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic written to Gopher, WAIS, and SSL servers.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.pkts_sent</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP messages sent to neighbors. This includes both
queries and replies but doesn't include HTCP
messages.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.pkts_recv</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP messages received from neighbors, including both
queries and replies.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.queries_sent</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP queries sent to neighbors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.replies_sent</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP replies sent to neighbors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.queries_recv</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP queries received from neighbors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.replies_recv</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP replies received from neighbors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.query_timeouts</span></span></span></DT></p>
<DD>
<P class="docList">The number of times that Squid timed out waiting for ICP replies to
arrive.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.replies_queued</span></span></span></DT></p>
<DD>
<P class="docList">The number of times Squid queued an ICP message after the initial
attempt to send failed. See <A class="docLink" HREF="#squid-CHP-14-SECT-2.1.24">Section 14.2.1.24</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.kbytes_sent</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic sent in all ICP messages, including both
queries and replies.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.kbytes_recv</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic received in all ICP messages, including both
queries and replies.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.q_kbytes_sent</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic sent to neighbors in ICP queries.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.r_kbytes_sent</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic sent to neighbors in ICP replies.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.q_kbytes_recv</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic received from neighbors in ICP queries.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.r_kbytes_recv</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic received from neighbors in ICP replies.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.times_used</span></span></span></DT></p>
<DD>
<P class="docList">The number of times ICP resulted in the selection of a neighbor as
the next-hop for a cache miss.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cd.times_used</span></span></span></DT></p>
<DD>
<P class="docList">The number of times Cache Digests resulted in the selection of a
neighbor as the next-hop for a cache miss.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cd.msgs_sent</span></span></span></DT></p>
<DD>
<P class="docList">The number of Cache Digest messages sent to neighbors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cd.msgs_recv</span></span></span></DT></p>
<DD>
<P class="docList">The number of Cache Digest messages received from neighbors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cd.memory</span></span></span></DT></p>
<DD>
<P class="docList">The amount of memory (in kilobytes) used by enabling the Cache
Digests' feature.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cd.local_memory</span></span></span></DT></p>
<DD>
<P class="docList">The amount of memory (in kilobytes) used to store
Squid's own Cache Digest.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cd.kbytes_sent</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic sent to neighbors in Cache Digest messages.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cd.kbytes_recv</span></span></span></DT></p>
<DD>
<P class="docList">The amount of traffic received from neighbors in Cache Digest
messages.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">unlink.requests</span></span></span></DT></p>
<DD>
<P class="docList">The number of unlink requests given to the (optional)
<I>unlinkd</I> process.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">page_faults</span></span></span></DT></p>
<DD>
<P class="docList">The number of (major) page faults as reported by <I>getrusage(
)</I>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">select_loops</span></span></span></DT></p>
<DD>
<P class="docList">The number of times Squid called <I>select( )</I> or
<I>poll( )</I> in the main I/O loop.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">cpu_time</span></span></span></DT></p>
<DD>
<P class="docList">The amount of CPU time (in seconds) accumulated, as reported by
<I>getrusage( )</I>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">wall_time</span></span></span></DT></p>
<DD>
<P class="docList">The amount of human time (in seconds) elapsed since Squid was started.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">swap.outs</span></span></span></DT></p>
<DD>
<P class="docList">The number of objects (swap files) saved to disk.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">swap.ins</span></span></span></DT></p>
<DD>
<P class="docList">The number of objects (swap files) read from disk.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">swap.files_cleaned</span></span></span></DT></p>
<DD>
<P class="docList">The number of orphaned cache files removed by the periodic cleanup
procedure.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">aborted_requests</span></span></span></DT></p>
<DD>
<P class="docList">The number of server-side HTTP <A NAME="squid-CHP-14-ITERM-2013"></A><A NAME="squid-CHP-14-ITERM-2014"></A>requests aborted due to client-side
aborts.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.31"></A>
<H5 class="docSection3Title">14.2.1.31 peer_select: Peer Selection Algorithms</H5>

<P class="docText">This page contains a lot of low-level
<A NAME="squid-CHP-14-ITERM-2015"></A><A NAME="squid-CHP-14-ITERM-2016"></A>detail
about cache digests that I won't discuss. Most of
the numbers are meaningful only to the developers that originally
wrote the Cache Digest implementation.</P>

<P class="docText">However, at the end of this page is a little table that compares
<TT>Algorithm usage</TT>:</P>

<PRE>Algorithm usage:
Cache Digest:      27 ( 24%)
Icp:               84 ( 76%)
Total:            111 (100%)</PRE>

<P class="docText">In this example, you can see that Squid sent 111 requests to one of
its neighbors: 27 are due to Cache Digests and 84 are due to ICP. In
this context, ICP also includes HTCP.</P>



<A NAME="squid-CHP-14-SECT-2.1.32"></A>
<H5 class="docSection3Title">14.2.1.32 digest_stats: Cache Digest and ICP Blob</H5>

<P class="docText">This page is actually just a <A NAME="squid-CHP-14-ITERM-2017"></A><A NAME="squid-CHP-14-ITERM-2018"></A><A NAME="squid-CHP-14-ITERM-2019"></A>concatenation
of the following other cache manager pages:</P>

<UL><LI><P class="docList">Traffic and Resource Counters</P></LI><LI><P class="docList">5 Minute Average of Counters</P></LI><LI><P class="docList">Full Histogram Counts</P></LI><LI><P class="docList">Peer Selection Algorithms</P></LI><LI><P class="docList">Store Digest</P></LI></UL>
<P class="docText">Its only purpose is to enable developers to take a snapshot of a
number of statistics with a single request.</P>



<A NAME="squid-CHP-14-SECT-2.1.33"></A>
<H5 class="docSection3Title">14.2.1.33 5min: 5 Minute Average of Counters</H5>

<P class="docText">This page shows a five-minute <A NAME="squid-CHP-14-ITERM-2020"></A><A NAME="squid-CHP-14-ITERM-2021"></A>average of the
data in the Traffic and Resource Counters page. In addition to the
counters mentioned in <A class="docLink" HREF="#squid-CHP-14-SECT-2.1.30">Section 14.2.1.30</A>, this page also contains the
following values:</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.all_median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The median service (response) time for all client requests from the
last five minutes.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.miss_median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The median service time for cache misses from the last five minutes.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.nm_median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute median service time for requests logged as
<TT>TCP_IMS_HIT</TT>. See "Not-Modified
Replies" in <A class="docLink" HREF="#squid-CHP-14-SECT-2.1.24">Section 14.2.1.24</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.nh_median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute median service time for Near Hits
(<TT>TCP_REFRESH_HIT</TT> requests).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">client_http.hit_median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute median service time for unvalidated cache hits.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.query_median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute median service time for ICP queries sent by Squid
(how long it takes for the neighbors to reply to our queries).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">icp.reply_median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute median service time for ICP queries received by Squid
(how long it takes Squid to reply to its neighbor's
queries). ICP processing normally occurs faster than the process
clock is updated, so this value is always zero.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">dns.median_svc_time</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute median service time for DNS queries.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">select_fds</span></span></span></DT></p>
<DD>
<P class="docList">The mean rate at which the main I/O loop scans file descriptors with
<I>select( )</I> or <I>poll( )</I>. Note:
a low number doesn't necessarily indicate poor
performance. It may just be that Squid often has no work to do.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">average_select_fd_period</span></span></span></DT></p>
<DD>
<P class="docList">The mean number of seconds required to scan a file descriptor in the
main I/O loop.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">median_select_fds</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute median number of ready file descriptors each time
Squid calls <I>select( )</I> or <I>poll(
)</I> (the median of the <I>select(
)</I>/<I>poll( )</I> return value).
Unfortunately, this value is almost always zero because
Squid's functions for calculating the median
don't work very well with the
<TT>select_fds</TT> histogram, in which 0 and 1 are the
most common values.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.selects</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of calls to <I>select(
)</I>/<I>poll( )</I>. If Squid is using
<I>poll( )</I> on your system, the variable is called
<span class="docEmphasis">syscalls.polls</span>. This value may be a little
larger than <span class="docEmphasis">select_loops</span>, because the latter
only includes calls in the main I/O loop.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.disk.opens</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>open( )</I> calls for
disk files.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.disk.closes</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>close( )</I> calls for
disk files.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.disk.reads</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>read( )</I> calls for
disk files.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.disk.writes</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>write( )</I> calls for
disk files.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.disk.seeks</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>seek( )</I> calls for
disk files. Probably zero unless you are using
<span class="docEmphasis">aufs</span>, which always calls <I>seek(
)</I> before reading.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.disk.unlinks</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>unlink( )</I> (or, in
some cases, <I>truncate( )</I>) calls for disk files.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.accepts</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>accept( )</I> calls for
network sockets.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.sockets</span></span></span></DT></p>
<DD>
<P class="docList">The five- minute mean rate of <I>socket( )</I> calls
for network sockets.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.connects</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>connect( )</I> calls
for network sockets.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.binds</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>bind( )</I> calls for
network sockets.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.closes</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>close( )</I> calls for
network sockets.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.reads</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>read( )</I> calls for
network sockets.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.writes</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>write( )</I> calls for
network sockets.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.recvfroms</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>recvfrom( )</I> calls
for network sockets. Used for UDP-based protocols, such as DNS, ICP,
HTCP, and some interprocess communication.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">syscalls.sock.sendtos</span></span></span></DT></p>
<DD>
<P class="docList">The five-minute mean rate of <I>sendto( )</I> calls for
network sockets. Used for UDP-based protocols, such as DNS, ICP,
HTCP, and some interprocess communication.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.34"></A>
<H5 class="docSection3Title">14.2.1.34 60min: 60 Minute Average of Counters</H5>

<P class="docText">This page shows a 60-minute average <A NAME="squid-CHP-14-ITERM-2022"></A><A NAME="squid-CHP-14-ITERM-2023"></A>of the data in
the Traffic and Resource Counters page. The descriptions are
identical to those for the 5 Minute Average of Counters
page, except the measurements are taken over one hour.</P>



<A NAME="squid-CHP-14-SECT-2.1.35"></A>
<H5 class="docSection3Title">14.2.1.35 utilization: Cache Utilization</H5>

<P class="docText">This page displays averages of the <A NAME="squid-CHP-14-ITERM-2024"></A><A NAME="squid-CHP-14-ITERM-2025"></A>counters
(see Traffic and Resource Counters and 5 Minute Average of Counters)
over various time spans. The same values are reported for 5-minute,
15-minute, 1-hour, 8-hour, 1-day, and 3-day intervals.</P>

<P class="docText">This page, with a poorly chosen name, exists primarily so that
developers can take a quick snapshot of statistics for testing
purposes.</P>



<A NAME="squid-CHP-14-SECT-2.1.36"></A>
<H5 class="docSection3Title">14.2.1.36 histograms: Full Histogram Counts</H5>

<P class="docText">This page displays the current <A NAME="squid-CHP-14-ITERM-2026"></A><A NAME="squid-CHP-14-ITERM-2027"></A>histogram
values (since Squid was started) for a number of measurements:</P>

<UL><LI><P class="docList"><TT>client_http.all_svc_time</TT></P></LI><LI><P class="docList"><TT>client_http.miss_svc_time</TT></P></LI><LI><P class="docList"><TT>client_http.nm_svc_time</TT></P></LI><LI><P class="docList"><TT>client_http.nh_svc_time</TT></P></LI><LI><P class="docList"><TT>client_http.hit_svc_time</TT></P></LI><LI><P class="docList"><TT>icp.query_svc_time</TT></P></LI><LI><P class="docList"><TT>icp.reply_svc_time</TT></P></LI><LI><P class="docList"><TT>dns.svc_time</TT></P></LI><LI><P class="docList"><TT>select_fds_hist</TT></P></LI></UL>
<P class="docText">These are the same measurements described in <A class="docLink" HREF="#squid-CHP-14-SECT-2.1.33">Section 14.2.1.33</A>, except that here Squid
gives the full histogram, instead of the mean or median.</P>

<P class="docText">Depending on the type of histogram, you may see two or three columns.
The first column is the bin number and lower bound on the bin value.
The second column is the number of counts for that bin. The optional
third column is the number of counts divided by the
"size" of the bin. The last column
is probably only interesting for log-based histograms, in which the
bin size isn't constant.</P>



<A NAME="squid-CHP-14-SECT-2.1.37"></A>
<H5 class="docSection3Title">14.2.1.37 active_requests: Client-Side Active Requests</H5>

<P class="docText">This page shows a list of currently
<A NAME="squid-CHP-14-ITERM-2028"></A><A NAME="squid-CHP-14-ITERM-2029"></A>active
client-side requests. The list is sorted starting with the most
recent, and ending with the oldest requests. The information given
here is primarily useful to developers. A typical entry looks like
this:</P>

<PRE>Connection: 0x84ecd10
        FD 132, read 1273, wrote 12182
        FD desc: http://www.squid-cache.org/Doc/FAQ/FAQ.html
        in: buf 0xa063000, offset 0, size 4096
        peer: 206.168.0.9:1058
        me: 192.43.244.42:3128
        nrequests: 3
        defer: n 0, until 0
uri http://www.squid-cache.org/Doc/FAQ/FAQ.html
log_type TCP_MISS
out.offset 0, out.size 0
req_sz 392
entry 0x960c680/3B49762ABF444D80B6465552F6CFAD4C
old_entry 0x0/N/A
start 1066036250.669955 (2.240814 seconds ago)</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Connection</span></span></span></DT></p>
<DD>
<P class="docList">The internal memory address of the connection structure.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">FD</span></span></span></DT></p>
<DD>
<P class="docList">The file descriptor for the TCP connection, followed by the number of
bytes read and written.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">FD desc</span></span></span></DT></p>
<DD>
<P class="docList">A short description of the socket, usually a URI. This is the same as
in <A class="docLink" HREF="#squid-CHP-14-SECT-2.1.25">Section 14.2.1.25</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">in</span></span></span></DT></p>
<DD>
<P class="docList">The internal memory location of the input buffer, the offset at which
Squid will place data after the next <I>read( )</I>
call, and the size of the input buffer.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">peer</span></span></span></DT></p>
<DD>
<P class="docList">The remote socket address of the TCP connection. You can correlate
this value with what you see in <I>netstat -n</I> output.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">me</span></span></span></DT></p>
<DD>
<P class="docList">The local socket address of the TCP connection.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">nrequests</span></span></span></DT></p>
<DD>
<P class="docList">The number of HTTP requests received on this connection. A value
greater than 1 indicates persistent connection reuse.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">defer</span></span></span></DT></p>
<DD>
<P class="docList">Indicates whether Squid is postponing reads on the socket.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">uri</span></span></span></DT></p>
<DD>
<P class="docList">The URI from the client's request. Unlike
<TT>FD desc</TT>, this one isn't
truncated.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">log_type</span></span></span></DT></p>
<DD>
<P class="docList">The cache status code that appears in <I>access.log</I>
when this transaction is complete.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">out.offset</span></span></span></DT></p>
<DD>
<P class="docList">The offset, relative to the start of the HTTP reply message, in which
the client side has requested data from the storage system.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">out.size</span></span></span></DT></p>
<DD>
<P class="docList">The number of response bytes written to the client.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">req_sz</span></span></span></DT></p>
<DD>
<P class="docList">The size of the client's HTTP request. Note, for
persistent connections, this refers only to the current request.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">entry</span></span></span></DT></p>
<DD>
<P class="docList">The memory address and MD5 hash of the corresponding
<TT>StoreEntry</TT> structure.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">old_entry</span></span></span></DT></p>
<DD>
<P class="docList">For validation requests, this is the memory address and MD5 hash of
the cached response <TT>StoreEntry</TT>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">start</span></span></span></DT></p>
<DD>
<P class="docList">The time at which Squid began processing this request.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.38"></A>
<H5 class="docSection3Title">14.2.1.38 store_digest: Store Digest</H5>

<P class="docText">This page is available only with <A NAME="squid-CHP-14-ITERM-2030"></A><A NAME="squid-CHP-14-ITERM-2031"></A>the
<I>./configure</I>
<I>—enable-cache-digests</I> option. It displays a
few statistics about Squid's own cache digest. It
looks like this:</P>

<PRE>store digest: size: 620307 bytes
         entries: count: 324806 capacity: 992490 util: 33%
         deletion attempts: 0
         bits: per entry: 5 on: 1141065 capacity: 4962456 util: 23%
         bit-seq: count: 1757902 avg.len: 2.82
         added: 324806 rejected: 611203 ( 65.30 %) del-ed: 0
         collisions: on add: 0.08 % on rej: 0.07 %</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">size</span></span></span></DT></p>
<DD>
<P class="docList">The number of bytes that the digest occupies in memory.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">entries count</span></span></span></DT></p>
<DD>
<P class="docList">The number of cached objects entered into the digest.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">entries capacity</span></span></span></DT></p>
<DD>
<P class="docList">The target capacity for the digest. Note, this isn't
a hard limit, but rather an estimate for optimally sizing the digest.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">entries util</span></span></span></DT></p>
<DD>
<P class="docList">The percentage of entries added compared to the capacity.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">deletion attempts</span></span></span></DT></p>
<DD>
<P class="docList">Squid doesn't currently support deletion of cache
digest entries, so this is always zero.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">bits per entry</span></span></span></DT></p>
<DD>
<P class="docList">The number of bits that each item turns on. The same as the
<span class="docEmphasis">digest_bits_per_entry</span> value from
<I>squid.conf</I>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">bits on</span></span></span></DT></p>
<DD>
<P class="docList">The number of bits that have been turned on so far.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">bits capacity</span></span></span></DT></p>
<DD>
<P class="docList">The total number of bits in the digest. Equal to the digest size
multiplied by eight.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">bit-seq count</span></span></span></DT></p>
<DD>
<P class="docList">The number of same-bit sequences in the digest. For example, the
pattern 110100011111 has 5 sequences of 1s and 0s.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">bit-seq avg.len</span></span></span></DT></p>
<DD>
<P class="docList">The mean length of same-bit sequences.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">added</span></span></span></DT></p>
<DD>
<P class="docList">The number of entries added to the digest since it was created.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">rejected</span></span></span></DT></p>
<DD>
<P class="docList">The number of entries not added to the digest. An entry may not be
added because it isn't cachable, is too large,
stale, or about to become stale, etc.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">del-ed</span></span></span></DT></p>
<DD>
<P class="docList">Squid doesn't currently support deletion of cache
digest entries, so this is always zero.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">collisions on add</span></span></span></DT></p>
<DD>
<P class="docList">This is the percentage of additions that didn't turn
on any new bits. Recall that Bloom filters have the property that two
or more entries may turn on the same bit.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">collisions on rej</span></span></span></DT></p>
<DD>
<P class="docList">This is the percentage of rejected additions that
wouldn't have turned on any new bits.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.39"></A>
<H5 class="docSection3Title">14.2.1.39 storedir: Store Directory Stats</H5>

<P class="docText">This page displays some statistics<A NAME="squid-CHP-14-ITERM-2032"></A><A NAME="squid-CHP-14-ITERM-2033"></A> from the storage system.
First, you'll see a few global values. For example:</P>

<PRE>Store Directory Statistics:
Store Entries          : 2873564
Maximum Swap Size      : 46080000 KB
Current Store Swap Size: 41461672 KB
Current Capacity       : 90% used, 10% free</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Store Entries</span></span></span></DT></p>
<DD>
<P class="docList">The number of <TT>StoreEntry</TT> objects. Most, but not
necessarily all, of these are for on-disk objects.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Maximum Swap Size</span></span></span></DT></p>
<DD>
<P class="docList">The sum of all <span class="docEmphasis">cache_dir</span> sizes.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Current Store Swap Size</span></span></span></DT></p>
<DD>
<P class="docList">The total amount of cached data currently stored on disk. Note that
Squid rounds response sizes (e.g., 1722 bytes) up to the nearest
multiple filesystem block size (e.g., 2048 bytes) when incrementing
and decrementing this value.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Current Capacity</span></span></span></DT></p>
<DD>
<P class="docList">The percentage of the maximum disk space currently in use. The
percentage in use should normally stay below the
<span class="docEmphasis">cache_swap_high</span> value.</P>
</DD>
</DL>

<P class="docText">Next, you'll see a section for each
<span class="docEmphasis">cache_dir</span>. It looks something like this:</P>

<PRE>Store Directory #1 (diskd): /cache1
FS Block Size 1024 Bytes
First level subdirectories: 16
Second level subdirectories: 64
Maximum Size: 15360000 KB
Current Size: 13823996 KB
Percent Used: 90.00%
Filemap bits in use: 958439 of 2097152 (46%)
Filesystem Space in use: 14030485/17370434 KB (81%)
Filesystem Inodes in use: 959440/4340990 (22%)
Flags: SELECTED
Pending operations: 0
Removal policy: lru
LRU reference age: 23.63 days</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Store Directory #</span></span></span></DT></p>
<DD>
<P class="docList">The directory number, type, and pathname.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">FS Block Size</span></span></span></DT></p>
<DD>
<P class="docList">The filesystem block size, determined by the <I>statfs(
)</I> or <I>statvfs( )</I> system calls. If
these functions aren't available or return an error,
the block size defaults to 2048 bytes.</P>
</DD>
</DL>

<P class="docText">The next few lines are actually storage scheme-dependent. For the
most part, <span class="docEmphasis">ufs</span>, <span class="docEmphasis">aufs</span>, and
<span class="docEmphasis">diskd</span> are very similar and all report the same
statistics.</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">First level subdirectories</span></span></span></DT></p>
<DD>
<P class="docList">The number of first-level subdirectories you told Squid to use on the
<span class="docEmphasis">cache_dir</span> line.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Second level subdirectories</span></span></span></DT></p>
<DD>
<P class="docList">The number of second-level subdirectories you told Squid to use on
the <span class="docEmphasis">cache_dir</span> line.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Maximum Size</span></span></span></DT></p>
<DD>
<P class="docList">The maximum allowed size for this cache directory.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Current Size</span></span></span></DT></p>
<DD>
<P class="docList">The amount of disk space currently in use.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Percent Used</span></span></span></DT></p>
<DD>
<P class="docList">The percentage of <span class="docEmphasis">cache_dir</span> space currently in
use.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Filemap bits in use</span></span></span></DT></p>
<DD>
<P class="docList">Squid uses a bitmap to keep track of file numbers that are allocated
and free. This line shows the number and percentage of bits in use.
The filemap grows automatically as needed, so don't
worry if it shows up as 99% full.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Filesystem Space in use</span></span></span></DT></p>
<DD>
<P class="docList">These numbers come from the <I>statfs(
)</I>/<I>statvfs( )</I> system calls. These
should be the same values as you'd see from the
<I>df</I> command. Squid doesn't use
these numbers, other than to report them here for your information.
Note that these values may be larger than
<TT>Current</TT>
<TT>Size</TT>, especially if the partition is
used for more than Squid's cache.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Filesystem Inodes in use</span></span></span></DT></p>
<DD>
<P class="docList">These numbers also come from <I>statfs(
)</I>/<I>statvfs( )</I>. They are present to
remind you that running out of inodes is just as bad as running out
of free space. Unfortunately, if you run out of inodes,
you'll probably be forced to
<I>newfs</I> the partition.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Flags</span></span></span></DT></p>
<DD>
<P class="docList">Possible values include <TT>SELECTED</TT> and
<TT>READ-ONLY</TT>. The <TT>SELECTED</TT> flag
means that this particular <span class="docEmphasis">cache_dir</span> was most
recently selected by the cache directory selection algorithm (see
<A class="docLink" HREF="squid-CHP-7-SECT-4.html#squid-CHP-7-SECT-4">Section 7.4</A>). The <TT>READ-ONLY</TT> flag
means that the cache directory has been marked
<TT>read-only</TT> in the configuration file (see <A class="docLink" HREF="squid-CHP-7-SECT-1.html#squid-CHP-7-SECT-1.5">Section 7.1.5</A>).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Pending operations</span></span></span></DT></p>
<DD>
<P class="docList">This line appears only for <span class="docEmphasis">diskd</span> cache
directories. It shows the number of I/O requests dispatched to the
<I>diskd</I> process that have not yet been acknowledged.</P>
</DD>
</DL>

<P class="docText">That's the end of the scheme-specific data. The
remaining lines are specific to the <span class="docEmphasis">cache_dir</span>
replacement algorithm:</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Removal policy</span></span></span></DT></p>
<DD>
<P class="docList">Possible values include <TT>lru</TT> (the default) or
<TT>heap</TT>. Note that for <TT>heap</TT>, you
won't see the algorithm name (LFU, GDSF, or LRU).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">LRU reference age</span></span></span></DT></p>
<DD>
<P class="docList">If the removal policy is <TT>lru</TT>,
you'll also see this line. It shows the age of the
oldest object in the LRU list.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.40"></A>
<H5 class="docSection3Title">14.2.1.40 store_check_cachable_stats: storeCheckCachable( ) Stats</H5>

<P class="docText">This page displays a table of
<A NAME="squid-CHP-14-ITERM-2034"></A><A NAME="squid-CHP-14-ITERM-2035"></A>counters
from the <I>storeCheckCachable( )</I> function. It is
called for most responses, just before Squid attempts to open a disk
file for writing.</P>

<P><table border="0" bgcolor="black" cellspacing="0" cellpadding="1" width="90%" align="center"><tr><td><table bgcolor="white" width="100%" border="0" cellspacing="0" cellpadding="6"><tr><td width="60" valign="top"><img src="images/tip_yellow.gif" width="50" height="54"></td><td valign="top">
<P class="docText">Squid knows that some responses can't be cached,
based entirely on the request. These responses
aren't included in the <I>storeCheckCachable(
)</I> statistics.</P>
</td></tr></table></td></tr></table></P><br>

<P class="docText">The table includes the following lines:</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.not_entry_cachable</span></span></span></DT></p>
<DD>
<P class="docList">The <TT>ENTRY_CACHABLE</TT> flag was cleared for some
reason.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.release_request</span></span></span></DT></p>
<DD>
<P class="docList">The <TT>RELEASE_REQUEST</TT> flag was set while reading the
response. This may be due to an error (such as receiving a partial
response) or to the rules of the transfer protocol.</P>

<P class="docList">In some versions of Squid, this counter is always zero because the
<I>storeReleaseRequest( )</I> function always clears
the <TT>ENTRY_CACHABLE</TT> bit, causing such objects to be
counted as <TT>no.not_entry_cachable</TT> instead.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.wrong_content_length</span></span></span></DT></p>
<DD>
<P class="docList">The actual content length doesn't match the
<TT>Content-Length</TT> header value.</P>
</DD>
</DL>

<P class="docText">In some versions of Squid, this counter is always zero because
<I>storeReleaseRequest( )</I> is always called if the
response size doesn't match the expected content
length.</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.negative_cached</span></span></span></DT></p>
<DD>
<P class="docList">The <TT>ENTRY_NEGCACHED</TT> flag was set. See the
description for <TT>TCP_NEGATIVE_HIT</TT> in <A class="docLink" HREF="squid-CHP-13-SECT-2.html#squid-CHP-13-SECT-2.1">Section 13.2.1</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.too_big</span></span></span></DT></p>
<DD>
<P class="docList">The response body was larger than the
<span class="docEmphasis">maximum_object_size</span> value.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.too_small</span></span></span></DT></p>
<DD>
<P class="docList">The response body was smaller than the
<span class="docEmphasis">minimum_object_size</span> value.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.private_key</span></span></span></DT></p>
<DD>
<P class="docList">The response has a private cache key, indicating that it
can't be shared with other users.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.too_many_open_files</span></span></span></DT></p>
<DD>
<P class="docList">The Squid process was low on free file descriptors.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">no.too_many_open_fds</span></span></span></DT></p>
<DD>
<P class="docList">Squid had more than <span class="docEmphasis">max_open_disk_fds</span> opened at
one time.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">yes.default</span></span></span></DT></p>
<DD>
<P class="docList">The response was cachable because it did not meet any of the
preceding criteria.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.41"></A>
<H5 class="docSection3Title">14.2.1.41 store_io: Store IO Interface Stats</H5>

<P class="docText">This short table contains four lines <A NAME="squid-CHP-14-ITERM-2036"></A><A NAME="squid-CHP-14-ITERM-2037"></A>related to allocating disk
storage for a new response. For example:</P>

<PRE>Store IO Interface Stats
create.calls 2825670
create.select_fail 0
create.create_fail 0
create.success 2825670</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">create.calls</span></span></span></DT></p>
<DD>
<P class="docList">The number of calls to the function that creates a new disk file.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">create.select_fail</span></span></span></DT></p>
<DD>
<P class="docList">The number of times that the create operation failed because the
<span class="docEmphasis">cache_dir</span> selection algorithm did not select a
cache directory. The default selection algorithm,
<TT>least-load</TT>, fails if it thinks all cache
directories are too busy.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">create.create_fail</span></span></span></DT></p>
<DD>
<P class="docList">The number of times that the create operation failed at the storage
layer. This may happen if the <I>open( )</I> call
returns an error or if the storage system (e.g.,
<span class="docEmphasis">diskd</span>) elects to not open a disk file for some
reason (e.g., overload condition).</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">create.success</span></span></span></DT></p>
<DD>
<P class="docList">The number of times the create operation succeeded.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.42"></A>
<H5 class="docSection3Title">14.2.1.42 pconn: Persistent Connection Utilization Histograms</H5>

<P class="docText">This page displays two <A NAME="squid-CHP-14-ITERM-2038"></A><A NAME="squid-CHP-14-ITERM-2039"></A>histograms. The first is for
client-side persistent connection usage. For example:</P>

<PRE>Client-side persistent connection counts:

        req/
        conn      count
        ----  ---------
           0      74292
           1   14362705
           2    3545955
           3    2068486
           4    1411423
           5    1030023
           6     778722
           7     603649
           8     474592
           9     376154
          10     301396</PRE>

<P class="docText">On the left is the number of requests per connection. On the right is
the number of times a client connection had that many requests. Most
likely, you'll see that one request/connection has
the highest count and that the counts decrease as the number of
requests/connection increases.</P>

<P class="docText">The second table has the same information, but for server-side HTTP
connections. You should see the same sort of pattern here, with one
request/connection having the highest count.</P>



<A NAME="squid-CHP-14-SECT-2.1.43"></A>
<H5 class="docSection3Title">14.2.1.43 refresh: Refresh Algorithm Statistics</H5>

<P class="docText">The <span class="docEmphasis">refresh</span> page shows a few tables
<A NAME="squid-CHP-14-ITERM-2040"></A><A NAME="squid-CHP-14-ITERM-2041"></A>relating to
the freshness of cached objects. Internally, Squid keeps track of the
way different modules use the refresh functions. The first table
shows how many calls each module has made. The really interesting
data is contained in the remaining tables, however.</P>

<P class="docText">The <TT>HTTP</TT> <TT>histogram</TT> shows the
breakdown of freshness checks for client HTTP requests. For example:</P>

<PRE>HTTP histogram:
Count   %Total  Category
     0    0.00  Fresh: request max-stale wildcard
     0    0.00  Fresh: request max-stale value
173984    9.76  Fresh: expires time not reached
462757   25.97  Fresh: refresh_pattern last-mod factor percentage
    42    0.00  Fresh: refresh_pattern min value
     0    0.00  Fresh: refresh_pattern override expires
     0    0.00  Fresh: refresh_pattern override lastmod
  5521    0.31  Stale: response has must-revalidate
     0    0.00  Stale: changed reload into IMS
     0    0.00  Stale: request has no-cache directive
470912   26.43  Stale: age exceeds request max-age value
455073   25.54  Stale: expires time reached
 65612    3.68  Stale: refresh_pattern max age rule
144706    8.12  Stale: refresh_pattern last-mod factor percentage
  3274    0.18  Stale: by default
1781881 100.00  TOTAL</PRE>

<P class="docText">Note, the rules aren't necessarily evaluated in the
order in which they appear in the table. Here's what
each line means:</P>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Fresh: request max-stale wildcard</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response fresh because the request
includes a <TT>max-stale</TT> directive without any value.
For example:</P>

<PRE>GET /blah... HTTP/1.1
Cache-control: max-stale</PRE>

<P class="docList">According to RFC 2616: "If no value is assigned to
<TT>max-stale</TT>, then the client is willing to accept a
stale response of any age."</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Fresh: request max-stale value</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response fresh because the request
includes a <TT>max-stale</TT> directive with a particular
value, which is larger than the amount of time since the object
expired.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Fresh: expires time not reached</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response fresh because its expiration time
has not yet been reached.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Fresh: refresh_pattern last-mod factor percentage</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response fresh because it matches one of
the <TT>refresh_pattern</TT> rules and has a last-modified
factor (LM-factor) value that's less than that
specified by the rule. See <A class="docLink" HREF="squid-CHP-7-SECT-7.html#squid-CHP-7-SECT-7">Section 7.7</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Fresh: refresh_pattern min value</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response fresh because it matches one of
the <TT>refresh_pattern</TT> rules and its age is less than
the <TT>min</TT> value specified by the rule. See <A class="docLink" HREF="squid-CHP-7-SECT-7.html#squid-CHP-7-SECT-7">Section 7.7</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Fresh: refresh_pattern override expires</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response fresh because it matched one of
the <TT>refresh_pattern</TT> rules with the
<TT>override-expire</TT> option. This option causes Squid
to give precedence to the <TT>refresh_pattern</TT> minimum
value over the object's expiration time. Note: using
the <TT>override-expire</TT> option is a violation of RFC
2616.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Fresh: refresh_pattern override lastmod</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response fresh because it matched one of
the <TT>refresh_pattern</TT> rules with the
<TT>override-lastmod</TT> option. This option causes Squid
to give precedence to the <TT>refresh_pattern</TT> minimum
value over the LM-factor value. Note: using the
<TT>override-lastmod</TT> option is a violation of RFC
2616.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: response has must-revalidate</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale because it contains a
<TT>Cache-Control</TT>: <TT>must-revalidate</TT>
directive.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: changed reload into IMS</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale because it matches one of
the <TT>refresh_pattern</TT> rules with the
<TT>reload-into-ims</TT> option. With this option, Squid
turns a request with <TT>Cache-Control</TT>:
<TT>no-cache</TT> (or similar) into a cache validation.
Note: using the <TT>reload-into-ims</TT> option is a
violation of RFC 2616.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: request has no-cache directive</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale because the request
contains a <TT>Cache-Control</TT>:
<TT>no-cache</TT> directive.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: age exceeds request max-age value</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale because the request has a
<TT>max-age</TT> directive, which is less than the
response's age.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: expires time reached</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale because its expiration time
has been reached.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: refresh_pattern max age rule</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale because it matches one of
the <span class="docEmphasis">refresh_pattern</span> rules, and its age is
greater than the <TT>max</TT> value specified by the rule.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: refresh_pattern last-mod factor percentage</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale because it matches one of
the <span class="docEmphasis">refresh_pattern</span> rules, and its LM-factor
value is greater than the factor specified by the rule.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Stale: by default</span></span></span></DT></p>
<DD>
<P class="docList">Squid considers the cached response stale by default, because it
didn't meet any of the other criteria.</P>
</DD>
</DL>

<P class="docText">Following the <TT>HTTP</TT> <TT>histogram</TT>,
you'll see the same data for <TT>ICP</TT>,
<TT>HTCP</TT>, <TT>Cache</TT>
<TT>Digests</TT>, and <TT>On</TT>
<TT>Store</TT>.</P>

<P class="docText">The <TT>On</TT>
<TT>Store</TT> table represents freshness checks
for responses that are coming into Squid's cache
(i.e., cachable misses). Note, however, that Squid does store stale
responses (as long as they have a cache validator).
Don't be alarmed if you see some stale responses in
the <TT>On</TT>
<TT>Store</TT> histogram.</P>



<A NAME="squid-CHP-14-SECT-2.1.44"></A>
<H5 class="docSection3Title">14.2.1.44 delay: Delay Pool Levels</H5>

<P class="docText">This page displays <A NAME="squid-CHP-14-ITERM-2042"></A><A NAME="squid-CHP-14-ITERM-2043"></A>the Delay Pool statistics.
Squid has three classes of pools (1, 2, 3) and three types of buckets
(aggregate, individual, and network). A class 1 pool has only an
aggregate bucket, a class 2 pool has both aggregate and individual,
and a class 3 pool has all three.</P>

<P class="docText">An aggregate bucket looks like this:</P>

<PRE>Aggregate:
        Max: 16384
        Restore: 4096
        Current: 6144</PRE>

<P class="docText">The values are all in bytes. <TT>Max</TT> is the size of
the bucket, which is the number of bytes the bucket can hold.
<TT>Restore</TT> is the number of bytes added to the bucket
each second. <TT>Current</TT> is the number of bytes
currently in the bucket. If nobody uses the bytes, the bucket fills
until it reaches the maximum size.</P>

<P class="docText">An individual bucket is almost the same:</P>

<PRE>Individual:
        Max: 20000
        Restore: 5000
        Current: 1:18760 9:4475 14:20000</PRE>

<P class="docText">The only difference is that the <TT>Current</TT> line
displays a number of different values, one for each host number. The
<I>host number</I> is defined as the last octet of an
IPv4 address. In this example, the host numbers are 1, 9, and 14. In
a class 2 delay pool, the host numbers from different networks share
the same bucket. For example, 192.168.0.1 and 192.168.44.1 both share
the bucket for host number 1. In a class 3 pool, however, each
network number (third octet) has its own array of individual buckets.
Thus, for a class 3 pool, the individual buckets appear this way:</P>

<PRE>Individual:
        Max: 20000
        Rate: 5000
        Current [Network 0]: 1:12000
        Current [Network 44]: 1:17000</PRE>

<P class="docText">A network bucket (for class 3 pools only) is similar as well:</P>

<PRE>Network:
        Max: 30000
        Rate: 15000
        Current: 0:3912 7:30000</PRE>

<P class="docText">In this case, the <TT>Current</TT> line shows the current
level for each network number (third octet). See <A class="docLink" HREF="squid-APP-C.html#squid-APP-C">Appendix C</A> for more information about Delay Pools.</P>



<A NAME="squid-CHP-14-SECT-2.1.45"></A>
<H5 class="docSection3Title">14.2.1.45 forward: Request Forwarding Statistics</H5>

<P class="docText">The table on this page shows <A NAME="squid-CHP-14-ITERM-2044"></A><A NAME="squid-CHP-14-ITERM-2045"></A>how many
attempts were made to forward each request, with their results. Upon
receiving some status codes, Squid gives up immediately. For others,
however, Squid keeps trying. Each row of the table is a different
HTTP status code (200, 401, 404, etc.). Each column is the number of
forwarding attempts. The value in each cell is how many requests were
forwarded that many times, resulting in the corresponding status
code. This information helps developers understand whether or not it
makes sense to retry a request after receiving certain types of
responses. Here is an example:</P>

<PRE>Status  try#1   try#2   try#3   try#4   try#5   try#6   try#7   try#8   try#9  try#10
  0      1       0       0       0       0       0       0        0       0      0
200     3970083 111015  51185   29002   18242   12097   8191    6080    4490   6140
201     57      0       0       0       0       0       0       0       0      0
202     162     0       0       0       0       0       0       0       0      0
204     1321    11      0       0       0       0       0       0       0      0
206     624288  453     25      9       4       3       0       1       0      0
207     147     0       0       0       0       0       0       0       0      0
300     23      0       0       0       0       0       0       0       0      0
301     23500   25      2       0       0       0       1       0       0      0
302     339332  3806    153     26      6       4       2       3       0      1
303     101     1       0       0       0       0       0       0       0      0
304     772831  3510    125     21      7       8       8       5       3      2
307     7       0       0       0       0       0       0       0       0      0
400     529     1       0       0       0       0       0       0       0      0
401     1559    0       0       0       0       0       0       0       0      0
403     5098    30      1       1       0       0       0       0       0      0
404     100800  216     25      6       7       1       2       4       1      5
405     1       0       0       0       0       0       0       0       0      0
...</PRE>

<P class="docText">A value of 29,002 in the cell under <TT>try#4</TT> and in
the row for <TT>status</TT> <TT>200</TT> means
that there were 29,002 times when Squid finally got a successful
response after <TT>4</TT> forwarding attempts. If you look
at the table, you may see some unknown status codes. Squid keeps
track of all status codes up to 600, even those it
doesn't know about. See <A class="docLink" HREF="squid-CHP-13-SECT-2.html#squid-CHP-13-TABLE-1">Table 13-1</A>
for the list of codes that Squid does know about.</P>



<A NAME="squid-CHP-14-SECT-2.1.46"></A>
<H5 class="docSection3Title">14.2.1.46 client_list: Cache Client List</H5>

<P class="docText">The cache client list shows a handful of
<A NAME="squid-CHP-14-ITERM-2046"></A><A NAME="squid-CHP-14-ITERM-2047"></A>statistics
for each client IP address accessing Squid, which looks like this:</P>

<PRE>Address: 206.168.0.9
Name: 206.168.0.9
Currently established connections: 0
    ICP Requests 59000
        UDP_HIT                 1609   3%
        UDP_MISS               57388  97%
        UDP_INVALID                3   0%
    HTTP Requests 11281
        TCP_HIT                  656   6%
        TCP_MISS                3464  31%
        TCP_REFRESH_HIT         4477  40%
        TCP_REFRESH_MISS         767   7%
        TCP_CLIENT_REFRESH_M     397   4%
        TCP_IMS_HIT             1082  10%
        TCP_SWAPFAIL_MISS          7   0%
        TCP_NEGATIVE_HIT          13   0%
        TCP_MEM_HIT              418   4%</PRE>

<P class="docText">The <TT>Address</TT> line, obviously, shows the
client's IP address. <TT>Name</TT> is the
same, unless you have <span class="docEmphasis">log_fqdn</span> enabled, and the
DNS reports a name for the address. The <TT>Currently</TT>
<TT>established</TT> <TT>connections</TT> line
shows how many HTTP connections are currently open between the client
and Squid.</P>

<P class="docText">If the client has sent any ICP queries, you'll see a
breakdown of the results here. In this example, only 3% of this
client's ICP queries were hits. Note, this page
doesn't currently include HTCP result statistics.
Finally, you'll see a breakdown of HTTP request
result codes.</P>

<P class="docText">The client database consumes a fair amount of memory, especially if
you have a large number of client IP addresses accessing Squid. You
can disable the database entirely, thus conserving memory, with the
<span class="docEmphasis">client_db</span> directive. Also note that there is no
way to clear the counters or to remove entries while Squid is
running.</P>



<A NAME="squid-CHP-14-SECT-2.1.47"></A>
<H5 class="docSection3Title">14.2.1.47 netdb: Network Measurement Database</H5>

<P class="docText">This page is available only with <A NAME="squid-CHP-14-ITERM-2048"></A><A NAME="squid-CHP-14-ITERM-2049"></A>the
<I>./configure</I> <I>—enable-icmp</I>
option (see <A class="docLink" HREF="squid-CHP-10-SECT-5.html#squid-CHP-10-SECT-5">Section 10.5</A>). On this page
you'll find quite a lot of IP addresses, hostnames,
packet counters, and RTT values. It looks something like this:</P>

<PRE>Network DB Statistics:
Network          recv/sent     RTT  Hops Hostnames
165.123.34.0        7/   7    12.7   8.6 onlinebooks.library.upenn.edu
                                         www.library.upenn.edu
                                         digital.library.upenn.edu
    rtp.us.ircache.net        17.0  11.0
    sj.us.ircache.net         71.0  17.3
209.202.204.0       4/   4    12.8  10.0 adbuyer3.lycos.com
    rtp.us.ircache.net        20.6  15.0
    sj.us.ircache.net         77.6  15.0
63.151.139.0       17/  17    12.8   9.0 www.originlab.com
    sj.us.ircache.net         80.0  12.0
209.68.20.0        23/  23    12.8  11.7 www6.tomshardware.com www.guestbook.nu
    rtp.us.ircache.net        34.9  15.1
    sj.us.ircache.net         73.9  14.7</PRE>

<P class="docText">Each /24 network is listed, in order of increasing round-trip time.
You can see how many ICMP pings have been sent and received, the
average RTT, and the estimated router hop-count. The
<TT>Hostnames</TT> field shows the hostnames that resolve
to addresses within the /24 network. If Squid has ICMP measurements
from its neighbors for the network, those are printed as well. In
this example, the local cache is closer to all the networks than its
neighbors (<A class="docLink" target="_blank" HREF="rtp.us.ircache.net">rtp.us.ircache.net</A> and
<A class="docLink" target="_blank" HREF="sj.us.ircache.net">sj.us.ircache.net</A>).</P>



<A NAME="squid-CHP-14-SECT-2.1.48"></A>
<H5 class="docSection3Title">14.2.1.48 asndb: AS Number Database</H5>

<P class="docText">Although this page is always <A NAME="squid-CHP-14-ITERM-2050"></A><A NAME="squid-CHP-14-ITERM-2051"></A>available, it
contains interesting data only if you are using one of the Autonomous
System (AS) ACLs, such as <span class="docEmphasis">src_as</span> or
<span class="docEmphasis">dst_as</span>.</P>

<P class="docText">When you use an AS-based ACL, Squid queries the Routing Arbiter
database (<A class="docLink" target="_blank" HREF="whois.ra.net">whois.ra.net</A>) to
discover the IP networks associated with the AS number. The results
of those queries are displayed on this page. The output looks like
this:</P>

<PRE>         Address       AS Numbers
   128.98.0.0/16       7
   146.80.0.0/16       7
   192.5.28.0/24       7
   192.5.29.0/24       7
   192.5.30.0/24       7
192.107.178.0/24       7
192.135.183.0/24       5637
 194.61.177.0/24       7
 194.61.180.0/24       7
 194.61.183.0/24       7
 194.83.162.0/24       7</PRE>



<A NAME="squid-CHP-14-SECT-2.1.49"></A>
<H5 class="docSection3Title">14.2.1.49 carp: CARP Information</H5>

<P class="docText">This page is available only <A NAME="squid-CHP-14-ITERM-2052"></A><A NAME="squid-CHP-14-ITERM-2053"></A>with the
<I>./configure</I> <I>—enable-carp</I>
option and if you have some CARP parents configured. Squid displays a
table of all CARP parents, which looks like this:</P>

<PRE>          Hostname       Hash Multiplier     Factor     Actual
bo1.us.ircache.net   f142425b   0.894427   0.400000   0.527950
bo2.us.ircache.net   12180f04   1.118034   0.600000   0.472050</PRE>

<P class="docText"><TT>Hash</TT> is the neighbor's hash value
from the CARP algorithm. <TT>Multiplier</TT> is another
value used by the algorithm. <TT>Factor</TT> is taken from
the <TT>carp-load-factor</TT> option on the
<span class="docEmphasis">cache_dir</span> line in
<I>squid.conf</I>. <TT>Actual</TT> is the
actual distribution of requests among the CARP parents. Ideally, it
should match the <TT>Factor</TT> value.</P>



<A NAME="squid-CHP-14-SECT-2.1.50"></A>
<H5 class="docSection3Title">14.2.1.50 server_list: Peer Cache Statistics</H5>

<P class="docText">This page displays various <A NAME="squid-CHP-14-ITERM-2054"></A><A NAME="squid-CHP-14-ITERM-2055"></A>counters
and statistics for your neighbor caches. For example:</P>

<PRE>Sibling    : pa.us.ircache.net/3128/4827
Flags      : htcp
Address[0] : 192.6.19.203
Status     : Up
AVG RTT    : 14 msec
OPEN CONNS : 19
LAST QUERY :        4 seconds ago
LAST REPLY :        4 seconds ago
PINGS SENT :     9119
PINGS ACKED:     9115 100%
FETCHES    :      109   1%
IGNORED    :     9114 100%
Histogram of PINGS ACKED:
        Misses      9114 100%
        Hits           1   0%
keep-alive ratio: 100%</PRE>

<DL class="docList"><br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Type</span></span></span></DT></p>
<DD>
<P class="docList">The first line shows the neighbor type (parent, sibling, or multicast
group), followed by the hostname and port numbers. The first port
number is for HTTP requests, while the second is for ICP or HTCP.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Flags</span></span></span></DT></p>
<DD>
<P class="docList">Here you'll see any of the
<span class="docEmphasis">cache_peer</span> options that you may have specified,
such as <TT>no-query</TT>, <TT>closest-only</TT>,
and more. See <A class="docLink" HREF="squid-CHP-10-SECT-3.html#squid-CHP-10-SECT-3.1">Section 10.3.1</A> for the complete list.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Address[  ]</span></span></span></DT></p>
<DD>
<P class="docList">This line displays the IP address(es) associated with the hostname.
The number in brackets is the number of addresses. Squid stores up to
10 addresses for each neighbor.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Status</span></span></span></DT></p>
<DD>
<P class="docList">The status line indicates whether Squid thinks the neighbor is
<TT>Up</TT> or <TT>Down</TT>. See <A class="docLink" HREF="squid-CHP-10-SECT-3.html#squid-CHP-10-SECT-3.2">Section 10.3.2</A>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">AVG RTT</span></span></span></DT></p>
<DD>
<P class="docList">This is the running average RTT for ICP/HTCP queries to the neighbor.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">OPEN CONNS</span></span></span></DT></p>
<DD>
<P class="docList">This is the number of HTTP connections currently open to the neighbor.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">LAST QUERY</span></span></span></DT></p>
<DD>
<P class="docList">This indicates the amount of time since Squid last sent an ICP/HTCP
query to the neighbor.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">LAST REPLY</span></span></span></DT></p>
<DD>
<P class="docList">This indicates the amount of time since Squid last received an
ICP/HTCP reply from the neighbor.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">PINGS SENT</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP/HTCP queries sent to the neighbor.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">PINGS ACKED</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP/HTCP replies received back from the neighbor.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">FETCHES</span></span></span></DT></p>
<DD>
<P class="docList">The number of HTTP requests sent to the neighbor. The percentage is
based on the <TT>PINGS</TT> <TT>ACKED</TT>
number. Unfortunately, the <TT>FETCHES</TT> number counts
requests forwarded for any reason (ICP, HTCP, Cache Digests, default
parent, etc.). Thus, the percentage doesn't always
make sense and may be higher than 100%.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">IGNORED</span></span></span></DT></p>
<DD>
<P class="docList">The number of ICP/HTCP replies ignored. The most common reason that
Squid ignores an ICP/HTCP reply is that it is too late.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">Histogram of PINGS ACKED</span></span></span></DT></p>
<DD>
<P class="docList">Here you'll see a breakdown of ICP/HTCP results. For
ICP neighbors, Squid prints the ICP status codes
(<TT>ICP_HIT</TT>, <TT>ICP_MISS</TT>, etc.). For
HTCP neighbors, the only categories are <TT>Hits</TT> and
<TT>Misses</TT>.</P>
</DD>
<br><p><DT><span class="docPubcolor"><span class="docPubcolor"><span class="docMonofont">keep-alive ratio</span></span></span></DT></p>
<DD>
<P class="docList">This shows the percentage of times that Squid wanted an HTTP
connection to be persistent, and the neighbor agreed. Note, this
doesn't indicate anything about whether the
connection was actually reused, only that both sides agreed that it
could be.</P>
</DD>
</DL>



<A NAME="squid-CHP-14-SECT-2.1.51"></A>
<H5 class="docSection3Title">14.2.1.51 non_peers: List of Unknown Sites Sending ICP messages</H5>

<P class="docText">This page shows a list of clients <A NAME="squid-CHP-14-ITERM-2056"></A><A NAME="squid-CHP-14-ITERM-2057"></A>that send
unauthorized ICP (but not HTCP) queries. The list is the same format
as the <span class="docEmphasis">Cache Client List</span> page.</P>



<A NAME="squid-CHP-14-SECT-2.2"></A>
<H4 class="docSection2Title">14.2.2 Cache Manager Access Controls</H4>

<P class="docText">The cache manager <A NAME="squid-CHP-14-ITERM-2058"></A><A NAME="squid-CHP-14-ITERM-2059"></A>interface provides a lot of
information. Much of it is sensitive and should be kept private. For
example, the <I>Cache Client List</I> reveals the IP
addresses of users, the <I>Process Filedescriptor
Allocation</I> page shows URIs currently being requested, and
the <I>Current Squid Configuration</I> displays the
values from <I>squid.conf</I>, including passwords and
access control rules. To keep unwanted visitors from browsing the
cache manager pages, you must carefully configure access to it.</P>

<A NAME="squid-CHP-14-SECT-2.2.1"></A>
<H5 class="docSection3Title">14.2.2.1 http_access</H5>

<P class="docText">All cache manager requests <A NAME="squid-CHP-14-ITERM-2060"></A><A NAME="squid-CHP-14-ITERM-2061"></A><A NAME="squid-CHP-14-ITERM-2062"></A>use the pseudo-protocol scheme
<TT>cache_object</TT>. The best way to protect the cache
manager is restrict the IP addresses allowed to make
<TT>cache_object</TT> requests. The default
<I>squid.conf</I> contains these lines:</P>

<PRE>acl Manager proto cache_object
acl Localhost src 127.0.0.1/255.255.255.255
http_access allow Manager Localhost
http_access deny Manager</PRE>

<P class="docText">Thus, cache manager requests from the local host (127.0.0.1) are
allowed, but all others are denied. If you have additional trusted
hosts, you may want to add them to the access rules also. Make sure
these lines are at the top of your <span class="docEmphasis">http_access</span>
rules.</P>



<A NAME="squid-CHP-14-SECT-2.2.2"></A>
<H5 class="docSection3Title">14.2.2.2 cachemgr_passwd</H5>

<P class="docText">You may also want to <A NAME="squid-CHP-14-ITERM-2063"></A>modify the default
<span class="docEmphasis">cachemgr_passwd</span> settings. Some of the cache
manager pages require a password, so you won't be
able to view those until you add one. For example, if you want to use
the <I>Current Squid Configuration</I> page, you must
assign it a password:</P>

<PRE>cachemgr_passwd JeckCy config</PRE>

<P class="docText">You can have a number of different passwords, but each action may
have only one password. You may want to use a different password for
less sensitive pages:</P>

<PRE>cachemgr_passwd byDroth filedescriptors client_list netdb</PRE>

<P class="docText">To disable a cache manager action, use <TT>disable</TT> as
the password:</P>

<PRE>cachemgr_passwd disable netdb</PRE>

<P class="docText">To enable the sensitive actions without requiring a password, use
<TT>none</TT>:</P>

<PRE>cachemgr_passwd none offline_toggle</PRE>

<P class="docText">If you want to give the same password to all actions, use the keyword
<TT>all</TT>:</P>

<PRE>cachemgr_passwd Knoujush all</PRE>

<P class="docText">When using the command-line cache manager interface (e.g.,
<I>squidclient</I>), put an @ sign and the password after
the action name. For example:</P>

<PRE>squidclient mgr:objects@byDroth | less</PRE>

<P class="docText">Note that cache manager passwords aren't printed
when you request the <I>Current Squid Configuration
</I>page (see <A class="docLink" HREF="#squid-CHP-14-SECT-2.1.7">Section 14.2.1.7</A>).</P>



<A NAME="squid-CHP-14-SECT-2.2.3"></A>
<H5 class="docSection3Title">14.2.2.3 cachemgr.cgi</H5>

<P class="docText">If you use <TT>cachemgr.cgi</TT>, <A NAME="squid-CHP-14-ITERM-2064"></A><A NAME="squid-CHP-14-ITERM-2065"></A>the IP address of your HTTP server must be
able to make cache manager requests to Squid. This opens up a
back-door security hole. Anyone who can execute the CGI program on
your server will be able to view the cache manager pages. The
passwords described earlier can help, but you may also want to
install access controls on your HTTP server so that only certain
people can execute <TT>cachemgr.cgi</TT>.</P>

<P class="docText">The main <TT>cachemgr.cgi</TT> page has a form with
<span class="docEmphasis">Username</span> and <span class="docEmphasis">Password</span>
fields. The username is purely informational. If you have multiple
administrators in your organization, each person can enter their own
name for auditing purposes.</P>

<P class="docText">If you leave the password field blank, the password-protected pages
are disabled. Entering a password activates links for those pages.
<TT>cachemgr.cgi</TT> is stateless, so the password must be
included as a URI parameter in links. Furthermore, the password
encoding scheme isn't very sophisticated and trivial
to break. Because many applications (such as Squid!) log the URIs of
HTTP requests, your cache-manager password may be logged or even
observed by an untrusted third party. If you really want to keep your
cache manager passwords secret, never use them with
<TT>cachemgr.cgi</TT> or from any remote system.</P>



<A NAME="squid-CHP-14-SECT-2.3"></A>
<H4 class="docSection2Title">14.2.3 Reasons to Dislike the Cache Manager</H4>

<P class="docText">The cache manager interface <A NAME="squid-CHP-14-ITERM-2066"></A>leaves
much to be desired. It has a very unpolished feel. Novice
administrators will probably find it difficult to use and understand.
One of the first problems you might notice is that the menu (or table
of contents) is unorganized. There is no logical order or grouping.
The first items in the list provide low-level information primarily
meant for developers. Currently, the order is determined by the
initialization sequence in the source code.</P>

<P class="docText">The output is often ugly. The <I>cachemgr.cgi</I> program
renders very bland-looking HTML pages. There are no icons or graphics
of any kind. Furthermore, many of the pages are simply presented as
unformatted text. <I>cachemgr.cgi</I>
doesn't do much more than format tab-delimited lines
as HTML tables and put <TT>&lt;A&gt;</TT> tags around some
URIs. Some of the cache manager pages are structured so that the
output can be easily parsed by computer programs, rather than humans.</P>

<P class="docText">By today's standards, the cache manager has very
weak security. You are essentially forced to use address-based
controls and cleartext passwords. If you allow cache manager requests
only from <A class="docLink" target="_blank" HREF="localhost">localhost</A>, and your
system security is good, you'll be relatively safe.</P>


<A NAME="squid-CHP-14-SECT-2.4"></A>
<H4 class="docSection2Title">14.2.4 Squid-RRD</H4>

<P class="docText">I personally use the cache manager to <A NAME="squid-CHP-14-ITERM-2067"></A><A NAME="squid-CHP-14-ITERM-2068"></A>populate a number of RRDTool
databases (<A class="docLink" target="_blank" HREF="http://www.rrdtool.com/">http://www.rrdtool.com/</A>). RRDTool is
nice package for storing and displaying time-series data. It allows
you to archive data at different time scales (e.g., days, weeks,
months, years) in a database that doesn't grow in
size over time.</P>

<P class="docText">I use a Perl script that runs every five minutes from
<I>cron</I>. It issues cache manager requests for a
number of pages and extracts the values that I am interested in.
These values are stored in the RRD files.</P>

<P class="docText">RRDTool also generates nice-looking graphs, from either a CGI script
or standalone program. I use the CGI program and check the graphs at
least daily. See 
<A class="docLink" HREF="#squid-CHP-14-FIG-2">Figure 14-2</A> for some samples from
one of my own Squid boxes.</P>

<CENTER>
<H5 class="docFigureTitle"><A NAME="squid-CHP-14-FIG-2"></A>Figure 14-2. Some sample RRD graphs from RRDTool and cache manager data</H5>
<IMG BORDER="0" WIDTH="481" HEIGHT="538" SRC="images/0596001622/figs/SQ_1402.gif" ALT="figs/SQ_1402.gif"></CENTER>

<P class="docText">You can find my scripts and instructions for integrating the cache
manager and RRDTool at <A class="docLink" target="_blank" HREF="http://www.squid-cache.org/~wessels/squid-rrd/">http://www.squid-cache.org/~wessels/squid-rrd/</A>.</P>



<ul></ul></td></tr></table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#e6e6e6">
<tr style="background-image: url(images/tile_back.gif);">
<td class="v2" align="left" width="30%">
<a href="squid-CHP-14-SECT-1.html"><img src="images/previous.gif" width="70" height="19" border="0" align="absmiddle" alt="Previous Section"></a>
</td>
<td class="v2" align="center" width="40%">
<a href="main.html" style="color:white;text-decoration:none;text-underline:none">&nbsp;&lt;&nbsp;Day Day Up&nbsp;&gt;&nbsp;</a>
</td>
<td class="v2" align="right" width="30%">
<a href="squid-CHP-14-SECT-3.html"><img src="images/next.gif" width="70" height="19" border="0" align="absmiddle" alt="Next Section"></a>
</td>
</tr>
</table>
</body>
</html>
