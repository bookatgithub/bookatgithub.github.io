<html><head>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!--SafClassName="docSection1Title"--><!--SafTocEntry="19.2 Best Practices for Working with Open-Source Developers"-->
<link rel="STYLESHEET" type="text/css" href="FILES/style.css">
<link rel="STYLESHEET" type="text/css" href="FILES/docsafari.css">
<style type="text/css">	.tt1    {font-size: 10pt;}</style>
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
	<a href="0131429019_ch19lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
	<a href="0131429019_ch19lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><A NAME="ch19lev1sec2"></A>
<H3 class="docSection1Title">19.2 Best Practices for Working with Open-Source Developers</H3>
<P class="docText"><A NAME="idd1e40407"></A>Much of what constitutes best practice in the open-source community is a natural adaptation to distributed development; you'll read a lot in the rest of this chapter about behaviors that maintain good communication with other developers. Where Unix conventions are arbitrary (such as the standard names of files that convey metainformation about a source distribution) they often trace back either to Usenet<A NAME="idd1e40413"></A> in the early 1980s, or to the conventions and standards of the GNU project<A NAME="idd1e40417"></A>.</P>
<A NAME="ch19lev2sec1"></A>
<H4 class="docSection2Title">19.2.1 Good Patching Practice</H4>
<P class="docText"><A NAME="idd1e40428"></A>Most people become involved in open-source software by writing patches for other people's software before releasing projects of their own. Suppose you've written a set of source-code changes for someone else's baseline code. Now put yourself in that person's shoes. How is he to judge whether to include the patch?</P>
<P class="docText">It is very difficult to judge the quality of code, so developers tend to evaluate patches by the quality of the submission. They look for clues in the submitter's style and communications behavior instead—indications that the person has been in their shoes and understands what it's like to have to evaluate and merge an incoming patch.</P>
<P class="docText">This is actually a rather reliable proxy for code quality. In many years of dealing with patches from many hundreds of strangers, I have only seldom seen a patch that was thoughtfully presented and respectful of my time but technically bogus. On the other hand, experience teaches that patches which look careless or are packaged in a lazy and inconsiderate way are very likely to actually <span class="docEmphasis">be</span> bogus.</P>
<P class="docText">Here are some tips on how to get your patch accepted:</P>
<A NAME="ch19lev3sec1"></A>
<H5 class="docSection3Title">19.2.1.1 Do send patches, don't send whole archives or files.</H5>
<P class="docText">If your change includes a new file that doesn't exist in the code, then of course you have to send the whole file. But if you're modifying an already-existing file, don't send the whole file. Send a diff instead; specifically, send the output of the <span class="docEmphasis">diff</span>(1)<A NAME="idd1e40459"></A> command run to compare the baseline distributed version against your modified version.</P>
<P class="docText">The <span class="docEmphasis">diff</span>(1) command and its dual, <span class="docEmphasis">patch</span>(1)<A NAME="idd1e40472"></A>, are the most basic tools of open-source development. Diffs are better than whole files because the developer you're sending a patch to may have changed the baseline version since you got your copy. By sending him a diff you save him the effort of separating your changes from his; you show respect for his time.</P>

<A NAME="ch19lev3sec2"></A>
<H5 class="docSection3Title">19.2.1.2 Send patches against the current version of the code.</H5>
<P class="docText">It is both counterproductive and rude to send a maintainer patches against the code as it existed several releases ago, and expect him to do all the work of determining which changes duplicate things he has since done, versus which things are actually novel in your patch.</P>
<P class="docText">As a patch submitter, it is <span class="docEmphasis">your</span> responsibility to track the state of the source and send the maintainer a minimal patch that expresses what you want done to the main-line codebase. That means sending a patch against the current version.</P>

<A NAME="ch19lev3sec3"></A>
<H5 class="docSection3Title">19.2.1.3 Don't include patches for generated files.</H5>
<P class="docText">Before you send your patch, walk through it and delete any patch bands for files in it that are going to be automatically regenerated once the maintainer applies the patch and remakes. The classic examples of this error are C<A NAME="idd1e40500"></A> files generated by <span class="docEmphasis">Bison</span><A NAME="idd1e40508"></A> or <span class="docEmphasis">Flex</span><A NAME="idd1e40514"></A>.</P>
<P class="docText">These days the most common mistake of this kind is sending a diff with a huge band that is nothing but changebars between your <span class="docEmphStrong"><TT>configure</TT></span> script and the maintainer's. This file is generated by <span class="docEmphStrong"><TT>autoconf</TT></span>.</P>
<P class="docText">This is inconsiderate. It means your recipient is put to the trouble of separating the real content of the patch from a lot of bulky noise. It's a minor error, not as important as some of the things we'll get to further on—but it will count against you.</P>

<A NAME="ch19lev3sec4"></A>
<H5 class="docSection3Title">19.2.1.4 Don't send patch bands that just tweak RCS or SCCS $-symbols.</H5>
<P class="docText">Some people put special tokens in their source files that are expanded by the version-control system when the file is checked in: the <TT>$Id$</TT> construct used by RCS and CVS, for example.</P>
<P class="docText">If you're using a local version-control system yourself, your changes may alter these tokens. This isn't really harmful, because when your recipient checks his code back in after applying your patch the tokens will be reexpanded in accordance with the <span class="docEmphasis">maintainer's</span> version-control status. But those extra patch bands are noise. They're distracting. It's more considerate not to send them.</P>
<P class="docText">This is another minor error. You'll be forgiven for it if you get the big things right. But you want to avoid it anyway.</P>

<A NAME="ch19lev3sec5"></A>
<H5 class="docSection3Title">19.2.1.5 Do use <TT>-c</TT> or <TT>-u</TT> format, don't use the default (<TT>-e</TT>) format.</H5>
<P class="docText">The default (<TT>-e</TT>) format of <span class="docEmphasis">diff</span>(1) is very brittle. It doesn't include any context, so the patch tool can't cope if any lines have been inserted or deleted in the baseline code since you took the copy you modified.</P>
<P class="docText">Getting an <TT>-e</TT> diff is annoying, and suggests that the sender is either an extreme newbie, careless, or clueless. Most such patches get tossed out without a second thought.</P>

<A NAME="ch19lev3sec6"></A>
<H5 class="docSection3Title">19.2.1.6 Do include documentation with your patch.</H5>
<P class="docText">This is very important. If your patch makes a user-visible addition or change to the software's features, <span class="docEmphasis">include changes to the appropriate man pages and other documentation files in your patch</span>. Do <span class="docEmphasis">not</span> assume that the recipient will be happy to document your code for you, or to have undocumented features lurking in the code.</P>
<P class="docText">Documenting your changes well demonstrates some good things. First, it's considerate to the person you are trying to persuade. Second, it shows that you understand the ramifications of your change well enough to explain it to somebody who can't see the code. Third, it demonstrates that you care about the people who will ultimately use the software.</P>
<P class="docText">Good documentation is usually the most visible sign of what separates a solid contribution from a quick and dirty hack. If you take the time and care necessary to produce it, you'll find you're already 85% of the way to having your patch accepted by most developers.</P>

<A NAME="ch19lev3sec7"></A>
<H5 class="docSection3Title">19.2.1.7 Do include an explanation with your patch.</H5>
<P class="docText">Your patch should include cover notes explaining why you think the patch is necessary or useful. This is explanation directed not to the users of the software but to the maintainer to whom you are sending the patch.</P>
<P class="docText">The note can be short—in fact, some of the most effective cover notes I've ever seen just said "See the documentation updates in this patch". But it should show the right attitude.</P>
<P class="docText">The right attitude is helpful, respectful of the maintainer's time, quietly confident but unassuming. It's good to display understanding of the code you're patching. It's good to show that you can identify with the maintainer's problems. It's also good to be up front about any risks you perceive in applying the patch. Here are some examples of the sorts of explanatory comments that experienced developers send:</P>
<P class="docText">"I've seen two problems with this code, X and Y. I fixed problem X, but I didn't try addressing problem Y because I don't think I understand the part of the code that I believe is involved".</P>
<P class="docText">"Fixed a core dump that can happen when one of the foo inputs is too long. While I was at it, I went looking for similar overflows elsewhere. I found a possible one in blarg.c, near line 666. Are you sure the sender can't generate more than 80 characters per transmission?"</P>
<P class="docText">"Have you considered using the Foonly algorithm for this problem? There is a good implementation at &lt;http://www.example.com/~jsmith/foonly.html&gt;".</P>
<P class="docText">"This patch solves the immediate problem, but I realize it complicates the memory allocation in an unpleasant way. Works for me, but you should probably test it under heavy load before shipping".</P>
<P class="docText">"This may be featuritis, but I'm sending it anyway. Maybe you'll know a cleaner way to implement the feature".</P>

<A NAME="ch19lev3sec8"></A>
<H5 class="docSection3Title">19.2.1.8 Do include useful comments in your code.</H5>
<P class="docText">A maintainer will want to have strong confidence that he understands your changes before merging them in. This isn't an invariable rule; if you have a track record of good work with the maintainer, he may just run a casual eye over the changes before checking them in semiautomatically. But everything you can do to help him understand your code and decrease his uncertainty increases your chances that your patch will be accepted.</P>
<P class="docText">Good comments in your code help the maintainer understand it. Bad comments don't.</P>
<P class="docText">Here's an example of a bad comment:</P>
<pre>

</pre><pre>
/* norman newbie fixed this 13 Aug 2001 */
</pre><pre>
</pre>
<P class="docText">This conveys no information. It's nothing but a muddy territorial bootprint you're planting in the middle of the maintainer's code. If he takes your patch (which you've made less likely) he will almost certainly strip out this comment. If you want a credit, include a patch band for the project <TT>NEWS</TT> or <TT>HISTORY</TT> file. He's more likely to take that.</P>
<P class="docText">Here's an example of a good comment:</P>
<pre>

</pre><pre>
/*
 * This conditional needs to be guarded so that crunch_data() never
 * gets passed a NULL pointer. &lt;norman_newbie@foosite.com&gt;
 */
</pre><pre>
</pre>
<P class="docText">This comment shows that you understand not only the maintainer's code but the kind of information that he needs to have confidence in your changes. This kind of comment <span class="docEmphasis">gives</span> him confidence in your changes.</P>

<A NAME="ch19lev3sec9"></A>
<H5 class="docSection3Title">19.2.1.9 Don't take it personally if your patch is rejected</H5>
<P class="docText">There are lots of reasons a patch can be rejected that don't reflect on you. Remember that most maintainers are under heavy time pressure, and have to be conservative in what they accept lest the project code get broken. Sometime resubmitting with improvements will help. Sometimes it won't. Life is hard.</P>


<A NAME="ch19lev2sec2"></A>
<H4 class="docSection2Title">19.2.2 Good Project- and Archive-Naming Practice</H4>
<P class="docText"><A NAME="idd1e40706"></A>As the load on maintainers of archives like ibiblio, SourceForge, and CPAN increases, there is an increasing trend for submissions to be processed partly or wholly by programs (rather than entirely by a human).</P>
<P class="docText">This makes it more important for project and archive-file names to fit regular patterns that computer programs can parse and understand.</P>
<A NAME="ch19lev3sec10"></A>
<H5 class="docSection3Title">19.2.2.1 Use GNU-style names with a stem and major.minor.patch numbering.</H5>
<P class="docText">It's helpful to everybody if your archive files all have GNU-like names—all-lower-case alphanumeric stem prefix, followed by a hyphen, followed by a version number, extension, and other suffixes.</P>
<P class="docText">A good general form of name has these parts in order:</P>
<span style="font-weight:bold"><OL class="docList" TYPE="1"><LI><span style="font-weight:normal"><P class="docList">project prefix</P></span></LI><LI><span style="font-weight:normal"><P class="docList">dash</P></span></LI><LI><span style="font-weight:normal"><P class="docList">version number</P></span></LI><LI><span style="font-weight:normal"><P class="docList">dot</P></span></LI><LI><span style="font-weight:normal"><P class="docList">"src" or "bin" (optional)</P></span></LI><LI><span style="font-weight:normal"><P class="docList">dot or dash (dot preferred)</P></span></LI><LI><span style="font-weight:normal"><P class="docList">binary type and options (optional)</P></span></LI><LI><span style="font-weight:normal"><P class="docList">archiving and compression extensions</P></span></LI></OL></span>
<P class="docText">Name stems in this style can contain hyphen or underscores to separate syllables; dashes are actually preferred. It is good practice to group related projects by giving the stems a common hyphen-terminated prefix.</P>
<P class="docText">Let's suppose you have a project you call 'foobar' at major version 1, minor version or release 2, patchlevel 3. If it's got just one archive part (presumably the sources), here's what its names should look like like:</P>
<P class="docText"><span class="docEmphStrong"><TT>foobar-1.2.3.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">The source archive.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foobar.lsm</TT></span></P>
<BLOCKQUOTE><P><P class="docList">The LSM file (assuming you're submitting to ibiblio).</P></P></BLOCKQUOTE>
<P class="docText">Please <span class="docEmphasis">don't</span> use names like these:</P>
<P class="docText"><span class="docEmphStrong"><TT>foobar123.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">This looks to many programs like an archive for a project called "foobar123" with no version number.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foobar1.2.3.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">This looks to many programs like an archive for a project called "foobar1" at version 2.3.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foobar-v1.2.3.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">Many programs think this goes with a project called "foobar-v1".</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foo_bar-1.2.3.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">The underscore is hard for people to speak, type, and remember.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>FooBar-1.2.3.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">Unless you <span class="docEmphasis">like</span> looking like a marketing weenie. This is also hard for people to speak, type, and remember.</P></P></BLOCKQUOTE>
<P class="docText">If you have to differentiate between source and binary archives, or between different kinds of binary, or express some kind of build option in the file name, please treat that as a file extension to go <span class="docEmphasis">after</span> the version number. That is, please do this:</P>
<P class="docText"><span class="docEmphStrong"><TT>foobar-1.2.3.src.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">Sources.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foobar-1.2.3.bin.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">Binaries, type not specified.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foobar-1.2.3.bin.i386.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">i386 binaries.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foobar-1.2.3.bin.i386.static.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">i386 binaries statically linked.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong"><TT>foobar-1.2.3.bin.SPARC.tar.gz</TT></span></P>
<BLOCKQUOTE><P><P class="docList">SPARC binaries.</P></P></BLOCKQUOTE>
<P class="docText">Please <span class="docEmphasis">don't</span> use names like 'foobar-i386–1.2.3.tar.gz', because programs have a hard time telling type infixes (like '-i386') from the stem.</P>
<P class="docText">The convention for distinguishing major from minor release is simple: you increment the patch level for fixes or minor features, the minor version number for compatible new features, and the major version number when you make incompatible changes.</P>

<A NAME="ch19lev3sec11"></A>
<H5 class="docSection3Title">19.2.2.2 But respect local conventions where appropriate.</H5>
<P class="docText">Some projects and communities have well-defined conventions for names and version numbers that aren't necessarily compatible with the above advice. For instance, Apache<A NAME="idd1e40934"></A> modules are generally named like mod_foo, and have both their own version number and the version of Apache with which they work. Likewise, Perl<A NAME="idd1e40938"></A> modules have version numbers that can be treated as floating point numbers (e.g., you might see 1.303 rather than 1.3.3), and the distributions are generally named Foo-Bar-1.303.tar.gz for version 1.303 of module Foo::Bar. (Perl itself, on the other hand, switched to using the conventions described here in late 1999.)</P>
<P class="docText">Look for and respect the conventions of specialized communities and developers; for general use, follow the above guidelines.</P>

<A NAME="ch19lev3sec12"></A>
<H5 class="docSection3Title">19.2.2.3 Try hard to choose a name prefix that is unique and easy to type.</H5>
<P class="docText">The stem prefix should be common to all of a project's files, and it should be easy to read, type, and remember. So please don't use underscores. And don't capitalize or BiCapitalize without extremely good reason—it messes up the natural human-eyeball search order and looks like some marketing weenie trying to be clever.</P>
<P class="docText">It confuses people when two different projects have the same stem name. So try to check for collisions before your first release. Two good places to check are the index file of ibiblio &lt;<A class="docLink" target="_blank" HREF="http://www.metalab.unc.edu/pub/Linux">http://metalab.unc.edu/pub/Linux</A>&gt; and the application index at Freshmeat &lt;<A class="docLink" target="_blank" HREF="http://www.freshmeat.net/default.htm">http://www.freshmeat.net</A>&gt;. Another good place to check is SourceForge &lt;<A class="docLink" target="_blank" HREF="http://www.sourceforge.net/default.htm">http://www.sourceforge.net</A>&gt;; do a name search there.</P>


<A NAME="ch19lev2sec3"></A>
<H4 class="docSection2Title">19.2.3 Good Development Practice</H4>
<P class="docText"><A NAME="idd1e40975"></A>Here are some of the behaviors that can make the difference between a successful project with lots of contributors and one that stalls out after attracting no interest:</P>
<A NAME="ch19lev3sec13"></A>
<H5 class="docSection3Title">19.2.3.1 Don't rely on proprietary code.</H5>
<P class="docText">Don't rely on proprietary languages, libraries, or other code. Doing so is risky business at the best of times; in the open-source community, it is considered downright rude. Open-source developers don't trust code for which they can't review the source.</P>

<A NAME="ch19lev3sec14"></A>
<H5 class="docSection3Title">19.2.3.2 Use GNU Autotools.</H5>
<P class="docText">Configuration choices should be made at compile time. A significant advantage of open-source distributions is that they allow the package to adapt at compile-time to the environment it finds. This is critical because it allows the package to run on platforms its developers have never seen, and it allows the software's community of users to do their own ports. Only the largest of development teams can afford to buy all the hardware and hire enough employees to support even a limited number of platforms.</P>
<P class="docText">Therefore: Use the GNU autotools to handle portability issues, do system-configuration probes, and tailor your makefiles. People building from sources today expect to be able to type <span class="docEmphStrong"><TT>configure; make; make install</TT></span> and get a clean build—and rightly so. There is a good tutorial on these tools &lt;<A class="docLink" target="_blank" HREF="http://www.seul.org/docs/autotut/default.htm">http://seul.org/docs/autotut/</A>&gt;.</P>
<P class="docText"><span class="docEmphasis">autoconf</span><A NAME="idd1e41014"></A> and <span class="docEmphasis">autoheader</span><A NAME="idd1e41020"></A> are mature. <span class="docEmphasis">automake</span><A NAME="idd1e41026"></A>, as we've previously noted, is still buggy and brittle as of mid-2003; you may have to maintain your own <TT>Makefile.in</TT>. Fortunately it's the least important of the autotools.</P>
<P class="docText">Regardless of your approach to configuration, do not ask the user for system information at compile-time. The user installing the package does not know the answers to your questions, and this approach is doomed from the start. The software must be able to determine for itself any information that it may need at compile- or install-time.</P>
<P class="docText">But <span class="docEmphasis">autoconf</span><A NAME="idd1e41041"></A> should not be regarded as a license for knob-ridden designs. If at all possible, program to standards like POSIX and refrain also from asking the system for configuration information. Keep ifdefs to a minimum—or, better yet, have none at all.</P>

<A NAME="ch19lev3sec15"></A>
<H5 class="docSection3Title">19.2.3.3 Test your code before release.</H5>
<P class="docText">A good test suite allows the team to easily run regression tests before releases. Create a strong, usable test framework so that you can incrementally add tests to your software without having to train developers in the specialized intricacies of the test suite.</P>
<P class="docText">Distributing the test suite allows the community of users to test their ports before contributing them back to the group.</P>
<P class="docText">Encourage your developers to use a wide variety of platforms as their desktop and test machines, so that code is continuously being tested for portability flaws as part of normal development.</P>
<P class="docText">It is good practice, and encourages confidence in your code, when it ships with the test suite you use, and that test suite can be run with <span class="docEmphStrong"><TT>make test</TT></span>.</P>

<A NAME="ch19lev3sec16"></A>
<H5 class="docSection3Title">19.2.3.4 Sanity-check your code before release.</H5>
<P class="docText">By "sanity check" we mean: use every tool available that has a reasonable chance of catching errors a human would be prone to overlook. The more of these you catch with tools, the fewer your users and you will have to contend with.</P>
<P class="docText">If you're writing C<A NAME="idd1e41079"></A>/C++<A NAME="idd1e41083"></A> using GCC, test-compile with -Wall and clean up all warning messages before each release. Compile your code with every compiler you can find—different compilers often find different problems. Specifically, compile your software on a true 64-bit machine. Underlying datatypes can change on 64-bit machines, and you will often find new problems there. Find a Unix vendor's system and run the lint utility over your software.</P>
<P class="docText">Run tools that look for memory leaks and other runtime errors; Electric Fence and Valgrind are two good ones available in open source.</P>
<P class="docText">For Python<A NAME="idd1e41096"></A> projects, the PyChecker<A NAME="idd1e41100"></A> &lt;<A class="docLink" target="_blank" HREF="http://www.sourceforge.net/projects/pychecker">http://sourceforge.net/projects/pychecker</A>&gt; program can be a useful check. It often catches nontrivial errors.</P>
<P class="docText">If you're writing Perl<A NAME="idd1e41110"></A>, check your code with perl <TT>-c</TT> (and maybe <TT>-T</TT>, if applicable). Use perl <TT>-w</TT> and 'use strict' religiously. (See the Perl documentation for further discussion.)</P>

<A NAME="ch19lev3sec17"></A>
<H5 class="docSection3Title">19.2.3.5 Spell-check your documentation and READMEs before release.</H5>
<P class="docText">Spell-check your documentation, README files and error messages in your software. Sloppy code, code that produces warning messages when compiled, and spelling errors in README files or error messages, all lead users to believe the engineering behind it is also haphazard and sloppy.</P>

<A NAME="ch19lev3sec18"></A>
<H5 class="docSection3Title">19.2.3.6 Recommended C/C++ Portability Practices</H5>
<P class="docText">If you are writing C<A NAME="idd1e41141"></A>, feel free to use the full ANSI features. Specifically, do use function prototypes, which will help you spot cross-module inconsistencies. The old-style K&amp;R compilers are ancient history.</P>
<P class="docText">Do not assume compiler-specific features such as the GCC <TT>-pipe</TT> option or nested functions are available. These will come around and bite you the second somebody ports to a non-Linux, non-GCC system.</P>
<P class="docText">Code required for portability should be isolated to a single area and a single set of source files (for example, an <TT>os</TT> subdirectory). Compiler, library and operating system interfaces with portability issues should be abstracted to files in this directory.</P>
<P class="docText">A portability layer<A NAME="idd1e41166"></A> is a library (or perhaps just a set of macros in header files) that abstracts away just the parts of an operating system's API your program is interested in. Portability layers make it easier to do new software ports. Often, no member of the development team knows the porting platform (for example, there are literally hundreds of different embedded operating systems, and nobody knows any significant fraction of them). By creating a separate portability layer, it becomes possible for a specialist who knows a platform to port your software without having to understand anything outside the portability layer.</P>
<P class="docText">Portability layers also simplify applications. Software rarely needs the full functionality of more complex system calls such as <span class="docEmphasis">mmap</span>(2)<A NAME="idd1e41179"></A> or <span class="docEmphasis">stat</span>(2)<A NAME="idd1e41186"></A>, and programmers commonly configure such complex interfaces incorrectly. A portability layer with abstracted interfaces (say, something named <TT>__file_exists</TT> instead of a call to <span class="docEmphasis">stat</span>(2)) allows you to import only the limited, necessary functionality from the system, simplifying the code in your application.</P>
<P class="docText">Always write your portability layer to select based on a feature, never based on a platform. Trying to create a separate portability layer for each supported platform results in a multiple update problem maintenance nightmare. A "platform" is always selected on at least two axes: the compiler and the library/operating system release. In some cases there are three axes, as when Linux vendors select a C<A NAME="idd1e41199"></A> library independently of the operating system release. With <span class="docEmphasis">M</span> vendors, <span class="docEmphasis">N</span> compilers, and <span class="docEmphasis">O</span> operating system releases, the number of platforms quickly scales out of reach of any but the largest development teams. On the other hand, by using language and systems standards such as ANSI and POSIX 1003.1, the set of features is relatively constrained.<A NAME="idd1e41212"></A></P>
<P class="docText">Portability choices can be made along either lines of code or compiled files. It doesn't make a difference if you select alternate lines of code on a platform, or one of a few different files. A rule of thumb is to move portability code for different platforms into separate files when the implementations diverge significantly (shared memory mapping on Unix vs. Windows<A NAME="idd1e41218"></A>), and leave portability code in a single file when the differences are minimal (for example, whether you're using <TT>gettimeofday</TT>, <TT>clock_gettime</TT>, <TT>ftime</TT> or <TT>time</TT> to find out the current time-of-day).</P>
<P class="docText">For anywhere outside a portability layer, heed this advice:</P>
<blockquote>

<p class="docText"><A NAME="idd1e41244"></A><TT>#ifdef</TT> and <TT>#if</TT> are last resorts, usually a sign of failure of imagination, excessive product differentiation, gratuitous "optimization" or accumulated trash. In the middle of code they are anathema. <TT>/usr/include/stdio.h</TT> from GNU is an archetypical horror.</p>
<p class="docText">—Doug McIlroy</p></blockquote>
<P class="docText">Use of <TT>#ifdef</TT> and <TT>#if</TT> is permissible (if well controlled) within a portability layer. Outside it, try hard to confine these to conditionalizing <TT>#includes</TT> based on feature symbols.</P>
<P class="docText">Never intrude on the namespace of any other part of the system, including filenames, error return values and function names. Where the namespace is shared, document the portion of the namespace that you use.</P>
<P class="docText">Choose a coding standard. The debate over the choice of standard can go on forever—regardless, it is too difficult and expensive to maintain software built using multiple coding standards, and so some common style must be chosen. Enforce your coding standard ruthlessly, as consistency and cleanliness of the code are of the highest priority; the details of the coding standard itself are a distant second.</P>


<A NAME="ch19lev2sec4"></A>
<H4 class="docSection2Title">19.2.4 Good Distribution-Making Practice</H4>
<P class="docText"><A NAME="idd1e41284"></A>These guidelines describe how your distribution should look when someone downloads, retrieves and unpacks it.</P>
<A NAME="ch19lev3sec19"></A>
<H5 class="docSection3Title">19.2.4.1 Make sure tarballs always unpack into a single new directory.</H5>
<P class="docText">The single most annoying mistake fledgling contributors make is to build tarballs that unpack the files and directories in the distribution into the current directory, potentially overwriting files already located there. <span class="docEmphasis">Never do this!</span></P>
<P class="docText">Instead, make sure your archive files all have a common directory part named after the project, so they will unpack into a single top-level directory directly <span class="docEmphasis">beneath</span> the current one. Conventionally, the name of the directory should be the same as the stem of the tarball's name. So, for example, a tarball named <TT>foo-0.23.tar.gz</TT> is expected to unpack into a subdirectory named <TT>foo-0.23</TT>.</P>
<P class="docText"><A class="docLink" HREF="#ch19ex01">Example 19.1</A> shows a makefile trick that, assuming your distribution directory is named "foobar" and SRC contains a list of your distribution files, accomplishes this.</P>

<H5 class="docExampleTitle"><A NAME="ch19ex01"></A>Example 19.1 <span class="docEmphasis">tar</span> archive maker production.</H5>

<PRE>
foobar-$(VERS).tar.gz:
 @ls $(SRC) | sed s:^:foobar-$(VERS)/: &gt;MANIFEST
 @(cd ..; ln -s foobar foobar-$(VERS))
 (cd ..; tar -czvf foobar/foobar-$(VERS).tar.gz 'cat foobar/MANIFEST')
 @(cd ..; rm foobar-$(VERS))
</PRE>


<A NAME="ch19lev3sec20"></A>
<H5 class="docSection3Title">19.2.4.2 Include a README.</H5>
<P class="docText">Include a file called <TT>README</TT> that is a roadmap of your source distribution. By ancient convention (originating with Dennis Ritchie himself before 1980, and promulgated on Usenet<A NAME="idd1e41343"></A> in the early 1980s), this is the first file intrepid explorers will read after unpacking the source.</P>
<P class="docText"><TT>README</TT> files should be short and easy to read. Make yours an introduction, not an epic. Good things to have in the <TT>README</TT> include the following:</P>
<span style="font-weight:bold"><OL class="docList" TYPE="1"><LI><span style="font-weight:normal"><P class="docList">A brief description of the project.</P></span></LI><LI><span style="font-weight:normal"><P class="docList">A pointer to the project website (if it has one).</P></span></LI><LI><span style="font-weight:normal"><P class="docList">Notes on the developer's build environment and potential portability problems.</P></span></LI><LI><span style="font-weight:normal"><P class="docList">A roadmap describing important files and subdirectories.</P></span></LI><LI><span style="font-weight:normal"><P class="docList">Either build/installation instructions or a pointer to a file containing same (usually <TT>INSTALL</TT>).</P></span></LI><LI><span style="font-weight:normal"><P class="docList">Either a maintainers/credits list or a pointer to a file containing same (usually <TT>CREDITS</TT>).</P></span></LI><LI><span style="font-weight:normal"><P class="docList">Either recent project news or a pointer to a file containing same (usually <TT>NEWS</TT>).</P></span></LI><LI><span style="font-weight:normal"><P class="docList">Project mailing list addresses.</P></span></LI></OL></span>
<P class="docText">At one time this file was commonly <TT>READ.ME</TT>, but this interacts badly with browsers, who are all too likely to assume that the <TT>.ME</TT> suffix means it's not textual and can only be downloaded rather than browsed. This usage is deprecated.</P>

<A NAME="ch19lev3sec21"></A>
<H5 class="docSection3Title">19.2.4.3 Respect and follow standard file-naming practices.</H5>
<P class="docText">Before even looking at the <TT>README</TT>, your intrepid explorer will have scanned the filenames in the top-level directory of your unpacked distribution. Those names can themselves convey information. By adhering to certain standard naming practices, you can give the explorer valuable clues about where to look next.</P>
<P class="docText">Here are some standard top-level file names and what they mean. Not every distribution needs all of these.</P>
<P class="docText"><span class="docEmphStrong">README</span></P>
<BLOCKQUOTE><P><P class="docList">The roadmap file, to be read first.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">INSTALL</span></P>
<BLOCKQUOTE><P><P class="docList">Configuration, build, and installation instructions.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">AUTHORS</span></P>
<BLOCKQUOTE><P><P class="docList">List of project contributors (GNU convention).</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">NEWS</span></P>
<BLOCKQUOTE><P><P class="docList">Recent project news.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">HISTORY</span></P>
<BLOCKQUOTE><P><P class="docList">Project history.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">CHANGES</span></P>
<BLOCKQUOTE><P><P class="docList">Log of significant changes between revisions.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">COPYING</span></P>
<BLOCKQUOTE><P><P class="docList">Project license terms (GNU convention).</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">LICENSE</span></P>
<BLOCKQUOTE><P><P class="docList">Project license terms.</P></P></BLOCKQUOTE>
<P class="docText"><span class="docEmphStrong">FAQ</span></P>
<BLOCKQUOTE><P><P class="docList">Plain-text Frequently-Asked-Questions document for the project.</P></P></BLOCKQUOTE>
<P class="docText">Note the overall convention that filenames with all-caps names are human-readable metainformation about the package, rather than build components. This elaboration of the <TT>README</TT> was developed early on at the Free Software Foundation<A NAME="idd1e41519"></A>.</P>
<P class="docText">Having a <TT>FAQ</TT> file can save you a lot of grief. When a question about the project comes up often, put it in the FAQ; then direct users to read the FAQ before sending questions or bug reports. A well-nurtured FAQ can decrease the support burden on the project maintainers by an order of magnitude or more.</P>
<P class="docText">Having a <TT>HISTORY</TT> or <TT>NEWS</TT> file with timestamps in it for each release is valuable. Among other things, it may help establish prior art if you are ever hit with a patent-infringement lawsuit (this hasn't happened to anyone yet, but best to be prepared).</P>

<A NAME="ch19lev3sec22"></A>
<H5 class="docSection3Title">19.2.4.4 Design for upgradability.</H5>
<P class="docText">Your software will change over time as you put out new releases. Some of these changes will not be backward-compatible. Accordingly, you should give serious thought to designing your installation layouts so that multiple installed versions of your code can coexist on the same system. This is especially important for libraries—you can't count on all your client programs to upgrade in lockstep with your API changes.</P>
<P class="docText">The Emacs, Python, and Qt projects have a good convention for handling this: version-numbered directories (another practice that seems to have been made routine by the FSF<A NAME="idd1e41564"></A>). Here's how an installed Qt library hierarchy looks (<TT>${ver}</TT> is the version number):</P>
<pre>

</pre><pre>
/usr/lib/qt
/usr/lib/qt-${ver}
/usr/lib/qt-${ver}/bin         # Where you find moc
/usr/lib/qt-${ver}/lib         # Where you find .so
/usr/lib/qt-${ver}/include     # Where you find header files
</pre><pre>
</pre>
<P class="docText">With this organization, multiple versions can coexist. Client programs have to specify the library version they want, but that's a small price to pay for not having the interfaces break on them. This good practice avoids the notorious "DLL Hell" failure mode of Windows<A NAME="idd1e41580"></A>.</P>

<A NAME="ch19lev3sec23"></A>
<H5 class="docSection3Title">19.2.4.5 Under Linux, provide RPMs.</H5>
<P class="docText">The de facto standard format for installable binary packages under Linux that used by the Red Hat Package manager, RPM. It's featured in the most popular Linux<A NAME="idd1e41593"></A> distribution, and supported by effectively all other Linux distributions (except Debian and Slackware; and Debian can install from RPMs). Accordingly, it's a good idea for your project site to provide installable RPMs as well as source tarballs.</P>
<P class="docText">It's also a good idea for you to include in your source tarball the RPM spec file, with a production that makes RPMs from it in your <TT>makefile</TT>. The spec file should have the extension <TT>.spec</TT>; that's how the <span class="docEmphasis">rpm</span> <TT>-t</TT> option finds it in a tarball.</P>
<P class="docText">For extra style points, generate your spec file with a shellscript that automatically plugs in the correct version number by analyzing the project <TT>makefile</TT> or a <TT>version.h</TT>.</P>
<P class="docText">Note: If you supply source RPMs, use BuildRoot to make the program be built in <TT>/tmp</TT> or <TT>/var/tmp</TT>. If you don't, during the course of running the make install part of your build, the install will install the files in the real final places. This will happen even if there are file collisions, and even if you didn't want to install the package at all. When you're done, the files will have been installed and your system's RPM database will not know about it. Such badly behaved SRPMs are a minefield and should be eschewed.</P>

<A NAME="ch19lev3sec24"></A>
<H5 class="docSection3Title">19.2.4.6 Provide checksums.</H5>
<P class="docText">Provide checksums with your binaries (tarballs, RPMs, etc.). This will allow people to verify that they haven't been corrupted or had Trojan-horse code inserted in them.</P>
<P class="docText">While there are several commands you can use for this purpose (such as <span class="docEmphStrong"><TT>sum</TT></span> and <span class="docEmphStrong"><TT>cksum</TT></span>) it is best to use a cryptographically-secure hash function. The GPG package provides this capability via the <TT>--detach-sign</TT> option; so does the GNU command <span class="docEmphStrong"><TT>md5sum</TT></span>.</P>
<P class="docText">For each binary you ship, your project Web page should list the checksum and the command you used to generate it.</P>


<A NAME="ch19lev2sec5"></A>
<H4 class="docSection2Title">19.2.5 Good Communication Practice</H4>
<P class="docText"><A NAME="idd1e41672"></A>Your software and documentation won't do the world much good if nobody but you knows they exist. Also, developing a visible presence for the project on the Internet will assist you in recruiting users and co-developers. Here are the standard ways to do that.</P>
<A NAME="ch19lev3sec25"></A>
<H5 class="docSection3Title">19.2.5.1 Announce to Freshmeat.</H5>
<P class="docText">Announce to Freshmeat &lt;<A class="docLink" target="_blank" HREF="http://www.freshmeat.net/default.htm">http://www.freshmeat.net</A>&gt;<A NAME="idd1e41691"></A>. Besides being widely read itself, this group is a major feeder for Web-based technical news channels.</P>
<P class="docText">Never assume the audience has been reading your release announcements since the beginning of time. Always include at least a one-line description of what the software does. Bad example: "Announcing the latest release of FooEditor, now with themes and ten times faster". Good example: "Announcing the latest release of FooEditor, the scriptable editor for touch-typists, now with themes and ten times faster".</P>

<A NAME="ch19lev3sec26"></A>
<H5 class="docSection3Title">19.2.5.2 Announce to a relevant topic newsgroup.</H5>
<P class="docText">Find a Usenet<A NAME="idd1e41707"></A> topic group directly relevant to your application, and announce there as well. Post only where the <span class="docEmphasis">function</span> of the code is relevant, and exercise restraint.</P>
<P class="docText">If (for example) you are releasing a program written in Perl that queries IMAP servers, you should certainly post to <TT>comp.mail.imap</TT>. But you should probably not post to <TT>comp.lang.perl</TT> unless the program is also an instructive example of cutting-edge Perl techniques.</P>
<P class="docText">Your announcement should include the URL of a project website.</P>

<A NAME="ch19lev3sec27"></A>
<H5 class="docSection3Title">19.2.5.3 Have a website.</H5>
<P class="docText">If you intend trying to build any substantial user or developer community around your project, it should have a website. Standard things to have on the website include:</P>
<UL><LI><P class="docList">The project charter (why it exists, who the audience is, etc.).</P></LI><LI><P class="docList">Download links for the project sources.</P></LI><LI><P class="docList">Instructions on how to join the project mailing list(s).</P></LI><LI><P class="docList">A FAQ (Frequently Asked Questions) list.</P></LI><LI><P class="docList">HTMLized versions of the project documentation.</P></LI><LI><P class="docList">Links to related and/or competing projects.</P></LI></UL>
<P class="docText">Refer to the website examples in <A class="docLink" HREF="0131429019_ch16.html#ch16">Chapter 16</A> for examples of what a well-educated project website looks like.</P>
<P class="docText">An easy way to have a website is to put your project on one of the sites that specializes in providing free hosting. In 2003 the two most important of these are SourceForge (which is a demonstration and test site for proprietary collaboration tools) or Savannah (which hosts open-source projects as an ideological statement).</P>

<A NAME="ch19lev3sec28"></A>
<H5 class="docSection3Title">19.2.5.4 Host project mailing lists.</H5>
<P class="docText">It's standard practice to have a private development list through which project collaborators can communicate and exchange patches. You may also want to have an announcements list for people who want to be kept informed of the project's progress.</P>
<P class="docText">If you are running a project named 'foo', your developer list might be <TT>foo-dev</TT> or <TT>foo-friends</TT>; your announcement list might be <TT>foo-announce</TT>.</P>
<P class="docText">An important decision is just how private the "private" development list is. Wider participation in design discussions is often a good thing, but if the list is relatively open, sooner or later you <span class="docEmphasis">will</span> get people asking new-user questions on it. Opinions vary on how best to solve this problem. Just having the documentation tell the new users not to ask elementary questions on the development list is not a solution; such a request must be enforced somehow.</P>
<P class="docText">An announcements list needs to be tightly controlled. Traffic should be at most a few messages a month; the whole purpose of such a list is to accommodate people who want to know when something important happens, but don't want to hear about day-to-day details. Most such people will quickly unsubscribe if the list starts generating significant clutter in their mailboxes.</P>

<A NAME="ch19lev3sec29"></A>
<H5 class="docSection3Title">19.2.5.5 Release to major archives.</H5>
<P class="docText">See the section <span class="docEmphasis">Where Should I Look?</span> in <A class="docLink" HREF="0131429019_ch16.html#ch16">Chapter 16</A> for specifics on the major open-source archive sites. You should release your package to these.</P>
<P class="docText">Other important locations include:</P>
<UL><LI><P class="docList">The Python Software Activity &lt;<A class="docLink" target="_blank" HREF="http://www.python.org/default.htm">http://www.python.org</A>&gt; site (for software written in Python).<A NAME="idd1e41836"></A></P></LI><LI><P class="docList">The CPAN &lt;<A class="docLink" target="_blank" HREF="http://www.language.perl.com/CPAN">http://www.language.perl.com/CPAN</A>&gt;<A NAME="idd1e41848"></A>, the Comprehensive Perl Archive Network (for software written in Perl).</P></LI></UL>



<ul></ul></td></tr></table>
<td></td>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<td class="tt1"><a href="NFO/lib.html">[ Team LiB ]</a></td><td valign="top" class="tt1" align="right">
          <a href="0131429019_ch19lev1sec1.html"><img src="FILES/btn_prev.gif" width="62" height="15" border="0" align="absmiddle" alt="Previous Section"></a>
          <a href="0131429019_ch19lev1sec3.html"><img src="FILES/btn_next.gif" width="41" height="15" border="0" align="absmiddle" alt="Next Section"></a>
</td></table>
</body></html>
