<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section F.3.&nbsp; Compiling and Linking</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=app06lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=app06lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><TR><td valign="top"><a name="app06lev1sec4"></a>

<H3 id="610536-838" class="docSection1Title">F.3. Compiling and Linking</h3>
<a name="app06lev2sec5"></a>
<H4 id="title-IDAUXUBT" class="docSection2Title">F.3.1. <a name="iddle1157"></a><a name="iddle1590"></a>Compiler Options</h4>
<p class="docText">GCC and the binary utilities provide some options supporting zSeries. You can find a detailed description of all GCC options in the manual <span class="docEmphasis"><a name="iddle2511"></a>Using the GNU Compiler Collection</span>.<sup class="docFootnote"><a class="docLink" href="#app06fn4">[4]</a></sup> This manual provides a section exclusively devoted to the zSeries-specific options<a name="d0e128463"></a>. We do not describe these options in full detail but rather give an overview. Also, it is likely that additional compiler options will be provided for new zSeries models and improvements might be offered for existing models. Check the most recent version of the GCC manual (see footnote 4) for details.</p><blockquote><p class="docFootnote"><sup><a name="app06fn4">[4]</a></sup> GCC manual, <a class="docLink" target="_blank" href="http://www.gnu.org/software/gcc/gcc.html">www.gnu.org/software/gcc/gcc.html</a></p></blockquote>
<p class="docText"><a class="docLink" href="#app06fig03">Figure F-3</a> shows a summary of the performance improvements achieved between 1999 and 2004 that suggests it is really worth exploiting GCC's zSeries-specific optimization options. Note that all data given in <a class="docLink" href="#app06fig03">Figure F-3</a> was taken on the latest zSeries model available in the particular year and is normalized. Overlapping measurements have been used to scale when the measurements were taken on a new zSeries model. The publication &quot;Contributions to the GNU Compiler Collection&quot;<sup class="docFootnote"><a class="docLink" href="#app06fn5">[5]</a></sup> details how the measurements were conducted.</p><blockquote><p class="docFootnote"><sup><a name="app06fn5">[5]</a></sup> <a class="docLink" target="_blank" href="http://www.research.ibm.com/journal/sj/442/edelsohn.pdf">www.research.ibm.com/journal/sj/442/edelsohn.pdf</a></P></blockquote>
<a name="app06fig03"></a><P><center>

<H5 class="docFigureTitle">Figure F-3. Performance increase due to improved compiler optimization</h5>

<p class="docText">
<img border="0" alt="" id="195131084204" width="444" height="274" SRC="images/fulp03.jpg"></P>


</center></p><br>
<p class="docText"><a class="docLink" href="#app06table3">Table F-3</a> shows the zSeries-specific code optimization options.</p>
<a name="app06table3"></a><p><table cellspacing="0" FRAME="hsides" RULES="groups" cellpadding="5"><caption><H5 class="docTableTitle">Table F-3. zSeries-Specific Code Optimization Compiler Options</H5></caption><colgroup align="left" span="2"><col width="150"><col width="350"></colgroup><thead><tr><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Options</p></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Function</p></th></tr></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-march=cpu-type</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Exploits all instructions provided by <tt>cpu-type</tt>, including those not available on older models. In general, code compiled with this option does not execute on older CPUs. See the GCC manual (footnote 4) for a list of supported CPU types.</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-mtune=cpu-type</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Schedules instructions to best exploit the internal structure of <tt>cpu-type</tt>. This option does not introduce any incompatibility with older CPUs, but code tuned for a different CPU might execute more slowly.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-mzarch</tt> and <tt>mesa</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Generate code exploiting the instruction set of the ESA/390 or the z/Architecture, respectively. See the GCC manual (see footnote 4) for default values and interaction with other options.</P></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-m64</tt> and <tt>-m31</tt></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Control whether the generated code is compliant to the Linux for S/390 ABI (<tt>-m31</tt>) or the Linux for zSeries ABI (<tt>-m64</tt>).<sup class="docFootnote"><a class="docLink" href="#app06fn6">[6]</a></sup>,<sup class="docFootnote"><a class="docLink" href="#app06fn7">[7]</a></sup></p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>-msmall-exec</tt> and <tt>-mno-small-exec</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">A switch to optimize jump instructions in executables with a total size not exceeding 64K. Some options exist to control and optimize stack growth.</P></td></tr></table></p><br><blockquote><p class="docFootnote"><sup><a name="app06fn6">[6]</a></sup> For details on the ABI, see LINUX for S/390 ELF Application Binary Interface Supplement, <a class="docLink" target="_blank" href="http://oss.software.ibm.com/linux390/docu/l390abi0.pdf">http://oss.software.ibm.com/linux390/docu/l390abi0.pdf</a>.</P></blockquote><blockquote><p class="docFootnote"><sup><a name="app06fn7">[7]</a></sup> For details on the ABI, see LINUX for zSeries ELF Application Binary Interface Supplement, <a class="docLink" target="_blank" href="http://oss.software.ibm.com/linux390/docu/lzsabi0.pdf">http://oss.software.ibm.com/linux390/docu/lzsabi0.pdf</a>.</P></blockquote>
<p class="docText"><a class="docLink" href="#app06table4">Table F-4</a> shows some options available to control and optimize stack growth.</p>
<a name="app06table4"></a><p><table cellspacing="0" FRAME="hsides" RULES="groups" cellpadding="5"><caption><h5 class="docTableTitle">Table F-4. Compiler Options to Control and Optimize Stack Growth</h5></caption><colgroup align="left" span="2"><col width="200"><col width="300"></colgroup><thead><TR><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Options</p></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Function</p></th></tr></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-mwarn-framesize=framesize</tt> and <tt>-mwarn-dynamicstack</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Cause a compile-time check of whether a function exceeds a given stack frame size, or uses dynamically sized stack frames. These options help when stack space is rare, as is the case in the Linux kernel, or when application programs fail during a stack overflow.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-mstack-guard=stack-guard</tt> and <tt>-mstack-size=stack-size</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Help debugging stack size problems. The checks are, however, performed during runtime by executing some extra code inserted into the binary.</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>-mpacked-stack</tt> and <tt>-mno-packed-stack</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Control whether the stack frame uses a space-optimized, dense packing scheme for register save slots. See the GCC manual (footnote 4) for details concerning compatibility with other options and for call compatibility with binary code generated by pre-3.0 versions of GCC.</p></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-mbackchain</tt> and <tt>mno-backchain</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Control whether the address of the caller's frame is stored as a so-called backchain pointer into the callee's stack frame. See the GCC manual (footnote 4) for details concerning the compatibility with other options, and for details related to debugging.</P></TD></TR></table></p><BR>
<p class="docText">Linux for zSeries has an important difference from other systems concerning shared libraries. The <tt>-fpic</tt> and <tt>-fPIC</tt> options cause the compiler to generate positioning-dependent code (<tt>pic</tt>) for use in shared or reentrant libraries. On zSeries, <tt>-fpic</tt> causes the Global Offset Table to be rather small, so you should instead use <tt>-fPIC</tt> for large shared libraries.</p>
<p class="docText">If the linker reports a &quot;relocation overflow&quot; bug, check whether the project in question uses the <tt>-fpic</tt> option. Changing it to <tt>-fPIC</tt> might fix the problem. Note that you must use the same variant of this option for all compiler runs related to the same project.</p>
<p class="docText">Last but not least, the options <tt>-mfused-madd, -mno-fused-madd, -mhard-float</tt>, and <tt>-msoft-float</tt> control the usage of floating-point operations. See the &quot;Principles of Operation&quot;<sup class="docFootnote"><a class="docLink" href="#app06fn8">[8]</a></sup>,<sup class="docFootnote"><a class="docLink" href="#app06fn9">[9]</a></sup> for a complete description of the zSeries instruction set and architecture. In addition, some technical papers describe the internals of how GCC generates code for zSeries, available for download.<sup class="docFootnote"><a class="docLink" href="#app06fn10">[10]</a></sup>,<sup class="docFootnote"><a class="docLink" href="#app06fn11">[11]</a></sup>,<sup class="docFootnote"><a class="docLink" href="#app06fn12">[12]</a></sup><a name="d0e128797"></a><a name="d0e128798"></a></p><blockquote><p class="docFootnote"><sup><a name="app06fn8">[8]</a></sup> &quot;ESA/390 Principles of Operation&quot;, <a class="docLink" target="_blank" href="http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9ar007">http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9ar007</a></p></blockquote><blockquote><p class="docFootnote"><sup><a name="app06fn9">[9]</a></sup> &quot;z/Architecture Principles of Operation&quot;, <a class="docLink" target="_blank" href="http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9zr001">http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9zr001</a></P></blockquote><blockquote><p class="docFootnote"><sup><a name="app06fn10">[10]</a></sup> &quot;The GNU 64-bit PL8 compiler: Towards an open standard environment for Firmware development&quot;, <a class="docLink" target="_blank" href="http://www.research.ibm.com/journal/rd/483/gellerich.pdf">www.research.ibm.com/journal/rd/483/gellerich.pdf</a></P></blockquote><blockquote><p class="docFootnote"><sup><a name="app06fn11">[11]</a></sup> &quot;Porting GCC to the IBM S/390 Platform&quot;, <a class="docLink" target="_blank" href="http://www.gccsummit.org/2003/">www.gccsummit.org/2003/</a></p></blockquote><blockquote><p class="docFootnote"><sup><a name="app06fn12">[12]</a></sup> &quot;Contributions to the GNU Compiler Collection&quot;, <a class="docLink" target="_blank" href="http://www.research.ibm.com/journal/sj/442/edelsohn.pdf">www.research.ibm.com/journal/sj/442/edelsohn.pdf</a></p></blockquote>

<a name="app06lev2sec6"></a>
<h4 id="title-IDADGVBT" class="docSection2Title">F.3.2. <a name="iddle1076"></a><a name="iddle1588"></a>Assembler Code</h4>
<p class="docText">Any assembler code must, of course, be rewritten. See ESA/390 Principles of Operation<sup class="docFootnote"><a class="docLink" href="#app06fn13">[13]</a></sup> and z/Architecture Principles of Operation<sup class="docFootnote"><a class="docLink" href="#app06fn14">[14]</a></sup> for a complete description of the zSeries architecture and instruction set.<a name="d0e128828"></a><a name="d0e128829"></a></P><blockquote><p class="docFootnote"><sup><a name="app06fn13">[13]</a></sup> <a class="docLink" target="_blank" href="http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9ar007">http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9ar007</a></p></blockquote><blockquote><p class="docFootnote"><sup><a name="app06fn14">[14]</a></sup> <a class="docLink" target="_blank" href="http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9zr001">http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dz9zr001</a></p></blockquote>

<a name="app06lev2sec7"></a>
<h4 id="title-IDA4HVBT" class="docSection2Title">F.3.3. <a name="iddle1597"></a><a name="iddle2288"></a>Stack Frame Layout and <a name="iddle1730"></a>Linkage</H4>
<p class="docText">Although not immediately required for the development of application programs in C and C++, you might occasionally need detailed information about certain implementation issues such as register usage conventions or the stack frame layout. This information is found in the ELF Application Binary Interface Supplement (see footnotes 6 and 7). More conventions used when compiling for zSeries are described in &quot;Porting GCC to the IBM S/390 Platform&quot; (see footnote 11).<a name="d0e128854"></a><a name="d0e128855"></a><a name="d0e128856"></a></p>

<a name="app06lev2sec8"></a>

<h4 id="title-IDA4JVBT" class="docSection2Title">F.3.4. <a name="iddle1596"></a><a name="iddle2029"></a>Predefined Symbols</H4>
<p class="docText">If some code needs to be platform-dependent, you can use two predefined symbols in preprocessor expressions. <tt>__s390__</tt> is set when compiling for zSeries in 31-bit or 64-bit mode, or when compiling for S/390. <tt>__s390x__</tt> is set when compiling for zSeries in 64-bit mode.<a name="d0e128884"></a><a name="d0e128885"></a></p>

<a name="app06lev2sec9"></a>
<h4 id="title-IDANLVBT" class="docSection2Title">F.3.5. <a name="iddle1592"></a>Debugging</h4>
<p class="docText">Many Linux debugging tools are available on Linux for zSeries. One additional feature is available for Linux running under VM. Using VM's <tt>trACE</tt> command offers a convenient and powerful way to debug the whole Linux system. See the book <span class="docEmphasis">z/VM CP Command and Utility Reference</span><sup class="docFootnote"><a class="docLink" href="#app06fn15">[15]</a></sup> for a reference on the <tt>trACE</tt> command. An introduction to debugging is given in Chapter 22 of the book <span class="docEmphasis">Linux on the Mainframe</span>.<sup class="docFootnote"><a class="docLink" href="#app06fn16">[16]</a></sup> A detailed description of how to debug is included in most Linux distributions in the file /usr/src/linux/Documentation/s390/debugging390.txt. For debugging more difficult problems, you can find information about register usage, stack frame layout, and other conventions in the ELF Application Binary Interface Supplement (see footnotes 6 and 7).<a name="d0e128920"></a></p><blockquote><p class="docFootnote"><sup><a name="app06fn15">[15]</a></sup> IBM publication number SC24-5967</p></blockquote><blockquote><p class="docFootnote"><sup><a name="app06fn16">[16]</a></sup> Eilert, John, et al. Linux on the Mainframe. Prentice Hall, 2003</p></blockquote>


</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=app06lev1sec3.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=app06lev1sec5.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>