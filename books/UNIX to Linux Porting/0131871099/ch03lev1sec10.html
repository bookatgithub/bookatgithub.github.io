<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 3.10.&nbsp; Internationalization (I18N) and Localization</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec9.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec11.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a name="ch03lev1sec10"></a>

<H3 id="588026-1000" class="docSection1Title">3.10. <a name="iddle1621"></a>Internationalization (I18N)<sup class="docFootnote"><a class="docLink" href="#ch03fn18">[18]</a></sup> and <a name="iddle1577"></a>Localization</H3><blockquote><p class="docFootnote"><sup><a name="ch03fn18">[18]</a></sup> Refer to <a class="docLink" target="_blank" href="http://www.li18nux.org/">www.li18nux.org/</a> to learn more about the Linux I18N Project.</P></blockquote>
<p class="docText">How <a name="iddle1769"></a>I18N affects the porting effort greatly depends on the application. If an application requires simple message catalogue conversions, date and time displays, or simple text string searches using regular expressions, porting these functionalities from UNIX platforms to Linux can be easy. However, if the application does more-complicated text analysis, like ones used in editors, those may be harder to port for the reason mentioned in the next paragraph.</P>
<p class="docText">Linux conforms to the ISO naming standard locale names, [locale]_[territory].[codeset], where locale is the two-character language and territory is the two-character territory. Examples of these are en_US.iso885915 and zh_CN.gb18030. However, the locales available on each system and locale contents differ. Porting applications that require complicated use of available locales may require the need to learn language specificity and translation as well as modification of existing locales on Linux to get similar behavior that is expected from the source application running on a different platform.</p>
<p class="docText"><a class="docLink" href="#ch03table04">Table 3-4</a> shows some of the supported GNU <tt>libc</tt> <a name="iddle1455"></a>internationalization functions.</p>
<a name="ch03table04"></a><p><table cellspacing="0" FRAME="hsides" RULES="none" cellpadding="5"><caption><H5 class="docTableTitle">Table 3-4. GNU libc I18N Support Table</H5></caption><colgroup align="left" span="2"><col width="250"><col width="250"></colgroup><thead><TR><th class="thead" scope="col" align="left" valign="top"><p class="docText">GNU libc</P></th><th class="thead" scope="col" align="left" valign="top"><p class="docText">Functions</P></th></tr></thead><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>wcscat, wcsncat, wcscmp, wcsncmp, wcscpy, wcsncpy, wcslen, wcschr, wcsrchr, wcsstr, wcspbrk, wcsspn, wcscspn, wcswcs, wcstok, wcscoll, wcwidth, wcswidth, wcsxfrm</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Wide character string functions</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>mblen, mbrlen, wcslen, strlen, wcswidth, wcwidth</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Dimension functions</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>mbsinit, mbrtowc, wcrtomb mbsrtowcs, wcsrtombs, btowc, wctob, mbtowc, mbstowcs wctomb, wcstombs, wcrtomb, wcsnrtombs, mbsnrtowcs</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Conversion functions</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>iconv, iconv_open, iconv_close</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Translation functions</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>ngettext, dngettext, dcngettext setlocale, textdomain, bindtextdomain, bind_textdomain_codeset, gettext, dgettext, dcgettext, catgets, gencat, catclose, catopen</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Message catalog functions</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>getc, getc_unlocked, getchar getchar_unlockec, fgetc, getw, putc, putchar, fputc, putw, fgetc, getw, ungetwc, getwc, getwchar, fgetwc, ungetwc, fgets, ungetc, fputwc, fputws, putwc, putwchar, fputs, fgetws</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Input/output functions</P></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>fwprintf, wprintf, swprintf, vfwprintf, vwprintf, vswprintf, strftime, strfmon, printf, fprintf, sprintf, wcfstime, vprintf, vfprintf, vsprintf, vsnprintf</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">String formatting functions</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>iswalpha, iswupper, iswlower iswdigit, iswxdigit, iswalnum iswspace, iswpunct, iswprint, iswgraph, iswcntrl, wctype, iswctype, isalpha, isupper, islower, isdigit, isxdigit, isalnum, isspace, ispunct, isprint, isgraph, iscntrl, isascii, isblank, isspace, isupper</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Character classifications</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>strcoll, strxfrm, wcscoll, wcsxfrm</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Collation functions</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>regcomp, regexec, regerror, regfree</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Regular expressions</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>memset, wmemchr, wmemcmp wmemcpy, wmemmove, wmemset, wcpcpy, wcpncpy, wcscpy, wcsncpy, wcsspn, wmemset, cpcpy, cpncpy, cscpy, csncpy, csspn</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">String copying and filling functions</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>towlower, towupper, towctrans, wctrans, tolower, toupper</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Conversion functions</P></TD></tr></table></P><br>
<p class="docText">On Linux, you can use the command <tt>locale a</tt> to determine the locales installed on the system, and the decoder file can be found in /usr/share/locale/locale.alias.<a name="d0e8990"></a><a name="d0e8991"></a><a name="d0e8992"></a><a name="d0e8993"></a></p>
<a name="ch03lev2sec8"></a>
<H4 id="title-IDA2A5HZ" class="docSection2Title">3.10.1. <a name="iddle1579"></a><a name="iddle1600"></a><a name="iddle1624"></a><a name="iddle1771"></a>Iconv Support</H4>
<p class="docText">Linux provides the <tt>iconv(1)</tt> utility to convert traditional string encoding to unicode. To get a list of currently implemented encodings in Linux, use the <tt>iconv list</tt> command at the Linux command prompt.</p>
<p class="docText">Sometimes using the <tt>iconv</tt> utilty to translate encodings is not sufficient. Some applications, such as mailers and Web interfaces, need to convert between two different text encodings. The GNU <tt>libc</tt> provides functionalities to programmatically convert string encodings between internal string representation (unicode) and external string representation (a traditional encoding).</p>
<p class="docText"><a class="docLink" href="#ch03ex04">Example 3-4</a> shows how to use the libiconv APIs.</p>
<a name="ch03ex04"></a><h5 id="title-IDASD5HZ" class="docExampleTitle">Example 3-4. Listing of iconv_samp.c</H5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<div class="docText"><pre>#include &lt;iconv.h&gt;
#include &lt;errno.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;

main(int argc, char *argv[])
{
  int Input = STDIN_FILENO;
  iconv_t cd;                  /* conversion descriptor */
  int bytesread;                /* num bytes read into input buffer */
  unsigned char inbuf[BUFSIZ]; /* input buffer */
  const unsigned char *inchar; /* ptr to input character */
  size_t inbytesleft;          /* num bytes left in input buffer */
  unsigned char outbuf[BUFSIZ];/* output buffer */
  const unsigned char *outchar;/* ptr to output character */
  size_t outbytesleft;         /* num bytes left in output buffer */
  size_t ret_val;               /* number of successful conversions */

  if (argc &lt; 2)
  {
    printf("usage  : iconv_samp &lt;tocode&gt; &lt;fromcode&gt;\n");
    printf("Example : iconv_samp WINDOWS-1256 ISO_8859-16\n");
    printf("Run the command \"iconv --list\" for list of known
                      character sets\n");
    exit(1);
  }
  /* Initiate conversion -- get conversion descriptor */
  if ((cd = iconv_open(argv[1], argv[2])) == (iconv_t)-1) {
    printf("iconv_open failed : %d \n", errno);
    exit(1);
  }

  inbytesleft = 0;       /* no. of bytes converted */
                         /* translate the characters */
  for ( ;; ) {
    /*
     * if any bytes are leftover, they will be in the
     * beginning of the buffer on the next read().
 */

inchar = inbuf;         /* points to input buffer */
outchar = outbuf;       /* points to output buffer */
outbytesleft = BUFSIZ;  /* no of bytes to be converted */
if ((bytesread = read(Input, inbuf+inbytesleft,
       (size_t)BUFSIZ-inbytesleft)) &lt; 0) {
      perror("prog");
      return 1;
}
if (!(inbytesleft += bytesread)) {
  break;      /* end of conversions */
}

ret_val = iconv(cd, (char **)&amp;inchar, &amp;inbytesleft,
          (char **)&amp;outchar, &amp;outbytesleft);

if (write(1, outbuf, (size_t)BUFSIZ-outbytesleft) &lt; 0) {
  perror("prog");
  return 1;
}

/* iconv() returns the number of non-identical conversions
 * performed. If the entire string in the input buffer is
 * converted, the value pointed to by inbytesleft will be
 * zero. If the conversion stopped due to any reason, the
 * value pointed to by inbytesleft will be nonzero and
 * errno is set to indicate the condition.
 */

switch (ret_val)
{
  case 0:
    /* nothing to do */
    break;
  case -1:
    switch (errno)
    {
      case EINVAL:
        /* Conversion stopped due to an incomplete
         * multibyte sequence encountered in the
         * input buffer.
         */
        /* Copy data left, to the start of buffer */
        memcpy((char *)inbuf, (char *)inchar,
              (size_t)inbytesleft);
        break;
      case EILSEQ:
        /* Conversion stopped due to an invalid
         * multibyte sequence encountered in the
         * input buffer.
                     */
            printf("EILSEQ encountered program exiting\n");
            exit(1);
            break;
          case E2BIG:
            /* Conversion stopped due to lack of space
             * in the output buffer.
             */
            memcpy((char *)inbuf, (char *)inchar,
               (size_t)inbytesleft);
            break;
          default:
            break;
        }
      default:
      break;
    }
    /* Go back and read from the input file. */
  }

  /* end conversion &amp; get rid of the conversion table */
  if (iconv_close(cd) == (int)-1) {
    printf("iconv_close failed : %d \n", errno);
    exit (1);
  }
  return 0;
}
</pre></div><br>
<p class="docText">Compile the code:</P>
<div class="docText"><pre>$ gcc iconv_samp.c -o iconv_samp
</pre></div><BR>
<p class="docText">Use the executable to convert an input file:</p>
<div class="docText"><pre>$ ./iconv_samp WINDOWS-1256 ISO_8859-16 &lt; <span class="docEmphasis">input_file</span>
</pre></div><br>
</td></tr></table></p>

<a name="ch03lev2sec9"></a>

<h4 id="title-IDAAF5HZ" class="docSection2Title">3.10.2. How to <a name="iddle1578"></a><a name="iddle1770"></a><a name="iddle1827"></a>Create a <a name="iddle1625"></a>Message Catalog<sup class="docFootnote"><a class="docLink" href="#ch03fn19">[19]</a></sup></h4><blockquote><p class="docFootnote"><sup><a name="ch03fn19">[19]</a></sup> Refer to <span class="docEmphasis">Linux Programming by Example</span> by Robbins (Prentice Hall, 2004) for more detailed Linux I18N examples.</p></blockquote>
<p class="docText">A message catalog is a file used to translate language-dependent output of an application in the language to which the system locale is set. <a class="docLink" href="#ch03ex05">Example 3-5</a> shows how to create a message catalog on Linux using the GNU <tt>xgettext</tt> and <tt>msgfmt</tt> utilities.<a name="d0e9151"></a><a name="d0e9152"></a><a name="d0e9153"></a><a name="d0e9154"></a></p>
<a name="ch03ex05"></a><h5 id="title-IDASI5HZ" class="docExampleTitle">Example 3-5. Sample Listing of message_cat.c</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>


<div class="docText"><pre>#include &lt;locale.h&gt;
#include &lt;stdio.h&gt;
#include &lt;libintl.h&gt;

#define PACKAGE  "my_message"
#define LOCALEDIR "locale"

int
main() {
  setlocale (LC_MESSAGES, "");
  bindtextdomain (PACKAGE, LOCALEDIR);
  textdomain (PACKAGE);

  printf("%s\n", gettext("Linux Porting Guide"));
  printf("%s\n", gettext("Author: Mendoza, Skawratananond,Walker"));
  return(0);
}
</pre></div><BR>
<p class="docText">In this example, we want to output the title and authors of the book in Spanish. To do this, we first run <tt>xgettext</tt> against the sample program:</p>
<div class="docText"><pre>$ xgettext hello.c
</pre></div><br>
<p class="docText">This produces a file named message.po:</p>
<div class="docText"><pre><span class="docEmphStrong">$ cat message.po</span>

# SOME DESCRIPTIVE TITLE.
# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2005-03-17 12:22-0800\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME &lt;EMAIL@ADDRESS&gt;\n"

"Language-Team: LANGUAGE &lt;LL@li.org&gt;\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=ISO-8859-2\n"
"Content-Transfer-Encoding: 8bit\n"

#: hello.c:13
msgid "Linux Porting Guide"
msgstr "Guia de Migracion a Linux"

#: hello.c:14
msgid "Author: Mendoza, Skawratananond,Walker"
msgstr "Autor: Mendoza, Skawratananond,Walker"
</pre></div><BR>
<p class="docText">Edit the file message.po, and change the <tt>msgstr</tt> for <span class="docEmphasis">each</span> of the messages to be translated. Edit the <tt>charset</tt> if it was not set before running <tt>xgettext</tt>. Then run the command msgfmt against the messages.po file. The file named my_messages.mo refers to the domain set in the bindtextdomain with the extension of .mo.<a name="d0e9208"></a><a name="d0e9209"></a><a name="d0e9210"></a><a name="d0e9211"></a></P>
<div class="docText"><pre><span class="docEmphStrong">$ msgfmt -v -o my_message.mo messages.po</span>
</pre></div><BR>
<p class="docText">For this example, we create a directory for Spanish (Costa Rica) in our local directory (not the default directory /usr/lib/locale, because we do not have root access):</P>
<div class="docText"><pre><span class="docEmphStrong">$ mkdir -p locale/es_CR/LC_MESSAGES</span>
</pre></div><BR>
<p class="docText">Then move my_messages.mo to the correct directory:</p>
<div class="docText"><pre>$ mv my_message.mo locale/es_CR/LC_MESSAGES
</pre></div><br>
<p class="docText">Export the correct <tt>LC_MESSAGES</tt> value and run the sample program:</p>
<div class="docText"><pre><span class="docEmphStrong">$ export LC_MESSAGES=es_CR</span>
<span class="docEmphStrong">$ ./hello</span>
Guia de Migracion a Linux
Autor: Mendoza, Skawratananond,Walker
</pre></div><BR>
<p class="docText">We have just successfully created a message catalogue file on Linux.</P>
</TD></TR></table></P>


</TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec9.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch03lev1sec11.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>