<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 4.9.&nbsp; Threads</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec8.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec10.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a href="9001536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a><a name="ch04lev1sec9"></a>

<H3 id="title-IDAYHV0Q" class="docSection1Title">4.9. <a name="iddle2281"></a>Threads</H3>
<p class="docText">This section addresses issues that developers might face when migrating multithreaded applications from <a name="iddle2474"></a>Solaris to Linux<a name="d0e22708"></a>. On the Linux side, the material in this section is based on the new implementation of a POSIX thread library (the Native POSIX Thread Library, NPTL for short, developed by Ulrich Drepper). We have provided an introduction to NPTL in <a class="docLink" href="ch03.html#ch03">Chapter 3</a>. Here we focus on the differences between threading implementations in Solaris and Linux.<a name="d0e22716"></a></P>
<a name="ch04lev2sec34"></a>
<H4 id="title-IDASJV0Q" class="docSection2Title">4.9.1. Solaris <a name="iddle1725"></a><a name="iddle2247"></a><a name="iddle2471"></a>libthread Versus Linux <a name="iddle1702"></a>libpthread</h4>
<p class="docText">Solaris supports two threading implementations: Solaris threads and POSIX threads (<a name="iddle2044"></a>pthreads). There are a few functions implemented by the Solaris threads API but not by pthreads API and vice versa. For those functions that do match, the associated arguments might not. The following features are exclusively supported by the Solaris threads API:</p>
<ul><LI><p class="docList">The ability to create <span class="docEmphasis">daemon</span> threads. The process exits when all of its nondaemon threads exit. Daemon threads do not affect its process exit status and are ignored when counting the number of thread exits.</P></LI><LI><p class="docList">The ability to suspend or continue the execution of the thread via <tt>tHR_suspend()</tt> and <tt>thr_continue()</tt>. Note that <tt>tHR_suspend()</tt> suspends the target thread with no regard to the locks that the thread might be holding. This will result in deadlock if the suspending thread calls a function that requires a lock held by the suspended target thread.</p></li><LI><p class="docList">The ability to allow a thread to wait for any undetached thread in the process to terminate. This is achieved when the first argument of <tt>tHR_join()</tt> is set to 0. If we set the first argument of <tt>pthread_join()</tt> to 0, the program will be terminated with a segmentation fault.</p></li></ul>
<p class="docText"><a class="docLink" href="#ch04table13">Table 4-13</a> compares the Solaris threads APIs with the Linux NPTL APIs.</p>

<p class="docText"></P><a name="ch04table13"></a><p><table cellspacing="0" FRAME="hsides" RULES="groups" cellpadding="5"><caption><h5 class="docTableTitle">Table 4-13. Solaris Threads and Linux POSIX pthreads Comparison</h5></caption><colgroup align="left" span="3"><col width="150"><col width="150"><col width="150"></colgroup><thead><tr><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Solaris Threads API</P></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Linux POSIX Threads API</P></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Description</p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_create()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_create()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Creates a new thread of control.</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_exit()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_exit()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Terminates the execution of the calling thread.</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>tHR_join()</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_join()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Suspends the calling thread until the target thread completes.</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_kill()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_kill()</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Sends a signal to another thread.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_self()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_self()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Returns the thread ID of the calling process.</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_yield()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>sched_yield()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Makes the current thread yield to another thread.</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>tHR_getprio()</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_getschedparam()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Retrieves a thread's priority parameters.</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_setprio()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setschedparam()</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Modifies a thread's priority parameters.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_getspecific()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_getspecific()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Binds a new thread-specific value to the key.</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_setspecific()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setspecific()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Binds a new thread-specific value to the key.</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>tHR_getconcurrency()</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_getconcurrency()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Gets thread concurrency level.</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_setconcurrency()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setconcurrency()</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Sets thread concurrency level.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_sigsetmask()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_sigmask()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Changes or examines the calling thread's signal mask.</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_keycreate()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_key_create()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Creates a key that locates data specific to a thread.</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText">N/A</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_key_delete()</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Deletes a key that locates data specific to a thread.</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_suspend()</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Suspends the execution of the specified thread.</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>thr_continue()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">N/A</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Resumes the execution of a suspended thread.</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>mutex_lock()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_lock()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Locks the given mutex.</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>mutex_unlock()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_unlock()</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Unlocks the given mutex.</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>mutex_trylock()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_trylock()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">The calling thread not blocked if the mutex is already locked but returns with the error code <tt>EBUSY</tt>.</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>mutex_init()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_init()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Initializes the mutex.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>mutex_destroy()</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_destroy()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Destroys a mutex object.</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>cond_wait()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_wait()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Blocks on the conditional variable.</P></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>cond_timedwait()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_timedwait()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Blocks on the conditional variable until the specified absolute time passes.</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>cond_reltimedwait()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">N/A</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Blocks on the conditional variable until the specified relative time passes.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>cond_signal()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_signal()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Signals a condition.</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>cond_broadcast()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_braodcast()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Broadcasts a condition.</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>cond_init()</tt></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_init()</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Initializes condition variables.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>cond_destroy()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_destroy()</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Destroys condition variables.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>rwlock_init()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_init()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Initializes a read-write lock object.</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>rwlock_destroy</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_destroy()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Destroys a read-write lock object.</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>rw_rdlock()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_rdlock()</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Locks a read-write lock object for reading.</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>rw_wrlock()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_wrlock()</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Locks a read-write lock object for writing.</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>rw_unlock()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_unlock()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Unlocks a read-write lock object.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>rw_tryrdlock()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_tryrdlock()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Tries to lock a read-write lock object for reading.</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>rw_trywrlock()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_<br>trywrlock()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Tries to lock a read-write lock object for writing.</P></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>sema_init()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>sem_init()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Initializes a semaphore.</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>sema_destroy()</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>sem_destroy()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Destroys a semaphore.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>sema_wait()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>sem_wait()</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Blocks until the semaphore count is greater than 0 and decrements the count.</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>sema_post()</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>sem_post()</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Atomically increments the semaphore.</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>sema_trywait()</tt></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>sem_trywait()</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Atomically decrements the semaphore.</P></td></tr></table></p><br>
<p class="docText">The behavior of <tt>fork()</tt> in <a name="iddle2476"></a>Solaris 9 and earlier releases is different from <tt>fork()</tt> in POSIX threads. In POSIX threads, <tt>fork()</tt> creates a new process, duplicating the complete address space in the child. However, it duplicates only the calling thread in the child process. The Solaris threads API also provides the <span class="docEmphasis">replicate all</span> <a name="iddle1359"></a>fork semantics, <tt>forkall()</tt><a name="d0e23561"></a>. This function duplicates the address space and all the threads in the child. This feature is not supported by the POSIX thread standard.<a name="d0e23563"></a><a name="d0e23564"></a><a name="d0e23565"></a><a name="d0e23566"></a><a name="d0e23567"></a></P>

<a name="ch04lev2sec35"></a>
<h4 id="title-IDA2GFIO" class="docSection2Title">4.9.2. Solaris <a name="iddle2246"></a>libpthread Versus <a name="iddle1749"></a>Linux libpthread</h4>
<p class="docText">Although Solaris and Linux both implement the POSIX 1003.1, there are minor differences in platform implementations. In this section, we focus on these differences.</p>
<p class="docText"><a class="docLink" href="#ch04table14">Table 4-14</a> shows the default values of attributes for POSIX threads on Linux compared to those on Solaris.</p>

<p class="docText"></P><a name="ch04table14"></a><P><table cellspacing="0" FRAME="hsides" RULES="groups" cellpadding="5"><caption><h5 class="docTableTitle">Table 4-14. Default pthreads Attributes for Solaris and Linux</h5></caption><colgroup align="left" span="4"><col width="135"><col width="135"><col width="135"><col width="135"></colgroup><thead><tr><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Attribute</p></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Solaris Default Value</p></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Linux Default Value</p></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Description of Default</p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Contentionscope</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>PTHREAD_SCOPE_ PROCESS</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>PTHREAD_SCOPE_ SYSTEM</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Threads contend for CPU time with all processes running on the machine.</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Detachstate</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>PTHREAD_CREATE_JOINABLE</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>PTHREAD_CREATE_JOINABLE</tt></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Thread created in the joinable state.</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Stacksize</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>NULL</tt><sup class="docFootnote"><a class="docLink" href="#ch04fn18">[18]</a></sup></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Variable</tt><sup class="docFootnote"><a class="docLink" href="#ch04fn19">[19]</a></sup></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Minimum stack size (in bytes).</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Priority</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>0</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>0</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Priority of the thread.</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Policy</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>SCHED_OTHER</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>SCHED_OTHER</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">The regular scheduling policy.</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Inheritsched</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>PTHREAD_EXPLICIT_SCHED</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>PTHREAD_INHERIT_SCHED</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Indicates how scheduling policy and parameters are determined for the newly created thread.</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>Guardsize</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>PAGESIZE</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>PAGESIZE</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Size of guard area for a thread's created stack.</p></td></tr></table></p><br><blockquote><p class="docFootnote"><sup><a name="ch04fn18">[18]</a></sup> 1MB for 32-bit processes and 2MB for 64-bit processes</p></blockquote><blockquote><p class="docFootnote"><sup><a name="ch04fn19">[19]</a></sup> Dependent on the distribution: 4194304 bytes in SuSE SLES9 and 10485760 bytes in RHEL4</p></blockquote>
<p class="docText"><a class="docLink" href="#ch04table15">Table 4-15</a> compares the Solaris pthreads APIs with the Linux NPTL APIs.</P>

<p class="docText"></p><a name="ch04table15"></a><p><table cellspacing="0" FRAME="hsides" RULES="groups" cellpadding="5"><caption><h5 class="docTableTitle">Table 4-15. Solaris pthread and Linux pthread Comparison</H5></caption><colgroup align="left" span="3"><col width="150"><col width="150"><col width="150"></colgroup><thead><TR><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Routine</P></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Solaris</P></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText">Linux</P></th></tr></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_atfork</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes<sup class="docFootnote"><a class="docLink" href="#ch04fn20">[20]</a></sup></P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_destroy</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getdetachstate</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getguardsize</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getinheritsched</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getschedparam</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getschedpolicy</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getscope</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getstack</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getstackaddr</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getstacksize</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_init</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_getaffinity_np</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setaffinity_np</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setdetachstate</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setguardsize</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setinheritsched</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setschedparam</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setschedpolicy</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setscope</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setstack</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setstackaddr</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_attr_setstacksize</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_barrierattr_destroy</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_barrierattr_getpshared</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_barrierattr_init</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_barrierattr_setpshared</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_barrier_destroy</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_barrier_init</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_barrier_wait</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cancel</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cleanup_pop</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cleanup_pop_restore_np</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cleanup_push</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cleanup_push_defer_np</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">No</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_condattr_destroy</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_condattr_getclock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_condattr_getpshared</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_condattr_init</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_condattr_setclock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_condattr_setpshared</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_broadcast</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_destroy</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_init</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_reltimedwait_np</tt></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">No</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_signal</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_timedwait</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_cond_wait</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_create</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_detach</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_equal</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_exit</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_getattr_np</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_getconcurrency</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_getschedparam</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_getspecific</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_join</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_key_create</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_key_delete</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_kill</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_kill_other_threads_np</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes<sup class="docFootnote"><a class="docLink" href="#ch04fn21">[21]</a></sup></P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_destroy</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_getprioceiling</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">No</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_getprotocol</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_getpshared</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_getrobust_np</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">No</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_gettype</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_init</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_setprioceiling</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_setprotocol</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">No</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_setpshared</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_setrobust_np</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutexattr_settype</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_consistent_np</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">No</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_destroy</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_getprioceiling</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_init</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_lock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_reltimedlock_np</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_setprioceiling</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">No</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_timedlock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_trylock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_mutex_unlock</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_once</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlockattr_destroy</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlockattr_getkind_np</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlockattr_getpshared</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlockattr_init</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlockattr_setkind_np</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">No</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlockattr_setpshared</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_destroy</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_init</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_rdlock</tt></P></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_reltimedrdlock_np</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">No</P></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_reltimedwrlock_np</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_timedrdlock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_timedwrlock</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_tryrdlock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_trywrlock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_unlock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_rwlock_wrlock</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_self</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setcancelstate</tt></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setcanceltype</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setconcurrency</tt></P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setschedparam</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setschedprio</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</P></TD></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_setspecific</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_sigmask</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_spin_destroy</tt></p></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_spin_init</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_spin_lock</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_spin_trylock</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_spin_unlock</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_testcancel</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_timedjoin_np</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>pthread_tryjoin_np</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Yes</p></td></TR></table></p><br><blockquote><p class="docFootnote"><sup><a name="ch04fn20">[20]</a></sup> In NPTL, thread handlers registered with <tt>pthread_atfork()</tt> are not run if <tt>vfork</tt> is used.</p></blockquote><blockquote><p class="docFootnote"><sup><a name="ch04fn21">[21]</a></sup> This is a nonportable LinuxThreads extension. It is no longer needed and is not available in the NPTL.</P></blockquote>
<p class="docText">Although many applications that run on the Linux 2.4 kernel will migrate to the Linux 2.6 kernel without recompilation, the addition of NPTL may require minor modifications in multithreaded applications. Instructions to migrate applications from LinuxThreads to NPTL are beyond the scope of this chapter. Additional information about migrating to use NPTL on the 2.6 kernel is available at <a class="docLink" target="_blank" href="http://linuxdevices.com/articles/AT6753699732.html">http://linuxdevices.com/articles/AT6753699732.html</a>.<a name="d0e25742"></a><a name="d0e25743"></a><a name="d0e25744"></a></P>

<a name="ch04lev2sec36"></a>
<H4 id="title-IDAJOHIO" class="docSection2Title">4.9.3. <a name="iddle1128"></a><a name="iddle2282"></a><a name="iddle2475"></a>Cancellation Points</H4>
<p class="docText">Thread cancellation allows a thread to terminate the execution of any thread in the process. A cancellation point is a certain point defined by the system at which cancellation can occur. When a thread changes the system or program state just before a cancellation point, and should restore that state before the thread is canceled, you can place a cleanup handler before the cancellation point with <tt>pthread_cleanup_push</tt>. Wherever a thread restores the changed state, you can pop the cleanup handler from the cleanup stack with <tt>pthread_cleanup_pop(3C)</tt>.<a name="d0e25782"></a><a name="d0e25783"></a><a name="d0e25784"></a></P>
<p class="docText">Both Solaris and Linux NPTL threads offer the range of cancellation points specified in IEEE POSIX 1003.1-2001 and the Single UNIX Specification.</p>

<a name="ch04lev2sec37"></a>

<h4 id="title-IDAWQHIO" class="docSection2Title">4.9.4. C++ <a name="iddle1118"></a>Exceptions and Linux Threads</h4>
<p class="docText">Searching the Internet for related topics on <a name="iddle2463"></a>C++ exceptions and POSIX threads yields a variety of opinions on how C++ should handle POSIX thread cancellations or vice versa.<a name="d0e25813"></a> The fact is that the POSIX thread programming model does not take C++ into account (it is based on C), and the C++ language standard only recently has begun to specify behavior in this area. The sample programs in <a class="docLink" href="#ch04ex02">Example 4-2</a> involve simple C++ routines mixed within POSIX threads. Compiling and running in both Solaris using the Sun Studio10 C++ compiler and SuSE 9.1 Linux with g++ version 3.3.3 yielded different results.</P>
<a name="ch04ex02"></a><H5 id="title-IDALSHIO" class="docExampleTitle">Example 4-2. Exception_1.c</H5><P><table cellspacing="0" width="90%" border="1" cellpadding="5"><TR><td>



<pre>#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

class FooClass {
    public:
    FooClass() {}
    ~FooClass() {
        pthread_cancel(pthread_self());
        pthread_testcancel();
    }
};

void* thread_func(void*) {
    try {
        FooClass cid;
        throw 1;
    }
    catch (int&amp;)
    {}

    return NULL;
}

int main() {
    pthread_t tid;

    pthread_create(&amp;tid, NULL, thread_func, NULL);
    pthread_join(tid, NULL);
    return 0;
}
</pre><BR>

<p class="docText">Compiling and running exception _1.c on <a name="iddle1763"></a><a name="iddle2464"></a>Linux yields the following:</p>
<div class="docText"><pre>$ g++ exception_1.cc -o exception_1 -lpthread -D_REENTRANT
$ ./exception_1
Aborted (core dumped)
</pre></div><br>
<p class="docText">Compiling and running exception <tt>_1.c</tt> on Solaris yields the following:</P>
<div class="docText"><pre>$ CC exception_1.cc -o exception_1 -lpthread -D_REENTRANT -g
$ ./exception_1
<span class="docEmphStrong">No core dumped</span>
</pre></div><BR>
<p class="docText">In the preceding case, the <tt><a name="iddle2045"></a>pthread_cancel</tt> within the destructor of FooClass is considered an exception<a name="d0e25878"></a>. The book <span class="docEmphasis">The C++ Programming Language</span>, 3rd Edition, by Bjarne Stroustrup (pp. 373, 378) mentions a rule about exceptions in destructorsjust don't do it! Dr. Stroustrup explains this in the following manner:</p>
<blockquote>
<p class="docText">During stack unwinding, the exception-handling mechanism exits a scope containing an object with a destructor. In this case, an exception may not escape from the destructor itself. If it does, it is considered a failure in the exception handling mechanism and std::terminate is called.</p>
</blockquote>
<p class="docText">Dr. Stroustrup offers a solution. See the following code snippet to catch the exception (but that solution did not work in our case):</p>
<div class="docText"><pre>~FooClass() {
         try {
       pthread_cancel(pthread_self());
       pthread_testcancel();
         }
    catch (&#8230;)
          {

          // do whatever
    throw;
    }
}
</pre></div><br>
<p class="docText">One solution to try and close the cancellation hole within destructors is to disable cancellation, as in the following code snippet:</P>
<div class="docText"><pre>~FooClass() {
    int oldstate;
    // Disable cancellation at entry
    pthread_setcancelstate(PTHREAD_CANCEL_DISABLE,
                       &amp;oldstate);
    pthread_cancel(pthread_self());
    pthread_testcancel();
    // Enable cancellation before exiting
    pthread_setcancelstate(PTHREAD_CANCEL_ENABLE,
                       &amp;oldstate);
}
</pre></div><br>
<p class="docText"><a class="docLink" href="#ch04ex03">Example 4-3</a> involves simple throwing of exceptions within threads.</p></td></tr></table></P>
<a name="ch04ex03"></a><H5 id="title-IDAQWHIO" class="docExampleTitle">Example 4-3. Exception_2.cc</h5><p><table cellspacing="0" width="90%" border="1" cellpadding="5"><tr><td>



<pre>#include &lt;iostream&gt;
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;pthread.h&gt;
#include &lt;unistd.h&gt;
using namespace std;

void * thread_func(void *);

int main(int argc, char *argv[]) {
  pthread_t t;
  int i;
  int status;

  try
  {
   if( pthread_create(&amp;t,NULL,thread_func,(void *)i) != 0) {
    cerr &lt;&lt; "pthread_create failed" &lt;&lt; endl;
    return 1;
   }

   pthread_join(t, NULL);
   cout &lt;&lt; "end of thread " &lt;&lt; endl;
  }
  catch(...)
  {
    cout &lt;&lt; "unexpected exception" &lt;&lt; endl;
  }
 }
void * thread_func(void *arg) {
  int i;
  for (i=0; i&lt;4; i++) {
    sleep(1);
    try {
     cout &lt;&lt; "throwing exception" &lt;&lt; endl;
     throw "exception";
    }
    catch(char *st) {
     cout &lt;&lt; "thread_func caught" &lt;&lt; st &lt;&lt; endl;
    }
   }
   return 0;
}
</pre><br>

</td></tr></table></p>
<p class="docText">Compiling and running <tt>exception_2.cc</tt> on Linux yields the following:</p>
<div class="docText"><pre>$ g++ exception_2.cc -o exception_2 -lpthread -D_REENTRANT
$ ./exception_2
throwing check
Aborted (core dumped)
</pre></div><br>
<p class="docText">Compiling and running <tt>exception_2.cc</tt> on Solaris yields the following:</p>
<div class="docText"><pre>$ CC exception_2.cc -o exception_2 -lpthread -D_REENTRANT -g
$ ./exception_2
throwing exception
Abort (core dumped)
</pre></div><br>
<p class="docText">Changing <tt>thread_func</tt> to throw an integer instead of a char * changes the behavior of the program to complete its run without aborting:<sup class="docFootnote"><a class="docLink" href="#ch04fn22">[22]</a></sup></p><blockquote><p class="docFootnote"><sup><a name="ch04fn22">[22]</a></sup> Note that the sample <tt>exception_2.cc</tt> compiled and ran fine on AIX 5.3 using xlC version 6 compiler.</P></blockquote>
<div class="docText"><pre>void * thread_func(void *arg) {
  int i;
  for (i=0; i&lt;4; i++) {
    sleep(1);
    try {
     cout &lt;&lt; "throwing exception" &lt;&lt; endl;
     throw 1;
    }
   catch(int&amp;) {
    cout &lt;&lt; "thread_func caught" &lt;&lt; endl;
   }
 }
 return 0;
}
</pre></div><br>
<p class="docText">Another change to make this work is to put a &quot;catchall&quot; catcher:</p>
<div class="docText"><pre>void * thread_func(void *arg) {
  int i;
  for (i=0; i&lt;4; i++) {
    sleep(1);
    try {
     cout &lt;&lt; "throwing exception" &lt;&lt; endl;
     throw 1;
    }
    catch(&#8230;) {
     cout &lt;&lt; "thread_func caught" &lt;&lt; endl;
     }
   }
   return 0;
}
</pre></div><br>
<p class="docText">In the case of program listing <tt>exception_2.cc</tt>, the problem seems to be that of uncaught exceptions. Again referring to <span class="docEmphasis">The C++ Programming Language</span>, 3rd Edition, by Bjarne Stroustrup (p. 381), Dr. Stroustrup explains that if an exception is thrown but not caught, the function <tt>std::terminate</tt> is called. Catching the exception prevents the core dump.<a name="d0e25994"></a><a name="d0e25995"></a><a name="d0e25996"></a></P>
<p class="docText">The preceding programs clearly show that C++ exceptions and POSIX threads do not mix well. The consensus from porting experience<sup class="docFootnote"><a class="docLink" href="#ch04fn23">[23]</a></sup> indicates that there is no well-defined standard as to how C++ needs to handle <tt>pthread_cancellations</tt> and exceptions, especially within destructors.<sup class="docFootnote"><a class="docLink" href="#ch04fn24">[24]</a></sup> The one piece of advice for porting engineers is to be aware of these differences and make sure to test error paths and cleanup handlers as thoroughly as the good path during the testing phase of the porting project.</P><blockquote><p class="docFootnote"><sup><a name="ch04fn23">[23]</a></sup> Even comments from the comp.programming.threads newsgroup</P></blockquote><blockquote><p class="docFootnote"><sup><a name="ch04fn24">[24]</a></sup> ANSI C++ does not recommend throwing exceptions in the constructor and destructor of a class whose instances may be defined globally (static-globally).</P></blockquote>


<a href="9001536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec8.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch04lev1sec10.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>