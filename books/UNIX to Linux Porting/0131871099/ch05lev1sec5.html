<html>
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<head>
<title>Section 5.5.&nbsp; Linker</title>
<link rel="STYLESHEET" type="text/css" href="images/style.css">
<link rel="STYLESHEET" type="text/css" href="images/docsafari.css">
</head>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec4.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec6.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
<br><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><TD valign="top"><a href="9001536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a><a name="ch05lev1sec5"></a>
<H3 id="title-IDAXIKWR" class="docSection1Title">5.5. <a name="iddle1034"></a>Linker</H3>
<p class="docText">Like UNIX, AIX and Linux provide facilities for the creation, development, testing, and debugging of shared libraries and applications that use them. AIX linker utilizes the eXtensible Common Object File Format (XCOFF), and Linux utilizes the <a name="iddle1325"></a>Executable and Linkable Format (ELF)<a name="d0e38420"></a>. Early versions of Linux used a version of the old &quot;a.out&quot; format, but that format had many limitations that <a name="iddle1261"></a>ELF corrects<a name="d0e38427"></a>. ELF has become the most popular binary file format for UNIX and related operating systems such as Linux.<a name="d0e38429"></a></P>
<p class="docText">On both platforms, the default name for an XCOFF and ELF executable file is a.out.</P>
<a name="ch05lev2sec12"></a>

<h4 id="title-IDAYKKWR" class="docSection2Title">5.5.1. Linker <a name="iddle1036"></a>Incompatibilities</h4>
<p class="docText">Although both AIX and Linux view &quot;static linking&quot; as the technique of defining multiple object files defining global symbols, and containing code and data, which are combined and written to an executable file with all references defined, they have different views on how the linker handles libraries in general. The linker and loader on AIX are designed such that libraries are self-contained entities with well-defined interfaces consisting of sets of imported and exported symbols. The system loader looks up symbols to relocate references, but all symbol resolution is performed at link time, simplifying the work of the loader. Shared objects in AIX are considered fully linked and resolved entities, where symbol references are resolved at link time and cannot be rebound at load time. On the other hand, Linux utilizes a version of linking, whereas it sees libraries as being very similar to ordinary ELF files where resolution of all global symbols is performed at runtime by the loader. In Linux, a dynamically linked file contains a <a name="iddle2031"></a>Procedure Linkage Table (PLT)<a name="d0e38458"></a>. This table contains all the linker information that the runtime linker needs to relocate files and resolve any undefined symbols. The segment within the <a name="iddle1939"></a>PLT that the loader examines when it loads a dynamically linked file is the <tt>DYNAMIC</tt> section<a name="d0e38468"></a>. The <tt>DYNAMIC</tt> section contains the tagged values and pointers that the loader needs to locate symbols.</p>
<p class="docText">A shared module in AIX can be an object file or an archive file member, which can contain shared modules and/or ordinary object files. In Linux, shared libraries are always ordinary ELF object files, created with special options. Because of these differences, on the AIX platform GNU utilizes the native AIX linker rather than the GNU linker to link GNU executables.</P>
<p class="docText">In AIX to enable runtime linking (RTL), you must specify the <tt>brtl</tt> parameter on the link line when building shared objects. The equivalent parameter in Linux is the <tt>shared</tt> parameter. Both simply tell the loader to defer resolution of certain identified symbols until runtime. On AIX, when used with <tt>bdynamic, brtl</tt> also changes the search behavior for libraries on the link line. When both switches are turned on in AIX, the <tt>l</tt> parameter tells the linker to search for libraries with .so and .a extensions (that is, shared objects and archives with precedence on .so). This is why archives can contain shared objects as members in AIX. In Linux, the <tt>ld</tt> command utilizes the standard UNIX behavior for searching for libraries, and the <tt>l</tt> parameter only searches for archives (.a). For example, in Linux the following <tt>ld</tt> command searches for a <tt>libout.a</tt> library:</P>
<div class="docText"><pre>ld o output <span class="docEmphStrong">lout</span> L/usr/libs
</pre></div><BR>
<p class="docText">The following command builds an RTL shared object in Linux:<a name="d0e38516"></a></P>
<div class="docText"><pre>ld <span class="docEmphStrong">shared</span> o libshobj.so <span class="docEmphStrong">lout</span> L/usr/libs
</pre></div><BR>
<p class="docText">Additionally, Linux and AIX handle symbol resolution differently. In AIX, when the linker is resolving symbols, it grabs all the code available from the archive whether it needs it or not. In Linux, the linker only grabs what it needs. The downside is in Linux you may have to list archives on the command line more than once (unlike with AIX, in which you only need to list them once). This forces the Linux linker to search the archive more than once for additional symbols found in subsequent object files that are listed further down the link line.</p>
<p class="docText">As you can see, if you are accustomed to the AIX linker and loader mechanism for building archives and shared objects, you will have to make a few changes in your build environment before building on the Linux platform. Additional differences that AIX users need to be mindful of when porting to Linux include the following:</P>
<ul><li><p class="docList">In AIX, because archives can contain shared modules and vice versa, for archives that contain both shared objects and regular archives, the shared objects have to be separated from the link line (<tt>ld</tt> command) and built as separate linkable shared objects with .so extensions. The same goes for .o (object) files that contain shared objects.</P></LI><li><p class="docList">Shared objects that are passed to the Linux linker via the <tt>l</tt> parameter have to be moved further down the link line (<tt>ld</tt> command) after the object file listing with the fully named shared library specified (for example, <tt>libshobj.so</tt>).</p></li><li><p class="docList">To resolve symbols, archives may have to be listed more than once on the link line down level from triggering modules.</P></li></ul>

<a name="ch05lev2sec13"></a>
<h4 id="title-IDAOPKWR" class="docSection2Title">5.5.2. <a name="iddle1035"></a>Linker: AIX to Linux Reference</h4>
<p class="docText">Although GNU linker (<tt>ld</tt>) has a plethora of parameters, when porting from AIX you only have to concern yourself with a few. <a class="docLink" href="#ch05table04">Table 5-4</a> highlights some subtle differences in the most commonly used parameters that are somewhat necessary, depending on your target, when porting to Linux from AIX.</P>

<p class="docText"></P><a name="ch05table04"></a><p><table cellspacing="0" FRAME="hsides" RULES="groups" cellpadding="5"><caption><h5 class="docTableTitle">Table 5-4. AIX and Linux Linker Switches Comparison Table<sup class="docFootnote"><a class="docLink" href="#ch05fn001">[*]</a></sup></h5></caption><colgroup align="left" span="3"><col width="100"><col width="150"><col width="250"></colgroup><thead><tr><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText"><span class="docEmphStrong">AIX</span></p></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Linux</span></p></th><th class="bottomBorder thead" scope="col" align="left" valign="top"><p class="docText"><span class="docEmphStrong">Description</span></p></th></tr></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-bexpall</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-E --export-dynamic</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">When creating a dynamically linked executable, adds all symbols to the dynamic symbol table.</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>-bmaxdata:&lt;</tt><span class="docEmphasis"><tt>size</tt></span><tt>&gt;</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-G</tt><span class="docEmphasis"><tt>value</tt></span> <tt>--gpsize=</tt><span class="docEmphasis"><tt>value</tt></span></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Sets the maximum size of objects to be optimized using the GP register to <span class="docEmphasis"><tt>size</tt></span>. This is only meaningful for object file formats such as MIPS ECOFF that support putting large and small objects into different sections. This is ignored for other object file formats.</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-e</tt><span class="docEmphasis"><tt>Label</tt></span></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-e</tt><span class="docEmphasis"><tt>enTRy</tt></span> <tt>--enTRy=</tt><span class="docEmphasis"><tt>entry</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Uses <span class="docEmphasis"><tt>enTRy</tt></span> as the explicit symbol for beginning execution of your program, rather than the default entry point.</p></td></tr><tr><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>-bdynamic</tt> or <tt>bshared</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-Bdynamic -dy -call_shared</tt> or <tt>-Wl brt -shared</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Links against dynamic libraries. The different variants of this option are for compatibility with various systems. You may use this option multiple times on the command line: It affects library searching for <tt>-l</tt> options that follow it.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-bM:SRE</tt> or <tt>brtl</tt> or <tt>G</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-shared -Bshareable</tt></p></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Creates a shared library that is reentrant (runtime linkable).</p></td></TR><TR><TD class="docTableCell" align="left" valign="top"><p class="docText"><tt>-l</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-l</tt><span class="docEmphasis"><tt>archive</tt></span></p></td><TD class="docTableCell" align="left" valign="top"><p class="docText">Adds archive file <tt>lib</tt><span class="docEmphasis"><tt>archive</tt></span><tt>.a</tt> to the list of files to link. This option may be used any number of times. This option also searches for shared objects (.so) for other platforms; however, when running on a Linux platform, only archives are searched.</P></TD></TR><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-Z</tt></P></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-Y</tt></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Specifies a search path for library names.</p></td></tr><TR><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-L</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-rpath</tt> <span class="docEmphasis"><tt>path</tt></span></P></TD><td class="docTableCell" align="left" valign="top"><p class="docText">Specifies the library search direction for the runtime linker.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-L</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><tt>-L</tt></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Searches the specified directory for library files specified by the <tt>-l</tt> option.</p></td></TR></table></p><br><blockquote><p class="docFootnote"><sup><a name="ch05fn001">[*]</a></sup> Caution is advised when using the equivalent Linux solutions presented. The list is presented only as a reference and not as officially recommended solutions. Please investigate the viability of the solutions before planning to implement them in your applications.</p></blockquote>
<p class="docText">The GNU linker (<tt>ld</tt>) is meant to cover a broad range of situations and to be as compatible as possible with other linkers. As a result, you have many other choices to control its behavior. But if you want your application to remain portable, you can use the GNU libtool for building libraries for Linux. GNU libtool is a generic library support script that hides the complexity of using libraries (for example, creating and installing shared and archived libraries) behind a consistent, portable interface. On Linux, GNU libtool is built on top of the tools and conventions for using the standard GNU Library (<tt>glib</tt>). Refer to the GNU libtool online for additional options and its usage.<a name="d0e38863"></a><a name="d0e38864"></a></P>


<a href="9001536.html"><img src="images/pixel.jpg" alt="" width="1" height="1" border="0"></a></TD></TR></table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec4.html><img src="images/prev.gif" width="60" height="17" border="0" align="absmiddle" alt="Previous Page"></a>
<td align="right"><div STYLE="MARGIN-LEFT: 0.15in;">
<a href=ch05lev1sec6.html><img src="images/next.gif" width="60" height="17" border="0" align="absmiddle" alt="Next Page"></a>
</div></td></tr></table>
</body></html>